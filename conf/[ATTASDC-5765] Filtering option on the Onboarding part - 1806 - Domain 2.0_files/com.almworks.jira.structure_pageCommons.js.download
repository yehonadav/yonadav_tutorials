;
/* module-key = 'com.almworks.jira.structure:pageCommons', location = 'js/structure/page-commons.js' */
ï»¿define("structure/page/PageSettingsDialog",["underscore","almworks/util/Util","almworks/util/Cell"],function(e,b,c){function h(a){this._options=a;this._$={};this._init()}var k=window.AJS,f=function(a){a&&a.stopPropagation()};b.extend(h.prototype,{_init:function(){var a=this._options.trigger;a&&(this._ajsDialog=k.InlineDialog(a,"structure-uioptions",e.bind(this._showDialog,this),{hideDelay:2E4,width:460,offsetX: -360,useLiveEvents: !0,closeOnTriggerClick: !0}))},_showDialog:function(a,b,c){this._contentInitialized||(this._buildContent(a),this._contentInitialized= !0);c()},_buildContent:b.pvc,_commonDialogInit:function(){var a=this._$["#s-uid-defaultname"];a&&(new c(this._options.configuration,function(a){return(a=(a=a&&a.defaultStructure)&&a.name)&&b.abbreviateLabel(a)||""})).pipe(function(b){a.text(b)});var e=this._$.working;this._options.uploading&&e&&this._options.uploading.pipeBottlenecked(500,function(a){e.css("visibility",a?"visible":"hidden")});this._$.dialog.click(f).mouseout(f);var g=this._ajsDialog;this._$.close.click(function(){g.hide()})}});return h});define("structure/page/PageWidgetConfig",
"almworks/jquery underscore almworks/util/Cell almworks/util/Objects almworks/util/JSON almworks/util/Util structure/widget/util/NavigationHint".split(" "),function(e,b,c,h,k,f,a){function m(a){this._options=a;this._contextParams=b.object(b.compact(b.map(p,function(d){return a[d]&&[d,a[d]]})));this._configuration=new c(null);this._settings=new c(null);this._uploading=new c(0);this._uploadingState=new c(this._uploading,function(a){return 0<a});this._initialNavigationHint=null;this._init()}var g=namespace("almworks.structure"),n={autoSwitch:"off",autoCollapse: !0,keepStructureWhenNavigating: !0},l=b.keys(n),p=["forIssue","forProject","forAgileBoard"];h.extend(m.prototype,{_init:function(){var a=this;a._configuration.pipeChanges(function(d){if(d){a._updatingSettings= !0;try{var c=b.object(l,b.map(l,function(a){return d&&void 0!==d[a]?d[a]:n[a]}));a._settings.setValue(c)}finally{a._updatingSettings= !1}}});a._settings.pipeChanges(function(d,b){if(!a._updatingSettings&&d&&b){var c={};l.forEach(function(a){d[a]!==b[a]&&(c[a]=d[a])});a._uploadSettings(c)}});a._downloadSettings()},_uploadSettings:function(b){var d=this;d._uploading.setValue(d._uploading.value()+1);f.extend(b,
d._contextParams);b.forIssue&&a.restoreNavigationHint(d._initialNavigationHint);var c= !1;g.ajax.doAjax({url:g.ajsbridge.localURL(g.ajax.RESOURCES.CONFIG_UI_SETTINGS),dataType:"json",type:"POST",contentType:"application/json; charset=UTF-8",data:k.stringify(b),success:function(a){c= !0;1===d._uploading.value()&&d._configuration.setValue(a)},complete:function(){b.forIssue&&a.clearNavigationHint();c||f.warn("problem uploading user settings");d._uploading.setValue(d._uploading.value()-1)}})},_downloadSettings:function(){var b=this,d=g.ajsbridge.localURL(g.ajax.RESOURCES.CONFIG_UI_SETTINGS),c=f.extend({},b._contextParams);b._options.preferredStructure&&(c.preferredStructure=b._options.preferredStructure);var e= !1;g.ajax.doAjax({url:d+f.buildUrlParameters(c),dataType:"json",success:function(a){e= !0;a&&b._configuration.setValue(a)},complete:function(){e||f.warn("problem loading UI configuration");c.forIssue&&(b._initialNavigationHint=a.clearNavigationHint())}})},getSettingsCell:function(){return this._settings},getConfigCell:function(){return this._configuration},getUploadingCell:function(){return this._uploadingState}});return m});define("structure/page/PageDecoration",[],function(){
return{connectWidgetAndInitialStructure:function(e,b){e.field("initialStructure.id").pipe(function(c){c&&b.setPrimaryStructure(c)})},connectWidgetAndSingleStructureMode:function(e,b){e.field("singleStructure").pipe(function(c){b.setSingleStructureMode(! !c)})}}}); ;