;
/* module-key = 'com.almworks.jira.structure:widget-bare', location = 'js/structure/structure-widget.js' */
ï»¿define("structure/api/GeneratorDescriptor",[],function(){return namespace("almworks.structure.api").baseClass("GeneratorDescriptor",{init:function(f){f&&(this.moduleKey=f.moduleKey)},suggestLabel:function(f){return null}})});define("structure/api/AttributeDescriptor",["almworks/util/Objects"],function(f){var b=namespace("almworks.structure.api").baseClass("AttributeDescriptor",{init:function(b){b&&(b.id&&(this.id=""+b.id),b.label&&(this.label=""+b.label),b.formats&&(this.formats=b.formats,"*"!==this.formats&&Object.freeze(this.formats)))},getAttributeID:function(){if(this.id)return this.id;throw Error("invalid descriptor, ID is not defined");},getLabel:function(){if(this.label)return this.label;throw Error("invalid descriptor, no label");},suggestLabel:function(b){return this.getLabel()},createOptions:function(b){return[]},getDefaultSpec:function(){return{id:this.getAttributeID()}},isConfigurable:function(){return!1},isParamsValid:function(b){return!0},getSupportedFormats:function(){return this.formats?this.formats:"*"},isFormatSupported:function(b){var d=this.getSupportedFormats();return "*"===d? !0:0<=d.indexOf(b)},isFormatSupportedBySpec:function(b,d){
return this.isFormatSupported(d)},getPrimaryFormat:function(b){b=null;this.formats&&this.formats.length&&(b=this.formats[0]);return b||null}});b.Formats={ALL:"*",BASIC:["html"],NUMERIC:["number"]};f.deepFreeze(b.Formats);return b});define("structure/api/SpecOption","almworks/util/Functions almworks/util/MiscUtils almworks/util/Template almworks/util/Cell almworks/util/CellPresenter almworks/util/JSON structure/widget/ui/UIUtil almworks/util/Util almworks/util/Log structure/widget/attributes/Attributes underscore jquery almworks/jquery structure/widget/ui/attribute/AttributeEditor structure/widget/jira/Fields".split(" "),function(f,b,g,d,e,a,n,c,p,m,k,r,l,h,u){r=namespace("almworks.structure.api");var s=namespace("almworks.structure.ajsbridge"),q=new g('<div class="field-group {klass}"></div>');c=r.baseClass("SpecOption",{init:function(a){if(a){a.configurator&&(this.configurator=a.configurator);if(a.context||this.configurator)this.context=a.context||this.configurator.getContext&&this.configurator.getContext()||{};if(a.spec||this.configurator)this.spec=a.spec||this.configurator.shareSpec&&this.configurator.shareSpec()||{};void 0!==a.title&&(this.title=a.title||"");a.getValue&&(
this.getValue=a.getValue);a.setValue&&(this.setValue=a.setValue);void 0!==a.param&&(this.param=a.param);void 0!==a.defaultValue&&(this.defaultValue=a.defaultValue)}},title:"",createLabel:function(a){l("<label></label>").text(this.title||"").appendTo(a)},createInput:function(a){},createRow:function(){this.div$=q.render$({klass:this.fieldGroupClass()});this.createLabel(this.div$);this.createInput(this.div$);return this.div$},fieldGroupClass:c.returnConst(""),notify:f.returnTrue,isInputValid:f.returnTrue,getValue:function(){if(!this.spec)throw Error("no spec");if(!this.param)throw Error("no param");var a=this.spec.params,a=a&&a[this.param];return void 0===a||null===a?this.defaultValue:a},setValue:function(a){if(!this.spec)throw Error("no spec");if(!this.param)throw Error("no param");var b=this.spec.params;a===this.defaultValue?b&&(delete b[this.param],k.isEmpty(b)&&delete this.spec.params):(b||(this.spec.params=b={}),b[this.param]=a);this.div$&&this.div$.trigger("notify")}});var x=r.subClass("SelectOption",c,{init:function(a){this.select$=null;if(!this.options.options)throw Error("no options");if(!k.isFunction(this.options.getValue))throw Error("no getter");if(!k.isFunction(
this.options.setValue))throw Error("no setter");this.options.getValue=k.bind(a.getValue,this);this.options.setValue=k.bind(a.setValue,this);this.selectTemplate=new g('<select class="select"></select>');this.optionTemplate=new g('<option value="{value}">{name}</option>');this.valueCell=new d},createInput:function(a){var h=this,c=this.options.options;k.isFunction(c)&&(c=c.call(this,a));this.select$=this.selectTemplate.render$();c=b.whenAll(c);n.displayPromise(c,this.select$).done(function(b){var c=k.chain(arguments).flatten().filter(function(a){return!(void 0===a.value|| !a.name)}).map(k.bind(h.optionTemplate.renderHtml,h.optionTemplate)).value().join("");h.select$.html(c);h.select$.appendTo(a);(c=h.options.getValue())&&h.valueCell.setValue(c);h.valueCell.pipeChanges(function(a){a&&(h.options.setValue(a),h.select$.trigger("notify"))});var e=s.createAjsSingleSelect(h.select$);(new s.SingleSelectPresenter(h.valueCell)).setView(e,!c)})},notify:function(){this.select$.val(this.options.getValue());return!0},isInputValid:function(){return! !this.valueCell.value()}}),t=new g('<textarea class="textarea long-field s-attribute-editor"></textarea>'),w=r.subClass("AttributeOption",c,{init:
function(a){if(!this.options.getValue)throw Error("no getter");if(!this.options.setValue)throw Error("no setter");this.textarea$=null;this.valueCell=new d},createInput:function(b){var h=this;h.textarea$=t.render$();h.textarea$.text(a.stringify(h.options.getValue())||"{}");h.textarea$.appendTo(b);new e.TextPresenter(h.valueCell,h.textarea$,!0);h.valueCell.pipeChanges(function(b){(b=a.safeParse(b))&&b.id&&(h.options.setValue(b),h.textarea$.trigger("notify"))})},notify:function(b){this.attributeEditor?"close"===b&&this.attributeEditor.updateRecents():this.attributeEditor=new h(this.textarea$,{expectedFormat:this.options.expectedFormat||"",presetFilter:this.options.presetFilter,usePrimaryFormat:this.options.usePrimaryFormat,context:this.context});this.textarea$.text(a.stringify(this.options.getValue()));return!0},isInputValid:function(){return! !a.safeParse(this.valueCell.value())}}),v=r.subClass("CheckboxOption",c,{init:function(a){this.checkbox$=null;this.template=a.template||new g('<div><label><input type="checkbox" class="checkbox">&nbsp;<span>{label}</span></label></div>');this.valueCell=(new d(this.getValue())).pipeChanges(k.bind(this.setValue,this))},createLabel:f.noop,
createInput:function(a){this.checkbox$=this.template.render$({label:this.title||""});this.input$=this.checkbox$.find("input");a.append(this.checkbox$);(new e.CheckboxPresenter(this.valueCell)).setView(this.input$)},notify:function(){this.valueCell.setValue(this.getValue());return!0},isInputValid:function(){return!0}}),C=r.subClass("AggregateOption",c,{getSpec:function(a){if(a===m.DISPLAYED||a===m.UNFILTERED)return a;null!==a&&void 0!==a&&p.warn("Illegal value for forestSpec: "+a);return m.DISPLAYED},init:function(a){a=this.options;var b=this.spec.params,h=this;a.getValue||(a.getValue=function(){return b});a.setValue||(a.setValue=function(a){null==a?(delete b.aggregate,delete b.forestSpec,delete b.distinct):(b.aggregate="sum",b.forestSpec=h.getSpec(a.forestSpec),b.distinct= ! !a.distinct)});a.isApplicable||(a.isApplicable=function(){var a=b.field,a=a&&h.context.jira.getIssueFieldById(a)||{id:a};return u.isSummableField(a)});this.inputs=null;var c=new d,e=new d,q=new d,l=new d(c,f.not);this.cells={sum:c,filter:e,distinct:q,hideFilterDistinct:l};this.updateCells();this.cells.state=(new d(c,e,q,function(a,b,h){var c=null;a&&(c={forestSpec:b?m.DISPLAYED:m.UNFILTERED,distinct:h});
return c})).pipeChanges(function(b){a.setValue(b)})},createInput:function(a){function b(a){return(new g('<div class="checkbox"><label><input type="checkbox">'+a+"</label></div>")).render$()}var h=this.cells,c=b("{sw.column.opt.aggr.sum.title}"),q=b("{sw.column.opt.aggr.sum.filtering}"),d=b("{sw.column.opt.aggr.sum.distinct}"),l={sum$:c.find("input"),filter$:q.find("input"),distinct$:d.find("input")};this.inputs=l;a.append(c,d,q);(new e.CheckboxPresenter(h.sum)).setView(l.sum$);(new e.CheckboxPresenter(h.filter)).setView(l.filter$);(new e.CheckboxPresenter(h.distinct)).setView(l.distinct$);h.state.pipe(function(){a.trigger("notify")});h.hideFilterDistinct.pipe(function(a){q.toggle(!a);d.toggle(!a)})},updateCells:function(){var a=this.options.getValue();d.prototype.multiUpdate(!0);try{a&&"sum"===a.aggregate?(this.cells.sum.setValue(!0),this.cells.filter.setValue(m.isDisplayed(a.forestSpec)),this.cells.distinct.setValue(a.distinct)):this.cells.sum.setValue(!1)}finally{d.prototype.multiUpdate(!1)}},notify:function(){if(this.options.isApplicable())return this.updateCells(),!0;var a=this.spec.params;this.inputs.sum$&&this.inputs.sum$.prop("checked",!1);this.inputs.filter$&&
this.inputs.filter$.prop("checked",!1);this.inputs.distinct$&&this.inputs.distinct$.prop("checked",!1);delete a.aggregate;delete a.forestSpec;delete a.distinct;return!1}});r=r.subClass("TextOption",c,{init:function(a){this.input$=null;this.template=a.template||new g('<input type="text" class="text">');this.valueCell=(new d(this.getValue())).pipeChanges(k.bind(this.setValue,this))},createInput:function(a){this.section$=this.template.render$();this.input$=this.section$.is("input")?this.section$:this.section$.find("input:first");a.append(this.section$);(new e.TextPresenter(this.valueCell)).setView(this.input$)},notify:function(){this.valueCell.setValue(this.getValue());return!0},isInputValid:function(){return!0}});c.Select=x;c.Attribute=w;c.Checkbox=v;c.Aggregate=C;c.Text=r;return c});define("structure/api/Column",["almworks/jquery","almworks/util/Util","almworks/util/JSON","almworks/util/Template"],function(f,b,g,d){namespace("almworks.structure.columns");f=namespace("almworks.structure.api");var e=new d('<div class="celldiv"><div class="grad"></div><span class="value">{name}</span></div>'),a={};return f.baseClass("Column",{init:function(a){b.assert(a.spec);this.spec=a.spec;
a.context&&(this.context=a.context);this.csid=this.spec.csid||a.csid;if(!this.csid)throw Error("cannot create column without csid");this.spec.name&&(this.name=b.renderTemplate(this.spec.name,{column:this}))},getColumnSpec:function(){return this.spec},getCsid:function(){return this.csid},getColumnKey:function(){return this.spec.key},isColumnOfType:function(a){return this.getColumnKey()===a},getName:function(){return this.name||this.getDefaultName()||""},getDefaultName:function(){return ""},isUniversal:b.returnFalse,isStructureDependent:b.returnFalse,isResizable:b.returnTrue,canShrinkWhenNoSpace:b.returnFalse,isAutoSizeAllowed:b.returnFalse,getWidth:function(){return this._width},setWidth:function(a){"number"===typeof a?this._width=Math.max(b.toIntSafe(a),this.getMinWidth()):a||(this._width=void 0)},getMinWidth:b.returnConst(27),getDefaultWidth:b.returnConst(120),renderHeader:function(a){this.safeSetHtml(a,this.getHeaderCellHtml())},getHeaderCellHtml:function(){var a=this.getName();return a?e.renderHtml({name:a}):""},render:function(a){this.renderCellView(a)},renderCellView:function(a){var b=this.getCellViewHtml(a);b!==a._cell$.html()&&this.safeSetHtml(a._cell$,b);
this.updateRowClasses(a)},updateRowClasses:function(a){},getCellViewHtml:function(a){return '<div class="celldiv"><div class="grad"></div><span class="value">'+this.getCellValueHtml(a)+"</span></div>"},getCellValueHtml:function(a){return ""},safeSetHtml:function(e,c){if(e&&e.length)try{e.html(c)}catch(d){var f=this.name||"?";if(!a[f]){a[f]= !0;var f=this.name||"?",k="problem rendering column "+f;try{k+=" ("+g.stringify(this.spec)+")"}catch(r){}k+=": "+d;k+="\n***********************\nStructure Plugin caught a JavaScript exception when trying to display a value in column ["+f+"].\nThis problem could be caused by errors or incompatibility in other JIRA plugins.\nPlease contact ALM Works support with the information about this problem and the plugins in use.\n***********************\nCell HTML:\n"+c+"\n***********************";if(d)try{var l=b.getStackTrace(d).join("\n");!l&&d.stack&&(l=""+d.stack);l&&(k+="\nError:\n"+l+"\n***********************")}catch(h){}b.warn(k)}}},collectRequiredAttributes:function(a){},getSortAttribute:function(){return null},getSortTransform:function(){var a=this.getSortAttribute();return a?{module:"com.almworks.jira.structure:sorter-attribute",params:{
attribute:a}}:null},isSortDescendingByDefault:function(){return!1},shouldFlash:function(a){var b= !1;this.collectRequiredAttributes({requireAttribute:function(e,d){!b&&e&&a.isAttributeFlashed(e,d)&&(b= !0)}});return b},getMetadataRequests:function(){return null},getSuggestedAttributeSpecs:function(){return null}})});define("structure/api/ColumnConfigurator",["almworks/util/Classes","almworks/util/Util"],function(f,b){return f.baseClass("ColumnConfigurator",{init:function(f){b.assert(f.spec);this.spec=f.spec;f.context&&(this.context=f.context);var d=this;["presetName","description","groupKey"].forEach(function(b){d.spec[b]&&(d[b]=d.spec[b],delete d.spec[b])})},getContext:function(){return this.context},shareSpec:function(){return this.spec},getPresetName:function(){return this.presetName||this.getColumnName()},getColumnName:function(){return this.spec.name||this.getDefaultColumnName()||this.getColumnTypeName()},getDescription:function(){return this.description||""},getDefaultColumnName:b.returnConst(""),getColumnTypeName:b.returnConst(""),getGroupKey:function(){return this.groupKey|| !1},getOptions:b.returnFalse,isConfigured:b.returnTrue,getColumnSpec:function(){return this.spec},
getMetadataRequests:function(){return null},isConfigurationPanelWide:b.returnFalse})});define("structure/api/ColumnType",["almworks/util/Classes","almworks/util/Util","structure/api/Column"],function(f,b,g){var d=[],e={},a=f.baseClass("ColumnType",{createSwitchTypePreset:function(a){return null},createAddColumnPresets:function(a){return[]},createConfigurator:function(a,b){return null},createColumn:function(a,b){return null},getMetadataRequests:function(){return null},getPresetMetadataRequests:function(){return null},getColumnMetadataRequests:function(){return null},getConfigMetadataRequests:function(){return null}}),n=f.subClass("SimpleColumnType",a,{init:function(a){this.columnClass=a.columnClass;this.columnKeys=a.columnKeys},createColumn:function(a,e){return e&&e.key&&0<=b.indexOf(this.columnKeys,e.key)?new this.columnClass({context:a,spec:e}):null}});a.register=function(c,p){"string"===typeof p&&(p=[p]);if(!p|| !b.isArray(p)|| !p.length)throw Error("expected a non-empty array of column keys, but got "+c);f.isSubClass(g,c)&&(c=new n({columnClass:c,columnKeys:b.addAll([],p)}));if(!c|| !f.isInstance(a,c))throw Error("expected subclass of ColumnType, but got "+c);d.push(c);for(
var m=0,k=p.length;m<k;m++)e[p[m]]=c};a.getAllColumnTypes=function(){return b.addAll([],d)};a.getColumnTypeForKey=function(a){return e[a]};return a});define("structure/api/ColumnGroup",["almworks/util/Classes"],function(f){var b=[],g=f.baseClass("ColumnGroup",{init:function(){if("string"!==typeof this.getGroupKey())throw Error("no valid groupKey");if(!this.getTitle())throw Error("no title");if("number"!==typeof this.getOrder())throw Error("bad order type");},getGroupKey:function(){return this.options.groupKey},getTitle:function(){return this.options.title},getOrder:function(){return this.options.order||0}});g.getGroups=function(){return b.slice()};g.register=function(d){if(!d||"object"!==typeof d)throw Error("bad options object");b.push(new g(d))};return g});define("structure/api/StructureCoreExtensionRegistry",["underscore","almworks/util/Util"],function(f,b){var g={};return{registerCoreExtension:function(b){b&&b.key&&b.extension&&(g[b.key]=b.extension)},getExtensionRequests:function(){var d={};f.each(f.keys(g),function(e){try{var a=g[e].getExtensionRequest();a&&(d[e]=a)}catch(f){b.error("Cannot get extension request for "+e+". "+f)}});return d},isPollBlocked:function(){
return f.values(g).some(function(b){return b.isBlockingPoll()})}}});define("structure/api/SecondaryPanelRegistry",["underscore","almworks/util/Util"],function(f,b){function g(a,b){0>a.visitedListeners.indexOf(b)&&(b(a.layoutName,a.descriptor),a.visitedListeners.push(b))}function d(b){var c=e[b];a.forEach(function(a){g(c,a)})}var e={},a=[];return{onRegisterPanel:function(b){for(var c in e)g(e[c],b);a.push(b)},registerSecondaryPanel:function(a,c){var f=require("structure/widget/widget");f&&f.onWidgetReady(function(f){b.assert(!e[a],"panel already registered:",a);c.panel$.appendTo(f.div$);e[a]={layoutName:a,descriptor:c,visitedListeners:[]};d(a)})},getPanelDescriptors:function(){return f.pluck(e,"descriptor")}}});define("structure/widget/ui/Tooltip",["jquery","underscore","almworks/util/Util"],function(f,b,g){function d(a){"string"===typeof a&&(a=f(a));a.each(function(){var a=f(this);a.data("s-tooltip-initialized")||(a.data("s-tooltip-initialized",!0),f(".s-tooltip,[data-tooltip],[original-title]",this).tooltip(l))});h||(h= !0,f(document).click(function(a){f(a&&a.target).closest(".s-tooltip-box").length||c(null)}));return! !a.length}function e(a){var b=a.data("s-tooltip-data");b||(b={
},a.data("s-tooltip-data",b));return b}function a(a,h){return a&&b.isFunction(a)?g.safeCall(a,h[0]):a}function n(h){if(!k(h))return h.attr("title")||h.attr("original-title");var c=e(h);b.each(r,function(a,b){h.hasClass(b)&&g.extend(c,a)});b.has(c,"html")||(c.html= !0);var l=a(c.title,h);"string"!==typeof l&&(l=h.data("tooltip"));var d=h.attr("title");"string"===typeof d&&(h.removeAttr("title"),d&& !l&&(l=d,h.attr("data-tooltip",d)));l=l||h.attr("original-title")||"";a(c.html,h)||(l=g.htmlEscape(l));return l}function c(a){var b=a&&a.data("tipsy");f("body").children(".s-tooltip-box").each(function(){var a=f(this).data("s-tooltip-data");a&&a.tipsy!==b&&a.tipsy.hide()})}function p(a){var h=a.tip$;if(2===a.gravity.length){var c=a.trigger$,c=c.offset().left+c.outerWidth()/2,e=h.outerWidth(),l;l=h.find(".s-tooltip-align");l=l.length?l.offset().left-h.offset().left+l.width()/2:16;l=Math.min(l,e/4);if("ne"===a.gravity||"se"===a.gravity)l=e-l;h.css({left:Math.round(c-l)});h.find(".tipsy-arrow").css({left:Math.round(l)})}h.css("visibility","");a.interval=window.setInterval(b.bind(m,a),300)}function m(){var a= !1,b=this.trigger$,h=this.tip$;if(g.onPage(h)&&g.onPage(b)&&h.is(":visible"))if(
b.is(":visible")){if(h=b.offset(),b=h.top-f(document).scrollTop(),h=h.left-f(document).scrollLeft(),h=Math.round(h-this.left),b=Math.round(b-this.top),Math.abs(h)>u||Math.abs(b)>u)this.tipsy.hide(),a= !0}else this.tipsy.hide(),a= !0;else a= !0;a&&(window.clearInterval(this.interval),this.interval=0)}function k(a){return(a=a&&a.length?f(a[0]).data("tipsy"):null)&&a.enabled}var r={"jira-issue-status-lozenge":{className:"jira-issue-status-tooltip",title:function(){return ""}}},l={live: !0,html: !0,title:function(){try{var a=f(this),b=a.data("s-tooltip-data");if(b&&b.tip$&&g.onPage(b.tip$)&&b.tip$.is(":visible"))return "";c(a);return n(a)}catch(h){return g.warn("error managing tipsy tooltip",h),""}},className:function(){var h=f(this),c=b.chain(g.getClasses(h)),c=["s-tooltip-box","s-tooltip-box-heavy"].concat(c.map(function(a){return(a=g.tail(a,"s-tooltip-"))?"s-tooltip-box-"+a:null}).compact().value()).join(" ");(h=a(e(h).className,h))&&(c+=" "+h);return c},fade: !1,delayIn:500,delayOut:1E3,gravity:function(){var a=f(this),h=a.data("tipsy");if(!h)return g.warn("cannot find tipsy"),"nw";var c=e(a);try{var l=h.tip(),d=a.offset();g.extend(c,{top:d.top-f(document).scrollTop(),left:d.left-
f(document).scrollLeft(),trigger$:a,tip$:l,tipsy:h,heavy: !0});l.data("s-tooltip-data",c);var h="n",k=f(window).height(),m=a.outerHeight()+l.outerHeight()+8;c.top+m>k&&c.top>k/2&&(h="s");var u=c.heavy?"w":"",n=f(window).width(),r=l.outerWidth(),D=a.outerWidth();c.left+(D/2+("w"===u?r:r/2)+8)>n&&c.left>n/2&&(u="e");""===u&&0>c.left+D/2-r/2-8&&(u="w");c.gravity=h+u;b.defer(p,c);l.css("visibility","hidden");return c.gravity}catch(G){return g.warn("error doing tipsy magic",G),"nw"}},hideOnClick: !0},h= !1,u=8;return{initialize:function(a){a?d(a):f(function(){var a=namespace("almworks.structure");a.modes.PCV_PAGE?d("#structure-board"):a.modes.GH_TAB?d("#ghx-tab-com-almworks-jira-structure-greenhopper-tab"):a.modes.ISSUE_PAGE?d("#structuremodule"):d(".structureBorder,#s-board-toolbar")})},options:function(a,b){a&&a.length&&b&&g.extend(e(f(a[0])),b)},toggle:function(a,b){if(a&&a.length){b?f(a[0]).unbind("mouseenter.tipsy mouseleave.tipsy focus.tipsy blur.tipsy",g.returnFalse):(f(a[0]).bind("mouseenter.tipsy mouseleave.tipsy focus.tipsy blur.tipsy",g.returnFalse),a.attr("title",n(a)));var h=a&&a.length?f(a[0]).data("tipsy"):null;h&&(b?h.enable():h.disable())}},hide:function(){c(null)}}});
define("structure/widget/ui/UIUtil","almworks/util/Template almworks/util/Log almworks/util/Cell almworks/util/Functions almworks/util/Life underscore almworks/jquery jquery".split(" "),function(f,b,g,d,e,a,n,c){function p(b,h,c){this.events=a.chain(b.split(" ")).compact().map(function(a){return a+".s-safe-ajs-binder"}).value().join(" ");this.delegate=h;this.f=c}var m=f.html('<span class="s-loading"><span class="aui-icon aui-icon-wait">Loading...</span> {s.w.loading}</span>'),k=f.html('<span class="s-loading"><span class="aui-icon aui-icon-small aui-iconfont-error">Error</span> {s.w.loading.error}</span>'),r=namespace("almworks.structure.appevents");p.prototype={ajsBind:function(a){a=c(a);if(this.delegate)a.on(this.events,this.delegate,this.f);else a.on(this.events,this.f)}};return{displayPromise:function(c,h){function e(){f&&(clearTimeout(f),f=null);d&&(d.remove(),d=null)}if(!c)return b.error("no promise"),c;a.isFunction(c.promise)&&(c=c.promise());if("resolved"===c.state())return h.show(),c;h.hide();var d,f=setTimeout(function(){c.isResolved()||c.isRejected()||(d=n(m).insertBefore(h),f=null)},500);c.done(function(){e();h.show()}).fail(function(){e();n(k).insertBefore(h)});
return c},getViewportPositionRatio:function(a,b,c,e){if(1>a-b)return 0;a=Math.min(1,Math.max(0,c/(a-b)));e&&(a=Math.round(a*e));return a},getViewportPixelPosition:function(a,b,c,e){if(1>a-b)return 0;e&&(c/=e);a-=b;return Math.round(Math.min(a,Math.max(0,c*a)))},toggleDropdownListItems:function(a,b){a.toggleClass("hidden",!b);var c=a.find("a");c.toggleClass("disabled",!b);c.attr("aria-disabled",!b)},AJS$Bind:function(a,b,c,e){if(!a)throw Error("no element");if(!b||"string"!==typeof b)throw Error("no events");c&&"string"!==typeof c&&(e=c,c=null);if(!e||"function"!==typeof e)throw Error("no function");var d=new p(b,c,e);a.each(function(){var a=n(this),b=a.data("s-safe-ajs-binder")||[];b.push(d);a.data("s-safe-ajs-binder",b).addClass("s-safe-ajs-binder");d.ajsBind(this)})},rebindAJSListeners:function(){n(".s-safe-ajs-binder").each(function(){var a=n(this).data("s-safe-ajs-binder");if(a){c(this).off(".s-safe-ajs-binder");for(var b=0,e=a.length;b<e;b++)a[b].ajsBind(this)}})},deleteSkateJsData:function(a){a&&a.find("*").toArray().forEach(function(a){delete a.__SKATE_DATA})},createDraggableButton:function(a){var b;a.is("li")?(b=a,a=b.find(".aui-button")):(b=(new f("<li></li>")).render$(),
b.append(a));if(a.hasClass("aui-dropdown2-trigger")){var c=new g,e=new g;(new g(c,e,d.and)).pipeChanges(function(b){a.toggleClass("aui-dropdown2-trigger",!b);b&&a.isDropdownVisible&&a.trigger("aui-button-invoke")});b.delegate(".s-ph-tr-icon","mouseenter mouseleave",function(a){g.prototype.multiUpdate(function(){e.setValue("mouseenter"===a.type);"mouseleave"===a.type&&c.setValue(!1)})});b.delegate(".s-ph-tr-icon","mousedown mouseup",function(a){c.setValue("mousedown"===a.type)})}return b},sortableBanner:function(b,h){h=a.extend({axis:"x",handle:".s-ph-tr-icon",containment:"parent",item:"li",scroll: !1,cancel: !1,start:function(a,c){this.index=b.find(h.items).index(c.item)},update:function(a,c){h.done(this.index,b.find(h.items).index(c.item))},done:d.noop},h);h.items||(h.items="> "+h.item);h.sort||(h.sort=function(a,b){var c=n(this),e=b.helper.outerWidth(),d=b.helper.outerHeight();c.children(h.item).each(function(){var a=n(this);if(a.hasClass("ui-sortable-helper")||a.hasClass("ui-sortable-placeholder")||Math.abs(b.position.top-a.position().top)>d/2)return!0;var h=Math.abs(b.position.left-a.position().left);if(e-h>e/2)return h=n(".ui-sortable-placeholder",c),b.position.left>
a.position().left?h.insertBefore(a):h.insertAfter(a),!1})});return b.sortable(h)},connectToolbarActions:function(a,b,c){function d(a,f){k||(k={},b.addListener(new e,r.ly,function(a,b,h){var e=k[a];!e||c&&c.actionUpdated&& !1===c.actionUpdated(a,b,h)||(e.attr("aria-disabled",!b),e.is(".aui-button-split-main")&&e.siblings(".aui-button-split-more").attr("aria-disabled",!b),e.is("button")?e.attr("aria-pressed",! !h.toggled):e.is(".aui-dropdown2-radio,.aui-dropdown2-checkbox")&&e.toggleClass("checked",! !h.toggled))}));k.hasOwnProperty(a)?k[a]=k[a].add(f):k[a]=f;b.fireEvent(r.mt,a)}function f(a,e,d){if(!a)return!0;(c&&c.getPerformEventBus&&c.getPerformEventBus()||b).fireEvent(r.ACTION,a,e,d);return!e|| !e.consumed}var k=null,m=n("button[data-action]",a);m.on("click",function(a){if(!a)return!1;var b=n(a.currentTarget?a.currentTarget:a.target);b.blur();return "true"===b.attr("aria-disabled")? !1:f(b.data("action"),a)});m.each(function(){var a=n(this),b=a.data("action");d(b,a)});a.on("click","a[data-action]",function(a){f(n(a.target).data("action"),a)});a.find(".aui-dropdown2").on("click","a[data-action]",function(a){f(n(a.target).data("action"),a)});a.find(".aui-dropdown2 a[data-action]")
.each(function(){var a=n(this);d(a.data("action"),a)})}}});define("structure/widget/perspective/StorageUtil",["underscore","almworks/util/JSON"],function(f,b){return{getStorageKey:function(b){return b?b.structureId||b.type||b.hasOwnProperty("sQuery")&&"sQuery"||null:null},serializeObject:function(f){return b.stringifyTruthy(f,"")},deserializeObject:function(f){return b.safeParse(f)},PRIMARY_PANEL_NAME:"primary",SECONDARY_PANEL_NAME:"secondary"}});define("structure/widget/perspective/StoredValueWrapper",["underscore","almworks/util/Util","structure/widget/perspective/StorageUtil"],function(f,b,g){function d(b,a){this.storage=b.storage;this.panelName=a}b.extendOwn(d.prototype,{key:null,fallbackReadKey:null,sessionOnly:"perspective",defaultValue:null,serialize:g.serializeObject,deserialize:g.deserializeObject,isPerspectiveMandatory:function(){return!this.panelName||this.panelName===g.PRIMARY_PANEL_NAME},perspectiveDisabled:b.returnConst(!1),importModel:b.pvc,bf:b.pvc,perspectivePath:null,setValue:function(b){this.importModel(b);this.storage.save(this)},restore:function(b){var a=this;this.storage.whenReady(function(){var d;a.importModel(a.storage.read(a));d=a.bf();f.isFunction(b)&&b(d)
})}});return d});define("structure/widget/perspective/CellBasedValueWrapper",["underscore","almworks/util/Util","structure/widget/perspective/StoredValueWrapper"],function(f,b,g){function d(e,a,d){b.addSuper(g,this)(a,d);this.valueCell=e;this.life=new b.Lifecycle;var c=this;this.valueCell.pipeChanges(this.life,function(b){c.forced||a.storage.save(c,b)})}b.extend(d.prototype,g.prototype,{detach:function(){this.life.dispose()},importModel:function(b){this.valueCell.setValue(b)},bf:function(){return this.valueCell.value()},forceValue:function(e){this.forced= !0;this.importModel(e);this.restore=this.setValue=b.noop;this.key=this.perspectivePath=null},getValueCell:function(){return this.valueCell}});return d});define("structure/widget/perspective/StorageManager",["underscore","almworks/util/Util","structure/widget/perspective/PerspectiveManager"],function(f,b,g){function d(a,b,d){a=e(a,b);return d?a+"."+d:a}function e(a,c){return a?a instanceof b.Cell?a.value():f.isFunction(a)?a.call(c):a:null}var a=namespace("almworks.structure");return function(n){function c(a){var b;if(b=m.getPerspectiveId())b= !(f.isFunction(a.perspectiveDisabled)?a.perspectiveDisabled():a.perspectiveDisabled);
return b?"perspective"+m.getPerspectiveId():null}function p(b,c,e){return(c=a.getStored(d(e,b,c)))?b.deserialize?b.deserialize(c):c:null}var m=new g(n);b.extend(this,{save:function(b,p){var l=e(b.key,b);if(l){1===arguments.length&&(p=b.bf());var h=c(b),u=f.isFunction(p)?p():p,u=b.serialize?b.serialize(u):u,g= !0===b.sessionOnly||m.getPerspectiveId()&&"perspective"===b.sessionOnly;a.setStored(d(l,b,h),u,g);return u}},read:function(a){var b=e(a.key,a);if(!b&& !m.perspectivePath(a))return null;var d=c(a),h=a.fallbackReadKey?e(a.fallbackReadKey,a):void 0,b=p(a,d,b),b=null!==b?b:d==="perspective"+m.getPerspectiveId()?m.readPerspective(a):null;h&& !b&&(b=p(a,d,h));return null!==b?b:a.defaultValue},getPerspectiveManager:function(){return m},whenReady:function(a){m.whenReady(a)},setValueFromSpec:function(a,b){b.setValue(m.readPerspective(b,a))}})}});define("structure/widget/perspective/PerspectiveManager","almworks/jquery jquery underscore almworks/util/Strings almworks/util/Util almworks/util/JSON almworks/util/Template structure/api/SecondaryPanelRegistry".split(" "),function(f,b,g,d,e,a,n,c){var p=namespace("almworks.structure",!1),m=namespace("AJS.InlineDialog",!1),k=namespace(
"JIRA.Messages",!1),r=function(a){a&&a.stopPropagation()},l=n.load("structure.widget.perspective.link-dialog").render$(),h=n.load("structure.widget.perspective.error-message").render$();return function(u){function n(a){a(G);B.resolve()}function q(a){D&&a&&(K=a)}function x(a,b,h){b[a.panelName]={};g.each([a.getPanelHeader(),a.ao(),a.bW(),a.getSpecController()],function(a){a.lb(b,h)})}function t(){var a={},b=g.partial(z,a);x(u.master,a,b);u.slave.isPerspectiveReady()&&x(u.slave,a,b);u.pageManager.lb(a,b);u.layoutManager.lb(a,b);u.toolbar.lb(a,b);u.bF.lb(a,b);u.fullScreenController.lb(a,b);c.getPanelDescriptors().forEach(function(h){h.isPerspectiveReady()&&h.lb(a,b)});a.structurePageId=p.modes.getStructurePageId();return{spec:a}}function w(){A&&u.errorCentral.reportError(new p.error.AppError(e.text("s.p.error.init",A.title),A.details))}function v(){var a=window.location;return a.protocol+"//"+a.host+a.pathname+"?p="}function C(b,h,c){h||(h="s.p.error.restore");void 0===c&&(c=G);try{c=a.stringify(c)}catch(d){c="Could not prepare details"}b="Perspective property is missing.\npath: "+b+"\nSpec: "+c;u.errorCentral.reportError(new p.error.AppError(e.text(h),b))}function z(a,b){var h=F(b);
if(h){var c=b.bf();if(g.isObject(c)){var d=e.deref(a,h,!0);null==d?C(h,"s.p.error.write"):g.extend(d,c)}else{var f=h.lastIndexOf(".");0<f?(d=h.substring(f+1,h.length),f=h.substring(0,f),f=e.deref(a,f,!0),null==f?C(h,"s.p.error.write"):f[d]=c):a[h]=c}}}function F(a){var b=a.perspectivePath;return b?b instanceof e.Cell?b.value():g.isFunction(b)?a.perspectivePath():b:null}var A=null,D=0,G=null,B=f.Deferred(),K=null;e.extend(this,{installPerspective:function(b,h){var c=g.partial(n,h);if(b){var f=new u.ajax.Task(p.ajax.RESOURCES.PERSPECTIVE+"/"+b,p.ajax.DOWNLOAD,function(h){var c;try{c=a.parse(h)}catch(e){A=e,c=null}h=c;h.primary||(A={title:"No primary panel spec"},h.primary={});G=h;D=b;q(h.structurePageId)},function(a,h){404===a.status?k&&k.showErrorMsg&&k.showErrorMsg(e.text("s.perspective.notfound",d.htmlEscape(b)),{closeable: !0,timeout:0}):A=e.httpErrorReport(a,h)});f.chainComplete(e.seq(w,c));u.ajax.addTask(f)}else c()},installSharingButton:function(){function c(a){s.toggle(a);n.toggle(!a);x.toggleClass("s-no-bganim",!a)}function e(){u.ni.popupHidden(w);x.removeAttr("aria-pressed");document.removeEventListener("mousedown",d,!0);document.removeEventListener("focusin",d)}function d(
a){a=f(a.target);a.closest(".perspective-link-dialog").length||a.closest("#s-share-perspective").length||w.hide()}function k(e,f,q){var m,n=new u.ajax.Task(p.ajax.RESOURCES.PERSPECTIVE+"/share",p.ajax.UPLOAD,function(a){m=a&&a.id});n.type="POST";n.chainComplete(function(){c(!1);x.attr("aria-pressed","true");f.html(m?l:h);f.width(450);q();u.ni.lV(w,w.hide);f.click(r);b(".s-inline-dialog-close",f).click(w.hide);document.addEventListener("mousedown",d,!0);document.addEventListener("focusin",d);if(m){var a=b("input:text",f);a.val(A+m);var e=function(){a.focus();a.select()};a.click(e);g.defer(e)}});n.data=a.stringify(e);u.ajax.addTask(n)}function q(a,b,h){if("true"===x.attr("aria-pressed"))return g.defer(w.hide),!1;c(!0);b=t();k(b,a,h);return!1}var x=f("#s-share-perspective");if(x.length){var n=f(".s-share-icon",x),s=f(".aui-icon-wait",x),A=v();f(window).on("popstate",function(){w.hide()});u.jiraConfig.load(function(a){x.toggle(a.isCreatePerspectiveAllowed())});var w=m(b("#s-share-perspective"),"s-share-perspective",q,{cacheContent: !1,persistent: !0,hideCallback:e})}},iw:C,oh:function(){return K},setPerspectiveStructurePageId:q,getPerspectiveId:function(){return D},createPerspective:t,
writeModelSpec:z,readPerspective:function(b,h){void 0===h&&(h=G);var c=F(b);if(!c)return null;var d=e.deref(h,c);null===d&&b.isPerspectiveMandatory()&&C(c,null,h);return a.parse(a.stringify(d))},perspectivePath:F,whenReady:function(a){B.done(a)}})}});define("structure/widget/jira/Fields",["almworks/util/Objects","almworks/util/Collections","underscore"],function(f,b,g){function d(a,b){var c=b||{};this.id=a;this.editable=e(c.editable,!0);this.sortable=e(c.sortable,!0);this.descending=e(c.descending,!1);this.gadgetEditable=e(c.gadgetEditable,!1);this.attributeId=c.hasOwnProperty("attributeId")?c.attributeId:a;c.type&&(this.type=c.type)}function e(a,b){return void 0===a?b:a}function a(a){return b.flipSet(g.pluck(g.where(n,a),"id"))}var n=[new d("issuekey",{editable: !1,attributeId:"key"}),new d("project",{editable: !1}),new d("issuetype",{gadgetEditable: !0}),new d("security",{gadgetEditable: !0}),new d("summary",{type:"text"}),new d("description",{type:"text"}),new d("environment",{type:"text"}),new d("status",{editable: !1}),new d("resolution",{editable: !1}),new d("assignee",{gadgetEditable: !0}),new d("creator"),new d("reporter"),new d("components"),new d("versions"),new d(
"fixVersions"),new d("labels"),new d("priority",{descending: !0,gadgetEditable: !0}),new d("created",{editable: !1,descending: !0,type:"date"}),new d("updated",{editable: !1,descending: !0,type:"date"}),new d("duedate",{descending: !0,type:"date"}),new d("resolutiondate",{editable: !1,descending: !0,type:"date"}),new d("votes",{editable: !1,descending: !0,type:"number"}),new d("watches",{editable: !1,descending: !0,type:"number"}),new d("timespent",{editable: !1,descending: !0,type:"duration"}),new d("timeoriginalestimate",{descending: !0,type:"duration",gadgetEditable: !0}),new d("timeestimate",{descending: !0,type:"duration",gadgetEditable: !0}),new d("workratio",{editable: !1}),new d("thumbnail",{editable: !1,attributeId:void 0,sortable: !1}),new d("issuelinks",{editable: !1,attributeId:void 0,sortable: !1}),new d("subtasks",{editable: !1,attributeId:void 0,sortable: !1})],c=b.flipSet(["com.atlassian.jira.plugin.system.customfieldtypes:importid","com.pyxis.greenhopper.jira:gh-global-rank","com.pyxis.greenhopper.jira:greenhopper-ranking"]);return f.deepFreeze({systemFields:n,systemFieldsMap:b.mapArray(n,function(a){return a.id}),uneditableFieldSet:a({editable: !1}),
sortableFieldSet:a({sortable: !0}),descendingByDefaultFieldSet:a({descending: !0}),gadgetEditableFieldSet:a({gadgetEditable: !0}),TEXT:"text",TIME:"time",DATE:"date",NUMBER:"number",DURATION:"duration",fieldSet:a,isNumericCustomField:function(a){return!(!(a&&a.id&&"number"===a.type&&a.custom)||c[a.custom])},isSummableField:function(a){var b=a&&a.id;if(!b)return!1;if("worklogged"===b)return!0;b=this.systemFieldsMap[b];return!b||"duration"!==b.type&&"number"!==b.type?this.isNumericCustomField(a): !0}})});define("structure/widget/model/Rows",[],function(){var f= -100;return{isLocalRow:function(b){return 0>b},isPersistentRow:function(b){return 0<b&&0===b%2},isTransientRow:function(b){return 0<b&&1===b%2},nextTemporaryRowId:function(){return f--}}});define("structure/widget/model/Items",["underscore","almworks/util/Strings","almworks/util/Types","structure/widget/model/PageId"],function(f,b,g,d){function e(a){return! !(a&&0>a.indexOf("/"))}function a(a){return "com.almworks.jira.structure:type-issue/"+a}var n={TITLE:1};Object.freeze(n);return{Semantics:n,ISSUE:"com.almworks.jira.structure:type-issue",FOLDER:"com.almworks.jira.structure:type-folder",GENERATOR:
"com.almworks.jira.structure:type-generator",STRUCTURE:"com.almworks.jira.structure:type-structure",LABEL:"com.almworks.jira.structure:type-label",LOOP_MARKER:"com.almworks.jira.structure:type-loop-marker",STATUS:"com.almworks.jira.structure:type-status",GROUP:"com.almworks.jira.structure:type-group",COMPONENT:"com.almworks.jira.structure:type-project-component",SPRINT:"com.almworks.jira.structure:type-sprint",TEMPO_ACCOUNT:"com.almworks.jira.structure:type-tempo-account",TEXT:"com.almworks.jira.structure:type-text",CONFLUENCE_PAGE:"com.almworks.structure.pages:type-confluence-page",isIssue:e,issue:a,completeItemId:function(b){return e(b)?a(b):b},toItemId:function(a,b){return f.isNumber(b)?a+"/"+b:a+"//"+b},getGeneratorId:function(a){return(a=a&&a.match(/^com\.almworks\.jira\.structure:type-generator\/(\d+)/))&&a[1]?g.toIntSafe(a[1],0):null},getPageId:function(a){return(a=a&&a.match(/^com\.almworks\.structure\.pages:type-confluence-page\/(\d+)/))&&a[1]?d.parse(a[1]):null},isGenerator:function(a){return!(!a||0!==a.indexOf("com.almworks.jira.structure:type-generator"))},isLoopMarker:function(a){return!(!a||0!=a.indexOf("com.almworks.jira.structure:type-loop-marker"))},isPermanent:
function(a){return f.isNumber(a)&&0===a%2},isTransient:function(a){return f.isNumber(a)&&1===a%2},getIssueIdFromItemId:function(a){return e(a)?g.toIntSafe(a,0):0},getPageIdFromItemId:function(a){return g.toIntSafe(a&&b.tail(a,"com.almworks.structure.pages:type-confluence-page/"))},getItemType:function(a){if(!a||"string"!==typeof a)return "";var b=a.indexOf("/");return 0>=b&&0!==g.toIntSafe(a)?"com.almworks.jira.structure:type-issue":a.substring(0,b)},getLongId:function(a){if(!a||"string"!==typeof a)return 0;var b=a.indexOf("/");return 0>=b?0:g.toIntSafe(a.substring(b+1,a.length))}}});define("structure/widget/model/PageId",["underscore","almworks/util/Util"],function(f,b){function g(b,e){if(0>b||1E9<=b)throw Error("illegal confluence ID "+b);if(0>e||1E9<=e)throw Error("illegal page ID "+e);this.confluenceId=b;this.pageId=e}g.parse=function(b){return new g(Math.floor(b/1E9),b%1E9)};return g});define("structure/widget/attributes/Attributes",["almworks/util/Objects"],function(f){var b={SUMMARY_TEXT:{id:"summary",format:"text"},SUMMARY_HTML:{id:"summary",format:"html"},ICON_HTML:{id:"icon",format:"html"},EDITABLE:{id:"editable",format:"boolean"},DONE:{id:"done",format:"boolean"},
DESCRIPTION_HTML:{id:"description",format:"html"},URL_TEXT:{id:"url",format:"text"},KEY_TEXT:{id:"key",format:"text"},PROJECT_ID:{id:"project",format:"id"},PROJECT_HTML:{id:"project",format:"html"},ISSUETYPE_ID:{id:"issuetype",format:"id"},ISSUETYPE_HTML:{id:"issuetype",format:"html"},PROGRESS_NUMBER:{id:"progress",format:"number"},RUN_AS_USER_ICON_HTML:{id:"run-as-user.icon",format:"html"},ORIGINAL_GENERATOR_KIND:{id:"original-generator-kind",format:"text"},BASIC_GENERATION_INFO:{id:"basic-generation-info",format:"json"},CHILDREN_GENERATORS_HINT:{id:"children-generators-hint",format:"html"},INSERTER_MARKS:{id:"inserter-marks",format:"jsonArray"},ATTACHED_RESPONSIBLE_INSERTERS:{id:"attached-responsible-inserters",format:"jsonArray"},ATTACHED_RESPONSIBLE_INSERTER_DEPTHS:{id:"attached-responsible-inserter-depths",format:"jsonArray"},EXTENDED_SUMMARY_HTML:{id:"extended-summary",format:"html"},DISPLAYED:"displayed",UNFILTERED:"unfiltered",isDisplayed:function(f){return!f||f===b.DISPLAYED},isUnfiltered:function(f){return f===b.UNFILTERED}};b.REQUIRED_FOR_CREATE=[b.PROJECT_ID,b.ISSUETYPE_ID];b.Formats={HTML:"html",TEXT:"text",NUMBER:"number",ORDER:"order",DURATION:"duration",TIME:"time"}
;f.deepFreeze(b);return b});define("structure/widget/transform/Transform",["almworks/util/Util"],function(f){var b=namespace("almworks.structure.api"),g=b.baseClass("TransformerType",{getKey:f.pvc,getIconHtml:f.pvc,getLabel:function(){return f.text("s.w.transform.+"+this.getKey()+"+.label")},getActionLabel:function(){return f.text("s.w.transform.+"+this.getKey()+"+.action")},createTransformer:function(b){return new d}}),d=b.baseClass("Transformer",{init:function(b){this.cell=new f.Cell(b);b&&b.permanent&&this.cell.freeze()},getIconHtml:function(){return null},getTransformCell:function(){return this.cell},setTransform:function(b){this.getTransformCell().setValue(b)},createConfigurator$:function(){return null},applyConfiguration:function(b,a){return a}});return{Type:{FILTER:"filter",SORTER:"sorter",GROUPER:"grouper",EXTENDER:"extender"},TransformerType:g,Transformer:d}});define("structure/widget/transform/Filter","jquery underscore almworks/util/Template structure/widget/transform/Transform structure/widget/generator/FilterQueryDescriptor almworks/util/Util".split(" "),function(f,b,g,d,e,a){f=namespace("almworks.structure.api");var n=f.subClass("FilterTransformerType",
d.TransformerType,{getKey:function(){return d.Type.FILTER},getIconHtml:function(){return '<i class="alm alm-filter"></i>'},createTransformer:function(a){return c.supportsModule(a.module)?new c:d.TransformerType.prototype.createTransformer.apply(this,arguments)}}),c=f.subClass("QueryFilterTransformer",d.Transformer,{init:function(){this.rawTransform=new a.Cell(null);this.error=new a.Cell(!1);this.query=new a.Cell(null);this.type=new a.Cell(null);this.transformCell=new a.Cell(this.query,this.type,this.error,this.rawTransform,function(a,e,d,f){if(""===a)return null;if(a&&e){if(d)return this.value();a=b.extend(c.createTransformSpec(a,e),{quick:f.quick,permanent:f.permanent});b.extend(a.params,f.params);return a}})},getQuery:function(){return this.query.value()},getTransformCell:function(){return this.transformCell},setTransform:function(b){a.Cell.prototype.multiUpdate(!0);try{var c=e.getFilterType(b.module);this.type.setValue(c);this.query.setValue(b.params&&b.params[c]);this.rawTransform.setValue(b)}finally{a.Cell.prototype.multiUpdate(!1)}},getIconHtml:function(){return(new g('<i class="alm alm-{type}"></i>')).renderHtml({type:"text"===this.type.value()?"text-query":"jql-query"})}});
c.supportsModule=function(a){return! !e.getFilterType(a)};c.createTransformSpec=function(a,b){var c=e.getFilterModule(b);if(!c)return null;c={key:"filter",module:c,params:{}};c.params[b]=a;return c};return{TransformerType:n,QueryFilterTransformer:c}});define("structure/widget/transform/Sorter",["almworks/jquery","almworks/util/Template","structure/widget/transform/Transform","almworks/util/Util"],function(f,b,g,d){var e=namespace("almworks.structure.api"),a=0,n=e.subClass("SorterTransformerType",g.TransformerType,{getKey:function(){return g.Type.SORTER},getIconHtml:function(){return '<i class="alm alm-sort-asc"></i>'},createTransformer:function(){return new c}}),c=e.subClass("SorterTransformer",g.Transformer,{init:function(a){var b=a&&a.params;this.sortCell=new d.Cell(b&&b.desc?"desc":"asc");this.rawTransformCell=new d.Cell(a);this.transformCell=new d.Cell(this.rawTransformCell,this.sortCell,function(a,b){if(!a|| !a.params)return null;var c=f.extend(!0,{},a);c.params.desc="desc"===b;return c})},getTransformCell:function(){return this.transformCell},setTransform:function(a){d.Cell.prototype.multiUpdate(!0);try{var b=a.params;this.sortCell.setValue(b&&b.desc?"desc":"asc");
this.rawTransformCell.setValue(a)}finally{d.Cell.prototype.multiUpdate(!1)}},getIconHtml:function(){return d.renderTemplate('<i class="alm {iconClass}"></i>',{iconClass:"alm-sort-"+this.sortCell.value()})},applyConfiguration:function(a,b){var c=a.find('button[aria-pressed="true"]').val();return f.extend({},b,{desc:"desc"===c})},createConfigurator$:function(){a++;var c='<form class="s-opts-sorting"><div class="aui-buttons tiny-hide s-sort-style">'+'<button class="sort aui-button" value="{order}" id="s-tr-sorter-{order}-{id}" name="sort"><i class="alm s-fa alm-sort-{order}"></i><span>{sw.widget.tr.sorter.{order}.label}</span></button>'.replace(/\{order}/gi,"asc")+'<button class="sort aui-button" value="{order}" id="s-tr-sorter-{order}-{id}" name="sort"><i class="alm s-fa alm-sort-{order}"></i><span>{sw.widget.tr.sorter.{order}.label}</span></button>'.replace(/\{order}/gi,"desc")+"</div></form>",c=(new b(c)).render$({id:a}),e=c.find('button[value="asc"]').attr("aria-pressed","true"),f=c.find('button[value="desc"]');(new d.AuiButtonPresenter(this.sortCell)).setView(e,!0);(new d.AuiButtonPresenter(this.sortCell)).setView(f,!0);var g=e.find("i").addClass("col-sort"),l=f.find("i");
this.sortCell.pipeChanges(function(a){g.toggleClass("col-sort","asc"===a);l.toggleClass("col-sort","desc"===a)});return c}});return{TransformerType:n}});define("structure/widget/transform/Grouper",["structure/widget/transform/Transform"],function(f){return{TransformerType:namespace("almworks.structure.api").subClass("GrouperTransformerType",f.TransformerType,{getKey:function(){return f.Type.GROUPER},getIconHtml:function(){return '<i class="alm alm-group"></i>'}})}});define("structure/widget/transform/Extender",["structure/widget/transform/Transform"],function(f){return{TransformerType:namespace("almworks.structure.api").subClass("ExtenderTransformerType",f.TransformerType,{getKey:function(){return f.Type.EXTENDER},getIconHtml:function(){return '<i class="alm alm-extend"></i>'}})}});define("structure/widget/generator/GeneratorRegistry",["almworks/jquery","underscore","almworks/util/Objects","almworks/util/MiscUtils"],function(f,b,g,d){function e(a,b){var h=p.subClass(n.capitalize(a)+"GeneratorKindInfo",k,{getKey:function(){return a},getIconHtml:function(){return b}});r[a]=new h}function a(a){function e(a){return b.find(v,function(b){return b.module===a})}function q(a){var h=e(
a.module);if(!h|| !h.presets)return null;var c=m[h.type],d= !(!c|| !c.length),f= !(!a.params|| !Object.keys(a.params).length);return b.find(h.presets,function(b){if(!b.params&& !f)return!0;if(!d)return n.deepEquals(b.params,a.params);var h=n.extend({},a.params);c.forEach(function(a){b.params.hasOwnProperty(a)?h.hasOwnProperty(a)||(h[a]=b.params[a]):delete h[a]});return n.deepEquals(b.params,h)})}function k(){h.length&&(h.forEach(function(a){b.isFunction(a)&&a(F)}),h=[])}function p(a){if(a){var b=a.moduleKey;if(!b)throw Error("invalid module key "+b);if(z[b])throw Error('descriptor with module key "'+b+'" is already registered');z[b]=a}}var w=f.Deferred(),v=[],C=[],z={},F={widget:a,addDescriptor:p};c.ajax.doAjax({url:c.ajsbridge.localURL(c.ajax.RESOURCES2g.GENERATOR),type:"GET",timeout:3E4,success:function(a){a&&a.generators&&(v=a.generators.map(function(a){var b={};b.label=a.label;b.type=a.type;b.module=a.module;b.notConfigurable=a.notConfigurable;a.presets&&(b.presets=a.presets.map(function(a){var h={};h.type=b.type;h.module=b.module;h.label=a.label;h.description=a.description;h.params=a.params&&JSON.parse(a.params);return h}));return b}),v=b.sortBy(v,"label"),a=b.filter(v,
function(a){return a.presets&&a.presets.length}),C=b.sortBy(b.flatten(b.pluck(a,"presets")),"label"),g.deepFreeze(v),g.deepFreeze(C));w.resolve(v)},error:function(){w.resolve([])}});return n.extend(this,{whenReady:function(a){w.always(a)},getPresets:function(a){return C.filter(function(b){return!a||b.type===a})},findPreset:q,getGenerators:function(a){return v.filter(function(b){return!a||b.type===a})},findGenerator:e,addDescriptor:p,suggestLabel:function(a){k();var b=f.Deferred();if(a&&a.module){var h=q(a);h?b.resolve(h.label):(h=z[a.module])?(a=h.suggestLabel(a),d.pipeDeferred(b,f.when(a))):b.reject(null)}else b.reject(null);return b.promise()},getKinds:function(){return l},getKindInfo:function(a){return r[a]}})}var n=namespace("almworks.util"),c=namespace("almworks.structure"),p=namespace("almworks.structure.api"),m={grouper:["level","includeGroups"],extender:["from","to"],sorter:["desc","from","to","locale"],filter:["hard","showSubItems","pinnedItem","level"]},k=p.baseClass("GeneratorKindInfo",{getKey:n.pvc,getIconHtml:n.pvc,getLabel:function(){return n.text("sw.widget.act.ext.+"+this.getKey()+"+.label")},getTitle:function(){return n.text("sw.widget.act.ext.+"+this.getKey()+
"+.title")},getActionLabel:function(){return n.text("sw.widget.act.ext.+"+this.getKey()+"+.action")}}),r={},l=["inserter","filter","sorter","grouper","extender"];e("inserter",'<i class="alm alm-fw alm-structure"></i>');e("filter",'<i class="alm alm-fw alm-filter"></i>');e("sorter",'<i class="alm alm-fw alm-sort-asc"></i>');e("grouper",'<i class="alm alm-fw alm-group"></i>');e("extender",'<i class="alm alm-fw alm-extend"></i>');var h=[];a.getPlatformParams=function(a){return m[a]};a.registerFactory=function(a){h.push(a)};return a});define("structure/widget/generator/GeneratorUtil",["almworks/util/Util","almworks/util/JSON","jira/dialog/form-dialog"],function(f,b,g){var d=namespace("almworks.structure");return{showEditGeneratorDialog:function(e,a,n){e={autoClose: !0,ajaxOptions:{url:d.ajsbridge.localURL("/secure/StructureGeneratorEdit.jspa"+(e?"?"+e:""))},onSuccessfulSubmit:function(a,e){var d=e.getResponseHeader("X-Structure-Generator-Params");d&&(d=b.parse(decodeURIComponent(d)),Object.keys(d).forEach(function(b){null===a[b]&&delete a[b]}),n(d))}};a&&f.extend(e,a);return(new g(e)).show()}}});define("structure/widget/transform/TransformRegistry",
"underscore structure/widget/transform/Transform structure/widget/transform/Filter structure/widget/transform/Sorter structure/widget/transform/Grouper structure/widget/transform/Extender almworks/util/Util".split(" "),function(f,b,g,d,e,a,n){var c=[new g.TransformerType,new d.TransformerType,new e.TransformerType,new a.TransformerType];return function(a){function e(b){if(!b)return null;b=f.isString(b)?b:b.module;return b?(b=a.findGenerator(b))&&b.type:null}var d={};c.forEach(function(a){var b=a.getKey();if(!f.isString(b))throw Error("expected a string key, but got "+b);if(d.hasOwnProperty(b))throw Error("transformer type is already registered with key "+b);d[b]=a});n.extendOwn(this,{getTransformerType:function(a){return(a=f.isString(a)?a:a.key)?(a="unresolved"===a||"assigned2me"===a?b.Type.FILTER:a,d[a]):null},getTransformType:e,isFilter:function(a){return e(a)===b.Type.FILTER},isSorter:function(a){return e(a)===b.Type.SORTER}})}});define("structure/widget/spec/SpecController",["underscore","almworks/util/Objects","almworks/util/JSON","structure/widget/perspective/StoredValueWrapper","structure/widget/perspective/StorageUtil"],function(f,b,g,d,e){function a(a){if(!a)throw Error(
"you must provide transform spec");if(!a.key)throw Error("key is not defined for transformation");if(!a.module)throw Error("module is not defined for transformation");this.id=a.id||l++;this.key=a.key;this.module=a.module;a.quick&&(this.quick=a.quick);a.permanent&&(this.permanent= !0);a.params&&(this.params=f.isString(a.params)?g.parse(a.params):b.deepClone(a.params))}function n(h,d,l){function q(a){return a.filter(function(a){if(a&&a.module){var b=C.findGenerator(a.module);b?a.key||(a.key=b.type):a=null}else a=null;return! !a})}function g(b){A.setValue(q(b).map(function(b){return new a(b)}))}function t(h){if(-1===w(h)){h=new a(h);var c=m.addAll([],A.value());c.push(h);A.setValue(c);return b.deepClone(h)}}function w(a,b){if(!a)return-1;b||(b=A.value());var h=f.isNumber(a)?a:a.id;return m.find(b,function(a){return a.id===h})}function v(){var a=h.config.forProject;return a?{sQuery:{type:"jql",query:'project = "'+a+'"',projectQuery: !0}}:null}var C=h.generatorRegistry,z=h.eventBus,F=new m.Cell,A=(new m.Cell).setValue([]),D=new m.Cell(F,A,function(a,h){if(!a)return null;var c=m.extendOwn({},a);h&&h.length&&n.isTransformable(c)&&(c.transforms=h);return b.deepFreeze(c)}),G=new p(h,d,D),B=
 !1,K= !1,J=new c(h,d,this,A);F.pipeChanges(function(a,b){K&&(b&&a&&b.sQuery&&a.sQuery&&b.sQuery.type===a.sQuery.type||z.postEvent(k.gS,"forestSpec.change"))});A.pipeChanges(function(){K&&z.postEvent(k.gS,"forestSpec.transform")});var O=0;m.extend(this,{getProjectPageSpec:m.returnConst(v()),getSearchAndAddSlaveSpec:m.returnConst(function(){var a=v();return a?a:{sQuery:{type:"jql",query:""}}}()),bw:m.returnConst(D),copySpec:f.bind(G.copySpec,G),copySpecForRest:f.bind(G.getSpecForRest,G),isTransformable:function(){return n.isTransformable(D.value())},isStructure:function(){return n.isStructure(D.value())},pinItem:function(a){var h=b.deepClone(F.value());a?h.pinnedItem=a:delete h.pinnedItem;F.setValue(h)},setSpec:function(a){if(!n.isValidSpec(a))return!1;var b= ++O;C.whenReady(function(){if(b===O)try{var h=F.value(),c=m.extendOwn({},a);delete c.transforms;f.isUndefined(c.pinnedItem)&&h&&(c.pinnedItem=h.pinnedItem);var q= !m.deepEquals(c,h);F.setValue(c);J.spec=c;J.prependPermanentProjectFilter=l===r.PAGE_IDS.PROJECT&&d===e.PRIMARY_PANEL_NAME;a&&a.transforms?g(a.transforms): !q||l!==r.PAGE_IDS.BOARD&&l!==r.PAGE_IDS.BOARD_WITH_DETAILS&&l!==r.PAGE_IDS.PROJECT||J.restore()}finally{q?(B||(
B= !0,setTimeout(function(){K= !0},3E3)),z.postEvent(k.STRUCTURE_CHANGED)):z.postEvent(k.STRUCTURE_NOT_CHANGED)}});return!0},isInitialized:function(){return B},setTransforms:g,addTransform:t,saveTransform:function(b){if(b){if(b.id){var h=w(b.id);if(0<=h){var c=m.addAll([],A.value());b=new a(b);c[h]=b;A.setValue(c);return b}throw Error("transform with id "+b.id+" is not found");}return t(b)}},removeTransform:function(a){a=w(a,A.value());if(0<=a){var b=[].concat(A.value());b.splice(a,1);A.setValue(b)}},updateTransform:function(b){if(b&&b.id){var h=w(b,A.value());if(0<=h){var c=[].concat(A.value());c[h]=new a(b);A.setValue(c)}else throw Error("transform with id "+b.id+" is not found");}},findTransforms:function(a){return f.where(A.value(),{key:a})},replaceTransform:function(b,h){var c=w(b);if(0<=c){var e=[].concat(A.value());e[c]=new a(h);A.setValue(e)}else throw Error("transform with id "+b+" is not found");},lb:function(a,b){b(G)},readPerspectiveSpec:function(){return h.az.readPerspective(G)},appendTransformsFromSpec:function(a){a&&a.transforms&&g(f.union(A.value()||[],a.transforms.filter(function(a){return!a.permanent}).map(function(a){return f.omit(a,"quick","id")})))}})}
function c(a,b,c,l){m.addSuper(d,this)(a,b);var k=this;l.pipeChanges(function(){k.storage.save(k)});m.extend(this,d.prototype,{key:function(a){var h=this.spec,c=null;a=(r.modes.ISSUE_PAGE||r.modes.GADGET||r.modes.GH_TAB?r.modes.getStructurePageId()+"-":"")+"transforms-"+(a||b);h&&h.structureId?c=a+"-structure-"+h.structureId:h&&h.sQuery&&(c=a+"-query");return c},fallbackReadKey:function(){return this.spec.structureId&&this.key(b===e.PRIMARY_PANEL_NAME?e.SECONDARY_PANEL_NAME:e.PRIMARY_PANEL_NAME)},importModel:function(a){a=a||[];if(k.prependPermanentProjectFilter){var b=c.getProjectPageSpec();b&&(a=f.union([{key:"filter",module:"com.almworks.jira.structure:filter-jql",params:{jql:b.sQuery.query},permanent: !0}],a))}c.setTransforms(a)},bf:function(){return l.value().filter(function(a){return!0!==a.permanent}).map(function(a){return f.omit(a,"id")})},perspectivePath:b+".forestSpec.transforms",isPerspectiveMandatory:function(){return!1}})}function p(a,b,c){function e(){return g.parse(g.stringify(c.value()))}m.addSuper(d,this)(a,b);m.extend(this,d.prototype,{copySpec:e,getSpecForRest:function(){return n.getRestSpec(e(),a.transformRegistry)},bf:function(){var a=e();a&&a.transforms&&
a.transforms.length&&a.transforms.forEach(function(a){delete a.id});return a},perspectivePath:b+".forestSpec"})}var m=namespace("almworks.util"),k=namespace("almworks.structure.appevents"),r=namespace("almworks.structure"),l=1;n.getRestSpec=function(a,b){if(!a)return null;a=g.safeParse(g.stringify(a));a.hasOwnProperty("pinnedItem")&& !a.pinnedItem&&delete a.pinnedItem;a.pinnedItem&&b&&(a.transforms?a.transforms.forEach(function(c){b.isFilter(c)&&(c.params||(c.params={}),c.params.pinnedItem=a.pinnedItem)}):a.transforms=[],a.transforms.push({key:"pin",module:"com.almworks.jira.structure:filter-item",params:{item:a.pinnedItem,showSubItems: !0}}),delete a.pinnedItem);a.transforms&&(a.transforms.length?a.transforms.forEach(function(a){delete a.id;delete a.permanent;delete a.quick}):delete a.transforms);a.sQuery&&a.sQuery.projectQuery&&delete a.sQuery.projectQuery;return a};n.getSpecForFilter=function(a,b){if(!a|| !a.transforms|| !a.transforms.length)return null;for(var c=g.safeParse(g.stringify(a)),e=c.transforms.length-1;0<=e;e--){var d=c.transforms[e];if(!b.isSorter(d))if(b.isFilter(d))d.params||(d.params={}),d.params.hard= !0;else break}return m.deepEquals(a,c)?null:c};
n.getSpecForAttributes=function(a){if(!a)return null;a=g.safeParse(g.stringify(a));delete a.pinnedItem;if(!a.transforms|| !a.transforms.length)return delete a.transforms,a;a.transforms=a.transforms.filter(function(a){return "pin"!==a.key});a.transforms.length?a.transforms.forEach(function(a){delete a.id;delete a.permanent;delete a.quick;a.params&&delete a.params.pinnedItem}):delete a.transforms;return a};n.getUntransformedSpec=function(a){if(!a)return null;a=g.safeParse(g.stringify(a));delete a.pinnedItem;delete a.transforms;delete a.title;return a};n.isValidSpec=function(a){if(!a)return!1;var b=Object.keys(a),c=a.hasOwnProperty("pinnedItem")?2:1;return b.length>c||b.length===c&& !a.transforms};n.isStructure=function(a){return a&&f.isNumber(a.structureId)};n.isClipboard=function(a){return a&&"clipboard"===a.type};n.isTransformable=function(a){return n.isValidSpec(a)&& !n.isClipboard(a)};n.areUntransformedSpecsEqual=function(a,b){return m.deepEquals(n.getUntransformedSpec(a),n.getUntransformedSpec(b))};return n});define("structure/widget/util/NavigationHint",["almworks/jquery","almworks/util/Cookies","almworks/util/Util"],function(f,b,g){function d(a,d){var f=a.getStructureId();f&&(
f=f+"|"+Date.now()+"|"+d,b.setCookie("structure3.navigation.hint",f,1,e.cookiePath()))}var e=namespace("almworks.structure.ajsbridge"),a=namespace("almworks.structure.apputil");b=b.defaultCookies;var n=null;return{saveNavigationHint:d,saveNavigationHintFromLink:function(b,p){if(p&&b.getStructureId()){p=p.closest("a[href]");var m;try{var k=p[0];m=k&&k.href}catch(r){return}if(m){if(!n){n=e.localURL("/browse/");try{n=f('<a href="'+n+'"></a>')[0].href}catch(l){g.warn("cannot figure out absolute link prefix, navigation hint will likely not work",l)}}g.tail(m,n)&&(m=a.getIssueKeyFromUrl(m))&&d(b,m)}}},clearNavigationHint:function(){var a=b.getCookie("structure3.navigation.hint");a&&b.setCookie("structure3.navigation.hint",null,0,e.cookiePath());return a},restoreNavigationHint:function(a){a&&b.setCookie("structure3.navigation.hint",a,1,e.cookiePath())}}});define("structure/widget/ui/editor/EditorUtil",["almworks/util/Log","structure/widget/model/ItemRow"],function(f,b){return{RowStates:{EDITING:0,UPLOAD_PENDING:1,UPLOAD_STARTED:2,UPLOAD_FAILED:3,UPLOAD_FINISHED:4,EDIT_CANCELLED:5,UPLOAD_CANCELLED:6},RowEditStates:{EDITING:1,SUCCESS:2,CANCEL:3},newRowAdjustment:function(g,d){f.assert(0>g,
g);return function(e){var a=0===d.under?0:e.rowDepth(e.indexOf(d.under))+1,a=new b(g,a,!0);e.cP([a],d.under,d.after)}}}});define("structure/widget/ui/editor/IssueCreationParameters","almworks/jquery almworks/util/Util almworks/util/Template structure/widget/attributes/Attributes structure/widget/ui/editor/IssueCreationContextManager structure/widget/model/Items".split(" "),function(f,b,g,d,e,a){function n(a,e){this.panel=a;this.container$=f("<div></div>");this.widget=a.widget;this.hG=e;this._$={};this.idPrefix="s"+l++ +"-";var d=c.getStored("new.clone.mode"),d=d?"true"===d: !0,q=e.bC&&e.bC.creationContext&&e.bC.creationContext.sample;q&& !e.panel.getRowSummary(q)&&(q=void 0);var k=this;this.cells={};this.cells.sample=new b.Cell(q);this.cells.cloneMode=q?(new b.Cell(d)).pipeChanges(function(a){c.setStored("new.clone.mode",a?"true":"false")}):new b.Cell(!1);this.cells.project=(new b.Cell("0")).pipeChanges(function(a){k.cells.cloneMode.value()||k.cells.pickedProject.setValue(a)});this.cells.pickedProject=(new b.Cell(c.getStored("new.project")||"0")).pipeChanges(function(a){k.cells.cloneMode.value()||k.cells.project.setValue(a);a&&c.setStored("new.project",a)});this.cells.type=(
new b.Cell("0")).pipeChanges(function(a){k.cells.cloneMode.value()||k.cells.pickedType.setValue(a)});this.cells.pickedType=(new b.Cell(c.getStored("new.issuetype")||"0")).pipeChanges(function(a){k.cells.cloneMode.value()||k.cells.type.setValue(a);a&&c.setStored("new.issuetype",a)});this.cells.ll=new b.Cell(!1);this.cells.createMode=new b.Cell(this.cells.cloneMode,function(a){return!a});this.cells.lj=new b.Cell(!1);this.cells.output=(new b.Cell(this.cells.cloneMode,this.cells.project,this.cells.type,this.cells.lj,function(a,c,h,e){return e?{mode:a?"clone":"new",pid:a?0:b.toIntSafe(c,0),issuetype:a?"":h}:null})).setDelay(200);this.cells.kZ=new b.Cell(!1);this.cells.km=new b.Cell(!0);this.cells.controlsLoaded=new b.Cell(this.cells.kZ,this.cells.km,b.and);this.presenters={cloneMode:new b.CheckboxPresenter(this.cells.cloneMode),project:new p.SingleSelectPresenter(this.cells.project),type:new p.SingleSelectPresenter(this.cells.type)};this.initHtml();this.jS();this.cells.output.pipe(function(a){a&&e.kd(a)});this.cells.project.pipeChanges(b.delayed(100,this.presenters.type.viewChanged,this.presenters.type))}var c=namespace("almworks.structure"),p=namespace("almworks.structure.ajsbridge"),
m=b.requireGlobal("AJS"),k=b.requireGlobal("JIRA"),r=g.load("structure.widget.ui.editor.issue-creation-panel"),l=1;b.extend(n.prototype,{initValue:function(){var a=this,b=this.cells.sample.value();if(b){var c=this.panel.getAttributeValue(b,d.PROJECT_ID)||"0",e=this.panel.getAttributeValue(b,d.ISSUETYPE_ID)||"0";"0"!==e&&(this.kr=e,this.loadSubtaskTypesIfNeeded())}this.cells.cloneMode.pipe(function(b){a.cells.project.setValue(b?c:a.cells.pickedProject.value());a.cells.type.setValue(b?e:a.cells.pickedType.value())})},initHtml:function(){var a=r.render$().saveBindings(this._$);this.container$.empty().append(a);var c=this._$,e=this.cells.sample.value();e?(a=this.hG.panel.getRowKey(e)||"",e=this.hG.panel.getRowSummary(e)||"",80<e.length&&(c.clonedIssueSpan.attr("title",b.htmlEscape(e)),e=e.substring(0,77)+"..."),c.clonedIssueSpan.text(a?a+" "+e:e),this.presenters.cloneMode.setView(c.cloneCheckbox)):this.container$.find(".s-newp-clone").hide();new b.ElementClassToggler(this.cells.cloneMode,"s-disabled",c.projectTypeSection,!1);(new b.Cell(this.cells.cloneMode,this.cells.ll,b.and)).pipe(function(a){b.showHide(c.typesDiv,!a);b.showHide(c.typesSubtaskDiv,a)})},jS:function(){
this.widget.jiraConfig.kx(b.withThis(this,this.lz))},lz:function(a,e){var d=a&&a.project&&a.project.createHtml;d?this._$.projectDiv.html(d):this._$.projectDiv.html(b.renderTemplate('<span class="s-newp-pt-err">{s.w.editor.new.project.error}</span>'));var l=a&&a.issuetype&&a.issuetype.createHtml;l?(this._$.typesDiv.html(l),this._$.typesDiv.find("option[value='']").remove()):this._$.typesDiv.html(b.renderTemplate('<span class="s-newp-pt-err">{s.w.editor.new.type.error}</span>'));var k=this.idPrefix;this.container$.find("[id]").each(function(){this.id=k+this.id});this.container$.find("label[for]").each(function(){var a=f(this);a.attr("for",k+a.attr("for"))});this.container$.find(".project-field").removeClass("project-field").addClass("s-project-field");this.container$.find(".issuetype-field").removeClass("issuetype-field").addClass("s-issuetype-field");this.loadSubtaskTypesIfNeeded();this.cells.kZ.setValue(!0);!a&&e&&this.widget.errorCentral.reportError(new c.error.AppError(b.text("s.w.editor.new.pt.error"),e.title+"\n\n"+e.details));d&&l||this.cells.cloneMode.setValue(!0)},loadSubtaskTypesIfNeeded:function(){if(this.kr&&this.widget.jiraConfig.lk(this.kr)&& !this.km){this.km= !0;
this.cells.km.setValue(!1);var a=this.hG.getSampleForNewIssue(),a={issueId:this.hG.issueId,creationContext:{pid:0,issuetype:"",mode:"clone",sample:a.rowId,sampleIssueId:a.issueId},field:"issuetype",ii:b.withThis(this,this.jV),jw:b.withThis(this,this.jX)};this.widget.jiraConfig.gB(a);this.cells.ll.setValue(!0)}},jX:function(a){if(a=(a=a&&a.fields)&&a.issuetype&&a.issuetype.createHtml){this._$.typesSubtaskDiv.html(a);var c=this.idPrefix+"subtask-";this._$.typesSubtaskDiv.find("[id]").each(function(){this.id=c+this.id});this._$.typesSubtaskDiv.find(".issuetype-field").removeClass("issuetype-field").addClass("s-issuetype-field");this.installSubtaskTypeField()}else this._$.typesSubtaskDiv.html(b.renderTemplate('<span class="s-newp-pt-err">{s.w.editor.new.type.error}</span>'));this.cells.km.setValue(!0)},jV:function(a){this.jX(null)},kt:function(){m.$(this._$.spinner).spin();this.cells.controlsLoaded.value()&& !this.gl&&(this.gl= !0,this.lw(),this.cells.lj.setValue(!0))},lw:function(){function a(){var b=m.$(l).val();this.ks=new e({element:l,revertOnInvalid: !0,pageSize:50,pagingThreshold:100,model:d});new p.SingleSelectEnabler(this.cells.createMode,this.ks);
this.presenters.project.setView(this.ks,!c);var h=this.cells.project.value();h&&"0"!==h||this.cells.project.setValue(b);c&&this.presenters.project.sync(!0);(b=this.cells.pickedProject.value())&& !this.presenters.project.isValidViewValue(b)&&((b=this.presenters.project.getViewValue())&&"0"!==b||(b=this.presenters.project.getFirstNonEmptyValue()),this.cells.pickedProject.setValue(b))}function b(){n.bind("reset",function(){n.find("option[value='']").remove()}).trigger("reset");this.jP=new m.SingleSelect({element:n,revertOnInvalid: !0,model:d});var a=this._$.typesDiv.find("#"+g.id+"-projects"),e=this._$.typesDiv.find("#"+g.id+"-defaults");this.jP.model.remove("");new k.ProjectIssueTypeSelect({project:m.$(l),issueTypeSelect:this.jP,projectIssueTypesSchemes:m.$(a[0]),issueTypeSchemeIssueDefaults:m.$(e[0])});new p.SingleSelectEnabler(this.cells.createMode,this.jP);this.presenters.type.setView(this.jP,!c);c&&this.presenters.type.sync(!0);(a=this.cells.pickedType.value())&& !this.presenters.type.isValidViewValue(a)&&this.cells.pickedType.setValue(this.presenters.type.getViewValue())};if(m.SingleSelect){var c="0"!==this.cells.project.value()&&"0"!==this.cells.type.value(),e=window.require(
"jira/ajs/select/scrollable-single-select"),d=window.require("jira/ajs/select/suggestion-collection-model"),l=this._$.projectDiv.find(".s-project-field")[0];l&&a.call(this);var g=this._$.typesDiv.find(".s-issuetype-field")[0],n=m.$(g);g&&b.call(this);if(this.ks&&this.jP){var r=this._$.typesDiv.find(".project-issue-types"),z=this._$.typesDiv.find(".default-project-issue-type"),F=n.find("option:selected");if(F.length){var A=F.val();n.find("option").each(function(){var a=f(this);a.val()===A?a.attr("data-selected","selected"):a.removeAttr("data-selected")})}r[0]&&z[0]&&k.ProjectIssueTypeSelect&&new k.ProjectIssueTypeSelect({project:m.$(l),issueTypeSelect:n,projectIssueTypesSchemes:r,issueTypeSchemeIssueDefaults:z})}}},installSubtaskTypeField:function(){var a=this._$.typesSubtaskDiv.find(".s-issuetype-field")[0];if(a&&m.SingleSelect&& !this.kW){var c=window.require("jira/ajs/select/suggestion-collection-model");this.kW=new m.SingleSelect({element:a,revertOnInvalid: !0,model:c});b.assert(this.kr,this);new p.SingleSelectPresenter(new b.Cell(this.kr),this.kW);new p.SingleSelectEnabler(new b.Cell(!1),this.kW)}},kV:function(a,b){var c=a.target,e=this.ks&&this.ks.$field,d=this.jP&&
this.jP.$field;if(!e|| !d)return!1;if(c===b[0])this.cells.cloneMode.setValue(!1),e.focus().select();else if(e&&c===e[0]){if(p.mc(this.ks,a))return!0;this.cells.cloneMode.setValue(!1);d.focus().select()}else{if(d&&c===d[0]&&p.mc(this.jP,a))return!0;b.focus()}return!0},lx:function(a,b){if(!this._$.cloneCheckbox.is(":visible"))return!1;this.cells.cloneMode.setValue(!this.cells.cloneMode.value());b.focus();return!0},validateProjectId:function(a){var c=this._$.projectDiv.find(".s-project-field");if(!a|| !c.length)return "0";if(c.is("input")){var e=c.attr("id");if(e&&(e=this._$.projectDiv.find("#"+e+"-options").attr("data-suggestions")))try{var d=window.JSON.parse(e);if(d&&d.length){var f=null;return d.some(function(b){return b&&b.items&&b.items.some(function(b){if(!b)return!1;!f&&b.selected&&(f=b.value);return b.value==a})})?a:f||c.val()||"0"}}catch(l){b.warn("failed to process project select element: "+l)}b.warn("unknown project select element structure")}return c.val()||"0"},getContextManager:b.lazy(function(){return new e(this.panel)}),isSameItemType:function(b){return a.isIssue(b)},isOutputReady:function(){return! !this.cells.output.value()}});return n});define(
"structure/widget/ui/editor/IssueCreationContextManager",["almworks/jquery","almworks/util/Util"],function(f,b){function g(b){this.panel=b}var d={rowId:0};Object.freeze(d);b.extend(g.prototype,{lp:function(e){if(0<this.rowId)return null;var a=e.bC;if(!a|| !a.creationContext)return null;a=b.extend({},a.creationContext);a.sample=e.getSampleForNewIssue();return a.sample.rowId||a.pid&&a.issuetype?a:null},kd:function(e,a){var d=b.extend(e.bC.creationContext,{mode:a.mode,pid:a.pid,issuetype:a.issuetype}),c=this.panel.widget.jiraConfig.gZ();this.panel.widget.attributeManager.kJ(e.forestSpecForAttributes,e.rowId,d,c)},prepareContext:function(b){return f.extend({},b,{pid:0,issuetype:"",mode:"new",parentIssue:0})},getSample:function(b,a){return{rowId:b,issueId:a.sampleIssueId}},getNullSample:b.returnConst(d)});return g});define("structure/widget/ui/editor/ItemEditor",
"almworks/jquery underscore almworks/util/Util almworks/util/JSON structure/widget/ui/editor/EditorUtil structure/widget/model/Items structure/widget/ui/column/EditableColumn structure/widget/model/DataForest structure/widget/ui/editor/RowEditState structure/widget/attributes/Attributes structure/widget/spec/SpecController structure/widget/generator/GeneratorUtil structure/widget/model/Rows".split(" "),function(f,b,g,d,e,a,n,c,p,m,k,r,l){function h(a){return 0<arguments.length?(s.setStored("prefer.create.dialog",a?"true":"false"),a):"true"===s.getStored("prefer.create.dialog")}function u(){return!s.modes.GADGET&&s.openCreateIssueDialog}var s=namespace("almworks.structure"),q=namespace("almworks.structure.appevents"),x=e.RowStates,t=e.RowEditStates,w={};w[x.EDITING]=t.EDITING;w[x.UPLOAD_PENDING]=t.EDITING;w[x.UPLOAD_STARTED]=t.EDITING;w[x.UPLOAD_FINISHED]=t.SUCCESS;w[x.UPLOAD_FAILED]=t.EDITING;w[x.EDIT_CANCELLED]=t.CANCEL;w[x.UPLOAD_CANCELLED]=t.CANCEL;var t={name:g.text("s.w.editor.inplace.type.issue"),type:a.ISSUE},v={name:g.text("s.w.editor.inplace.type.folder"),type:a.FOLDER},C={name:g.text("s.w.editor.inplace.type.page"),type:a.CONFLUENCE_PAGE},z=[t,v];return function(t){
function A(a,b){s.bG.call(this,t);this.rowId=a;this.edit=b;this.itemId=b.itemId;this.hT=b.hB;this.forestSpec=b.forestSpec}function D(b,c,e){s.bG.call(this,t);g.assert(0>b);this.tempRowId=b;this.edit=c;this.priority=e;this.forestSpec=c.forestSpec;this.spec={forest:{spec:c.forestSpec},items:{},rowId:b,item:{itemId:c.itemId,type:c.itemType,values:c.itemType===a.ISSUE?{issue:g.extend({},c.jiraDialogData,c.hB)}:g.extend({},c.hB)},semantics:0,parameters:{}};this.init()}function v(b,c,e,h){D.call(this,b,e,h);g.assert(0<c);this.spec.item={itemId:a.issue(c)}}function B(){var a=t.panelName+".ItemEditor",b=0,c= !1,e=0;g.eachValue(oa,function(a){a.hasUploadErrors&&(b++,a.hJ?(c||(e=a.rowId),c= !0):e||(e=a.rowId))});if(b){var h;h=(c?"s.w.editor.footer-warning.blocking":"s.w.editor.footer-warning")+(1===b?".1":".n");xa.show(a,g.text(h,b),g.text("s.w.editor.footer-warning.tooltip"),function(){var a=T(e);(a=a&&a.column)&&K(e,a)})}else xa.hide(a)}function K(c,e,h){if(!(c&&e&& !t.isReadOnly()&&e.isInstanceOf(n)&&e.isEditableColumn()&&t.hh(c,!1,e.isUniversal())))return null;var d=t.bd(),l=d.row(d.indexOf(c));if(!l)return null;if(d=l&&a.getGeneratorId(l.itemId))return r.showEditGeneratorDialog(
"generatorId="+d,{id:"s-generator-edit"},g.noop),null;var d= !1,k=oa[c];if(k){if(g.assert(!h),k.bm.value()===x.UPLOAD_STARTED)return null}else oa[c]=k=new p(c,t,h),k.itemId=l.itemId,d= !0;var m=document.activeElement,s=e.getCsid();if(l=k.ho[s]){if(l.jq())return k;l.cS()}else{l=e.createCellEditor(k);if(!l)return null;l.om(0>c&&k.itemType===a.ISSUE&&u());k.kF[s]&&(g.assert(0>c,s),l.lq(k.kF[s]),k.kF[s]=null);h&&l.setTabItems(t.widget.jiraConfig.isConfluenceAvailable()?b.union(z,[C]):z);if(!l.cS())return g.warn("cannot start edit "+c+" column "+e),null;g.assert(l.jq());k.ho[s]=l}k.bm.setValue(x.EDITING);h=l.hc();g.assert(! !h,h);m&&m!==window&&m!==window.document&& !f(m).closest(".s-editorpanel").length&&(y=m);(h=pa.value())&&h!==l&&P(h);pa.setValue(l);t.aS().aM(c,!0);ia();l.takeFocus();d&&ya.fireEvent(q.dz,la,c);ua=e;Ea= !0;try{t.cc().focusRow(c,!0)}finally{Ea= !1}fa();return k}function J(a){if(!Ea&& !na){var b=pa.value();if(b&&a!==b.rowId){var c= ! !a;c&&(c= ! !K(a,b.column));c||E()}}}function O(b,c,d,l,m,n){if(t.isReadOnly()||oa[b])return!1;g.assert(0>b,b);var r;r=t.getVersionedSpec().spec;r=k.getSpecForAttributes(r);ta.prepareRowDataForNew(r,b);r=Y();var N=e.newRowAdjustment(b,d);
r.add(N);var w=pa.value();w&&P(w);c=c||s.getStored("new.item.type")||a.ISSUE;s.setStored("new.item.type",c);d={rowId:b,itemType:c,placement:d,aV:N};d.creationContext={sample:l,sampleIssueId:m};t.bn().fs();l=t.af().gj();var C;if(n||c===a.ISSUE&&h())if(u()&&b&& !t.isReadOnly()&&t.hh(b)){(C=pa.value())&&P(C);g.assert(!oa[b]);C=oa[b]=new p(b,t,d);C.bm.setValue(x.EDITING);(m=document.activeElement)&&m!==window&&m!==window.document&& !f(m).closest(".s-editorpanel").length&&(y=m);ya.fireEvent(q.dz,la,b);Ea= !0;try{t.cc().focusRow(b,!0)}finally{Ea= !1}va(C)?fa():(L(C,b),C=null)}else C=null;C||n||(C=K(b,l,d));C?C.jU():r.remove(N);return C}function V(){if(y){if(g.isVisibleOnPage(y))try{f(y).focus()}catch(a){}y=null}}function U(a){a&&(a.gW(),a===pa.value()&&pa.setValue(null))}function P(a){a&&(a.fV(),a===pa.value()&&pa.setValue(null),a.hG.bC&&a.tabsCell&&s.setStored("new.item.type",a.tabsCell.value()))}function Y(){return aa.dC(t.getVersionedSpec().spec)||new c}function N(a,b){var c=oa[a];c&&(delete oa[a],g.eachValue(c.ho,P),c.bC&&Y().remove(c.bC.aV),ta.clearAllDirtyFields(k.getSpecForAttributes(c.forestSpec),a,b),ta._eventBus.postEvent(q.VALUES_REQUIRED),t.aS().aM(a,!0),g.eachValue(c.ho,U),
ya.fireEvent(q.aN,la,a,b),b&&ya.fireEvent(q.kD),B())}function L(a,b){if(!a)return!1;g.assert(oa[b]===a,b);if(a.bm.value()===x.UPLOAD_STARTED)return!1;a.bm.setValue(x.EDIT_CANCELLED);a.createDialog&&(a.createDialog.hide(),$=a.createDialog=null);N(b,!1);if(0>b){var c=[];qa.dv(function(a){var e=a.aB(b,null);e&&a.edit&&(c.push(a.edit.rowId),a.edit.bm.setValue(x.UPLOAD_CANCELLED));return!e});ya.fireEvent(q.REPLACE_ROW_IDS,[b],[null],a.forestSpec);if(c.length)for(var e=0;e<c.length;e++){var h=c[e],d=oa[h];d&&L(d,h)}a.hJ&&qa.hx(a.rowId)}ia();return!0}function fa(){g.eachValue(oa,function(a){$&&$===a.createDialog||g.findKey(a.ho,function(a){return a&&a.jq()})||ba(a.rowId)})}function X(a){return a?a.bm.value()===x.UPLOAD_FINISHED?(L(a,a.rowId),!1):a.bm.value()!==x.EDITING? !1: !0: !1}function M(a,b){var c={},e= !g.isEmpty(a.kF);g.eachValue(a.ho,function(h,d){e&&(a.kF[d]=null);b?P(h):h.im();g.extendOwn(c,h.gg())});if(e){var h={};g.eachValue(a.kF,function(a){g.extendOwn(h,a)});g.extendOwn(h,a.hB);c=h}return c}function ba(a){var b=oa[a];if(!X(b)|| !b.createDialog&&b.bz()&& !b.bz().isOutputReady())return!1;b.gM();b.hB=M(b,!0);var c=g.isEmpty(b.hB);if(!c){var e=b.bC;e?(g.assert(a===e.rowId),
g.assert(0>a),g.assert(! !e.aV),b.hB.summary?(e= ! !b.hJ,qa.enqueue(new D(a,b,e)),e&&(b.hJ= !1,qa.hx(a))):c= !0):qa.enqueue(new A(a,b))}c?L(b,a):b.bm.setValue(x.UPLOAD_PENDING);ia();return!c}function E(){g.eachValue(oa,function(a){ba(a.rowId)});V()}function I(a,b,c){g.eachValue(oa,function(e){k.areUntransformedSpecsEqual(e.forestSpec,c)&&e.bm.value()!==x.UPLOAD_STARTED&&e.rowId!==a&&e.aB(a,b)&& !b&&L(e,e.rowId)})}function ma(){return pa.value()}function R(){var a=pa.value();a&&(a=a.hG)&&(L(a,a.rowId),g.assert(!pa.value()));E()}function S(){var a=pa.value();if(a)if(l.isLocalRow(a.rowId)){var b=a.hG;g.isEmpty(M(b))&&g.deepEquals(Q(b.jiraDialogActiveFields,b),Q(b.jiraDialogInitialActiveFields,b))||window.confirm(g.text("s.w.editor.inplace.cancel-confirmation"))?R():a.takeFocus()}else a.fV(!0),E()}function ga(a){g.eachValue(a.ho,da)}function da(a){a.iR()}function ia(){var a=0,b=pa.value();b&&b.hv&&(a=Math.max(b.hv.height(),0),0<a&&(a+=5));Fa.setValue(a)}function T(a){a=oa[a];if(!a|| !a.hasUploadErrors)return null;var b=g.findKey(a.ho,function(a){return a&&a.iS()});return b&&a.ho[b]}function Aa(a,b){a=k.getSpecForAttributes(a);var c=ta.getAttributeValue(a,b,m.KEY_TEXT);return c?c:(c=
ta.getAttributeValue(a,b,m.SUMMARY_TEXT))?c:"#"+b}function Z(a,c){var e=a.panel,h=e.af().gj();e.cc().oQ(a.rowId,function(d){var f=d.getCsid(),l=a.ho[f];if(l)l.cS(),l.applyData(c),l.fV();else if(l=d.createCellEditor(a))l.setTabItems(e.widget.jiraConfig.isConfluenceAvailable()?b.union(z,[C]):z),l.om(!0),l.cS(),l.applyData(c),l.fV(),l.hS()||h.getCsid()===f?a.ho[f]=l:l.gW()})}function va(a){function b(c){a.bz().cells.project.setValue(""+c)}function c(b){a.bz().cells.type.setValue(""+b)}if(!u())return!1;var e;a||(e=ma(),a=e.hG);if(a){if($)return a.createDialog=$,!0;var d=a.panel;if(!X(a))return!1;a.hB=M(a,!0);if(!a.bC)return!1;var f=a.bC.creationContext,l,q,n=a.bz().cells.cloneMode.value(),p= ! !d.widget.jiraConfig.getFeature("altInitialValuesInDialog");!n&& !p|| !f.sample||0!==f.pid&&""!==f.issueType?0===f.pid||""===f.issueType?(l=s.getStored("new.project")||0,q=s.getStored("new.issuetype")||0):(l=f.pid,q=f.issuetype):(l=(f=ta.aR(k.getSpecForAttributes(a.forestSpec),f.sample))&&f.getValue(m.PROJECT_ID)||0,q=f&&f.getValue(m.ISSUETYPE_ID)||0);n&&a.bz().cells.cloneMode.setValue(!1);q=g.toInt(q);var r={cancel:function(){$=a.createDialog=null;L(a,a.rowId);E()},inline:function(b,c,f){$=
a.createDialog=null;h(!1);var l=a.panel.af().gj();Z(a,b);a.jiraDialogData=b;a.jiraDialogActiveFields=f;a.bz().cells.cloneMode.setValue(!1);a.bz().cells.project.setValue(""+b.projectId);a.bz().cells.type.setValue(""+b.issueType);c&&a.jj({fieldErrors:c});a.bm.setValue(x.EDITING);e||(e=a.ho[l.getCsid()]);e&&e.getRowId()!==a.rowId&&g.warn("Incoherent row for edit("+a.rowId+") and activeEditor("+e.getRowId()+")");pa.setValue(e);e.cS();d.aS().aM(a.rowId,!0);ia();e.takeFocus();Ea= !0;try{d.cc().focusRow(a.rowId,!0)}finally{Ea= !1}},submit:function(b,c,h){Z(a,h);h= ! !a.hJ;qa.enqueue(new v(a.rowId,b,a,h));h&&(a.hJ= !1,qa.hx(a.rowId));a.bm.setValue(x.UPLOAD_PENDING);c?(b=d.aZ().nextTemporaryRowId(),c=g.extendOwn({},a.bC.placement),h=a.bC.creationContext.sample,0!==c.under&&d.ao().by(c.under,!0),c.after=a.rowId,a=O(b,a.itemType,c,h,a.bC.creationContext.sampleIssueId,!0),e=null,g.assert(null===pa.value()),d.ao().kK(b,d.bs()),d.bn().aJ()):$=a.createDialog=null},onProjectId:b,onIssueType:c,openFailed:function(){g.eachValue(a.ho,function(a){a.om(!1)})},onJiraDialogInit:function(b){g.isEmpty(a.jiraDialogInitialActiveFields)&&(a.jiraDialogInitialActiveFields=b)}},Y=g.extend({},Q(g.clone(
a.jiraDialogData),a),a.hB),t=$=a.createDialog={hide:g.noop};a.bz().cells.kZ.pipeOnce(function(a){return a},function(){l=a.bz().validateProjectId(l);l=g.toIntSafe(l,0);var e=d.widget.jiraConfig.validateStructuredProjectId(l);e&&e!==l&&(l=e,q=null);l&&(b(l),q&&c(q));s.openCreateIssueDialog(l,q,Y,a.hA,n,a.panel.widget,r,t)})}return!0}function Q(a,b){g.eachValue(b.ho,function(b){b=b.getInputData();for(var c in b)delete a[c]});delete a.project;delete a.issuetype;return a}function sa(){g.eachValue(oa,function(a){g.eachValue(a.ho,function(a){a.jr()})})}var ta=t.widget.attributeManager,ya=t.bD(),qa=t.widget.ad,aa=t.widget.forestCache,la=this,oa={},pa=(new g.Cell).setValue(null),Fa=(new g.Cell).setValue(0),y,ua=null,Ea= !1,na= !1,$=null;pa.pipeChanges(function(){na= !1});g.extend(A.prototype,s.bG.prototype,{aj:function(){return this.hT},bN:function(a){return function(){return null}},isOverridingAction:function(a){return a instanceof A&&this.rowId===a.rowId},aB:function(a,b){var c=this.edit.aB(a,b);this.rowId===a&&(g.assert(c,this.edit),c= !0,this.rowId=b);return c}});qa.aF({dw:function(b){function c(a){var b= !(!a|| !a.success);b?(e.edit.bm.setValue(x.UPLOAD_FINISHED),N(e.rowId,!0)):(
e.edit.jj(a),t.aS().aM(e.edit.rowId,!1),B());ya.fireEvent(q.EDIT_UPLOAD_FINISHED,{rowId:e.edit.rowId,itemId:e.edit.itemId},b)}var e=b[0];if(!(e instanceof A)||0>e.rowId)return null;e.jobId?(b={jobId:e.jobId},e.jobId=null):(b={item:{itemId:a.completeItemId(e.itemId),values:e.hT},items:{version:t.widget.attributeManager.getItemsVersion()},forest:{spec:e.forestSpec,version:t.widget.forestCache.getCurrentVersion(e.forestSpec)}},e.edit.bm.setValue(x.UPLOAD_STARTED));return{count:1,url:s.ajax.RESOURCES2g.ITEM.UPDATE,data:d.stringify(b),cB: !1,es:c,eI:c}}});g.extend(D.prototype,s.bG.prototype,{action:"add",aj:function(){return this.spec},bN:function(a){return function(){return null}},isOverridingAction:function(a){return a instanceof D&&this.tempRowId===a.tempRowId},aB:function(a,b){return this.edit.aB(a,b)?(this.init(),!0): !1},init:function(){g.extendOwn(this.spec,this.edit.bC.placement);this.edit.bC.creationContext&&this.spec.item&&this.spec.item.values&&(g.extend(this.spec.item.values,this.edit.bC.creationContext),"clone"!==this.spec.item.values.mode&&(this.spec.item.values.sample=0))}});g.extend(v.prototype,D.prototype,{isOverridingAction:function(a){return(a instanceof D||
a instanceof v)&&this.tempRowId===a.tempRowId}});qa.aF({dw:function(a,b){function c(a){return! !(0>a||b&&b[a])}function e(a){h.edit.jj(a);h.edit.hJ= !0;qa.iP(h.tempRowId);t.aS().aM(h.edit.rowId,!1);B()}var h=a[0];if(!(h instanceof D||h instanceof v))return null;var f;if(h.jobId)f={jobId:h.jobId},h.jobId=null;else{f=h.spec;if(c(f.under))return g.debug("cannot upload creation of a new issue under "+f.under),null;if(c(f.after))return g.debug("cannot upload creation of a new issue after "+f.after),null;if(c(f.before))return g.debug("cannot upload creation of a new issue before "+f.before),null;var l=f.item&&f.item.values&&f.item.values.sample;if(l&&c(l))return g.debug("cannot upload creation of a new issue with sample "+l),null;if(l){var k=t.widget.forestCache.getItemIdByRowId(f.forest.spec,l);k||g.debug("cannot resolve item ID for cloning: "+l);f.item.values.sampleItemId=k}f.forest.version=t.widget.forestCache.getCurrentVersion(f.forest.spec);f.items.version=t.widget.attributeManager.getItemsVersion();h.edit.bm.setValue(x.UPLOAD_STARTED)}return{count:1,url:s.ajax.RESOURCES2g.ITEM.CREATE,data:d.stringify(f),cB: !0,es:function(a){var b=a.itemId;b&&(h.edit.itemId=b,h.spec.item.itemId=b);
0<g.toIntSafe(a.successfulActions,0)?(h.edit.bm.setValue(x.UPLOAD_FINISHED),N(h.tempRowId,!0)):a.updateError?(h.edit.bm.setValue(x.UPLOAD_FAILED),h.edit.hJ= !0,qa.iP(h.tempRowId)):e(a)},eI:e}}});var xa=t.widget.footerWarning;g.extend(this,{cu:function(){return!g.isEmptyOrFalsy(oa)},isReallyEditingNow:function(){return this.cu()&& ! !g.findKey(oa,function(a){return a.bm.value()===x.EDITING})},isEditingRow:function(a){return! !oa[a]},kH:function(a){if(!(0>a))return!1;a=oa[a];return!(!a||a.bm.value()===x.UPLOAD_STARTED)},getCellEditor:function(a,b){var c=oa[a];return c&&c.ho[b]},getRowEdit:function(a){return oa[a]},po:function(a){a=(a=this.getRowEdit(a))?new g.Cell(a.bm,g.curry(g.accessArray,w)):new g.Cell(null);return a},editRow:K,fN:O,moveNew:function(a,b,c){var h=oa[a];if(!h)return!1;var d=h.bC;if(!d||h.bm.value()===x.UPLOAD_STARTED)return!1;d.placement.under=b;d.placement.after=c;d.placement.before=t.bs().getBeforeForAfter(b,c);b=d.aV;d.aV=e.newRowAdjustment(a,d.placement);Y().replace(b,d.aV);h.bm.value()===x.UPLOAD_FAILED&&(h.bm.setValue(x.EDITING),ba(a));return!0},gf:function(){g.eachValue(oa,L);V()},finishAllEdits:E,cancelCurrentRowEdit:R,cancelSpecifiedRowEdit:function(a){
var b=oa[a];if(!b)return!1;a=L(b,a);E();return a},cancelCurrentCellEdit:S,finishEdit:ba,hH:function(a){if(!a|| !a.target)return null;var b=s.apputil.getRowIdFromEvent(a);if(!b)return null;b=oa[b];if(!b)return null;var c=f(a.target).parents().andSelf(),e=null;g.eachValue(b.ho,function(a){var b=a.hc();if(b&&b.length&&0<=g.indexOf(c,b[0]))return e=a,!1});return e},fQ:ma,hE:function(){return pa},fS:function(){return Fa},je:function(){g.eachValue(oa,ga)},gq:function(){return ua},ik:ia,isRowEditedAndHasUploadErrors:function(a,b){var c=oa[a];return c&&c.hasUploadErrors?b?(c=c.ho[b.getCsid()])&&c.iS(): !0: !1},getFirstCellEditorWithError:T,revertCurrentCellEdit:function(){var a=pa.value();a&&a.kS(!0,!0)},getUncommittedItems:function(){var a=[],b=0;g.eachValue(oa,function(c){c.ie()&&(0>c.rowId?b++ :a.push(Aa(c.forestSpec,c.rowId)))});return{changed:a,"new":b}},kX:function(a){if(0<a)return!0;a=oa[a];if(!a)return!0;var b= !1;g.eachValue(a.ho,function(a){if(a.hasSummary)return b=a.hasSummary(),!1});return b},switchToDialog:function(){var b=this.fQ();b.hasTabs()&&b.getCurrentItemType()!==a.ISSUE||va(null)&&h(!0)},canCreateDialog:u,nM:h});la[q.ar]=sa;la[q.au]=sa;la[q.eu]=J;la[q.mg]=function(a,b)
{var c=pa.value();if(c){if(c=b===t&&a&&a.rowId(0)===c.rowId)for(var e=1,h=a.size();e<h;e++)if(0===a.rowDepth(e)){c= !1;break}c?na= !0:E()}};la[q.aq]=g.delayed(50,function(){if(na){na= !1;J(t.ao().bc());var a=pa.value();a&&a.takeFocus()}});la[q.cv]=S;la[q.REPLACE_ROW_IDS]=function(a,b,c){for(var e=0,h=a.length;e<h;e++)I(a[e],b[e],c)};ya.addListener(new g.Life,la)}});define("structure/widget/ui/editor/RowEditState","almworks/util/Util structure/widget/ui/editor/EditorUtil structure/widget/model/Items structure/widget/ui/editor/IssueCreationParameters structure/widget/ui/editor/ConfluenceCreationParameters structure/widget/model/DataForest".split(" "),function(f,b,g,d,e,a){function n(c,n,m){this.rowId=c;this.panel=n;this.forestSpec=n.getVersionedSpec().spec;this.forestSpecForAttributes=n.getSpecForAttributes();this.forestUploadAdjust=n.widget.forestCache.dC(this.forestSpec)||new a;this.ho={};this.hB={};this.jiraDialogData={};this.jiraDialogInitialActiveFields={};this.jiraDialogActiveFields={};this.kF={};this.bm=new f.Cell(b.RowStates.EDITING);this.bC=m;this.creationControllers={};this.creationControllers[g.ISSUE]=new d(n,this);n.widget.jiraConfig.isConfluenceAvailable()&&(
this.creationControllers[g.CONFLUENCE_PAGE]=new e(n,this));0>this.rowId&&m&&(this.itemType=m.itemType,c=this.bz())&&(c.initValue(),this.bC.creationContext=this.withContextManager(function(a){return a.prepareContext(m.creationContext)}))}Object.freeze({rowId:0,issueId:0});f.extend(n.prototype,{aB:function(a,e){f.assert(0<e|| !e,e);var d= !1;this.rowId===a&&(e&&(this.rowId=e),d= !0);f.eachValue(this.ho,function(b){b.aB(a,e)});var k=this.bC,g=k&&k.placement,l=k&&k.creationContext;if(g&&(l&&l.sample===a||g.under===a||g.after===a||g.before===a)&&(d= !0,e)){l&&l.sample===a&&(l.sample=e);if(g.under===a||g.after===a)g.under===a&&(g.under=e),g.after===a&&(g.after=e),l=k.aV,k.aV=b.newRowAdjustment(k.rowId,g),this.forestUploadAdjust.replace(l,k.aV);g.before===a&&(g.before=e)}return d},initCreationController:function(a){this.itemType=a;(a=this.bz())&&a.initValue()},ix:function(a){if("string"!==typeof a)return "";if(!a)return a;var b=f.tail(a,"pid:")||f.tail(a,"issuetype:");return b?b.trim():a.trim()},jj:function(a){this.bm.setValue(b.RowStates.UPLOAD_FAILED);var e=a&&a.formErrors,d=a&&a.fieldErrors;e&&e.length||d&& !f.isEmptyOrFalsy(d)||(e=[f.text("s.w.edit.generic-error")]);
this.hasUploadErrors= !0;var k=[];if(e&&e.length)for(a=0;a<e.length;a++){var g=this.ix(e[a]);g&&k.push(g)}e=f.extend({},this.jiraDialogData,this.hB);if(d){var l={},h=this.panel.widget.jiraConfig.getJiraFieldMap();a=function(a){var b=h[a],b=b?b.name:f.capitalize(a.toLowerCase().replace(/_.*$/,""));return f.text("s.w.edit.error.for.field",b,d[a])};f.eachValue(this.ho,function(a){a=a.getInputData();for(var b in d)d.hasOwnProperty(b)&&b in a&&(l[b]= !0)});for(var n in d)!d.hasOwnProperty(n)||n in l&&n in e||k.push(a(n));k.sort()}f.eachValue(this.ho,function(a){var b=a.getInputData(),c=f.addAll([],k);if(d)for(var e in d)d.hasOwnProperty(e)&&e in b&&c.push(d[e]);a.jB(c)});this.hA=d},gM:function(){this.hasUploadErrors= !1;this.hA=null;f.eachValue(this.ho,function(a){a.jB(null)})},ie:function(){return! !f.findKey(this.ho,function(a){return a&&a.hS()})},ip:function(a){return! !f.findKey(this.ho,function(b){return b&&b!==a&&b.hS()})},getSampleForNewIssue:function(a){return this.withContextManager(function(b){if(0<this.rowId)return b.getNullSample();var e=this.bC;if(!e)return b.getNullSample();if(a&&0<=f.indexOf(a,this.rowId))return f.warn("recursive call "+this.rowId+" "+a.join(",")),
b.getNullSample();var d=e.creationContext&&e.creationContext.sample;if(!d)return b.getNullSample();if(0<=d)return b.getSample(d,e.creationContext);e=this.panel.bh().getRowEdit(d);if(!e)return b.getNullSample();a||(a=[]);a.push(this.rowId);return e.getSampleForNewIssue(a)})},getContextManager:function(){return this.bz()?this.bz().getContextManager():null},withContextManager:function(a){var b=this.getContextManager();return b?a.call(this,b):null},lp:function(){return this.withContextManager(function(a){return a.lp(this)})},kd:function(a){if(this.bC){var b=this.bC.creationContext;if(b){var e=this;f.eachValue(this.ho,function(a,b){if(!a.jq()&& !a.kc()){var c=a.gg();a.gW();e.kF[b]=c}});for(var d in e.kF)e.kF.hasOwnProperty(d)&&null!=e.kF[d]&&(this.ho[d]=null);this.withContextManager(function(e){f.extend(b,e.kd(this,a))});this.panel.aS().aM(this.rowId,!1);this.jU()}}},jU:function(){var a=this.lp();0>this.rowId&& !a||this.panel.widget.jiraConfig.iG({rowId:this.rowId,creationContext:a})},bz:function(){return this.creationControllers[this.itemType]},findSameTypeAncestor:function(){for(var a=this.panel.bs().bL(this.rowId),b=null;!b&&a;){var e=this.panel.bs().aL(a).getItemId();this.bz()&&
this.bz().isSameItemType(e)&&(b=e);a=this.panel.bs().bL(a)}return b}});return n});define("structure/widget/ui/editor/CellEditor",["almworks/jquery","underscore","almworks/util/Util","almworks/util/Template"],function(f,b,g,d){function e(a){function b(a){if(a){var h=a.currentTarget||f(a.target).closest(".s-editorpanel")[0];if(h){var d=e.fQ();if(d&&d.jq()&&h===d.hv[0]){h=a.type;if("keydown"===h)return l&&(c=g.keyboardCodeFromEvent(a)),d.jF(a);if("keyup"===h)return l&&(h=g.keyboardCodeFromEvent(a),l[h]&&h!==c&& !d.jF(a))? !1:d.iB(a);if("mouseup"===h)return d.iU(a);if("click"===h)return d.it(a);if("select"===h)return d.onEditorSelect(a)}}}}if(!a.dK){var e=a.bh();if(e){a.dK= !0;var c=0;m(a.panel$).delegate(".s-editorpanel",{keydown:b,keyup:b,click:b,mouseup:b,select:b})}}}function a(a,b){this._$={};this.gn= ++s;this.hG=a;this.column=b;this.rowId=g.toInt(a.rowId);this.attributeManager=a.panel.widget.attributeManager;this.trCache=a.panel.aS();this.forestSpec=a.forestSpecForAttributes;this.fA=new g.Lifecycle(!1);this.editor$=this.hv=null;this.ajsInitialized= !1;this.gD=this.eo=this.jg=null;this.gI= !1;this.gN=null;this.gX="";this.nV=this.gs= !1;this.jl=g.delayed(10,g.bottlenecked(100,
this.jK,this))}var n=namespace("almworks.structure.appevents");namespace("almworks.structure.columns");var c=namespace("almworks.structure.apputil"),p=namespace("almworks.structure"),m=window.AJS&&window.AJS.$,k=d.load("structure.widget.ui.editor.cell-editor-panel"),r=g.codeMapFromKeyMap({"ctrl+enter":"finishAllEdits","alt+enter":"switchToDialog",enter:"finishAllEdits",escape:"cancelCurrentCellEdit",tab:"nextEditableField","shift+tab":"prevEditableField","ctrl+alt+up":"upEditableField","ctrl+alt+down":"downEditableField","ctrl+alt+left":"leftEditableField","ctrl+alt+right":"rightEditableField"}),l=g.KeyboardManager.BLOCKED_KEYDOWN_CODES,h=g.codeMapFromKeyMap({up:"up",left:"left",right:"right",down:"down","alt+down":"alt+down","alt+up":"alt+up"}),u=["s-e-editor","s-e-noeditor","s-e-loading","s-e-create","s-e-complex"],s=0;g.extend(a.prototype,{hL:g.pvc,jh:g.pvc,ge:g.pvc,om:function(a){this.nV=a;this.ot&& !a?(this.ot.remove(),this.ot=null): !this.ot&&a&&this._$.buttons&&(this.ot=f(g.renderTemplate('<a href="#" class="s-editor-dialog" tabIndex="1002" title="{s.w.editor.dialog.tooltip}">{s.w.editor.dialog}</a>')),this._$.buttons.addClass("s-with-dialog").prepend(this.ot))},nJ:function(
){return this.nV},cS:function(){var a= !this.hv;if(a){var e=this.hG.rowId,c=this.attributeManager.aR(this.forestSpec,e);if(!c||0<e&& !this.hL(c))return!1;this.hv=k.render$().saveBindings(this._$);this.jv()}else this.hv.addClass("s-e-active");this.jq()||this.jL();this.fA.cycleStart();this.jK();a?this.jh()||this.fA.cycleEnd():this.editor$&&(this.eo=this.gO(this.editor$));if(a&&this.tabItems){var h=this;this.tabsCell=new g.Cell(this.hG.itemType);this.populateTabs();this.tabsCell.pipeChanges(function(a,b){if(h._$.tabs){b&&h._$.tabs.find('.s-tab[data-type="'+b+'"]').removeClass("active");h._$.tabs.find('.s-tab[data-type="'+a+'"]').addClass("active");h.hG.itemType=a;var e=h._$.params.find("div.active");e.length&&(e.hide(),e.removeClass("active"));e=h._$.params.find('div[data-type="'+a+'"]');0===e.length?h.installEditorParametersFor(a):(e.show(),e.addClass("active"));h.updateSwitchToDialog(a);h.takeFocus()}});b.findWhere(this.tabItems,{type:this.tabsCell.value()})||this.tabsCell.setValue(this.tabItems[0].type)}return this.fA.isStarted()},jv:function(){e(this.hG.panel);var a=this.hv;a&&(a.data("cellEditor",this),this.gT=a.find(".s-editor-cancel"),this.om(this.nV))},setTabItems:function(a){
this.tabItems=a},populateTabs:function(){if(this.tabsCell)for(var a=0,b=this.tabItems.length;a<b;a++){var e=this.tabItems[a],c=f('<div class="s-tab"></div>');c.html(e.name);c.attr("data-type",e.type);e.type===this.tabsCell.value()&&c.addClass("active");this._$.tabs.append(c)}},ic:function(){return this.hS()},iu:function(){var a=this.ic();this._$.revert.css("visibility",a?"visible":"hidden");this._$.onelineRevert.toggleClass("active",a);this.gT.css("visibility",a||this.hS()||this.hG.ie()?"visible":"hidden")},updateIndentButton:function(){if(this.indentChildCell){var a=this.hG.panel.bs(),b=this.hG.panel.aZ(),e=a.indexOf(this.hG.rowId),c,h=void 0;0<=(c=a.lG(e))?b.eP(this.hG.rowId,a.rowId(c))&&(h= !0):0<=(c=a.aI(e))&&(c=a.aI(c),b.eP(this.hG.rowId,0<=c?a.rowId(c):0)&&(h= !1));this.indentChildCell.setValue(h)}},iK:function(){},isNewItemDetailsEditor:function(){return "main"===this.getColumn().getCsid()&&void 0!==this.hG.bC},hasTabs:function(){return this.isNewItemDetailsEditor()&&void 0!==this.tabItems},iX:function(a){g.assert(!this.editor$);g.assert(! !a);this.editor$=a;this._$.editor.html(a);g.updateClasses(this.hv,["s-e-editor"],u);(0<a.find("textarea").length||1<a.find(
'input[type="text"],select,input[type="checkbox"],input[type="radio"]').length)&&g.updateClasses(this.hv,["s-e-complex","s-e-editor"],u);this.isNewItemDetailsEditor()&&(g.updateClasses(this.hv,["s-e-editor","s-e-complex","s-e-create"],u),this.positionCell=(new g.Cell).pipeChanges(g.withThis(this,this.updateIndentButton)),this.indentChildCell=new g.Cell(null),this.indentChildCell.pipe(function(a){var b=this._$.indent,e=b.find("i");void 0===a?(b.attr("aria-disabled","true"),e.removeClass("alm-outdent").addClass("alm-indent")):(b.attr("aria-disabled","false"),a?e.removeClass("alm-outdent").addClass("alm-indent"):e.removeClass("alm-indent").addClass("alm-outdent"))}.bind(this)),this._$.indent.on("click",function(a){if("true"!==this._$.indent.attr("aria-disabled")){var b=this.hG.panel.ae(),e=this.indentChildCell.value();0>b.indexOf(this.hG.rowId)||(b=e?"levelDown":"levelUp",this.hG.panel.bD().fireEvent(n.ACTION,b,a),this.indentChildCell.setValue(!e),this.takeFocus())}}.bind(this)));a=g.onPage(a);this.jq()&& !a&&this.jL();a&&this.kt();this.fW();this.kn&&this.jN();this.takeFocus(!0)},kk:function(a){a.attr("data-type",this.hG.itemType);a.addClass("active");this._$.params.append(a)},jI:
function(a){g.assert(!this.editor$);this.jB([a]);g.updateClasses(this.hv,["s-e-noeditor"],u);this.jL()},fV:function(a){this.jq()&&(this.fA.cycleEnd(),this.hv.removeClass("s-e-active"),a?this.kS(!1,!1):this.im(),this.ge(),this.lA())},getInputData:function(){return this.gO(this.editor$)},im:function(){if(this.editor$&&this.jg){var a=this.gO(this.editor$);this.iI(this.jg,a)?this.gD=null:this.gD=a}},applyData:function(a){this.gp(a,this.editor$);this.im();this.iu()},kS:function(a,b){var e=a?this.jg:this.eo;this.editor$&&e&&(this.gp(e,this.editor$),this.im(),a&&this.gD&&(g.assert(!1,c.ct(this.gD)),this.gD=null),this.jB(null),this.iu(),b&&this.takeFocus(!0))},gW:function(){this.fV();this.hv&&g.onPage(this.hv)&&(g.warn("editor is still on page after edit stopped ["+this.rowId+","+this.column.getCsid()+"]"),this.hv.remove());this.fA.dispose()},iR:function(){if(this.hv){var a=g.onPage(this.hv);if(a!==this.gI)if(a)this.jn();else this.gI= !1,this.iZ();else a&&this.jr()}},jn:function(){this.hv.find("form").submit(g.returnFalse);this.kt()},kt:function(){this.iK();this.jD().always(function(){g.onPage(this.hv)&&(this.gI= !0,this.jr(),this.takeFocus(!0))}.bind(this));this.jK()},jD:function(){var a=
f.Deferred(),b= !1;if(this.editor$){this.editor$.find(".aui-field-versionspicker > .jira-multi-select, .aui-field-componentspicker > .jira-multi-select").remove();if(this.ajsInitialized)return a.reject(),a.promise();this.editor$.find("select.single-select,select.single-user-picker").length&&(m(this.editor$).on("initialized",a.resolve.bind(a)),b= !0);p.ajsbridge.js(this.hv);this.ajsInitialized= !0;var e=this.editor$.find(".aui-field-datepicker :text");e.length&&m&&m(e[0]).unbind("keydown");b?setTimeout(a.resolve.bind(a),1E3):a.resolve()}return a.promise()},iZ:function(){},jz:function(a,b){if(this.editor$){var e=a&&a.target;if(e&& !a.isDefaultPrevented()){var c=f(e);if(c.is(":input")){if(("alt+down"===b||"down"===b)&&c.is('input[type="text"]')&&m){var h=this.editor$.find(".icon-date:visible,.aui-iconfont-calendar:visible").parent();if(h.length){m(h[0]).click();a.preventDefault();return}}if(this.hasTabs()&&this.editor$.is(":focus")){if("alt+up"==b){this.switchPrevTab();a.preventDefault();return}if("alt+down"==b){this.switchNextTab();a.preventDefault();return}}if("alt+down"!==b&&"alt+up"!==b){if(c.is("select")){if("left"!==b&&"right"!==b)return}else if(c.is(
'input[type="text"],textarea'))return;c=this.editor$.find(":input:visible");e=g.indexOf(c,e);0>e||(e="left"===b||"up"===b?e-1:e+1,0>e||e>=c.length||(c[e].focus(),a.preventDefault()))}}}}},jF:function(a){var b=g.keyboardCodeFromEvent(a),e=r[b];"cancelCurrentCellEdit"!==e&&this.gv&&(this.gv=0);if(e){if(this.hv.find(".atlassian-autocomplete .suggestions:visible").length||f("body > .ajs-layer:visible").length)return!0;if(p.modes.GADGET){var c=this.hv.find(".ajs-layer-placeholder");if(c.length&& !c.children().length)return!0}if(c=a&&a.target){if("cancelCurrentCellEdit"===e&&f(c).is("select")&& !c.multiple&& !this.gv)return this.gv=(new Date).getTime(),!0;if(13===b&&f(c).is("textarea")&& !f(c).is(".jira-multi-select > textarea"))return!0}this.hG.panel.bD().fireEvent(n.ACTION,e,a);13===b&&document.activeElement!==c&&a.preventDefault();return a&&a.consumed? !1: !0}if(b=h[b])this.jz(a,b)},iB:function(a){this.jl()},iU:function(a){this.jl()},onEditorSelect:function(a){this.jK()},installEditorParametersFor:g.pvc,updateSwitchToDialog:g.pvc,switchTab:function(a){this.tabsCell.setValue(a);this.hG.initCreationController(a)},switchNextTab:function(){var a=this.getNextPrevTab(this.getCurrentTab$()
.next(),".s-tab:first");a&&this.switchTab(a)},switchPrevTab:function(){var a=this.getNextPrevTab(this.getCurrentTab$().prev(),".s-tab:last");a&&this.switchTab(a)},getNextPrevTab:function(a,b){var e=this.getCurrentTab$();if(1===a.length)return a.attr("data-type");var c=e.parent().find(b);if(c!==e)return c.attr("data-type")},getCurrentTab$:function(){return this._$.tabs.find(".s-tab.active")},getCurrentItemType:function(){return this.hasTabs()&&this.getCurrentTab$().attr("data-type")||void 0},it:function(a){var b=f(a.target),e=null;if(b.is(".s-editor-save"))e="finishAllEdits";else if(b.is(".s-editor-dialog"))e="switchToDialog";else if(b.is(".s-editor-revert"))e="revertCurrentCellEdit";else if(b.is(".s-editor-cancel")){if(this.hG.ip(this))return this._$.editErrors.find(".s-editor-cancel-confirm").length||(a=0>this.rowId?g.text("s.w.editor.cancel.new.confirm"):g.text("s.w.editor.cancel.edit.confirm"),f('<div class="s-editor-cancel-confirm"><div>'+a+'</div><div class="s-answer"><a href="#" class="s-editor-cancel-yes">'+g.text("s.w.editor.cancel.confirm.yes")+'</a> | <a href="#" class="s-editor-cancel-no">'+g.text("s.w.editor.cancel.confirm.no")+"</a></div></div>").hide().appendTo(
this._$.editErrors).slideDown(200)),!1;e="cancelCurrentIssueEdit"}else if(b.is(".s-editor-cancel-yes"))e="cancelCurrentIssueEdit";else{if(b.is(".s-editor-cancel-no"))return this._$.editErrors.find(".s-editor-cancel-confirm").slideUp(200,function(){f(this).remove()}),!1;b.is(".s-tab")&& !b.is(".active")&&this.switchTab(b.attr("data-type"))}if(e)return this.hG.panel.bD().fireEvent(n.ACTION,e,a),a.preventDefault(),!1},jK:function(){this.jq()&&(this.im(),this.iu())},hn:function(a,b){var e=[];a.find(":input").each(function(){var b=f(this);b.attr("name")&&(b.is("select")?b.find("option:selected").each(function(){e.push(f.trim(f(this).html()))}):b.is('input[type="text"],textarea')?(b=b.val())&&e.push(g.htmlEscape(b)):b.is(":checked")&&(b=b.attr("id")||b.attr("name"),(b=a.find('label[for="'+b+'"]').text())&&e.push(g.htmlEscape(b))))});return e.length?e.join(", "):""},iA:function(a,b){},eA:function(a,b){var e=a.closest(".tr"),c=parseInt(a.css("left"),10)||0,h=e.width(),d=a.offset(),e=e.offset(),h=h-(d.left-c-e.left)-6,d=a.outerWidth(!1),h=h&&d>h?h-d:0;h!==c&&(h?(a.css("left",h+"px"),this._$.positionMarker.css("left",-h+10+"px").show()):(a.css("left",""),this._$.positionMarker.hide()))},jr:
function(){var a=this.hv;if(a){var b=a.parent();b.length&&a.closest(".tr").length&&(this.iA(a,b),this.eA(a,b),this.ik(),this.positionCell&&(b=this.hG.panel.bs(),a=b.indexOf(this.hG.rowId),b=b.rowDepth(a),this.positionCell.setValue(0<=a?{index:a,depth:b}:void 0)))}},fW:function(){this.eo=this.jg=this.gO(this.editor$)},jq:function(){return this.fA.isStarted()},hN:function(){return!this.editor$&&this.hv.is(".s-e-loading")},hc:function(){return this.hv},hS:function(){return! !this.gD},gg:function(){return this.gD},getColumnId:function(){return this.column.getCsid()},getColumn:function(){return this.column},getRowId:function(){return this.rowId},lA:function(){this.trCache.aM(this.rowId,!0)},jL:function(){this.trCache.aM(this.rowId,!1)},aB:function(a,b){this.rowId===a&&b&&(this.rowId=b)},iS:function(){return!(!this.gN|| !this.gN.length)},hb:function(){return this.gN},hw:function(){return this.gX},jB:function(a){this.gN=a&&a.length?a:null;this.gX=this.gR(this.gN);this.gs= !1;if(this.hv)if(this.gN){this.hv.addClass("s-e-error");for(var b="",e=0,c=a.length;e<c;e++)b+='<div class="s-editerror"><div></div><span>'+g.htmlEscape(a[e])+"</span></div>";this.editor$&&(b+=
'<div class="s-editerror-description">'+g.text("s.w.editor.edit.error.description.html")+"</div>");this._$.editErrors.html(b);this._$.errorMarker.attr("title",g.htmlEscape(this.gX))}else this.hv.removeClass("s-e-error"),this._$.editErrors.empty(),this._$.errorMarker.attr("title","");this.jL()},jb:function(){if(!this.iS())return!1;var a= !this.gs;this.gs= !0;return a},gR:function(a){if(!a|| !a.length)return "";for(var b="",e=0;e<a.length;e++){if(b.length){var c=b.substring(b.length-1);if("."===c||"!"===c)b=b.substring(0,b.length-1);b+="; "}b+=f.trim(a[e]||"")}return b},iO:function(){var a=document.activeElement;if(!a)return!0;if(a===window||a===window.document)return!1;a=f(a);if(a.is("#s-focus-placeholder")){if(a.attr("rel")!=this.gn)return!1}else if(a=a.closest(".s-editorpanel"),!a.length||a[0]!==this.hv[0])return!1;return!0},takeFocus:function(a){if(this.jq()&&this.hv){if(a&& !this.iO())return!1;var b=g.onPage(this.hv)&&this.hv.find(":input:visible:eq(0)");b&&b.length?(a=function(){b.is('input[type="text"], input:not([type])')&&b.select();b.focus()},f.browser.msie?setTimeout(a,1):a()):(a=this.hG.panel.widget.gk,a.attr("rel",this.gn),a.focus())}},ik:function(){this.hG.panel.bh()
.ik()},gO:function(a){return c.ht(a)},gp:function(a,b){return c.hl(a,b)},iI:function(a,b){return c.jc(a,b)},ig:function(a,b){var e=this.hS()&&"string"===typeof b?b:void 0;this.attributeManager.ig(this.forestSpec,this.rowId,a,e)},kc:g.returnFalse,lq:function(a){this.kn=a;this.editor$&&this.jN()},jN:function(){var a=this.kn;a&&this.editor$&&(this.kn=null,this.gp(a,this.editor$),this.iu())}});return a});/*
 ** StructureWidget, Copyright ALM Works 2011-2013 **
*/var STRUCTURE_BETAMODE= !1,STRUCTURE_DEBUG= !1;(function(f){function b(a){var b=e[a];if(!0===b|| !1===b)return b;b= ! !(f&&f.location&&(new RegExp("^#(.*/)?"+a+"(/.*)?$")).exec(""+f.location.hash));return e[a]=b}var g=namespace("almworks.structure"),d=namespace("almworks.util");g.$=namespace("almworks.$",!1)||d.requireGlobal("jQuery");g.JSON=d.requireGlobal("JSON");g.mouseTracker=d.mouseMoveTracker();var e={};g.getUrlHashParam=b;var a=STRUCTURE_DEBUG||b("debug"),n=b("nobetamode")? !1:STRUCTURE_BETAMODE||b("betamode");d.assertionsEnabled(a);d.logDebug(a);g.PAGE_IDS={BOARD:"structure",BOARD_WITH_DETAILS:"structure-with-details",ISSUE:"issue",PROJECT:"project",GADGET:"gadget",AGILE:"greenhopper"};g.modes={STRUCTURE_BETAMODE:n,STRUCTURE_DEBUG:a,DEVMODE:b("devmode"),BLOCK_AJAX: !1,getStructurePageId:function(){return this.ISSUE_PAGE?g.PAGE_IDS.ISSUE:this.ISSUE_DETAILS?g.PAGE_IDS.BOARD_WITH_DETAILS:this.PCV_PAGE?g.PAGE_IDS.PROJECT:this.GADGET?g.PAGE_IDS.GADGET:this.GH_TAB?g.PAGE_IDS.AGILE:g.PAGE_IDS.BOARD}};g.MAX_GET_PARAMETERS_LENGTH=400;g.MIN_COLUMN_WIDTH=16;g.MAX_COLUMN_WIDTH=1E4;g.pf=6E4;g.nY=1E4;d.isDebugging()&&d.debug("debugging enabled");(function(){var a=g.$("").jquery;
"string"!==typeof a&&d.error("no jQuery version");0!==a.indexOf("1.8")&&d.warn("jQuery version "+a)})();f.AJS&&f.AJS.$&&(f.jQuery=f.$=f.AJS.$);f.jscoverage_report&&g.$(function(){g.$('<a id="open_jscoverage" onclick="window.open(\'/jscoverage.html\'); return false;">JSCoverage</a>').prependTo(g.$("body"))});(function(a){a.mozilla&&0<=f.navigator.userAgent.indexOf("Trident/")&&(delete a.mozilla,a.msie= !0)})(g.$.browser)})(window);(function(f){function b(){v(this).addClass("hover")}function g(){v(this).removeClass("hover")}function d(){v(this).addClass("pressed")}function e(){v(this).removeClass("pressed")}function a(a){if(!a)return!1;var b=v(a.target);if(b.is(".s-disabled"))return!1;var e=m(b,"action");if(!e)return!0;b=m(b,"eventBus");if(!b)return!0;b.fireEvent(x.ACTION,e,a);return a&&a.consumed? !1: !0}function n(b,e){w.assert(! !e);b.off("click.button");b.on("click.button",a);p(b,"action",e)}function c(a,b){a&&(b||(b=new w.Cell(!1)),b.pipe(function(b){a.attr("aria-pressed",b)}),a.on("click",function(){a.blur()}));return b}function p(a,b,e){a&&v(a).data(b,e).addClass("app-"+b)}function m(a,b){return a?v(a).closest(".app-"+b).data(b):null}function k(a){if(!a)return 0;if("number"===
typeof a)return a;if("string"===typeof a){var b=w.toIntSafe(a,-1);-1===b&&(w.warn("invalid issue ["+a+"]"),b=0);return b}w.warn("invalid issue ["+a+"]");return 0}function r(a){this[a]= !0}function l(a,b,e){b=b||[];if(!a)return b;for(var c=0,h=a.length,d,f=0;c<h;)d=a.indexOf("+",c),0>d&&(d=h),c=w.toIntSafe(a.substring(c,d),0),0!==c&&(f+=c,e?e.call(b,f):b.push(f)),c=d+1;return b}function h(a){return function(b,e){var c=a[e];return "object"===typeof b||"object"===typeof c?("string"===typeof b&&(b=[b]),"string"===typeof c&&(c=[c]),w.arrayEquals(b,c)):b===c}}function u(a){return function(b,e){return a.hasOwnProperty(e)}}var s=namespace("almworks.structure"),q=namespace("almworks.structure.apputil"),x=namespace("almworks.structure.appevents"),t=namespace("almworks.structure.ajsbridge"),w=namespace("almworks.util"),v=namespace("almworks.structure.$"),C=namespace("almworks.structure.api");q.defaultStructureId=1;var z=/\/browse\/([^\-#\?]+\-\d+)([#\?].*)?$/i,F=null;w.extend(q,{initializeButton:function(a,c){a.off(".button");a.on({"mouseenter.button":b,"mouseleave.button":g,"mousedown.button":d,"mouseup.button":e,"mousemove.button":e});c&&n(a,c)},initAUIToggleButton:function(a,b){b=c(a,b);
if(a)a.on("click",function(){"true"!==a.attr("aria-disabled")&&b.setValue(!b.value())});return b},bindAUIToggleButtonState:c,actionFormattedShortcut:function(a,b){var e=s.keymap();if(e.formattedShortcuts){var c=e.formattedShortcuts[a];if(c)return c}c=w.keyOf(e,a);!c&&b&&(c=w.keyOf(e,b));return c?w.formatShortcut(c):null},installEventBus:function(a,b){w.assert(! !b);p(a,"eventBus",b)},installAction:n,registerBooleanActions:function(a,b,e,c,h,d,l){d===f&&(d= !0);l===f&&(l= !1);e&&a.register(e,function(){b.setValue(d)});c&&a.register(c,function(){b.value()===d&&b.setValue(l)});h&&a.register(h,function(){b.setValue(b.value()===d?l:d)})},gV:function(a,b,e,c){var h=c.length,d=new w.Cell(b,function(a){return c[(w.indexOf(c,a)+1)%h]});a.register(e,function(){b.setValue(d.value())});return d},pipeToggled:function(a,b,e){a.pipe(function(a){(e?e(a):a)?b.addClass("toggled"):b.removeClass("toggled")})},jm:function(a,b,e){a.pipe(function(a){(e?e(a):a)?b.addClass("s-disabled"):b.removeClass("s-disabled")})},pipeText:function(a,b,e){a.pipe(function(a){(a=e?e(a):a)&&b.text(a)})},setDominator:p,getDominator:m,bU:function(a,b,e,c,h){b.stop(!0,!0);if(a!=b.is(":visible")){var d="window"===
e.config.height||s.modes.GH_TAB?e.div$:null;d&&d.height(d.height());var f;h?(a?(b.css("opacity",0).show(),f=c(b.height()),b.height(0)):(f=b.height(),b.css("opacity",1)),b.animate({opacity:a?1:0},{duration:500,easing:"swing",complete:function(){b.css({display:a?"block":"none",height:"",opacity:""});d&&d.css("height","");e.eventBus.fireEvent(x.av)},step:function(c){c=Math.round(Math.min(1,c*(a?4:2.5))*f);var h=b.height();c!=h&&(b.height(c),d&&(c=0==h&&0<c?b.outerHeight(!0):0<h&&0==c? -(h+b.outerHeight(!0)):c-h,e.pageManager.bZ(c)))}})):(b.css("display",a?"block":"none"),f=c(b.height()),d&&e.pageManager.bZ(a?f: -f),d&&d.css("height",""),e.eventBus.fireEvent(x.av))}},getRowIdFromEvent:function(a){return!a||a.isDefaultPrevented()?null:s.getRowIdFromParentTR(a.target)},fJ:k,validateRowArray:function(a){var b=[],e=a&&a.length;if(e)for(var c=0;c<e;c++){var h=k(a[c]);0!==h&&b.push(h)}return b},validateRowMap:function(a){var b={};if(a)for(var e in a)a.hasOwnProperty(e)&&0!==k(e)&&(b[e]=a[e]);return b},ct:require("almworks/util/JSON").stringify,cl:l,kf:function(a){return l(a,{},r)},ht:function(a){var b={},e={};if(!a|| !a.length)return b;a.find(":input").add(a.filter(":input")).each(function()
{var a=v(this),c=a.attr("name");if(c)if(b[c]===f||b.hasOwnProperty(c)){if(e[c]= !0,!a.is("input[type=checkbox],input[type=radio]")|| !a.is(":not(:checked)"))if(b[c]){var h=b[c],a=a.val();w.isArray(h)||(h=[h]);w.isArray(a)?w.addAll(h,a):h.push(a);b[c]=h}else b[c]=a.val()}else w.warn('Skipped input with name "'+c+'"')});for(var c in e)!e.hasOwnProperty(c)||c in b||(b[c]=[]);return b},hl:function(a,b){b&&b.length&&b.find(":input").add(b.filter(":input")).each(function(){var b=v(this),e=b.attr("name");if(e in a){var c=a[e];if(b.is("input[type=checkbox],input[type=radio]")){var e=b.is(":checked"),h=b.val();(c=h===c||"object"===typeof c&&0<=w.indexOf(c,h))&& !e?b.attr("checked","checked"): !c&&e&&b.removeAttr("checked")}else b.val(c)}})},jc:function(a,b){return a? !1!==w.eachValue(a,h(b),!0)&& !1!==w.eachValue(b,u(a),!0): !b},getIssueKeyFromUrl:function(a){if(!a)return null;(a=(a=z.exec(a))&&a[1])&&"function"===typeof a.toUpperCase&&(a=a.toUpperCase());return a},openWindow:function(a,b,e,c){function h(a,b){return b+2+encodeURIComponent(a).length+encodeURIComponent(this[a]).length}c||(c=w.eachOwn(b,h,0)>s.MAX_GET_PARAMETERS_LENGTH?"POST":"GET");b=w.renderTemplate(
'<form action="{url}" method="{method}" target="{target}" style="display: none;">{params:html}</form>',{url:t.localURL(a),method:c,target:e,params:w.eachOwn(b,function(a,b){return b+w.renderTemplate('<input type="hidden" name="{name}" value="{value}">',{name:a,value:this[a]})},"")});b=v(b);F&&w.onPage(F)?F.replaceWith(b):b.appendTo(v("body"));F=b;try{b.submit()}catch(d){w.debug("Caught while submitting "+a,d)}},getScrollBarSize:function(){var a=v("<div></div>").css({width:"100%",height:"100%"}),b=v("<div></div>").css({width:"100px",height:"100px",position:"absolute",top:"0",left:"0",visibility:"hidden",overflow:"hidden"});v(document.body).append(b.append(a));var e=a.width(),c=a.height();b.css("overflow","scroll");var h=a.width(),a=a.height();e===h&&b[0].clientWidth&&(h=b[0].clientWidth);c===a&&b[0].clientHeight&&(a=b[0].clientHeight);b.remove();return{width:e-h,height:c-a}}});w.extend(C,require("almworks/util/Classes"))})();(function(f){f=namespace("almworks.structure");var b=namespace("almworks.structure.api"),g=namespace("almworks.util"),d=f.$;namespace("almworks.structure.apputil").MenuList=b.baseClass({init:function(){this.container$=this.options.container$;this.selector=
this.options.selector||"li";this.handler=this.options.handler;if(!this.container$)throw Error("no container");this.cV=new g.Cell(null);this.initClicks();this.initMouse();this.initKeyboard();this.initHover()},initHover:function(){this.cV.pipeChanges(function(b,a){a&&a.removeClass("s-hover");b&&b.addClass("s-hover")})},initClicks:function(){var b=this;this.container$.on("click","a",function(a){return b.onClick(a,d(a.target).closest(b.selector))});this.container$.on("click",b.selector,function(a){return b.onClick(a,d(a.target))})},onClick:function(b,a){if(a.length&&d.contains(this.container$[0],a[0])&&this.chooseItem(a))return b.preventDefault(),b.stopPropagation(),!1},initMouse:function(){var b=this;this.container$.on("mouseenter",b.selector,function(a){b.cV.setValue(d(this))})},initKeyboard:function(){var b=this;this.container$.keydown(function(a){if(a&&a.target&& !d(a.target).is(".s-menulist-keyboard-ignore")){var f=a.keyCode;if(27===f||9===f)b.cancel();else if(38===f)b.selectPrevious(a);else if(40===f)b.selectNextOrFirst(a);else if(13===f){if(!b.cV.value())return;b.chooseItem()}else return;a.preventDefault();a.stopPropagation()}})},selectPrevious:function(b){var a=this.cV.value();
a&&(b=this.container$.find(this.selector),a=b.index(a),0>a||(b=b.slice(0,a),b=b.filter(":visible").last(),null!=b&&b.length&&this.selectItem(b)))},selectNextOrFirst:function(b){var a=this.cV.value();b=this.container$.find(this.selector);a&&(a=b.index(a),0<=a&&(b=b.slice(a+1)));b=b.filter(":visible").first();null!=b&&b.length&&this.selectItem(b)},chooseItem:function(b){b&&this.selectItem(b);b=this.cV.value();var a=this.handler;return b&&a?g.safeCall(a.onMenuItemChosen,a,b)|| !1: !1},cancel:function(){var b=this.handler;b&&g.safeCall(b.onMenuCancelled,b)},selectItem:function(b){this.cV.setValue(b);this.lc()},lc:function(){var b=this.options.viewPort$;if(b){var a=this.cV.value();if(a&&a.length){var d=Math.round(a.position().top),a=Math.round(a.height()),c=Math.round(b.height());0>d?b.scrollTop(b.scrollTop()+d):d+a>c&&b.scrollTop(b.scrollTop()+d+a-c)}}},getSelectedItem:function(){return this.cV.value()},selectFirst:function(){var b=this.container$.find(this.selector+":visible:first");b.length&&this.selectItem(b)},jo:function(){this.selectItem(null)}})})(window);(function(){function f(a){var c=null;try{window[a]&&window[a].setItem&&(c=window[a])}catch(e){}finally{c||b.warn(a+
" is not supported")}return c}var b=namespace("almworks.util"),g=namespace("almworks.structure"),d=f("localStorage"),e=f("sessionStorage"),a={};b.extend(g,{isStorageSupported:function(){return!(!e&& !d)},setStored:function(f,c,g){if("string"!==typeof f||"string"!==typeof c)b.assert(!1,"bad value ("+f+", "+c+")");else{var m=null;g?g=e||a:(g=e||d||a,m=e&&d);var k="almworks.structure3."+f;try{g[k]=c}catch(r){b.debug("cannot store "+f,r)}if(m)try{m[k]=c}catch(l){b.debug("cannot store to localStorage "+f,l)}}},getStored:function(f){var c,g="almworks.structure3."+f;try{c=e&&e[g],c||(c=d&&d[g])||(c=a[g])}catch(m){b.debug("cannot retrieve "+f,m)}return c||""}})})();(function(){function f(){return "_e"+ ++g}var b=namespace("almworks.structure.appevents"),g=0;b.POLL_FINISHED=f();b.UPLOAD_FINISHED=f();b.STRUCTURE_CHANGED=f();b.STRUCTURE_NOT_CHANGED=f();b.kl=f();b.cQ=f();b.aX=f();b.bY=f();b.kE=f();b.TR_ANIMATION_FINISHED=f();b.aA=f();b.dz=f();b.aN=f();b.EDIT_UPLOAD_FINISHED=f();b.au=f();b.ko=f();b.mh=f();b.aE=f();b.bu=f();b.eu=f();b.AUTOMATION_OFF_REQUIRED=f();b.UI_STATE_LOADED=f();b.av=f();b.dr=f();b.ar=f();b.cX=f();b.cj=f();b.bX=f();b.cK=f();b.dF=f();b.cR=f();b.be=f();b.mg=f();b.cr=f();b.aq=
f();b.dP=f();b.DISPLACEMENT_UPDATED=f();b.am=f();b.nl=f();b.dc=f();b.ACTION=f();b.mt=f();b.ly=f();b.cq=f();b.gJ=f();b.JIRA_DIALOG_SHOWN=f();b.jx=f();b.mx=f();b.kD=f();b.jH=f();b.VIEW_ADJUSTED=f();b.md=f();b.VIEW_SAVED_AS=f();b.cv=f();b.bM=f();b.gS=f();b.ISSUE_DETAILS_EDIT_STARTED=f();b.ISSUE_DETAILS_EDIT_STOPPED=f();b.STRUCTURE_PAGE_CHANGED=f();b.BEFORE_CLICK=f();b.FOREST_SPEC_ACTIVATED=f();b.FOREST_SPEC_DEACTIVATED=f();b.REQUEST_POLL=f();b.POLL_RESULT=f();b.POLL_ERROR=f();b.REPLACE_ROW_IDS=f();b.VALUES_REQUIRED=f();b.ROW_DATA_LOADING_STATE_CHANGED=f();b.FOREST_UPDATE_DISPLAYED=f();b.AFFECTED_ROWS_IN_UPCOMING_CHANGE=f();b.IFRAME_FOCUS=f();b.IFRAME_BLUR=f();b.WIDGET_STARTED=f()})();(function(f,b){function g(a,b){var c,e=x.rest(arguments);return function(){if(c)return c;c=d(a);if(!c){r.warn("cannot resolve "+a);for(var b=0;!c&&b<e.length;b++)c=namespace(e[b],!1)}return c||{}}}function d(a){if("function"===typeof s)try{return s(a)}catch(b){}return null}function e(a){var b=f.contextPath;"string"!==typeof b&&(b=B);"string"!==typeof b&&(b="/");if(0===b.length||"/"!==b.substring(b.length-1))b+="/";if(!a)return b;"/"===a.substring(0,1)&&(a=a.substring(1));return 0===a.indexOf(b)?a:b+a}
function a(a,b){r.addSuper(r.CellPresenter,this)(a);this.setView(b)}function n(a){r.addSuper(r.CellPresenter,this)(a)}function c(){var a=namespace("AJS.InlineLayer.OptionsDescriptor.prototype",!1);a&&a._inIFrame&&(a._inIFrame=function(){var a=f;try{for(;a.parent.window!==a.window&&a.parent.document!==a.document;)if(a=a.parent,a.AJS)return!0}catch(b){}return!1})}var p=namespace("almworks.structure"),m=namespace("almworks.structure.ajsbridge"),k=namespace("almworks.structure.$"),r=namespace("almworks.util"),l=namespace("almworks.structure.appevents"),h=f.AJS,u=f.JIRA,s=f.require,q=s("structure/widget/model/Items"),x=s("underscore");s("almworks/util/JSON");var t= !1,w,v,C,z,F,A,D= !1,G= !1,B="/";"string"===typeof f.contextPath?B=f.contextPath:(r.warn("no contextPath in context"),B="/");var K=g("jira/issue","jira.app.issue","JIRA.Issue"),J=g("jira/issuenavigator/issue-navigator","jira.app.issuenavigator","JIRA.IssueNavigator"),O=g("jira/dialog/dialog-register","JIRA.DIALOGS","JIRA.Dialogs"),V=null,U="";k(function(){var a=f;a.top?a=a.top:a.parent&&(a=a.parent);U=k(a.document).find("meta#atlassian-token").attr("content");m.TOKEN=U});var P= !1;r.extend(a.prototype,
r.CellPresenter.prototype,{updateView:function(a){try{a?this.view.enable():this.view.disable()}catch(b){r.warn("cannot enable/disable SingleSelect",b)}}});r.extend(n.prototype,r.CellPresenter.prototype,{updateView:function(a){var b=this.view.model;b&&((a=b.getDescriptor(String(a)))?this.view.setSelection(a):this.view.clear())},isValidViewValue:function(a){var b=this.view.model;return b? ! !b.getDescriptor(String(a)): !0},getViewValue:function(){var a=h.$(this.view.options.element).val();a&&"object"===typeof a&&(a=a.length?a[0]:"");return a||this._emptyValue},subscribeToViewEvents:function(a){h.$(this.view.options.element).change(r.withThis(this,this.viewChanged))},getFirstNonEmptyValue:function(){var a=this.view&&this.view.model;if(!a)return this._emptyValue;try{var b=a.getAllDescriptors(),c=b&&b[0],e=c&&c.items(),h=e&&e[0];return h&&h.value()||this._emptyValue}catch(d){r.warn("cannot extract value for the first element in SingleSelect model: "+d)}},_emptyValue:"0",setEmptyValue:function(a){this._emptyValue=a;return this}});var Y=function(){try{var a=h.$;return f.Class.extend({init:function(b){var c=this;this.$project=b.project;this.backgroundImages=this.removeBackgroundImages(
b.issueTypeSelect);this.$refIssueTypeSelect=a(b.issueTypeSelect).clone(!0,!0);this.$issueTypeSelect=b.issueTypeSelect;this.$projectIssueTypesSchemes=b.projectIssueTypesSchemes;this.$issueTypeSchemeIssueDefaults=b.issueTypeSchemeIssueDefaults;this.projectIssueTypeSchemes=this.getProjectIssueTypeSchemesFromDom();this.issueTypesSchemeDefaults=this.getIssueTypeSchemeIssueDefaults();0<c.$project.length&&(b=c.$project.val(),c.setIssueTypeScheme(c.getIssueTypeSchemeForProject(b)),this.$project.is("select")&&this.$project.change(function(){var a=c.$project.val();c.lastIssueType=c.$issueTypeSelect.find(":selected:first").val();c.$refIssueTypeSelect.val("");c.setIssueTypeScheme(c.getIssueTypeSchemeForProject(a));c.$issueTypeSelect.trigger("reset")}))},getIssueTypeSchemeForProject:function(a){return this.projectIssueTypeSchemes[a]},getDefaultIssueTypeForScheme:function(a){return this.issueTypesSchemeDefaults[a]},removeBackgroundImages:function(b){var c={};a(b).find("option[style]").each(function(){c[a(this).attr("id")]=a(this).css("background-image");a(this).attr("style","");a(this).removeAttr("style")});return c},addBackgroundImages:function(){var b=this;this.$issueTypeSelect.find("option")
.each(function(){a(this).css("background-image",b.backgroundImages[a(this).attr("id")])})},setIssueTypeScheme:function(b){var c,e=this,h,d=a("<span class='hidden' />");c=this.$refIssueTypeSelect.find("optgroup");d.insertAfter(this.$issueTypeSelect);this.$issueTypeSelect.detach().empty();c.length?c.each(function(){var c=a(this);if(c.is("[data-scheme-id='"+b+"']"))return e.$issueTypeSelect.append(c.clone(!0).children()),!1}):this.$issueTypeSelect.append(this.$refIssueTypeSelect.children());c=this.$issueTypeSelect.find("option[data-selected]").val()||"";e.lastIssueType?h=this.$issueTypeSelect.find("option[value='"+e.lastIssueType+"']"):c&&(h=this.$issueTypeSelect.find("option[value='"+c+"']"));h&&0!==h.length?(h.attr("selected","selected"),this.$issueTypeSelect.val(h.val())):this.setDefaultIssueType(b);this.$issueTypeSelect.insertAfter(d);this.addBackgroundImages();this.$issueTypeSelect.attr("data-project",this.$project.val());d.remove()},setDefaultIssueType:function(b){b=this.getDefaultIssueTypeForScheme(b);""!==b?this.$issueTypeSelect.find("option[value='"+b+"']").attr("selected","selected"):this.$issueTypeSelect.find("option").each(function(b,c){if(this.value&&""!==this.value)
return a(c).attr("selected","selected"),!1})},getProjectIssueTypeSchemesFromDom:function(){var b={};this.$projectIssueTypesSchemes.find("input").each(function(c,e){var h=a(e),d=h.attr("title"),h=h.val();b[d]=h});return b},getIssueTypeSchemeIssueDefaults:function(){var b={};this.$issueTypeSchemeIssueDefaults.find("input").each(function(c,e){var h=a(e),d=h.attr("title"),h=h.val();b[d]=h});return b}})}catch(b){return r.warn("cannot instantiate IssueTypePicker class"),null}}(),N=0;k(function(){k.browser.msie&&9>k.browser.version&&c();var a=f.JIRA;a&& !a.InlineLayer&&(a.InlineLayer={})});(function(){function a(b){if(b&&"function"===typeof b.getDefaultAjaxOptions)return b}function b(a){a.getDefaultAjaxOptions=function(a){return function(){var b=a.apply(this,arguments);try{b&&b.data&&"true"!==b.data.inline&&this.$activeTrigger&&this.$activeTrigger.is("[class*=issueaction-]")&&(b.data.inline="true")}catch(c){r.warn("Error patching result of JIRA.Dialogs.getDefaultAjaxOptions()",c)}return b}}(a.getDefaultAjaxOptions)}var c=a(d("jira/dialog/dialog-util")),e=a(O());c&&e?e.getDefaultAjaxOptions===c.getDefaultAjaxOptions?(b(c),e.getDefaultAjaxOptions=c.getDefaultAjaxOptions):(b(c),b(e)):c?b(c):
e?b(e):r.warn("Cannot find the JIRA module with getDefaultAjaxOptions()")})();(function(){if(u.AssigneePicker){var a=u.AssigneePicker.prototype._resetPagination;"function"===typeof a&&(u.AssigneePicker.prototype._resetPagination=function(){var c=this.$container.attr("data-query")===b;a.apply(this,arguments);c&&(this._pagination.lastQuery=null)})}})();r.extend(m,{AJSBridge:function(a){function c(){if(!G){G= !0;var a=J();try{a.isNavigator=r.returnTrue}catch(b){r.warn("cannot override IssueNavigator.isNavigator")}var e=d("jira/issuenavigator/issue-navigator/shortcuts");e||(e=a.Shortcuts||{});try{e.isNavigator=r.returnTrue}catch(h){r.warn("cannot override IssueNavigator.Shortcuts.isNavigator")}}}function e(a,b,c){var d=c.aS(),f=(b=a&&c.bs().aL(a))&&q.getIssueIdFromItemId(b.getItemId());b=K();var l=J();if(0<f){D||(w=b.getIssueId,v=b.getIssueKey,C=l.isRowSelected,z=l.getSelectedIssueKey,F=l.getSelectedIssueId,A=l.get$focusedRow,D= !0);b.getIssueId=function(){return f};var k=c.getRowKey(a);b.getIssueKey=function(){k||(k=c.getRowKey(a));return k};l.isNavigator=r.returnTrue;l.isRowSelected=r.returnTrue;l.getSelectedIssueKey=b.getIssueKey;l.getSelectedIssueId=b.getIssueId;l.get$focusedRow=
function(){if(!a)return h.$();var b=d.TRByRowId(a);return b.length?h.$(b[0]):h.$()};x.unbind("click.structure-blocker");t&&r.debug("JIRA.Issue <- "+f)}else D&&(b.getIssueId=w,b.getIssueKey=v,l.isRowSelected=C,l.getSelectedIssueKey=z,l.getSelectedIssueId=F,l.get$focusedRow=A,D= !1),x.bind("click.structure-blocker",r.returnFalse),t&&r.debug("JIRA.Issue <- none")}function g(){if(h){var b=f.JIRA;b&&h.$(a.div$[0]).delegate("a.aui-dd-link","click",function(){s.postEvent(l.gS,"jira.actions.dropdown.click");if(!h.$.data(this,"AJS_dropDown_initialised")){var a=h.DropDown.create({trigger:h.$(this),ajaxOptions:{dataType:"json",cache: !1,formatSuccess:namespace("jira.app.fragments.issueActionsFragment",!1)||b.FRAGMENTS.issueActionsFragment}})[0];a&&(a.layerController&&a.layerController.contentChange&&(a.layerController.contentChange(function(a){a.$layer.data("previousFocus",document.activeElement).find("a:visible:first").focus()}),a.layerController.onhide(function(a){var b=a.$layer.data("previousFocus");if(b&&(a.$layer.data("previousFocus",null),b!==f))try{var c=h.$(b);c.is(":visible")&&c.focus()}catch(e){}})),a.show());h.$.data(this,"AJS_dropDown_initialised",!0);return!1}})}}function m(){
function a(b){if(b&&"function"===typeof b.reloadViaWindowLocation)return b}function b(a){var c=a.reloadViaWindowLocation,e=function(){if(0!=arguments.length){a.reloadViaWindowLocation=c;try{return c.apply(this,arguments)}catch(b){return r.debug("original reloadViaWindowLocation failed: "+b),!0}finally{a.reloadViaWindowLocation=e}}if(u&&u.Dialog&&u.Dialog.current&&"function"===typeof u.Dialog.current.hide){try{u.Dialog.current.hide()}catch(h){}try{s.fireEvent(l.kD)}catch(d){}}return!0};a.reloadViaWindowLocation=e}var c=a(d("jira/util/browser")),e=a(h);c?(b(c),e&&(e.reloadViaWindowLocation=c.reloadViaWindowLocation)):e?b(e):r.warn("Cannot find the JIRA module with reloadViaWindowLocation()")}function n(){var a=O().editLabels,b;a&&(b=a.labelsProvider,"function"===typeof b&&(a.labelsProvider=function(a){return b.apply(this,arguments)||k()}))}var s=a.eventBus,Y=r.delayed(100,function(a,c){var e=O(),d=c&&c.attr("id"),f=null,l,k;if(d&&r.tail(d,"workflow-transition-")&&e[d]){try{f=h.$("#"+d)}catch(g){}if(f&&f.length&& !f.is(":visible")){if(l=e[d].options&&e[d].options.trigger)k=h.$(document),"string"===typeof l?k.undelegate(l,"click"):r.isArray(l)&&0<l.length&&h.$.each(l,function(a,b){
"string"===typeof b&&k.undelegate(b,"click")});try{e[d].destroy()}catch(m){}f.remove();e[d]=b}}});h.$(document).bind("hideAllLayers",function(){Y.apply(this,arguments);s.fireEvent(l.gJ)});h.$(document).bind("Dialog.show",function(){s.fireEvent(l.JIRA_DIALOG_SHOWN)});p.modes.ISSUE_PAGE||p.modes.GH_TAB||setTimeout(c,800);var x=h.$("#s-issueaction-links .issueaction-assign-issue");g();p.modes.ISSUE_PAGE||p.modes.GH_TAB||(this[l.eu]=e,s.addListener(new r.Life,this),h.$.event.special.shortcut.remove.apply(document,[{data:"e"}]),h.$.event.special.shortcut.remove.apply(document,[{data:"a"}]),h.$.event.special.shortcut.remove.apply(document,[{data:"l"}]));p.modes.ISSUE_PAGE||(m(),n());k.browser.mozilla&&k("#assign-to-me").attr("id","assign-to-me-compatible-with-structure");p.modes.ISSUE_PAGE&&function(){var a=f.JIRA;a&&a.trigger&&a.Events&&a.Events.ISSUE_REFRESHED&&h.$(h).bind(a.Events.ISSUE_REFRESHED,function(){try{s.fireEvent(l.kD)}catch(a){}})}();r.extend(this,{ob:g})},jiraDialogs:O,localURL:e,currentURL:function(){var a=f.location,b=a.pathname,c=e();0==b.indexOf(c)&&(b=b.substr(c.length));return b+a.search+a.hash},issueURL:function(a){return a?e("/browse/"+a):null},cookiePath:function(
){if(!V){var a=e("");a||(a="/");var b=a.indexOf("://");0<=b?(b=a.indexOf("/",b+3),a=0>b?"/":a.substring(b)):"/"!==a.substring(0,1)&&(a="/"+a);b=a.length;1<b&&"/"===a.substring(b-1)&&(a=a.substring(0,b-1));V=a}return V},hW:function(a,b,c){if(!h|| !h.$|| !h.$.fancybox)return!1;a=h.$(a[0]);if(a.data("fancyboxInitialized"))return!1;a.data("fancyboxInitialized",!0);var e=function(){P&&(P= !1,c.keyboardManager.setEnabled(!0),"function"==typeof h.enableKeyboardShortcuts?h.enableKeyboardShortcuts():h.popup&&(h.popup.current=null),"function"===typeof h.enableKeyboardScrolling&&h.enableKeyboardScrolling())},d={type:"image",imageScale: !0,cyclic: !0,centerOnScroll: !0,autoDimensions: !0,overlayShadow: !(h.$.os.linux&&h.$.browser.mozilla),titleShow: !1,hideOnContentClick: !0,changeSpeed:150,changeFade:0,speedIn:300,speedOut:300,onStart:function(){P||(P= !0,c.keyboardManager.setEnabled(!1),"function"===typeof h.disableKeyboardShortcuts?h.disableKeyboardShortcuts():h.popup&&(h.popup.current= !0),"function"===typeof h.disableKeyboardScrolling&&h.disableKeyboardScrolling())},onCancel:e,onClosed:e,transitionIn:"fade",transitionOut:"fade"};h.$.browser.msie&&(d.transitionIn="none",d.transitionOut=
"none",d.onCancel=d.onClosed=r.delayed(50,e));a.find("a").fancybox(d);b&&h.$(b).trigger("click");return!0},SingleSelectEnabler:a,SingleSelectPresenter:n,kg:function(a,b,c,e){return Y?new Y({project:h.$(a[0]),issueTypeSelect:h.$(b[0]),projectIssueTypesSchemes:h.$(c[0]),issueTypeSchemeIssueDefaults:h.$(e[0])}):null},js:function(a){if(a=a&&a[0]){var b=h.$(a);b.find("form").submit(r.returnFalse);try{h.$(f.document).trigger("dialogContentReady",{get$popupContent:function(){return b},options:{}})}catch(c){r.warn("problem calling dialogContentReady: "+c)}}},mc:function(a,b){if(!a|| !b|| !a.suggestionsVisible)return!1;var c=a.listController;if(!c)return!1;var e=c.keys&&c.keys.Return;if(!e)return!1;try{e.call(c,b)}catch(h){return!1}return!0},createAjsSingleSelect:function(a,b){if(!h|| !h.$|| !h.SingleSelect||"remote"===p.modes.GADGET)return a.on("ajs:expand",function(){a.focus()}),null;a.attr("id")||a.attr("name")||(N+=1,a.attr("name","s-ss-"+N));var c=new h.SingleSelect(r.extend({},b||{},{element:a[0],revertOnInvalid: !0,removeOnUnSelect: !1}));c.dropdownController.$layer.addClass("s-aui-dd").css({"max-height":"188px","overflow-y":"auto","overflow-x":"hidden","font-size":"12px"});
c.submitForm=function(){this.suggestionsVisible||a.trigger("ajs:submitForm")};h.$(a[0]).on("selected",function(){a.trigger("change")});a.on("ajs:update",function(b,e){var h=e||a.val(),h=r.isArray(h)?h[0]:h,h=c.model.getDescriptor(h);c.model.setSelected(h);c.setSelection(h)}).on("ajs:expand",function(){c.suggestionsVisible||c.$dropDownIcon.click()});return c},jiraRequire:d,setDebug:function(a){t=a}})})(window);(function(){var f=namespace("almworks.structure"),b=namespace("almworks.structure.ajax"),g=namespace("almworks.structure.ajsbridge"),d=namespace("almworks.util"),e=f.$;b.doAjax=function(a){return e.ajax(a)};b.UPLOAD=2;b.DOWNLOAD=1;b.RESOURCES2g=new function(){d.extend(this,{structure:function(a){return "/rest/structure/2.0/structure/"+a},forest:function(a){return this.structure(a)+"/forest"},favorite:function(a){return "/rest/structure/2.0/structure/"+a+"/favorite"},history:function(a){return "/rest/structure/2.0/history/"+a},versions:function(a,b){var c=this.history(a)+"/versions",e,d="?";if(b)for(e in b)b.hasOwnProperty(e)&&(c+=d+encodeURIComponent(e)+"="+encodeURIComponent(b[e]),d="&");return c},version:function(a,b){return this.history(a)+"/version/"+b},quickTransforms:
function(a){return "/rest/structure/2.0/structure/"+a+"/quick-transforms"},POLL:"/rest/structure/2.0/poll",VALUE:"/rest/structure/2.0/value",STRUCTURE:"/rest/structure/2.0/structure",STRUCTURE_LIST:"/rest/structure/2.0/structure/list",MAPPING:"/rest/structure/2.0/mapping",GENERATOR:"/rest/structure/2.0/generator",QUERY:{VALIDATE:"/rest/structure/2.0/query/validate"},FOREST:{LATEST:"/rest/structure/2.0/forest/latest",UPDATE:"/rest/structure/2.0/forest/update"},ITEM:{CREATE:"/rest/structure/2.0/item/create",UPDATE:"/rest/structure/2.0/item/update"},CONFLUENCE:{MODIFIABLE_SPACE:"/rest/structure-pages/1.0/space/modifiable",IGNORE_SYSTEM_ERROR:"/rest/structure-pages/1.0/error/ignore/system",RETRY_USER:"/rest/structure-pages/1.0/error/retry/user"},EFFECT:{UNDO:"/rest/structure/2.0/effect/undo",REDO:"/rest/structure/2.0/effect/redo"},EXPR:{VALIDATE:"/rest/structure/2.0/expr/validate"}})};b.RESOURCES=new function(){d.extend(this,{STRUCTURE_LIST:"/rest/structure/1.0/structure/list",structure:function(a){return "/rest/structure/1.0/structure/"+a},forest:function(a){return this.structure(a)+"/forest"},RENDER:"/rest/structure/1.0/data",ISSUE:"/rest/structure/1.0/issue",issueUpdate:function(a){
return this.ISSUE+"/"+a+"/update"},ISSUE_CREATE:"/rest/structure/1.0/issue/create",CONFIG_WIDGET:"/rest/structure/1.0/config/widget",CONFIG_UI_SETTINGS:"/rest/structure/1.0/config/ui",UPDATE_FIELDS:"/rest/structure/1.0/config/fields/forUpdate",CREATE_FIELDS:"/rest/structure/1.0/config/fields/forCreate",SEARCH:"/rest/structure/1.0/issues",SEARCH_RESOLVED:"/rest/structure/1.0/issues/resolved",POLL:"/rest/structure/1.0/poll",GADGET:{STRUCTURES:"/rest/structure/1.0/gadget/structures",VALIDATE:"/rest/structure/1.0/gadget/validate",META:"/rest/structure/1.0/gadget/meta",VIEWS:"/rest/structure/1.0/gadget/views",WEBRESOURCES:"/rest/structure/1.0/gadget/webresources"},CONFIG_PROJECTS:"/rest/structure/1.0/config/projects",CONFIG_ROLES:"/rest/structure/1.0/config/roles",CONFIG_GROUPS:"/rest/structure/1.0/config/groups",CONFIG_TIMEZONE:"/rest/structure/1.0/config/timezone",HIDE_MIGRATE_BANNER:"/rest/structure/1.0/config/hideMigrateBanner",USER_PICKER_PERMISSION:"/rest/structure/1.0/config/userPickerPermission",VIEW:"/rest/structure/1.0/view",STATISTICS:"/rest/structure/1.0/statistics",PERSPECTIVE:"/rest/structure/1.0/perspective",DATE_STYLES:"/rest/structure/1.0/config/dateFormatStyle"})};
b.AJAX=function(){function a(){m=null;p||0===c.length||f.modes.BLOCK_AJAX||(c.sort(k),(p=c.splice(0,1)[0])&&p.runAjax())}function e(b){b&&c.push(b);m&&clearTimeout(m);m=setTimeout(a,50)}var c=[],p=null,m=null,k=function(a,b){return b.priority-a.priority};d.extend(this,{Task:function(){function c(a,b,e,d){this.url=g.localURL(a);this.priority=b;this.callback=e;this.errorCallback=d;this.context=this}d.extend(c.prototype,{timeout:6E4,contentType:"application/json; charset=UTF-8",type:"GET",dataType:"json",error:function(a,b,c){if("notmodified"===b)this.success(null,b);else if(this.shouldRetry(a,b,c))this.priority--,e(this);else if("function"===typeof this.errorCallback)try{this.errorCallback(a,b,c)}catch(f){d.error(f)}},success:function(a,b,c){if(c&&"success"===b){b=null;var e=0;try{b=c.statusText}catch(f){}try{e=c.status}catch(k){}b=0===e&& !b&& !a}else b= !1;if(b)this.error(c,"connection",null);else if("function"===typeof this.callback)try{this.callback(a)}catch(g){d.error(g)}},complete:function(){d.assert(this===p);this===p&&(p=null);a()},chainComplete:function(a){if(a){d.assert("function"===typeof a,a);var b=this.complete;this.complete=function(){a.apply(this,arguments);b&&b.apply(
this,arguments)}}},preCheck:d.returnTrue,shouldRetry:d.returnFalse,runAjax:function(){d.assert(this===p);this.preCheck()?("remote"===f.modes.GADGET&&(this.headers={Accept:"application/json, text/javascript, */*; q=0.01","Content-Type":this.contentType||"application/json; charset=UTF-8"}),b.doAjax(this)):this.complete()}});return c}(),addTask:e,gH:e})}})();(function(f){function b(){if(k)return k;var b=a.Deferred();c.doAjax({url:p.localURL("/secure/StructureSearchData.jspa"),cache: !1,dataType:"text",success:function(c){function e(b){var c=a(b,f).text();if(c)try{return n.parse(c)}catch(h){d.warn("cannot parse "+b+" "+c,h)}return[]}c=a(c);var f=c.filter("#searchData");f.length||(d.warn("bad reply..."),f=c);r={jqlFieldNames:e("#jqlFieldz"),jqlFunctionNames:e("#jqlFunctionNamez"),jqlReservedWords:e("#jqlReservedWordz")};b.resolveWith(null,[r])},error:function(a,c){b.rejectWith(null,[a,c])}});return k=b.promise()}function g(a){var b=m.$("#"+a.fieldID);if(b.length){var c=namespace("jira.widget.autocomplete.JQL",!1)||f.JIRA.JQLAutoComplete,e=namespace("jira.jql.parser.MyParser",!1)||f.JIRA.JQLAutoComplete.MyParser,k=c({fieldID:a.fieldID,parser:e(r.jqlReservedWords),queryDelay:.65,
jqlFieldNames:r.jqlFieldNames,jqlFunctionNames:r.jqlFunctionNames,minQueryLength:0,allowArrowCarousel: !0,autoSelectFirst: !1,errorID:a.errorID});b.unbind("keypress");k.buildResponseContainer();b.click(function(){k.dropdownController.hideDropdown()});k.updateParseIndicator=d.seq(k.updateParseIndicator,a.updateParseIndicator);k.completeField=d.seq(k.completeField,a.completeField);a=b.val();void 0!==a&&k.parse(a);m.Meta.set("advanced-search-help-url","https://confluence.atlassian.com/display/JIRA/Advanced+Searching");return k}}var d=namespace("almworks.util"),e=namespace("almworks.structure"),a=e.$,n=e.JSON,c=e.ajax,p=e.ajsbridge,m=f.AJS,k=null,r={jqlFieldNames:[],jqlFunctionNames:[],jqlReservedWords:[]},e=namespace("almworks.structure.jqlutil");d.extend(e,{loadSearchData:b,createAutocomplete:g,installJqlCompletionAndValidation:function(e,h,f){b().always(function(){var b=a("#"+e),k=a("#"+h);if(b.closest("body").length){g({fieldID:e}).enable();f&&f.configure&&f.configure(b,k);var m=new d.Cell(null);new d.TextPresenter(m,b,!0);(new d.Cell(m,a.trim)).setDelay(500).pipe(function(a){function b(a){k.toggleClass("jqlgood","valid"===a).toggleClass("jqlerror","error"===a)}a?c.doAjax({url:
p.localURL(c.RESOURCES2g.QUERY.VALIDATE),type:"GET",dataType:"json",data:{type:"jql",q:a},success:function(a){a&&a.errors&&a.errors.length?b("error"):b("valid")},error:function(){b("error")}}):b(null)})}})}})})(window);define("structure/widget/ui/column/EditableColumn",["almworks/util/Classes","almworks/util/Util","structure/api/Column"],function(f,b,g){var d=namespace("AJS.InlineLayer",!1);return f.subClass("EditableColumn",g,{isEditableColumn:b.returnTrue,gb:b.returnFalse,createCellEditor:b.returnFalse,render:function(b){var a=b._cellEditor;if(a&&a.jq()&& !a.hN())this.renderCellEditor(b);else{if(a&&a.hv&&a.hv.parent().length){var f=a.hv.find(".ajs-layer-placeholder");f.length&& !f.children().length&&d&&d.current&&"function"===typeof d.current.hide&&d.current.hide();a.hv.detach()}this.renderCellView(b)}a&&a.iR()},renderCellEditor:function(e){var a=e._cellEditor;b.assert(a);b.assert(! !a.hv,a);a.editor$||this.safeSetHtml(a._$.cell,this.getCellViewHtml(e));a=a.hv;b.arrayEquals(e._cell$,a.parent())||(a.detach(),e._cell$.empty(),e._cell$.append(a))}})});define("structure/widget/columns/InserterMarks",["almworks/util/Util","underscore","structure/widget/attributes/Attributes"],
function(f,b,g){function d(a,c,h,d,k,g,m){if(!a)return null;var n= -1,p= !1,v= !1,C,z,F;if(null!=h&&null!=g){F= -1;z=h.length-1;for(C=g.length-1;0<=C&&0<=z;C--)if(0!==C||g[C]!==k){if(g[C]!==h[z]){f.assert(!1,h+" "+g);n=p=d[z];p=p===F;v=0===z&&h[z]===c;break}else z-=1;F=m[C]}0>n&&0<=z&&(n=p=d[z],p=p===F,v=0===z&&h[z]===c)}else null===g&&(n=0,p= !1);if(0<=n){a=b.clone(a);for(C=0;C<a.length&&(h=a[C],c=h>>4,d=c===n&&p,h=e(h&15,d,v),0>h?(a.splice(C,1),C-=1):a[C]=c<<4|h,c!==n);++C);a.length||(a=null)}return a}function e(a,b,c){switch(a){case m.ATTACHED_ROW:return b?m.ATTACHED_END_NESTED:m.ATTACHED_END;case m.DETACHED_ROW:return m.DETACHED_ROW;case m.ATTACHED_DETACHED_ROW:return b?m.ATTACHED_DETACHED_END_NESTED:m.ATTACHED_DETACHED_END;case m.INSERTER_ATTACHED:return-1;case m.ATTACHED_INSERTER_ATTACHED:case m.ATTACHED_INSERTER_DETACHED:return c?m.ATTACHED_ROW:b?m.ATTACHED_END_NESTED:m.ATTACHED_END;case m.DETACHED_INSERTER_DETACHED:return a}f.assert(!1,a);return a}function a(a,b){var e=b._panel,f=b.getAttributeValue(n),k=b.getAttributeValue(c),g=b.getAttributeValue(p),m=b.getRowId();if(!f)return null;var t=e.ae(),w=t.indexOf(b.getRowId())+1,v=null,C=null,v=null,z=(t=w==t.size()?null:t.row(
w))?t.getId():0;if(z){a.cycle();v=b.getRowValueAccessor(z);if(!v|| !v.hasValue(c)|| !v.hasValue(p))return e.getAttributeSubscription().addDataUpdateHandler(function(b){b[z]&&(e.aS().aM(m,!0),a.cycleEnd())},a.life()),f;C=v.getValue(c);v=v.getValue(p)}return d(f,m,k,g,z,C,v)}var n=g.INSERTER_MARKS,c=g.ATTACHED_RESPONSIBLE_INSERTERS,p=g.ATTACHED_RESPONSIBLE_INSERTER_DEPTHS,m={ATTACHED_ROW:0,DETACHED_ROW:1,ATTACHED_DETACHED_ROW:2,ATTACHED_END:3,ATTACHED_END_NESTED:4,ATTACHED_DETACHED_END:5,ATTACHED_DETACHED_END_NESTED:6,INSERTER_ATTACHED:7,ATTACHED_INSERTER_ATTACHED:8,DETACHED_INSERTER_DETACHED:9,ATTACHED_INSERTER_DETACHED:10},k=[];b.each(m,function(a,b){k[a]=b.toLowerCase().replace(/_/g,"-")});return{render:function(b,c){var e="",d=a(b,c),f,g,m,n,p=0;if(d&&d.length){e+='<div class="im">';for(f=d.length-1;0<=f;--f)g=d[f]>>4,m=k[d[f]&15],n=c._getDepthOffset(g),g=n-p,p=n,e+='<div class="'+m+'" style="width: '+g+'px"/>';e+="</div>"}return e},collectRequiredAttributes:function(a){a.requireAttribute(n);a.requireAttribute(c);a.requireAttribute(p)}}});define("structure/widget/columns/ActionsColumn",["almworks/util/Util","almworks/util/Template","structure/widget/model/Items",
"structure/api/Column"],function(f,b,g,d){function e(){return 46}var a=namespace("almworks.structure.ajsbridge"),n=new b('<div class="issue_actions"><div class="action-dropdown aui-dd-parent"><a class="aui-dropdown-trigger issue-actions-trigger aui-dd-link standard icon-tools-small" id="actions_{id}" title="{sw.table.actions.title}" href="{actionsUrl}" hidefocus onClick="return false;"><span><em>Actions</em></span></a><div id="actions_{id}_drop" class="aui-dropdown gadget-dropdown standard hidden"></div></div></div>');return{key:"actions",columnType:f.subClass("ActionsColumn",d,{init:function(){this.suffix=a.TOKEN?"?atl_token="+a.TOKEN:""},getCellViewHtml:function(b){b=b.getItemId();b=g.getIssueIdFromItemId(b);if(0<b){var e=a.localURL("/rest/api/1.0/issues/"+b+"/ActionsAndOperations"+this.suffix);return n.renderHtml({id:b,actionsUrl:e})}return ""},getWidth:e,getMinWidth:e,getDefaultWidth:e,isResizable:f.returnFalse,setWidth:f.returnTrue,shouldFlash:f.returnFalse})}});define("structure/widget/columns/RowId",["almworks/util/Util","structure/api/Column","structure/api/ColumnType","structure/api/ColumnConfigurator"],function(f,b,g,d){var e=namespace("almworks.structure"),a=f.subClass(
"RowIdColumn",b,{getDefaultName:f.returnConst(f.text("sw.column.type.rowid")),getCellValueHtml:function(a){return ""+a.getRowId()},isAutoSizeAllowed:f.returnTrue,canShrinkWhenNoSpace:f.returnTrue}),n=f.subClass("RowIdConfigurator",d,{getGroupKey:f.returnConst("fields"),getColumnTypeName:f.returnConst(f.text("sw.column.type.rowid"))});return{key:"rowid",columnType:new(f.subClass("RowIdType",g,{createSwitchTypePreset:function(a){return e.modes.STRUCTURE_DEBUG?{key:"rowid"}:null},createAddColumnPresets:function(a){return e.modes.STRUCTURE_DEBUG?[{key:"rowid"}]:[]},createConfigurator:function(a,b){return new n({context:a,spec:b})},createColumn:function(b,e){return "rowid"===e.key?new a({context:b,spec:e}):null}}))}});define("structure/widget/columns/ItemId",["almworks/util/Util","structure/api/Column","structure/api/ColumnType","structure/api/ColumnConfigurator"],function(f,b,g,d){var e=namespace("almworks.structure"),a=f.subClass("ItemIdColumn",b,{getDefaultName:f.returnConst(f.text("sw.column.type.itemid")),getCellValueHtml:function(a){a=""+a.getItemId();0===a.indexOf("com.almworks.jira.structure:type-")&&(a=a.substring(33));return f.htmlEscape(a)},isAutoSizeAllowed:f.returnTrue,
canShrinkWhenNoSpace:f.returnTrue}),n=f.subClass("ItemIdConfigurator",d,{getGroupKey:f.returnConst("fields"),getColumnTypeName:f.returnConst(f.text("sw.column.type.itemid"))});return{key:"itemid",columnType:new(f.subClass("ItemIdType",g,{createSwitchTypePreset:function(a){return e.modes.STRUCTURE_DEBUG?{key:"itemid"}:null},createAddColumnPresets:function(a){return e.modes.STRUCTURE_DEBUG?[{key:"itemid"}]:[]},createConfigurator:function(a,b){return new n({context:a,spec:b})},createColumn:function(b,e){return "itemid"===e.key?new a({context:b,spec:e}):null}}))}});define("structure/widget/columns/FieldColumn","underscore almworks/jquery almworks/util/Template almworks/util/Strings almworks/util/Util almworks/util/Classes structure/widget/ui/column/ColumnUtil structure/widget/jira/Fields structure/widget/attributes/Attributes structure/api/SpecOption structure/widget/ui/column/EditableColumn structure/api/ColumnConfigurator structure/api/ColumnType structure/widget/columns/edit/FieldCellEditor".split(" "),function(f,b,g,d,e,a,n,c,p,m,k,r,l,h){function u(a,b){b&&"timeAggregate"===b.key&&(b=n.copySpec(b),b.key="field",b.params||(b.params={}),b.params.aggregate="sum");return b}function s(
a,b){var d=b&&b.params&&b.params.field,h=(d=d&&a.jira.getIssueFieldById(d))&&d.name||"";h&&"sum"===b.params.aggregate&&c.isSummableField(d)&&(h=e.text("sw.column.opt.aggr.sum.colname",h));return h}function q(a){D= !0;a.div$.delegate(".s-f-thumbnail .value a","click",function(c){if(!c|| !c.target)return!0;if(t.hW(b(c.target).closest(".value"),c.target,a))return c.preventDefault(),!1})}function x(a,c){if("string"!==typeof a||0>a.indexOf("img"))return a;G.html(a);var e= !1;G.find("img").each(function(){var a=b(this),d=parseInt(a.attr("width"),10),h=parseInt(a.attr("height"),10);d&&h&&26<h&&(a.attr("height",26),a.attr("width",Math.round(26*d/h)),e= !0);a.closest("a").attr({target:"imageAttachment",rel:"thumbnail_"+c})});var d=e?G.html():a;G.empty();return d}var t=namespace("almworks.structure.ajsbridge"),w=c.uneditableFieldSet,v=c.sortableFieldSet,C=c.descendingByDefaultFieldSet,z=c.fieldSet({type:c.DURATION}),F=c.gadgetEditableFieldSet,A={id:"project.icon",format:"html"},D= !1,G=b("<div></div>"),B=new g('<span class="s-icons">{icon:html}</span>&nbsp;{issueId}'),K=new g('<span class="s-icons">{icon:html}</span>'),J=new g(
'<a class="issue-link s-item-link" data-issue-key="{key}" href="{url}">{content:html}</a>'),O=new g('<a class="s-item-link" href="{url}">{content:html}</a>'),V=a.subClass("FieldColumn",k,{init:function(){var a=this.spec.params||{};this.fieldId=a.field;var b="key"===this.fieldId?"issuekey":this.fieldId;this.jiraField=b&&this.context.jira.getIssueFieldById(b);this.attributes=[];b=(b=e.toIntSafe(e.tail(this.fieldId,"customfield_"),0))?{id:"customfield",params:{fieldId:b}}:{id:this.fieldId};"issuekey"===this.fieldId?(this.attributes.push(p.KEY_TEXT),this.attributes.push(p.URL_TEXT),this.spec.params.compact&&this.attributes.push(A)):(this.attribute=e.extend({},b,{format:"html"}),this.attributes.push(this.attribute));"sum"===a.aggregate&&c.isSummableField(this.jiraField)&&(this.aQ={id:"sum",format:"html",params:{attribute:e.extend({},b,{format:z[this.fieldId]?"duration":"number"})}},a.distinct&&(this.aQ.params.distinct= !0),this.attributes.push(this.aQ));this.gm=(a=this.fieldId)&&e.htmlEscape(a)===a?" s-f-"+a:""},getDefaultName:function(){return s(this.context,this.spec)},collectRequiredAttributes:function(a){var b=this.spec.params;this.attributes.forEach(function(c){a.requireAttribute(
c,b.forestSpec)})},hasValue:function(a){return this.attribute?a.hasValue(this.attribute):this.attributes&&this.attributes.length?a.hasValue(this.attributes[0]): !1},getSortAttribute:function(){return "issuekey"===this.fieldId?{id:"key",format:"order"}:this.aQ?e.extend({},this.aQ,{format:this.aQ.params.attribute.format}):this.fieldId&&v[this.fieldId]?{id:this.fieldId,format:"order"}:this.attribute&&"customfield"===this.attribute.id?e.extend({},this.attribute,{format:"order"}):null},getSortTransform:function(){if(this.attribute&&this.attribute.params&&"customfield"===this.attribute.id){var a=this.attribute.params.fieldId,c=this.context.structure._panel.widget.jiraConfig,e=b.Deferred(),d=this;c.load(function(){f.findWhere(c.getJiraAgileRankFields(),{customId:a})?e.resolve({module:"com.almworks.jira.structure:sorter-agile-rank",params:{fieldId:a}}):e.resolve(k.prototype.getSortTransform.apply(d))});return e.promise()}return k.prototype.getSortTransform.apply(this)},isSortDescendingByDefault:function(){return this.fieldId&&(C[this.fieldId]||e.tail(this.fieldId,"customfield_"))},getCellViewHtml:function(a){"thumbnail"!==this.fieldId||D||q(this.context.structure._panel.widget);var c;if(
"issuekey"===this.fieldId){var h=this.spec.params.compact,f=a.getAttributeValue(p.KEY_TEXT);if(f){c=a.getAttributeValue(p.URL_TEXT);var l;l=a.getAttributeValue(A);h&&l?(h=f.split("-"),l=2!==h.length?K.renderHtml({icon:l}):B.renderHtml({icon:l,issueId:h[1]})):l=d.htmlEscape(f);c&&(l=(a.isIssue()?J:O).renderHtml({key:f,url:c,content:l}));c=l}else c=""}else(c=a.getAttributeValue(this.aQ||this.attribute,this.spec.params.forestSpec))&&"thumbnail"===this.fieldId&&(c=x(c,a.getRowId()));l=null;this.aQ&&(l=a.getAttributeValue(this.attribute))&&c&&b.trim(l)===b.trim(c)&&(l=null);f='<div class="celldiv'+this.gm+'"><div class="grad"></div>';f=l?f+e.renderTemplate('<span class="value" title="{sw.column.opt.aggr.own-hint}">'):f+'<span class="value">';c&&(f+=c);l&&(f+='<span class="s-aggr-own">'+l+"</span>");f=(c=(a=a._cellEditor)&&a.hw())&&(a.hS()||a.jq())?f+('</span><div class="s-cellerror" title="'+e.htmlEscape(c)+'"><div class="s-error-triangle"></div></div></div>'):f+"</span></div>";a&&a.jq()&&a.hN()&&(f='<div class="s-editor-loading" title=""></div>'+f);return f},isAutoSizeAllowed:e.returnTrue,canShrinkWhenNoSpace:e.returnTrue,shouldFlash:function(a){return this.aQ?a.isAttributeFlashed(
this.aQ,this.spec.params.forestSpec):this.attributes.some(function(b){return a.isAttributeFlashed(b)})},createCellEditor:function(a){return new h(a,this)},isEditableColumn:function(){return this.context.structure.isGadget()? ! !F[this.fieldId]: !w[this.fieldId]},gb:function(a,b){var c={issueId:a};if(0>a){if("issuetype"===this.fieldId)return!0;var e=b.master.bh().getRowEdit(a);if(!e)return!1;c.creationContext=e.lp();if(!c.creationContext)return!1}c=b.jiraConfig.hy(c);if(!c)return!1;e=c.fields;if(!e)return!1;e=e[h.MAPPING[this.fieldId]||this.fieldId];if(!e)return!0;e=e[0>a?"createHtml":"editHtml"];return!e||"timeoriginalestimate"===this.fieldId&& !c.canChangeOriginalEstimate? !0: !1},getSuggestedAttributeSpecs:function(){return this.aQ?[e.deepClone(this.aQ)]:this.attribute?[e.deepClone(this.attribute)]:[]}}),U=a.subClass("FieldConfigurator",r,{getGroupKey:function(){return this.spec.params.aggregate?"totals":"fields"},getDefaultColumnName:function(){return s(this.context,this.spec)},getColumnTypeName:e.returnConst(e.text("sw.column.type.field")),getOptions:function(){var a={configurator:this};return[new P(a),new m.Aggregate(a),new Y(a)]}}),P=a.subClass("FieldOption",m,{title:e.text(
"sw.column.opt.field"),init:function(){this.select$=null},createInput:function(a){var c=this.context.jira.getAllIssueFields(),d="",h=this.spec.params;h.field||(d+=e.renderTemplate('<option value=""></option>'));for(var f=0,l;l=c[f++];)d+=e.renderTemplate('<option value="{id}">{name}</option>',l);this.select$=a.append('<select class="select">'+d+"</select>").find("select");this.select$.val(h.field||"");this.select$.on("change",function(){var c=b(this);c.find('option[value=""]').remove();c=c.val();e.isArray(c)&&(c=c[0]);h.field=c;a.trigger("notify")});t.createAjsSingleSelect(this.select$)},notify:function(){this.select$.val(this.spec.params.field||"");return!0},isInputValid:function(){return! !this.spec.params.field}}),Y=a.subClass("CompactViewOption",m,{init:function(){this.checkbox$=null},createInput:function(a){this.checkbox$=a.append(e.renderTemplate('<div class="checkbox"><label><input type="checkbox">{sw.column.issueid.compact.title}</label></div>')).find("input");var c=this.spec.params;this.checkbox$.on("change",function(){c.compact=b(this).prop("checked");a.trigger("notify")})},notify:function(){return "issuekey"===this.spec.params.field?(this.checkbox$.prop("checked",
this.spec.params.compact),!0): !1}});return{key:["field","timeAggregate"],columnType:new(a.subClass("FieldColumnType",l,{createSwitchTypePreset:function(a){return{key:"field",params:{}}},createAddColumnPresets:function(a){a=a.jira.getAllIssueFields();for(var b=[],e=0,d=a.length;e<d;e++){var h=a[e];b.push({key:"field",params:{field:h.id}});c.isSummableField(h)&&b.push({key:"field",params:{field:h.id,aggregate:"sum"}})}return b},createConfigurator:function(a,b){b=u(a,b);return new U({context:a,spec:b})},createColumn:function(a,b){b=u(a,b);var e;var d=b;d&&"field"===d.key&&d.params?(e=a.jira.getIssueFieldById(d.params.field))?(d=d.params.aggregate,e= !d||"sum"===d&&c.isSummableField(e)? !0: !1):e= !1:e= !1;return e?new V({context:a,spec:b}):null}})),isFieldColumn:function(a){return a instanceof V}}});define("structure/widget/columns/edit/FieldCellEditor",["almworks/jquery","almworks/util/Util","structure/widget/model/Items","structure/widget/ui/editor/CellEditor"],function(f,b,g,d){function e(a,b){d.call(this,a,b);this.hq=e.MAPPING[b.fieldId]||b.fieldId}function a(a,b,c,e,d,f){var k=b.width()-21;e="string"===typeof e?c.find(e):e;d=(c="string"==typeof d?c.find(d):d)&&c.length?
c.outerWidth(!0):0;d+=e.outerWidth(!0)-e.width();a=a.iS()?188-d:0;b=b.find(".s-editbuttons.s-with-dialog").length?210:0;f={width:Math.max(k-d,a,f||0,b)+"px","max-width":"none"};c&&c.length||(f["margin-right"]=0);e.css(f)}function n(b,c,e){return function(d,f,k,g){a(d,g,f,b,c,e)}}function c(a,b,c,e,d,f){f=f.width()-21;c=e.find("textarea");d=c.siblings(".content-inner");b=Math.max(188,b,f);d.length&&(b=Math.max(250,b));c.css({width:b+"px"});c.attr("rows",a);d.length&&d.css({width:b-1+"px",height:c.height()+e.find(".wiki-edit-toolbar").height()+"px"})}function p(b,c,e){return function(d,f,k,g){k=f.find("select");var n=f.find("*").filter(b);"remote"===m.modes.GADGET&&k.length?(n.remove(),k.removeAttr("multiple").show(),a(d,g,f,k,c,150)):n.length?(n.slice(1).remove(),a(d,g,f,n,c,150)):k.length?a(d,g,f,k,c,150):e&&(n=f.find(e),a(d,g,f,n,c,150))}}namespace("almworks.structure.columns");var m=namespace("almworks.structure");e.MAPPING={timeestimate:"timetracking",timeoriginalestimate:"timetracking"};b.extend(e.prototype,d.prototype,{hL:function(a){return this.column.hasValue(a)},iF:function(a){b.assert(! !a);var c=a.error;if(c)this.jI(c);else{var e=(c=a.fields)&&c[this.hq];if(c=e&&e.error)
this.jI(c);else if(c=e&&e[0>this.rowId?"createHtml":"editHtml"])if("timeoriginalestimate"!==this.column.fieldId||a.canChangeOriginalEstimate)this.jA=c,a=this.hd(c),this.iX(a);else this.jI(b.text("s.w.rest.config.fields.original-estimate.uneditable"));else this.jI(b.text("s.w.config.fields.load-got-nothing"))}},pk:function(a,b){this.editor$=this.hd(this.jA);this.hv.css("visibility","hidden");this._$.editor.html(this.editor$);var c=a.apply(this,b);this.ajsInitialized= !1;this.jD().then(function(){this.jr();this.hv.css("visibility","visible");this.hG.panel.bn().gL()}.bind(this));return c},kS:function(a,c){if(this.editor$&&b.onPage(this.editor$)){var e=c&&this.iO();this.pk(d.prototype.kS,[a,c]);e&&this.takeFocus(!1)}else d.prototype.kS.call(this,a,c)},applyData:function(a){this.editor$?this.pk(d.prototype.applyData,[a]):d.prototype.applyData.call(this,a)},hd:function(a){var b=f('<form class="aui" onsubmit="return false">'+a+"</form>");a=this.column.fieldId;"timeoriginalestimate"===a?b.find('input[name="timetracking_remainingestimate"]').closest("div.field-group").remove():"timeestimate"===a&&b.find('input[name="timetracking_originalestimate"]').closest("div.field-group").remove();
b.find("a.localHelp,legend").remove();a="";var c=b.find(".description,span.example");if(c.length){var e=[];c.each(function(){var a=f(this).text();(a=a&&f.trim(a))&&e.push(a)});e.length&&(a=e.join(" \n"),b.attr("title",a))}c.remove();b.find("label[for]").each(function(){var a=f(this),c=a.attr("for");b.find("#"+c+',[name="'+c+'"]').is(":checkbox,:radio")||a.remove()});return b},jh:function(){var a=this.hG.panel.widget.jiraConfig,c=this.hG.lp();if(0>this.rowId&& !c)return b.warn("cannot load editors when no project/type is set"),!1;var e=this.hG.itemId;if(e&& !g.isIssue(e))return!1;var d=this.hG.itemType;if(d&&d!==g.ISSUE)return!1;c={itemId:e,itemType:d,creationContext:c,field:this.hq,ii:b.withThis(this,this.jI),jw:b.withThis(this,this.iF)};a.gB(c);return!0},ge:function(){var a=this.gD,b=this.column.attribute;if(b&&"html"===b.format&&(a=a?this.hn(this.hv,a)||"":"",this.ig(b,a),this.column.aQ)){var b=this.hG.panel.bd(),c=b.indexOf(this.rowId);0<=c&&(c===b.size()-1||b.rowDepth(c+1)<=b.rowDepth(c))&&this.ig(this.column.aQ,a)}},iA:function(a,c){var e=this.editor$;if(e){var d=this.hq;(d=r[b.tail(d,"customfield_")?"customfield":d])&&d(this,e,a,c)}},gO:function(a){a=d.prototype.gO.call(this,
a);if("assignee"===(this.column&&this.column.fieldId)&&a){var b=a.assignee;b&&"string"!==typeof b&&1<b.length&&(b="-1"===b[0]?b[1]:b[0],a.assignee=b)}return a},hn:function(a,b){if("assignee"===(this.column&&this.column.fieldId)&&b){var c=b.assignee;if(c){if(c="string"===typeof c?c:1===c.length?c[0]:null)if(c=a.find('select option[value="'+c+'"]'),c.length&&c.is(":selected"))return f.trim(c.html())}else if(""===c&&(c=a.find('select option[value=""]:selected'),c.length))return f.trim(c.html())}return d.prototype.hn.call(this,a,b)}});var k=n("input[type=text]",null,110),r={assignee:b.seq(p("#assignee-single-select","#assign-to-me-trigger","input#assignee"),function(a,b,c,e){a=b.find("#assignee-container");c=b.find("#assignee-single-select,input#assignee");e=b.find("#assign-to-me-trigger");"remote"===m.modes.GADGET&&(c=b.find("select#assignee,input#assignee"),e.css("top","0"));a.width(c.outerWidth(!0)+(e.length?e.outerWidth(!0):0))}),description:b.curry(c,9,400),duedate:n("input","#duedate-trigger",110),environment:b.curry(c,3,0),issuetype:p("#issuetype-single-select",null,null),timeoriginalestimate:k,timetracking:k,priority:p("#priority-single-select",null,null),reporter:n("input",
"a.popup-trigger",110),security:n("select",null,110),customfield:function(b,e,d,f){var k=e.find("input[type=text],select");if(1===k.length){if(!k.siblings().length){a(b,f,e,k,null,130);return}if(k.hasClass("datepicker-input")){a(b,f,e,k,'a[href="#"][id$="trigger"]',110);return}}k=e.find("textarea");1!==k.length||k.closest(".jira-multi-select").length?(k=e.find(".wiki-edit"),1===k.length&&a(b,f,e,k,null,200)):c(3,0,b,e,d,f)}};return e});define("structure/widget/columns/HandleColumn","jquery almworks/util/Util almworks/util/Template structure/widget/attributes/Attributes structure/widget/model/Items structure/api/Column structure/widget/ui/column/ColumnUtil".split(" "),function(f,b,g,d,e,a,n){function c(){return p.modes.GH_TAB?56:70}var p=namespace("almworks.structure"),m=g.build("div","a",function(a,b){return[a(".st-dh"),a(".s-handles")(b(".s-ms-mark",{href:"#",id:"s-ms-{panelId}-{id}"}),"{handles:html}")]}),k=new g('<i class="{iconClass} {additionalClasses}" title="{tooltip}"></i>'),r=k.renderHtml({iconClass:"s-fa s-fa-check",additionalClasses:"s-done-mark",tooltip:b.text("sw.widget.resolved.tooltip")}),l=k.renderHtml({iconClass:"s-fa s-fa-pencil",additionalClasses:"s-dirty-mark",
tooltip:b.text("s.w.handle.ed.tooltip")}),h=k.renderHtml({iconClass:"s-fa s-fa-lock",additionalClasses:"s-ro-mark",tooltip:b.text("sw.widget.ro.tooltip")}),u=new g('<span class="s-h-{diffIcon}-mark" title="{tooltip}"></span>'),s=(new g('<span class="s-h-empty-mark"></span>')).renderHtml();return{key:"handle",columnType:b.subClass("HandleColumn",a,{collectRequiredAttributes:function(a){a.requireAttribute(d.DONE);a.requireAttribute(d.EDITABLE);a.requireAttribute(d.CHILDREN_GENERATORS_HINT)},getCellViewHtml:function(a){var c;a:{c=a.getRowId();var f=this._getUploadQueue(),g=this._getItemEditor();if(f&&f.hasUploadErrors(c))f="s-row-error s-upload-error";else if(g&&g.isRowEditedAndHasUploadErrors(c))f="s-row-error";else{c=null;break a}c=b.text(0>c?"s.w.handle.ed-err-new.tooltip":"s.w.handle.ed-err.tooltip");c=k.renderHtml({iconClass:"s-fa s-fa-exclamation-triangle",tooltip:c,additionalClasses:f})}p.modes.GH_TAB||(c||(c=p.modes.HISTORY?(c=a._panel.widget.bF.getRowIconData(a.getRowId()))?u.renderHtml({diffIcon:c.icon,tooltip:b.text("sw.widget.h."+c.status+".tooltip")}):s:null),c)||((c=r,(f=a._valueAccessor._displayedRowData)&&(f.iW()||f.nA()))?c+=l: !1===a.getAttributeValue(d.EDITABLE)&&
e.isIssue(a.getItemId())&&a._panel.aW()?c+=h:this._isStructureBoard()&&(f=a.getAttributeValue(d.CHILDREN_GENERATORS_HINT))&&(f=n.getGeneratorSummaryHtml(a,f),c+=k.renderHtml({iconClass:"alm alm-automation",additionalClasses:"s-generator-hint s-tooltip",tooltip:'<div class="st-cgen-hint">'+f+"</div>"})));return m.renderHtml({id:a.getRowId(),panelId:a._panel.panelId,handles:c||""})},updateRowClasses:function(a){a._row$.toggleClass("s-item-done",! !a.getAttributeValue(d.DONE))},getHeaderCellHtml:function(){return b.renderTemplate('<div class="s-th-handle"><a href="#" class="s-ms-toggle-all s-ms-t-a-th s-ms-{panelId}-all"></a></div>',this.options.panel)},isResizable:b.returnFalse,setWidth:b.returnTrue,getWidth:c,getMinWidth:c,getDefaultWidth:c,_isStructureBoard:function(){!0!==this._structureBoard&& !1!==this._structureBoard&&(this._structureBoard=this.context.structure.isStructureBoard());return this._structureBoard},_getItemEditor:function(){void 0===this._itemEditor&&(this._itemEditor=this.context.structure._panel.bh());return this._itemEditor},_getUploadQueue:function(){void 0===this._uploadQueue&&(this._uploadQueue=this.context.structure._panel.widget.ad);return this._uploadQueue}
})}});define("structure/widget/columns/IconsColumn","almworks/jquery almworks/util/Util structure/widget/ui/column/ColumnUtil structure/api/Column structure/api/ColumnConfigurator structure/api/SpecOption structure/api/ColumnType structure/widget/columns/JoinedFieldsColumn".split(" "),function(f,b,g,d,e,a,n,c){function p(a){if(a&&"joined"===a.key){var c=a.params&&a.params.fields,e;if(b.isArray(c)){for(e=0;e<c.length;e++)if(!h[c[e]])return a;a=g.copySpec(a);a.key="icons";a.name&&(a.name=b.renderTemplate(a.name))}}return a};function m(a,c){if(c&&("icons"===c.key||"joined"===c.key)&&c.params&&b.isArray(c.params.fields)){var e=c.params.fields,d;for(d=0;d<e.length;d++)if(!a.jira.getIssueFieldById(e[d]))return!1;if("icons"===c.key)for(d=0;d<e.length;d++)if(!l[e[d]])return!1;return!0}return!1}function k(a,c,e,d,f){for(var h=0;h<d.length;h++)if(!a.jira.getIssueFieldById(d[h]))return;a={key:"icons",params:{fields:d}};c&&(a.name=b.text(c));e&&(a.presetName=b.text(e));f.push(a)}var r="project issuetype priority status reporter assignee".split(" "),l=b.flipSet(r),h=b.flipSet(["issuetype","priority"]),u=b.subClass("IconsColumn",d,{init:function(a){this.fields=this.spec.params&&
this.spec.params.fields;a.statusSupported||(r=["project","issuetype","priority","reporter","assignee"],l=b.flipSet(r))},getCellValueHtml:function(a){var b='<span class="s-icons">';if(this.fields&&this.fields.length)for(var c=0;c<this.fields.length;c++)var e=a.getAttributeValue({id:this.fields[c]+".icon",format:"html"}),b=b+(e||"");return b+"</span>"},collectRequiredAttributes:function(a){this.fields&&this.fields.forEach(function(b){a.requireAttribute({id:b+".icon",format:"html"})})},getDefaultName:b.returnConst(b.text("sw.column.type.icons")),isAutoSizeAllowed:b.returnFalse,getDefaultWidth:function(){return 16*(this.fields&&this.fields.length||6)+32},canShrinkWhenNoSpace:b.returnTrue,getMetadataRequests:function(){return this.metaReqs}}),s=b.subClass("IconsConfigurator",e,{init:function(){this.spec.key="icons"},getGroupKey:b.returnConst("icons"),getDefaultColumnName:b.returnConst(b.text("sw.column.type.icons")),getColumnTypeName:b.returnConst(b.text("sw.column.type.icons")),getOptions:function(){return[new q({configurator:this})]}}),q=b.subClass("FieldsOption",a,{title:b.text("sw.column.icons.opt.fields"),init:function(){this.div$=null},createInput:function(a){function c(){
e.fields=[];a.find("input:checked").each(function(){e.fields.push(f(this).attr("data-field"))});a.trigger("notify")}var e=this.spec.params,d=b.addAll([],e.fields),h,k,l="";for(h=0;k=r[h++];)0>b.indexOf(d,k)&&d.push(k);l+='<div class="checkbox">';for(h=0;k=d[h++];)(k=this.context.jira.getIssueFieldById(k))&&(l+=b.renderTemplate('<div class="st-col-drag"><div class="st-col-drag-handle" title="{sw.column.icons.opt.fields.draghint}"><div class="st-col-drag-icon"></div></div><label><input type="checkbox" data-field="{id}"> {name}</label></div>',k));f(l+"</div>").appendTo(a).on("change","input",c).sortable({axis:"y",update:c});this.div$=a},notify:function(){var a=b.flipSet(this.spec.params.fields);this.div$.find("input").each(function(){var b=f(this);b.prop("checked",! !a[b.attr("data-field")])});return!0},isInputValid:function(){return!(!this.spec.params.fields|| !this.spec.params.fields.length)}});return{key:["icons","joined"],columnType:new(b.subClass("IconsColumnType",n,{createSwitchTypePreset:function(a){return{key:"icons",params:{}}},createAddColumnPresets:function(a){var c=[];k(a,"s.w.column.tp.label",null,["issuetype","priority"],c);this.isStatusSupported(a)&&k(a,
"s.w.column.stp.label",null,["status","issuetype","priority"],c);k(a,null,"s.w.column.all-icons.label",b.addAll([],r),c);return c},createConfigurator:function(a,b){b=p(b);return "joined"===b.key?new c.Configurator({context:a,spec:b}):new s({context:a,spec:b})},isStatusSupported:function(a){return 7E4>a.structure._widget.jiraConfig.getVersionSignature()},createColumn:function(a,b){b=p(b);if(m(a,b)){if("icons"===b.key)return new u({context:a,spec:b,statusSupported:this.isStatusSupported(a)});if("joined"===b.key)return new c.Column({context:a,spec:b})}return null}}))}});define("structure/widget/columns/JoinedFieldsColumn",["almworks/util/Util","structure/api/Column","structure/api/ColumnConfigurator"],function(f,b,g){b=f.subClass("JoinedFieldsColumn",b,{init:function(){this.fields=this.spec.params&&this.spec.params.fields;this.attributes=[];if(this.fields)for(var b=0,e=this.fields.length;b<e;b++)this.attributes.push({id:this.fields[b],format:"html"})},collectRequiredAttributes:function(b){this.attributes.forEach(function(e){b.requireAttribute(e)})},getCellValueHtml:function(b){var e="";this.attributes.forEach(function(a){(a=b.getAttributeValue(a))&&(e+=a)});return e},
isAutoSizeAllowed:f.returnTrue,canShrinkWhenNoSpace:f.returnTrue});f=f.subClass("JoinedFieldConfigurator",g,{getGroupKey:f.returnConst("icons"),getColumnTypeName:f.returnConst(f.text("sw.column.type.joined"))});return{Column:b,Configurator:f}});define("structure/widget/columns/ProgressColumn","almworks/jquery almworks/util/Util almworks/util/Template structure/widget/attributes/Attributes structure/widget/jira/Fields structure/api/Column structure/api/ColumnType structure/api/ColumnConfigurator structure/api/SpecOption".split(" "),function(f,b,g,d,e,a,n,c,p){function m(a){return a.id}function k(){x.status.url=u.localURL("rest/api/2/status");return x}function r(a){var b={statuses:[],percents:[]};a=a.getMetadata("status");if(!a)return b;for(var c=0;c<a.order.length;c++){var e=a.desc[a.order[c]];if(q.hasOwnProperty(e.name)){var d=q[e.name];b.statuses.push(e.id);b.percents.push(d)}}return b}function l(a){return b.isArray(a)?a[0]:a}var h=namespace("almworks.structure.apputil"),u=namespace("almworks.structure.ajsbridge"),s=d.PROGRESS_NUMBER,q={New:0,Open:0,Reopened:0,"To Do":0,"In Progress":50,Resolved:100,Done:100,Closed:100},x={status:{url:u.localURL("rest/api/2/status"),cacheable: !0,
extract:function(a){return b.isArray(a)?{order:b.convertArray(a,m),desc:b.mapArray(a,m)}:{order:[],desc:{}}},timeout:1E4}},t={basedOn:function(){return!0},includeSelf:function(a){return a&&0<=f.inArray(a.basedOn,["status","timetracking"])},percentField:function(a){return a&&0<=f.inArray(a.basedOn,["percentfield"])},statuses:function(a,b){return! !(a&&0<=f.inArray(a.basedOn,["status"])&&b.getMetadata("status"))},percents:function(a,b){return this.statuses(a,b)},resolvedComplete:function(a){return a&&0<=f.inArray(a.basedOn,["status","timetracking","percentfield","resolution"])},weightBy:function(a){return a&&0<=f.inArray(a.basedOn,["status","resolution","percentfield"])},weightByField:function(a){return this.weightBy(a)}},w=b.subClass("ProgressColumn",a,{init:function(){var a=this.spec.params,c=this.context;if(!a||0>f.inArray(a.basedOn,["status","resolution","percentfield","timetracking",""]))a=this.spec.params={},a.basedOn="timetracking",a.resolvedComplete= !0,a.includeSelf= !0;var e=b.filterMap(a,function(b,e){return null!==e&&t[b]&&t[b](a,c)});delete e.displayPercents;this.attributeSpec=b.extend({},s,{params:e})},collectRequiredAttributes:function(a){a.requireAttribute(
this.attributeSpec)},getSortAttribute:function(){return this.attributeSpec},getSuggestedAttributeSpecs:function(){return[b.deepClone(this.attributeSpec)]},getDefaultName:b.returnConst(b.text("sw.column.progress.name")),getCellViewHtml:function(a){a=this.attributeSpec&&a.getAttributeValue(this.attributeSpec);if("number"!==typeof a)return '<div class="celldiv"></div>';a=Math.floor(100*Math.min(1,Math.max(0,a)))+"%";return(this.spec.params&&this.spec.params.displayPercents?v:C).renderHtml({percent:a})},isAutoSizeAllowed:function(){return!(!this.spec.params|| !this.spec.params.displayPercents)},canShrinkWhenNoSpace:b.returnTrue}),v=g.build("div","span",function(a,b){return[a(".celldiv",{title:"{s.w.progress.title,percent}"})(a(".grad"),b(".value")("{percent}"))]}),C=g.build("div",function(a){return[a(".celldiv",{title:"{s.w.progress.title,percent}"})(a(".simpleProgress")(a({style:"width:{percent}"})))]}),z=b.subClass("ProgressColumnConfigurator",c,{init:function(){this.spec.key="progress"},getGroupKey:b.returnConst("progress"),getColumnTypeName:b.returnConst(b.text("sw.column.progress.name")),getOptions:function(){var a={configurator:this};return[new U(a),new F(a),new D(a),new G(a),
new V(a),new J(a),new A(a),new B(a),new K(a),new O(a)]}});g=b.subClass("HeaderOption",p,{createLabel:function(a){f("<div></div>").text(this.title||"").appendTo(a)},fieldGroupClass:function(){return "st-col-header"}});var F=b.subClass("ProgressIssueHeaderOption",g,{title:b.text("sw.column.progress.hdr.issue")}),A=b.subClass("ProgressSumHeaderOption",g,{title:b.text("sw.column.progress.hdr.sum"),notify:function(){return this.spec.params&&this.spec.params.basedOn&&""!==this.spec.params.basedOn}}),D=b.subClass("ProgressBaseOption",p,{title:b.text("sw.column.progress.opt.base"),init:function(){this.select$=null},jiraHasCustomFields:function(){for(var a=this.context.jira.getAllIssueFields(),b=0,c;c=a[b++];)if(e.isNumericCustomField(c))return!0;return!1},createInput:function(a){var c=this,e='<option value="timetracking">{sw.column.progress.opt.base.timetracking}</option><option value="resolution">{sw.column.progress.opt.base.resolution}</option>';this.context.getMetadata("status")&&(e+='<option value="status">{sw.column.progress.opt.base.status}</option>');this.spec.params&&""===this.spec.params.basedOn&&(e='<option value="">{sw.column.progress.opt.base.choose}</option>'+e);
this.jiraHasCustomFields()&&(e+='<option value="percentfield">{sw.column.progress.opt.base.percentfield}</option>');this.select$=a.append('<select class="select">'+b.renderTemplate(e)+"</select>").find("select");this.select$.on("change",function(){var b=l(c.select$.val());""!==b&&(c.select$.find('option[value=""]').remove(),c.spec.params=c.spec.params||{},c.spec.params.basedOn!==b&&(c.spec.params.basedOn=b,a.trigger("notify")))});u.createAjsSingleSelect(this.select$)},notify:function(a){var b=this.spec.params&&this.spec.params.basedOn;this.select$.trigger("ajs:update",b).val(b);if(""===b&&"show"===a){var c=this.select$;window.setTimeout(function(){c.trigger("ajs:expand")},10)}return!0}}),G=b.subClass("ProgressPercentFieldOption",p,{title:b.text("sw.column.progress.opt.percent"),init:function(){this.select$=null},createInput:function(a){for(var c=this,d=this.context.jira.getAllIssueFields(),f="",h=0,k;k=d[h++];)e.isNumericCustomField(k)&&(this.firstChoice=k.id,f+=b.renderTemplate('<option value="{id}">{sw.column.progress.opt.percent.field,name}</option>',k));this.select$=a.append('<select class="select">'+f+"</select>").find("select");this.select$.on("change",function(){var b=l(
c.select$.val());c.spec.params=c.spec.params||{};c.spec.params.percentField!==b&&(b?c.spec.params.percentField=b:delete c.spec.params.percentField,a.trigger("notify"))});u.createAjsSingleSelect(this.select$)},makesSense:function(){return t.percentField(this.spec.params)},notify:function(){if(this.makesSense()){!this.spec.params.percentField&&this.firstChoice&&(this.spec.params.percentField=this.firstChoice);var a=this.spec.params.percentField||"";this.select$.trigger("ajs:update",a).val(a);return!0}return!1}}),B=b.subClass("ProgressTimeWeightOption",p,{title:b.text("sw.column.progress.opt.weight"),createInput:function(a){f("<div></div>").addClass("st-col-progress-faketimeweight").text(b.text("sw.column.progress.opt.weight.time")).appendTo(a)},makesSense:function(){return this.spec.params&&0<=f.inArray(this.spec.params.basedOn,["timetracking"])},notify:function(){return this.makesSense()}}),K=b.subClass("ProgressWeightFieldOption",p,{title:b.text("sw.column.progress.opt.weight"),init:function(){this.select$=null},createInput:function(a){for(var c=this,d=this.context.jira.getAllIssueFields(),f=b.renderTemplate(
'<option value="equal">{sw.column.progress.opt.weight.equal}</option><option value="time">{sw.column.progress.opt.weight.time}</option>'),h=0,k;k=d[h++];)e.isNumericCustomField(k)&&(f+=b.renderTemplate('<option value="field|{id}">{sw.column.progress.opt.weight.field,name}</option>',k));this.select$=a.append('<select class="select">'+f+"</select>").find("select");this.select$.on("change",function(){var b=l(c.select$.val()).split("|"),e;c.spec.params=c.spec.params||{};e=0|c.spec.params.weightBy!==b[0];c.spec.params.weightBy=b[0];"field"===b[0]&&(e|=c.spec.params.weightByField!==b[1],null!=b[1]?c.spec.params.weightByField=b[1]:delete c.spec.params.weightByField);e&&a.trigger("notify")});u.createAjsSingleSelect(this.select$)},makesSense:function(){return t.weightBy(this.spec.params)},notify:function(){if(this.makesSense()){var a="field"===this.spec.params.weightBy?"field|"+this.spec.params.weightByField:this.spec.params.weightBy||"equal";this.select$.trigger("ajs:update",a).val(a);return!0}return!1}}),J=b.subClass("ProgressResolvedCompleteOption",p,{title:b.text(""),init:function(){this.input$=null},createInput:function(a){this.input$=a.append(b.renderTemplate(
'<div class="checkbox"><label><input type="checkbox">&nbsp;{sw.column.progress.opt.resolved}</label></div><div class="description">{sw.column.progress.opt.resolved.desc}</div>')).find("input");var c=this;this.input$.on("change",function(){if(!f(this).is(":disabled")){var b=f(this).is(":checked");b!== ! !c.spec.params.resolvedComplete&&(c.spec.params.resolvedComplete=b,a.trigger("notify"))}})},makesSense:function(){return t.resolvedComplete(this.spec.params)},notify:function(){return this.makesSense()?(this.input$.prop("checked","resolution"===this.spec.params.basedOn? !0: ! !this.spec.params.resolvedComplete),this.input$.attr("disabled","resolution"===this.spec.params.basedOn),!0): !1}}),O=b.subClass("ProgressIncludeSelfOption",p,{title:b.text(""),init:function(){this.input$=null},createInput:function(a){this.input$=a.append(b.renderTemplate('<div class="checkbox"><label><input type="checkbox">&nbsp;{sw.column.progress.opt.includeself}</label></div>')).find("input");var c=this;this.input$.on("change",function(){var b= !f(this).is(":checked");b!== ! !c.spec.params.includeSelf&&(c.spec.params.includeSelf=b,a.trigger("notify"))})},makesSense:function(){return t.includeSelf(
this.spec.params)},notify:function(){return this.makesSense()?(this.input$.prop("checked",!this.spec.params.includeSelf),!0): !1}}),V=b.subClass("ProgressStatusHistogramOption",p,{title:b.text("sw.column.progress.opt.statushist"),init:function(){this.tableSignature=this.adder$=this.div$=this.table$=null},calcSignature:function(){return this.spec.params&&this.spec.params.statuses&&this.spec.params.percents?this.spec.params.statuses.join(",")+";"+this.spec.params.percents.join(","):""},hi:function(){var a=this.spec.params;if(!a.statuses|| !a.percents){var b=r(this.context);a.statuses=b.statuses;a.percents=b.percents}},redrawTable:function(){var a=this.context.getMetadata("status"),b=this.spec.params;if(a){for(var c=[],e=0;e<b.statuses.length;++e)a.desc[b.statuses[e]]&&c.push([b.statuses[e],b.percents[e]]);c.sort(function(a,b){return a[1]-b[1]});for(e=0;e<c.length;++e){var d=this.table$.find(".st-progress-status-"+c[e][0]);d.length?d.find("input").val(c[e][1]):(d=this.createStatusRow(c[e][0],c[e][1],a),this.table$.append(d))}this.table$.find(".st-sth-row").each(function(){var a=f(this).data("status");0>f.inArray(a,b.statuses)&&f(this).remove()})}this.tableSignature=this.calcSignature(
)},createStatusRow:function(a,c,e){var d=this,k=this.spec.params;c=b.renderTemplate('<div class="st-sth-row">'+(7E4>this.context.structure._widget.jiraConfig.getVersionSignature()?'<img src="{status.iconUrl}" title="{status.description}">':"")+'<div class="st-sth-name" title="{status.description}"><span class="grad"></span>{status.name}</div><a class="st-tb" title="{sw.column.progress.opt.statushist.rm.hint}"><div class="st-tbi" style="background-position: -176px -96px;"></div></a><div class="st-sth-input"><span>%</span><input type="text" value="{percent}"></div></div>',{status:e.desc[a],percent:""+c});c=f(b.renderTemplate(c)).addClass("st-progress-status-"+a).data("status",a);h.initializeButton(c.find(".st-tb"));c.find("input").on("change",function(){var b=parseInt(f(this).val(),10),c=f.inArray(a,k.statuses);0<=b&&100>=b&&0<=c&&b!==k.percents[c]?(k.percents[c]=b,d.redrawTable(),d.div$.trigger("notify")):""===f.trim(b)?(k.percents[c]=0,d.redrawTable(),d.div$.trigger("notify")):f(this).val(k.percents[c])});c.find("a").on("click",function(){var b=f.inArray(a,k.statuses);0<=b&&(k.statuses.splice(b,1),k.percents.splice(b,1));d.redrawTable();d.gK();d.div$.trigger("notify");return!1});
return c},gK:function(){this.adder$.empty();var a=this.spec.params,c=this.context.getMetadata("status"),e="";if(c)for(var d=0;d<c.order.length;++d){var h=c.desc[c.order[d]];0>f.inArray(h.id,a.statuses)&&(""===e&&(e+=b.renderTemplate('<option value="">{sw.column.progress.opt.statushist.add}</option>')),e+=b.renderTemplate('<option value="{id}">{name}</option>',h))}if(""!==e){var k=this,c=f("<select>"+e+"</select>").appendTo(this.adder$).on("change",function(){var b=l(f(this).val());if(""!==b&&0>f.inArray(b,a.statuses)){a.statuses.push(b);a.percents.push(0);k.redrawTable();k.gK();b=k.adder$.parents(".st-col-edit:first");var c=k.adder$,e=c.offsetParent(),c=c.position();if(0!==b.length&&0!==e.length){for(var d=b.offsetParent();b[0]!==e[0]&&(0===d.length||d[0]!==e[0]);){var h=e.position();c.top+=h.top;c.left+=h.left;e=e.offsetParent()}b[0]!==e[0]&&(e=b.position(),c.top-=e.top,c.left-=e.left)}e=c.top+k.adder$.height()-b.height();0<e&&b.scrollTop(b.scrollTop()+e+10);k.div$.trigger("notify")}});u.createAjsSingleSelect(c)}},createInput:function(a){this.div$=a;this.table$=f('<div class="st-col-progress-statushist"></div>').appendTo(a);this.adder$=f(
'<div class="st-col-progress-statushist-adder"></div>').appendTo(a)},makesSense:function(){return t.statuses(this.spec.params,this.context)},notify:function(){return this.makesSense()?(this.tableSignature||(this.hi(),this.gK()),this.tableSignature!==this.calcSignature()&&this.redrawTable(),!0): !1}}),U=b.subClass("ProgressDisplayPercentsOptions",p,{title:b.text(""),init:function(){this.input$=null},createInput:function(a){this.input$=a.append(b.renderTemplate('<div class="checkbox"><label><input type="checkbox">&nbsp;{sw.column.progress.opt.displaypercents}</label></div>')).find("input");var c=this;this.input$.on("change",function(){var b=f(this).is(":checked");b!== ! !c.spec.params.displayPercents&&(c.spec.params.displayPercents=b,a.trigger("notify"))})},notify:function(){this.input$.prop("checked",this.spec.params.displayPercents);return!0}});return{key:"progress",columnType:new(b.subClass("ProgressColumnType",n,{getPresetMetadataRequests:k,getConfigMetadataRequests:k,getMetadataRequests:k,findCustomField:function(a,b){for(var c=a.jira.getAllIssueFields(),d=0,f;f=c[d++];)if(e.isNumericCustomField(f)&&b.test(f.name))return f;return null},createSwitchTypePreset:function(a){a=
a.jira.getAllIssueFields();for(var b=null,c=null,d=null,f=null,h,k=0;h=a[k++];)e.isNumericCustomField(h)&&(/\bpoints?/i.test(h.name)?b=h.id:/\bcomplet/i.test(h.name)?f=h.id:null===c?c=h.id:null===d&&(d=h.id));return{key:"progress",params:{basedOn:"timetracking",resolvedComplete: !0,includeSelf: !0,weightBy:"equal",percentField:f||c,weightByField:b||d||c}}},createAddColumnPresets:function(a){var c=this.createSwitchTypePreset(a),e=[];e.push(f.extend(!0,{},c,{presetName:b.text("sw.column.progress.preset.timetracking"),params:{basedOn:"timetracking",resolvedComplete: !0,includeSelf: !0}}));var d=this.findCustomField(a,/story point/i);a=r(a);var h=2<=a.statuses.length;d&&e.push(f.extend(!0,{},c,{presetName:b.text("sw.column.progress.preset.storypoints",d.name),params:{basedOn:"resolution",resolvedComplete: !0,weightBy:"field",weightByField:d.id}}));h&&e.push(f.extend(!0,{},c,{presetName:b.text("sw.column.progress.preset.status"),params:{basedOn:"status",includeSelf: !1,resolvedComplete: !0,weightBy:"equal",statuses:a.statuses,percents:a.percents}}));h&&d&&e.push(f.extend(!0,{},c,{presetName:b.text("sw.column.progress.preset.statuspoints",d.name),params:{basedOn:"status",
resolvedComplete: !0,includeSelf: !1,weightBy:"field",weightByField:d.id,statuses:a.statuses,percents:a.percents}}));e.push(f.extend(!0,{},c,{presetName:b.text("sw.column.progress.preset.custom"),shouldOpenConfigurator: !0,params:{basedOn:""}}));return e},_isSpecValid:function(a,b){return b&&"progress"===b.key},createConfigurator:function(a,b){return this._isSpecValid(a,b)?new z({context:a,spec:b}):null},createColumn:function(a,b){return this._isSpecValid(a,b)?new w({context:a,spec:b}):null}}))}});define("structure/widget/columns/WorkloggedColumn","almworks/jquery almworks/util/Util almworks/util/Log almworks/util/Template structure/api/SpecOption structure/api/Column structure/api/ColumnType structure/api/ColumnConfigurator".split(" "),function(f,b,g,d,e,a,n,c){function p(a){a=a.params;var c=b.text("sw.column.worklogged.period.+"+a.period+"+.colname");return a.aggregate?b.text("sw.column.opt.aggr.sum.colname",c):c}var m=namespace("almworks.structure"),k=namespace("almworks.structure.ajsbridge"),r=namespace("AJS",!1),l={resolve:function(){"undefined"===typeof this.resolved&&(this.single=namespace("JIRA.Templates.Fields.Pickers.User.single",!1),this.formatResponse=namespace(
"JIRA.UserPickerUtil.formatResponse",!1),this.resolved=f.isFunction(this.single)&&f.isFunction(this.formatResponse));return this.resolved}},h="today this_week this_month this_year yesterday last_week last_month last_year".split(" "),u=b.subClass("PeriodOption",e,{title:b.text("sw.column.worklogged.opt.period"),init:function(){this.select$=null},createInput:function(a){for(var c=this.spec.params,e="",d=0;d<h.length;d++)var l=h[d],e=e+b.renderTemplate('<option value="{id}">'+b.text("sw.column.worklogged.period.+"+l+"+.name")+"</option>",{id:l});this.select$=a.append('<select class="select">'+e+'</select><div class="description">'+b.text("sw.column.worklogged.timezone.desc",c.timeZone)+"</div>").find("select");this.select$.val(c.period);this.select$.on("change",function(){var e=f(this).val();b.isArray(e)&&(e=e[0]);c.period=e;a.trigger("notify")});k.createAjsSingleSelect(this.select$)},notify:function(){this.select$.val(this.spec.params.period);return!0},isInputValid:function(){return! !this.spec.params.period}}),s=b.subClass("InputAuthorOption",e,{title:b.text("sw.column.worklogged.opt.author"),init:function(){this.input$=null},createInput:function(a){this.input$=a.append(
'<input type="text" class="text">').find("input");this.input$.val(this.spec.params.author||"");this.input$.on("keyup",b.withThis(this,this._setValue))},_setValue:b.delayed(250,function(){var a=f.trim(this.input$.val());a?this.spec.params.author=a:delete this.spec.params.author;this.input$.trigger("notify")}),notify:function(){this.input$.val(this.spec.params.author||"");return!0}}),q=b.subClass("SelectAuthorOption",e,{title:b.text("sw.column.worklogged.opt.author"),init:function(){this.select$=null},createInput:function(a){var c=this.spec.params,e=new b.Cell(c.author||"");e.pipeChanges(function(b){b?c.author=b:delete c.author;a.trigger("notify")});var d=[{optionName:"",displayName:"",avatarURL:""}];c.author?d.push(this.context.getMetadata("author")||{optionName:c.author,displayName:c.author,selected: !0}):d[0].selected= !0;this.select$=a.append(l.single({field:{id:"",name:""},options:d})).find("select");var h=k.createAjsSingleSelect(this.select$,{element:this.select$,submitInputVal: !0,showDropdownButton: !0,errorMessage:r.I18n.getText("user.picker.invalid.user","'{0}'"),ajaxOptions:{url:k.localURL("/rest/api/1.0/users/picker"),query: !0,data:{showAvatar: !0},formatResponse:
l.formatResponse},inputText:""});(new k.SingleSelectPresenter(e)).setEmptyValue("").setView(h,!1);h.$field.on("keyup",b.delayed(250,function(){f(this).val()||e.setValue("")}));var g=h.submitForm;h.submitForm=function(){!h.$field.val()&&e.value()?e.setValue(""):g.call(h)}},notify:function(){this.select$.val(this.spec.params.author||"");return!0}}),x=b.subClass("WorkloggedColumn",a,{collectRequiredAttributes:function(a){var b=this.spec.params;if(b.timeZone){var c={timeZone:b.timeZone,period:b.period};b.author&&(c.author=b.author);var e={id:"worklogged",format:"html",params:c};b.aggregate||"sum"===b.aggregate?(this.attributeSpec={id:"sum",format:"html",params:{distinct: ! !b.distinct,attribute:{id:"worklogged",format:"duration",params:c}}},this.ownAttributeSpec=e,a.requireAttribute(this.ownAttributeSpec,b.forestSpec)):this.attributeSpec=e;a.requireAttribute(this.attributeSpec,b.forestSpec)}},getCellViewHtml:function(a){var c=this.spec.params.forestSpec,e=a.getAttributeValue(this.attributeSpec,c)||"";(a=this.ownAttributeSpec&&a.getAttributeValue(this.ownAttributeSpec,c))&&e&&f.trim(a)===f.trim(e)&&(a=null);c='<div class="celldiv"><div class="grad"></div>';c=a?c+b.renderTemplate(
'<span class="value" title="{sw.column.opt.aggr.own-hint}">'):c+'<span class="value">';e&&(c+=e);a&&(c+='<span class="s-aggr-own">'+a+"</span>");return c+"</span></div>"},getDefaultName:function(){return p(this.spec)},getMetadataRequests:function(){var a=this.spec.params.timeZone;return a?{offset:{cacheable: !0,url:k.localURL(m.ajax.RESOURCES.CONFIG_TIMEZONE+"?name="+a),extract:function(a){return a.offset}}}:null},isAutoSizeAllowed:b.returnTrue,canShrinkWhenNoSpace:b.returnTrue,getSortAttribute:function(){return b.extend({},b.deepClone(this.attributeSpec),{format:"duration"})},getSuggestedAttributeSpecs:function(){return[this.getSortAttribute()]},isSortDescendingByDefault:b.returnTrue}),t=b.subClass("WorkloggedConfigurator",c,{init:function(){this.spec.key="worklogged";this.spec.params||(this.spec.params={});this.spec.params.field="worklogged"},getColumnTypeName:b.returnConst(b.text("sw.column.worklogged.name")),getDefaultColumnName:function(){return p(this.spec)},getGroupKey:function(){return this.spec.params.aggregate?"totals":"advanced"},getOptions:function(){var a={configurator:this},b=this.context.getMetadata("userPickerPermission")&&l.resolve()?new q(a):new s(a);return[new u(
a),b,new e.Aggregate(a)]},getMetadataRequests:function(){return this.spec.params.author&&this.context.getMetadata("userPickerPermission")&&l.resolve()?{author:{cacheable: !0,url:k.localURL("/rest/api/2/user?key="+this.spec.params.author),extract:function(a){return{optionName:a.key,displayName:a.displayName,avatarURL:a.avatarUrls["16x16"],emailAddress:a.emailAddress,selected: !0}}}}:null}});return{key:"worklogged",columnType:new(b.subClass("WorkloggedColumnType",n,{createConfigurator:function(a,b){return "worklogged"===b.key?new t({context:a,spec:b}):null},createColumn:function(a,b){return "worklogged"===b.key?new x({context:a,spec:b}):null},createAddColumnPresets:function(a){a=a.getMetadata("timeZone");if(!a)return[];var c=[],e=h[0];c.push({key:"worklogged",shouldOpenConfigurator: !0,presetName:b.text("sw.column.worklogged.preset.default"),params:{period:e,timeZone:a.name}});c.push({key:"worklogged",shouldOpenConfigurator: !0,presetName:b.text("sw.column.worklogged.preset.sum"),params:{aggregate:"sum",period:e,timeZone:a.name}});return c},createSwitchTypePreset:function(a){return(a=a.getMetadata("timeZone"))?{key:"worklogged",presetName:b.text("sw.column.worklogged.preset.sum"),
params:{aggregate:"sum",period:h[0],timeZone:a.name}}:null},getPresetMetadataRequests:function(){return{timeZone:{cacheable: !0,url:k.localURL(m.ajax.RESOURCES.CONFIG_TIMEZONE)}}},getConfigMetadataRequests:function(){return{userPickerPermission:{cacheable: !0,url:k.localURL(m.ajax.RESOURCES.USER_PICKER_PERMISSION)}}}}))}});define("structure/widget/columns/SequenceColumn",["almworks/util/Util","structure/api/Column","structure/api/ColumnType","structure/api/ColumnConfigurator"],function(f,b,g,d){var e={id:"seq",format:"text"};f.deepFreeze(e);var a=f.subClass("SequenceColumn",b,{getDefaultName:f.returnConst(f.text("sw.column.seq.title")),collectRequiredAttributes:function(a){a.requireAttribute(e,"unfiltered")},getCellValueHtml:function(a){return(a=a.getAttributeValue(e,"unfiltered"))?f.htmlEscape(a):""},isAutoSizeAllowed:f.returnTrue,getSuggestedAttributeSpecs:function(){return[f.deepClone(e)]}}),n=f.subClass("SequenceConfigurator",d,{getGroupKey:f.returnConst("structure"),getColumnTypeName:f.returnConst(f.text("sw.column.seq"))});return{key:"seq",columnType:new(f.subClass("SequenceType",g,{createSwitchTypePreset:function(a){return{key:"seq",presetName:f.text("sw.column.seq")}},
createAddColumnPresets:function(a){return[{key:"seq",presetName:f.text("sw.column.seq")}]},createConfigurator:function(a,b){return new n({context:a,spec:b})},createColumn:function(b,e){return "seq"===e.key?new a({context:b,spec:e}):null}}))}});define("structure/widget/columns/formula/FormulaViewBuilder",["underscore","almworks/util/Util","almworks/util/Template"],function(f,b,g){function d(a,e,c,d){var g=function(b){return b&&"number"===typeof b.from&&"number"===typeof b.to&&0<=b.from&&b.from<a&&0<b.to&&b.to<=a&&b.from<b.to};e=f.chain(e).map(function(a){return f.map(a.usage||[],function(e){return b.extend({},e,{name:a.name,type:f.contains(c,a.name)?"definedVariable":"undefinedVariable"})})}).flatten().filter(g).value();d=f.chain(d).map(function(a){return f.map(a.usage||[],function(c){return b.extend({},c,{name:a.name,type:a.resolved?"resolvedFunction":"unresolvedFunction"})})}).flatten().filter(g).value();return f.sortBy(e.concat(d),"from")}var e={undefinedVariable:new g('<a href="#" data-formula-action="EditVar" class="s-formula-var s-formula-var-undefined" data-s-formula-name="{canonicalName}">{name}</a>'),definedVariable:new g(
'<a href="#" data-formula-action="EditVar" class="s-formula-var s-formula-var-defined" data-s-formula-name="{canonicalName}">{name}</a>'),resolvedFunction:new g('<span class="s-formula-fun s-formula-fun-resolved" data-s-formula-name="{canonicalName}">{name}</span>'),unresolvedFunction:new g('<span class="s-formula-fun s-formula-fun-unresolved" data-s-formula-name="{canonicalName}">{name}</span>'),errorSpan:new g('<span class="s-formula-error" title="{s.w.formula.parse-error,expectedTokens}">{unparsedExpr}</span>'),errorAtTheEnd:new g('<span class="s-formula-error" title="{s.w.formula.parse-error,expectedTokens}">&nbsp;</span>')};return{buildHtml:function(a,f,c){var p=a&&a.expr;if(!p)return "";c||(c=e);var m=p.length,k=a.errorIndex,r="number"===typeof k,l=m;r&&(k>m&&(k=m),l=k);var h=d(l,a.variables||[],f,a.functions||[]),u=h.length,s=0;f="";for(var q=0;q<=u;q++){var x=q<u?h[q]:null;if(x&&x.from<s)b.warn("bad validation result for ["+p+"]");else if(f+=b.htmlEscape(p.substring(s,x?x.from:l)),x&&(k=c[x.type]))f+=k.renderHtml({canonicalName:x.name,name:p.substring(x.from,x.to)}),s=x.to}r&&((k=c[l<m?"errorSpan":"errorAtTheEnd"])||(k=new g("{unparsedExpr}")),c=a.expectedTokens||[],a=
c.filter(function(a){return a&&1===a.length}).join(" "),c=c.filter(function(a){return a&&1<a.length}),0<a.length&&c.push(b.text("s.w.formula.symbol-tokens",a)),a=c.join(", "),f+=k.renderHtml({unparsedExpr:p.substring(l,m),expectedTokens:a}));return f},getVariableList:function(a,e){var c=a&&a.expr;if(!c)return[];var g=a.errorIndex,g="number"===typeof g?Math.min(g,c.length):c.length,g=d(g,a.variables||[],[],[]),m={},k=[];f.each(g,function(a){if(!m[a.name]){m[a.name]= !0;var d={canonicalName:a.name,displayName:c.substring(a.from,a.to)};e&&(a=e(a.name))&&b.extend(d,a);k.push(d)}});return k}}});define("structure/widget/columns/formula/FormulaColumn","almworks/jquery almworks/util/Util almworks/util/JSON almworks/util/Keyboard underscore almworks/util/Template structure/widget/attributes/Attributes structure/widget/jira/Fields structure/api/Column structure/api/ColumnType structure/api/ColumnConfigurator structure/api/SpecOption structure/widget/columns/formula/FormulaViewBuilder structure/widget/ui/attribute/AttributeEditor structure/widget/columns/formula/DefaultVariables structure/widget/ui/column/NumberFormatOption structure/widget/columns/formula/FormulaColumnPresets".split(" "),
function(f,b,g,d,e,a,n,c,p,m,k,r,l,h,u,s,q){function x(a){var c={id:"expr",format:"json",params:{formula:a.normalizedFormula||a.formula||"",variables:{}}};e.each(a.variables,function(a,d){d&&e.isString(d)&&z.test(d)&&t(a)&&(c.params.variables[d]=b.deepClone(a))});"sum"===a.aggregate&&(c.format="number",c={id:"sum",format:"number",params:{attribute:c}},a.distinct&&(c.params.distinct= !0));return c}function t(a){return a&&e.isString(a.id)}function w(a){a=a&&a.params&&a.params.formula||"";a=a.trim();if(!a)return b.text("s.w.formula.column-type.name");15<a.length&&(a=a.substring(0,15));return a}namespace("almworks.structure.apputil");var v=namespace("almworks.structure.ajsbridge"),C=namespace("almworks.structure.ajax"),z=/[a-zA-Z_][a-zA-Z_0-9.]*/,F=a.load("structure.widget.column.formula.formula"),A=a.load("structure.widget.column.formula.var-row"),D=a.load("structure.widget.column.formula.cell.error"),G=a.load("structure.widget.column.formula.cell.undefined"),B=a.load("structure.widget.column.formula.cell.numeric"),K=a.load("structure.widget.column.formula.cell.text"),J=a.load("structure.widget.column.formula.cell.formatted"),O=d.codeMapFromKeyMap({enter:"EnterPressed","shift+enter":
"Save"}),V=b.subClass("FormulaColumn",p,{init:function(){var a=this.spec.params;this.attributeSpec=x(a);this.forestSpec=a&&a.forestSpec;a=(a=a&&a.numberFormat)&&a.type?{id:"formatted-number",format:"text",params:b.extend({attribute:b.extend(b.deepClone(this.attributeSpec),{format:"number"})},a)}:null;this.formattedSpec=a;b.deepFreeze(this.attributeSpec);b.deepFreeze(this.formattedSpec)},collectRequiredAttributes:function(a){a.requireAttribute(this.attributeSpec,this.forestSpec);this.formattedSpec&&a.requireAttribute(this.formattedSpec,this.forestSpec)},getSortAttribute:function(){var a=b.deepClone(this.attributeSpec);"json"===a.format&&(a.format="order");return a},getDefaultName:function(){return w(this.spec)},getCellValueHtml:function(a){if(this.formattedSpec){var c=a.getAttributeValue(this.formattedSpec,this.forestSpec);if(c)return J.renderHtml({value:c})}a=a.getAttributeValue(this.attributeSpec,this.forestSpec);if(e.isNumber(a))return b.htmlEscape(a);if(!a)return "";if(a.error)return D.renderHtml(this.getErrorInfo(a.error));if(a.undefined)return G.renderHtml();a=a.value;return "number"===typeof a?B.renderHtml({value:a}):"string"===typeof a?K.renderHtml({value:a}):""},
getErrorInfo:function(a){function c(a,e){var d=b.text(a);d===a&&(d=b.text(e));b.assert(d!==e);return d}var e=c("s.w.formula.cell.error.+"+a+"+.label","s.w.formula.cell.error.label"),d=c("s.w.formula.cell.error.+"+a+"+.tooltip","s.w.formula.cell.error.tooltip");return{errorCode:a,label:e,tooltip:d}},getSuggestedAttributeSpecs:function(){var a=[b.deepClone(this.attributeSpec)];if("sum"!==a[0].id){var c=this.spec.params&&this.spec.params.numberFormat&&this.spec.params.numberFormat.type;a[0].format="duration"===c?n.Formats.DURATION:c?n.Formats.NUMBER:n.Formats.TEXT}return a},isSortDescendingByDefault:function(){return!0}}),U=b.subClass("FormulaAndVariablesOption",r,{title:b.text("s.w.formula.formula.title"),init:function(a){this.params=a.configurator.spec.params;this.param="formula";this.changed= !1;a.configurator.spec.resolveAndUpdateImmediately&&(this.changed= !0,delete a.configurator.spec.resolveAndUpdateImmediately);a=this.getValue()||"";var c=this;this.cells={committedValue:new b.Cell(a),editedValue:new b.Cell(a),validationResult:new b.Cell(null),editMode:new b.Cell(!1),committedVariables:new b.Cell(this.getVariablesValue()),editedVariable:new b.Cell(null),variableSpec:new b.Cell(
"")};this.cells.uiValues=new b.Cell(this.cells.committedValue,this.cells.validationResult,this.cells.committedVariables,function(a,b,c){return{expr:a||"",validation:a&&b&&b.expr===a?b:null,vars:e.keys(c)}});this.cells.displayedVariables=new b.Cell(this.cells.uiValues,this.cells.committedVariables,function(a,b){return l.getVariableList(a.validation,function(a){return(a=b[a])?{attributeSpec:a}:null})});this.cells.exprStatus=new b.Cell(this.cells.uiValues,this.cells.displayedVariables,this.cells.editMode,function(a,b,c){if(c)return "editing";if(a.expr.trim())if(a.validation){if(!a.validation.valid)return "parseError";if(!a.validation.resolved)return "resolveError"}else return "validating";else return "empty";return b.some(function(a){return!a.attributeSpec})?"varsError":"ok"});this.cells.variablesEditable=new b.Cell(this.cells.exprStatus,function(a){return "editing"!==a&&"parseError"!==a&&"validating"!==a});this.cells.variableEditMode=new b.Cell(this.cells.editedVariable,this.cells.editMode,function(a,b){return!b&& ! !a});this.cells.committedValue.pipeChanges(b.withThis(this.cells.editedValue,this.cells.editedValue.setValue));this.cells.editMode.pipeChanges(function(a){a&&
c.cells.editedVariable.setValue(null)});this.cells.committedValue.pipeChanges(function(){c.changed= !0});this.variableEditingLifecycle=new b.Lifecycle(!1);this.setupValidation(this.cells.committedValue,this.cells.validationResult);this._$={}},getVariablesValue:function(){return b.deepClone(this.spec.params&&this.spec.params.variables||{})},setupValidation:function(a,b){var c=this;a.pipe(function(e){e=e||"";e.trim()?C.doAjax({url:v.localURL(C.RESOURCES2g.EXPR.VALIDATE),type:"POST",dataType:"json",contentType:"application/json; charset=UTF-8",data:g.stringify({expr:e}),timeout:3E4,success:function(d){e===a.value()&&(b.setValue(d),c.changed&&c.assignVariablesAutomatically())},error:function(c){e===a.value()&&b.setValue(null)}}):b.setValue(null)})},assignVariablesAutomatically:function(){var a=this,c=this.cells.displayedVariables.value();if(!c.every(function(a){return t(a.attributeSpec)})){var e=b.deepClone(this.cells.committedVariables.value());c.forEach(function(b){if(!t(b.attributeSpec)){var c=u.getDefaultSpec(a.context,b.canonicalName);c&&(e[b.canonicalName]=c)}});this.cells.committedVariables.setValue(e)}},createInput:function(a){F.render$().saveBindings(this._$).appendTo(a);(
new b.TextPresenter(this.cells.editedValue)).setView(this._$.formulaText,!1);this.attachFormulaRenderer(this.cells.uiValues,this._$.formulaView);new b.ElementClassToggler(this.cells.editMode,"s-formula-edit-off",this._$.formulaPanel,!0);new b.ElementClassToggler(this.cells.editMode,"s-formula-edit-on",this._$.formulaPanel);new b.ElementClassToggler(this.cells.variableEditMode,"s-formula-var-edit-off",this._$.formulaPanel,!0);new b.ElementClassToggler(this.cells.variableEditMode,"s-formula-var-edit-on",this._$.formulaPanel);this.attachVariablesRenderer(this.cells.displayedVariables,this._$.varList);(new b.TextPresenter(this.cells.variableSpec)).setView(this._$.varSpec,!1);this.variableEditor=new h(this._$.varSpec,{additionalContentClasses:"s-when-formula-var-edit-on s-formula-var-ae",usePrimaryFormat: !0,context:this.context});this._$.formulaPanel.on("click","[data-formula-action]",b.withThis(this,this.applyAction));var c=this;this.cells.uiValues.pipeChanges(function(a){c.params.formula=a.expr||"";c.changed&&((a=a.validation&&a.validation.normalizedExpr)?c.params.normalizedFormula=a:delete c.params.normalizedFormula);c._$.formulaPanel.trigger("notify")});
this.cells.committedVariables.pipeChanges(function(a){c.params.variables=a||{};c._$.formulaPanel.trigger("notify")});this.setupFormulaView();this.setupEditing(this._$.formulaText);this.setupExprStatus(this.cells.exprStatus,this._$.exprStatus)},setupExprStatus:function(b,c){var e={empty:"",validating:a.load("structure.widget.column.formula.status.validating").renderHtml(),parseError:a.load("structure.widget.column.formula.status.parseError").renderHtml(),resolveError:a.load("structure.widget.column.formula.status.resolveError").renderHtml(),varsError:a.load("structure.widget.column.formula.status.varsError").renderHtml(),ok:a.load("structure.widget.column.formula.status.ok").renderHtml(),editing:a.load("structure.widget.column.formula.status.editing").renderHtml()};b.pipe(function(a){c.html(e[a]||"")})},setupEditing:function(a){var c=this;a.on("keydown",function(a){var e=d.keyboardCodeFromEvent(a);if(27===e&&c.cells.editMode.value())return a.stopPropagation(),a.preventDefault(),!1;(e=O[e])&&(e=c["on"+e])&&b.safeCall(e,c,a)&&(a.stopPropagation(),a.preventDefault())});a.on("keypress keyup",function(a){var b=d.keyboardCodeFromEvent(a);13===b&&a.stopImmediatePropagation();if(27===b&&
c.cells.editMode.value())return a.stopPropagation(),a.preventDefault(),!1});(function(){function b(a){e();d=window.setTimeout(function(){d=null;c.onSave(a)},50)}function e(){"SAVE_ON_BLUR"!==d&&window.clearTimeout(d);d=null}var d;a.on({blur:function(a){b(a)},focus:e});c._$.all$.find("[data-s-keep-edit-mode]").on({focus:function(){d&&(e(),d="SAVE_ON_BLUR")},blur:function(a){d&&b(a)}})})()},setupFormulaView:function(){function a(b,c,e){if(!h){h= !0;try{var d=b.scrollLeft(),f=b.scrollTop();c.scrollLeft(d);c.scrollTop(f);if(e){var l= ++k;window.setTimeout(function(){if(!h&&l===k){h= !0;try{c.scrollLeft(d),c.scrollTop(f)}finally{h= !1}}},0)}}finally{h= !1}}}var c=this,e=c._$.formulaText,d=c._$.formulaView,h= !1,k=0;e.on("focus",function(){c.cells.editMode.setValue(!0)});d.on("click",function(a){if(!f(a.target).data("formula-action")){var b= -1,h;try{if(h=window.getSelection().getRangeAt(0)){if(h.toString().length)return;h.setStart(d[0],0);b=h.toString().length}}catch(k){}c.cells.editMode.setValue(!0);e.focus();try{-1!==b&&e[0].setSelectionRange(b,b)}catch(l){}a.stopPropagation();a.preventDefault()}});d.on("scroll",b.curry(a,d,e));e.on("scroll",function(){c.cells.editMode.value()&&a(e,d)
});c.cells.editMode.pipe(function(b){b?(a(d,e,!0),d.hide()):(d.show(),a(e,d))})},attachFormulaRenderer:function(a,b){a.pipe(function(a){a.validation?b.html(l.buildHtml(a.validation,a.vars)):b.text(a&&a.expr||"")})},attachVariablesRenderer:function(a,c){var d=this;new b.ElementToggler(this.cells.variablesEditable,this._$.varListCover,!0);(new b.Cell(this.cells.exprStatus,this.cells.displayedVariables,function(a,c){return "editing"===a||"validating"===a?b.text("s.w.formula.vars.edit-on"):"parseError"===a?b.text("s.w.formula.vars.parse-error"):c.length?1===c.length?b.text("s.w.formula.vars.list.1"):b.text("s.w.formula.vars.list.n",c.length):b.text("s.w.formula.vars.none")})).pipe(function(a){d._$.varsComment.text(a)});a.pipe(function(a){a&&a.length?(a=e.map(a,function(a){return A.renderHtml({iconClasses:a.attributeSpec?"s-fa-check s-defined":"s-fa-exclamation-circle s-undefined",name:a.displayName,canonicalName:a.canonicalName})}).join(""),c.html(a)):c.empty();d._$.formulaView.trigger("notify")});this.cells.editedVariable.pipe(function(a){d._$.formulaPanel.find(".s-var-edited").removeClass("s-var-edited");a&&d._$.formulaPanel.find('[data-s-formula-name="'+a+'"]').addClass(
"s-var-edited")})},applyAction:function(a){var c=a&&f(a.target);if(!c)return!1;c=this["on"+c.data("formula-action")];if(!c)return!1;if(c=b.safeCall(c,this,a))a.stopPropagation(),a.preventDefault();return c},notify:function(a){var b=this.getValue();this.cells.committedValue.setValue(b);this.cells.editMode.value()&&this.cells.editedValue.setValue(b);"close"===a&&this.finalizeAndCleanupSpec();return!0},finalizeAndCleanupSpec:function(){if(this.cells.uiValues.value().validation&&this.changed){var a=this.cells.displayedVariables.value(),b=this.cells.committedVariables.value(),c={};a.forEach(function(a){var e=b[a.canonicalName];e&&(c[a.canonicalName]=e)});this.params.variables=c;this.cells.committedVariables.setValue(c)}},onEdit:function(a){this.cells.editMode.setValue(!0);this._$.formulaText.focus();return!0},onCancel:function(a){this.cells.editMode.value()&&(this.cells.editMode.setValue(!1),this.cells.editedValue.setValue(this.cells.committedValue.value()));return!0},onSave:function(a){this.cells.editMode.value()&&(this.cells.committedValue.setValue(this.cells.editedValue.value()),this.cells.editMode.setValue(!1));return!0},onEnterPressed:function(a){this.cells.editMode.value()||(
this.onEdit(),a.preventDefault());a.stopImmediatePropagation();return!1},onEditVar:function(a){var c=f(a.target).data("s-formula-name");if(!c)return!1;if(this.cells.editedVariable.value()!==c){this.cells.editedVariable.setValue(c);this._$.varName.text(f(a.target).text());this.variableEditingLifecycle.cycleStart();var e=this.cells.committedVariables,d=b.deepClone(e.value()[c]||u.getDefaultSpec(this.context,c)||{});this.variableEditor.edit(d);this.cells.variableSpec.pipeChanges(this.variableEditingLifecycle,function(a){if(a=g.safeParse(a,null)){var d=b.deepClone(e.value());d[c]=a;e.setValue(d)}})}a.stopPropagation();return!0},onVarList:function(a){this.cells.editedVariable.setValue(null);this.variableEditingLifecycle.cycleEnd();return!0}}),P=b.subClass("FormulaColumnConfigurator",k,{init:function(){this.spec.key="formula"},getColumnTypeName:b.returnConst(b.text("s.w.formula.column-type.name")),getDefaultColumnName:function(){return w(this.spec)},getOptions:function(){return[new U({configurator:this,context:this.context}),new r.Aggregate({configurator:this,isApplicable:b.returnTrue,title:b.text("s.w.formula.options")}),new s({configurator:this})]},isConfigurationPanelWide:
b.returnTrue});return{key:"formula",columnType:new(b.subClass("FormulaColumnType",m,{createSwitchTypePreset:function(a){return{key:"formula",params:{formula:""}}},createAddColumnPresets:function(a){var c=this.createSwitchTypePreset(a),e=[];e.push(f.extend(!0,{},c,{presetName:b.text("s.w.formula.preset"),shouldOpenConfigurator: !0,groupKey:"advanced"}));q.populate(e,a);return e},_isSpecValid:function(a,b){return b&&"formula"===b.key},createConfigurator:function(a,b){return this._isSpecValid(a,b)?new P({context:a,spec:b}):null},createColumn:function(a,b){return this._isSpecValid(a,b)?new V({context:a,spec:b}):null}}))}});define("structure/widget/columns/formula/FormulaColumnPresets",["almworks/util/Util","structure/widget/columns/formula/DefaultVariables"],function(f,b){function g(a){a=f.deepClone(a);a.groupKey="featured";return a}function d(a,b){var c={key:"formula",params:{formula:"IF(bugs+nonbugs > 0; bugs/(bugs+nonbugs))",variables:{bugs:{id:"sum",params:{attribute:{id:"expr",format:"number",params:{variables:{type:{id:"issuetype",format:"text"}}}},distinct: !0},format:"number"},nonbugs:{id:"sum",params:{attribute:{id:"expr",format:"number",params:{variables:{type:{id:
"issuetype",format:"text"},itemtype:{id:"itemtype",format:"text"}}}},distinct: !0},format:"number"}},numberFormat:{type:"percentage",rounding:0},normalizedFormula:"if(gt(sum(bugs,nonbugs),0),div(bugs,sum(bugs,nonbugs)))"}},e={timespent:{id:"timespent",format:"duration"},estimate:{id:"timeestimate",format:"duration"}},d=f.deepClone(c);d.name=f.text("s.w.formula.preset.bugfixPercent.time");d.description=f.text("s.w.formula.preset.bugfixPercent.time.description");d.groupKey="formulas";d.params.variables.bugs.params.attribute.params.formula="CASE(type;'bug';timespent+estimate)";f.deepExtend(d.params.variables.bugs.params.attribute.params.variables,e);d.params.variables.nonbugs.params.attribute.params.formula="IF(type != 'bug' AND itemtype = 'issue',timespent+estimate)";f.deepExtend(d.params.variables.nonbugs.params.attribute.params.variables,e);c=f.deepClone(c);c.name=f.text("s.w.formula.preset.bugfixPercent.count");c.description=f.text("s.w.formula.preset.bugfixPercent.count.description");c.groupKey="formulas";c.params.variables.bugs.params.attribute.params.formula="CASE(type;'bug';1)";c.params.variables.nonbugs.params.attribute.params.formula=
"IF(type != 'bug' AND itemtype = 'issue';1)";a.push(d,c,g(d))}function e(a,c){var e={name:f.text("s.w.formula.preset.wsjf"),description:f.text("s.w.formula.preset.wsjf.description"),groupKey:"formulas",key:"formula",params:{formula:"IF(!Resolution AND itemtype = 'issue';\n100 * CASE(Priority;\n     'Highest';160;\n     'High';80;\n     'Medium';40;\n     'Low';20;\n     'Lowest';10;\n     40)\n* (1 + Votes + Watches / 10)\n* IF(DueDate;1.5;1)\n/\n(1 \n+ IF(StoryPoints;10 + StoryPoints / 4)\n+ IF(RemainingEstimate;10 + CALENDAR_HOURS(RemainingEstimate) / 4)\n+ IF(!StoryPoints AND !RemainingEstimate;20)\n)\n)",variables:{priority:{id:"priority",format:"text"},votes:{id:"votes",format:"number"},duedate:{id:"duedate",format:"time"},remainingestimate:{id:"timeestimate",format:"duration"},resolution:{id:"resolution",format:"text"},itemtype:{id:"itemtype",format:"text"},watches:{id:"watches",format:"number"}},numberFormat:{type:"number",rounding:0},normalizedFormula:
'if(and(not(resolution),eq(itemtype,"issue")),div(mul(100,case(priority,"Highest",160,"High",80,"Medium",40,"Low",20,"Lowest",10,40),sum(1,votes,div(watches,10)),if(duedate,1.5,1)),sum(1,if(storypoints,sum(10,div(storypoints,4))),if(remainingestimate,sum(10,div(calendar_hours(remainingestimate),4))),if(and(not(storypoints),not(remainingestimate)),20))))'}},d=b.getDefaultSpec(c,"storypoints");d?e.params.variables.storypoints=d:(e.presetName=e.name+"...",e.shouldOpenConfigurator= !0);a.push(e);a.push(g(e))}function a(a,c){var e={name:f.text("s.w.formula.preset.wsjf.alm"),presetName:f.text("s.w.formula.preset.wsjf.alm")+"...",description:f.text("s.w.formula.preset.wsjf.alm.description"),groupKey:"formulas",shouldOpenConfigurator: !0,key:"formula",params:{formula:
'IF(itemtype=\'issue\',\n 100 * (\n   1 + CASE(Benefit, "Low", 1, "Medium", 2, "High", 5, 0)\n     + CASE(Pain, "Low", 1, "Medium", 3, "High", 6, 0)\n     + CASE(Marketability, "Medium", 1, "High", 4, 0)\n  ) \n  * CASE(Impact, "Low", 0.8, "Medium", 1.2, "High", 2, 1) \n  / \n  (1 + CASE(Cost, "Low", 1, "Medium", 1.5, "High", 3, 2)\n     * CASE(Risk, "Low", 1, "Medium", 1.5, "High", 3, 2)\n     * CASE(Clarity, "Medium", 1, "High", 0.9, 1.5)\n  )\n)',variables:{itemtype:{id:"itemtype",format:"text"}},numberFormat:{type:"number",rounding:0},normalizedFormula:'if(eq(itemtype,"issue"),div(mul(100,sum(1,case(benefit,"Low",1,"Medium",2,"High",5,0),case(pain,"Low",1,"Medium",3,"High",6,0),case(marketability,"Medium",1,"High",4,0)),case(impact,"Low",0.8,"Medium",1.2,"High",2,1)),sum(1,mul(case(cost,"Low",1,"Medium",1.5,"High",3,2),case(risk,"Low",1,"Medium",1.5,"High",3,2),case(clarity,"Medium",1,"High",0.9,1.5)))))'}},d=b.getDefaultSpec(c,"storypoints");d&&(e.params.variables.storypoints=d);a.push(e)}function n(a,c){var e=b.getDefaultSpec(c,"storypoints");e&&(e={name:f.text("s.w.formula.preset.wr.points"),description:f.text("s.w.formula.preset.wr.points.description"),groupKey:"formulas",
key:"formula",params:{formula:"IF(TotalStoryPoints > 0;\n   TotalResolvedPoints / TotalStoryPoints)",variables:{totalresolvedpoints:{id:"sum",params:{attribute:{id:"expr",format:"number",params:{formula:"if(and(storypoints,resolution),storypoints,0)",variables:{storypoints:f.deepClone(e),resolution:{id:"resolution",format:"text"}}}},distinct: !0},format:"number"},totalstorypoints:{id:"sum",format:"number",params:{attribute:f.deepClone(e),distinct: !0}}},normalizedFormula:"if(gt(totalstorypoints,0),div(totalresolvedpoints,totalstorypoints))",numberFormat:{type:"percentage",rounding:1}}},a.push(e));a.push({name:f.text("s.w.formula.preset.wr.time"),description:f.text("s.w.formula.preset.wr.time.description"),groupKey:"formulas",key:"formula",params:{formula:"IF(TotalTimeSpent > 0 OR\n   TotalRemainingEstimate > 0;\n   TotalTimeSpent /\n   (TotalTimeSpent + TotalRemainingEstimate)\n)",variables:{totaltimespent:{id:"sum",params:{attribute:{id:"timespent",format:"duration"},distinct: !0},format:"duration"},totalremainingestimate:{id:"sum",params:{attribute:{id:"timeestimate",format:"duration"},distinct: !0},format:"duration"}},numberFormat:{type:"percentage",rounding:1},
normalizedFormula:"if(or(gt(totaltimespent,0),gt(totalremainingestimate,0)),div(totaltimespent,sum(totaltimespent,totalremainingestimate)))"}});a.push({name:f.text("s.w.formula.preset.time.underestimation"),description:f.text("s.w.formula.preset.time.underestimation.description"),groupKey:"formulas",key:"formula",params:{formula:"IF(TotalOriginalEstimate > 0;\n   (  TotalTimeSpent \n    + TotalRemainingEstimate \n    - TotalOriginalEstimate\n   ) / TotalOriginalEstimate) ",variables:{totaltimespent:{id:"sum",params:{attribute:{id:"timespent",format:"duration"},distinct: !0},format:"duration"},totalremainingestimate:{id:"sum",params:{attribute:{id:"timeestimate",format:"duration"},distinct: !0},format:"duration"},totaloriginalestimate:{id:"sum",params:{attribute:{id:"timeoriginalestimate",format:"duration"},distinct: !0},format:"duration"}},normalizedFormula:"if(gt(totaloriginalestimate,0),div(minus(sum(totaltimespent,totalremainingestimate),totaloriginalestimate),totaloriginalestimate))",numberFormat:{type:"percentage",rounding:1}}});a.push({name:f.text("s.w.formula.preset.time.ttr"),description:f.text("s.w.formula.preset.time.ttr.description"),groupKey:"formulas",key:"formula",
params:{formula:"IF(Resolved;Resolved-Created)",normalizedFormula:"if(resolved,minus(resolved,created))",variables:{resolved:{id:"resolutiondate",format:"time"},created:{id:"created",format:"time"}},numberFormat:{type:"duration",workTime: !1}}})}function c(a,b){a.push({name:f.text("s.w.formula.preset.time.duein"),description:f.text("s.w.formula.preset.time.duein.description"),groupKey:"formulas",key:"formula",params:{formula:"IF(duedate;\n  IF(duedate - NOW() >= 0;\n     duedate - NOW();\n     'Overdue'))",normalizedFormula:'if(duedate,if(ge(minus(duedate,now()),0),minus(duedate,now()),"Overdue"))',variables:{duedate:{id:"duedate",format:"time"}},numberFormat:{type:"duration",workTime: !1}}});a.push({name:f.text("s.w.formula.preset.time.tslu"),description:f.text("s.w.formula.preset.time.tslu.description"),groupKey:"formulas",key:"formula",params:{formula:"IF(Updated;\n   NOW() - Updated)",normalizedFormula:"if(updated,minus(now(),updated))",variables:{updated:{id:"updated",format:"time"}},numberFormat:{type:"duration",workTime: !1}}})}return{populate:function(b,g){d(b,g);e(b,g);a(b,g);b.push({name:f.text("s.w.formula.preset.wsjf.safe"),presetName:f.text(
"s.w.formula.preset.wsjf.safe")+"...",description:f.text("s.w.formula.preset.wsjf.safe.description"),groupKey:"formulas",shouldOpenConfigurator: !0,key:"formula",params:{formula:"IF(JobSize > 0;\n (   UserBusinessValue\n   + TimeCriticality\n   + (   RiskReduction\n       | OpportunityEnablement\n     )\n ) / JobSize\n)",variables:{},numberFormat:{type:"number",rounding:2}}});n(b,g);c(b,g);b.push({name:f.text("s.w.formula.preset.time.cost-assignee"),description:f.text("s.w.formula.preset.time.cost-assignee.description"),groupKey:"formulas",key:"formula",params:{formula:"IF(Assignee AND Rate AND \n   ( RemainingEstimate | TimeSpent );\n   Rate * CALENDAR_HOURS(RemainingEstimate + TimeSpent))",normalizedFormula:"if(and(assignee,rate,or(remainingestimate,timespent)),mul(rate,calendar_hours(sum(remainingestimate,timespent))))",variables:{assignee:{id:"assignee",format:"text"},remainingestimate:{id:"timeestimate",format:"duration"},timespent:{id:"timespent",format:"duration"},rate:{id:"user-property",params:{userKey:{id:"assignee",format:"text"},propertyName:"Hourly Rate"},format:"text"}},aggregate:"sum",distinct: !0}});b.forEach(function(a){a.shouldOpenConfigurator&&(
a.resolveAndUpdateImmediately= !0)})}}});define("structure/widget/columns/formula/DefaultVariables",["almworks/util/JSON","almworks/util/Util","structure/widget/jira/Fields","structure/widget/attributes/Attributes"],function(f,b,g,d){function e(e){e=e.jira.getAllIssueFields();if(!e.length)return!1;c=b.mapArray(e,function(a){return a&&a.id?a.id:void 0});e.forEach(function(b){var c=b.name;b=b.id;var e=b.toLowerCase();e!==b&&(p[e]=b);c&&(c=a(c),c.length&&(e=c.join(""),e!==b&&(p[e]=b),c=c.join("_"),c!==b&&(p[c]=b)))});return!0}function a(a){var b=[];if(!a)return b;a=a.toLowerCase().trim();if(!a)return b;for(var c;c=l.exec(a);)c=c[0],"s"!==c&&b.push(c);return b}function n(a,f){if(!f)return null;m||(m=e(a),b.deepFreeze(c));var l,q=p[f];q||(q=f);if(q=c[q])if(q.customId)l={id:"customfield",params:{fieldId:q.customId}};else{var x=g.systemFieldsMap[q.id];(q=x?x.attributeId:q.id)&&(l={id:q})}l&&(q=a.structure._widget.attributeRegistry.getPrimaryFormat(l))&&(l.format=q);if(l)return l;(l=r[f])||(l=f);if(l=k[l])return l;(l=b.tail(f,"total"))||(l=b.tail(f,"sum"));l?("_"===l.charAt(0)&&(l=l.substring(1,l.length)),(l=n(a,l))?(q=l.format,l=q===d.Formats.NUMBER||q===d.Formats.DURATION?{id:"sum",
format:q,params:{attribute:l}}:null):l=null):l=null;return l}var c={},p={affects_versions:"versions",affects_version:"versions",affectsversions:"versions",versions_affected:"versions",versionsaffected:"versions",affected_versions:"versions",affectedversions:"versions",versions:"fixVersions",version:"fixVersions",fix_versions:"fixVersions",type:"issuetype",estimate:"timeestimate",remaining:"timeestimate",original:"timeoriginalestimate",spent:"timespent",due:"duedate"},m= !1,k={itemtype:{id:"itemtype",format:"text"},depth:{id:"depth",format:"number"}},r={item_type:"itemtype"};b.deepFreeze(k);var l=/[a-z0-9]+/g;return{getDefaultSpec:n}});define("structure/widget/columns/MainColumn","almworks/jquery almworks/util/Util almworks/util/Template structure/widget/attributes/Attributes structure/widget/model/Items structure/widget/columns/InserterMarks structure/widget/ui/column/EditableColumn structure/api/ColumnConfigurator structure/api/ColumnType structure/api/SpecOption structure/widget/ui/editor/CellEditor structure/widget/columns/MainColumnCellRendering".split(" "),function(f,b,g,d,e,a,n,c,p,m,k,r){function l(a,c){b.addSuper(k,this)(a,c)}namespace("almworks.structure.ajsbridge");
namespace("almworks.structure.columns");var h=namespace("almworks.structure");b.requireGlobal("AJS");var u=d.SUMMARY_TEXT;b.extend(l.prototype,k.prototype,{jh:function(){var a=this.attributeManager.aR(this.forestSpec,this.rowId).getValue(u);if(null===a)return!1;var b=f('<input name="summary" type="text" maxlength="255" class="s-summary-editor text long-field" autocomplete="off">');b.val(a);this.iX(b);this.installEditorParametersFor(this.hG.itemType);return!0},installEditorParametersFor:function(a){var c=this.hG.bz();if(c&&(a===e.ISSUE||a==e.CONFLUENCE_PAGE)){this.kk(c.container$);var d=this;c.cells.controlsLoaded.pipe(function(a){a&&b.onPage(d.editor$)&&d.jq()&&d.kt()})}},updateSwitchToDialog:function(a){this.om(0>this.hG.rowId&&a===e.ISSUE&& !h.modes.GADGET&&h.openCreateIssueDialog)},kt:function(){var a=this.hG.bz();a&&a.kt();this._super.kt()},jF:function(a){var c=b.keyboardCodeFromEvent(a),e=this.editor$;if((13===c||10013===c||9===c)&&e&& !e.val()&& !f(".ajs-layer.active:visible").length){var e=this.hG.bz(),d;e?(d= !0,13===c||9===c?e.kV(a,this.editor$):10013===c&&e.lx(a,this.editor$)):d=13===c||10013===c;if(d)return a&&(a.preventDefault(),a.stopPropagation(),a.consumed= !0),!1}
return this._super.jF(a)},iA:function(a,b){var c=this.editor$;if(c){var e=b.width(),d=a.data("offsetMargin");d&&(e-=d+20);e=Math.max(e,300);c.width(e)}},ge:function(){var a=this.gg();this.ig(u,a&&a.summary)},hL:function(a){return null!==a.getValue(u)},ic:function(){return this.hS()&&0<this.rowId},gO:function(a){a=k.prototype.gO.call(this,a);a.summary&&(a.summary=f.trim(a.summary));return a},hasSummary:function(){if(!this.editor$)return!1;var a=this.editor$.val();return a&&"string"===typeof a? ! !f.trim(a): !1},kc:b.returnTrue});var s=b.subClass("MainColumn",n,{_minWidth:0,collectRenderingParams:function(){var a=this.spec&&this.spec.params||{};this._showAutomation&&(a=b.extend({showAutomation: !0},a));return a},getCellViewHtml:function(a){return r.getCellViewHtml(a,this.collectRenderingParams())},renderCellEditor:function(a){var b=a._cellEditor.hv;if(b){var c=a._getDepthOffset()+(this.spec.params&& !1===this.spec.params.icons?0:21)+22;b.css("margin-left",c).data("offsetMargin",c)}n.prototype.renderCellEditor.call(this,a)},collectRequiredAttributes:function(a){r.collectRequiredAttributes(a,this.collectRenderingParams())},getWidth:function(){return "*"},setWidth:b.returnTrue,
getMinWidth:function(){0>=this._minWidth&&(this._minWidth=this.context.structure.isGreenHopperTab()?100:200);return this._minWidth},canShrinkWhenNoSpace:b.returnTrue,createCellEditor:function(a){return new l(a,this)},getDefaultName:function(){var a=this.context.jira.getIssueFieldById("summary");return a&&a.name||b.text("sw.column.main.name")}});s.canRender=function(a){return r.canRender(a)};s.isMainColumn=function(a){return a instanceof s};var q=b.subClass("MainConfigurator",c,{init:function(){this.spec.key="main";this.spec.params||(this.spec.params={})},getDefaultColumnName:function(){var a=this.context.jira.getIssueFieldById("summary");return a&&a.name||""},getColumnTypeName:b.returnConst(b.text("sw.column.main.name")),getOptions:function(){return[new m.Checkbox({title:b.text("sw.column.main.opt.description"),spec:this.spec,param:"description",defaultValue: !0}),new m.Checkbox({title:b.text("sw.column.main.opt.icons"),spec:this.spec,param:"icons",defaultValue: !0})]}});return{key:"main",columnType:new(b.subClass("MainColumnType",p,{createConfigurator:function(a,b){return "main"===b.key?new q({context:a,spec:b}):null},createColumn:function(a,c){if("main"===c.key){var e=new s({
context:a,spec:c}),d=a.structure._panel.widget.automationOn;e._showAutomation=d.value();d.pipeChanges(function(b){e._showAutomation=b;a.structure.onExternalParametersChanged()});e._panel=a.structure._panel;e._nextRowLoadWaitLifecycle=new b.Lifecycle;return e}return null}})),canRender:s.canRender,isMainColumn:s.isMainColumn}});define("structure/widget/columns/MainColumnCellRendering","underscore almworks/util/Util almworks/util/Template structure/widget/model/Items structure/widget/attributes/Attributes structure/widget/ui/column/ColumnUtil".split(" "),function(f,b,g,d,e,a){function n(a){return a&&"string"===typeof a?a.trim():""}function c(a,b,c){a.requireAttribute(e.SUMMARY_TEXT);a.requireAttribute(e.URL_TEXT);!1!==b.icons&&a.requireAttribute(e.ICON_HTML);c.isDescriptionShown(b)&&a.requireAttribute(e.DESCRIPTION_HTML);b.lozenge&&a.requireAttribute(e.BASIC_GENERATION_INFO)}var p=g.build("div","span",function(a,b){return["{automation:html}",a(".celldiv.offset",{style:"padding-left:{cellOffset}px"})(a(".grad"),"{expander:html}",b(".value.s-main")("{icon:html}","{loadError:html}","{summary:html}","{lozenge:html}","{description:html}"),"{editError:html}")]}),m=g.build("div",function(a){
return[a(".s-cellerror",{title:"{title}",style:"margin-left:{offset}px"})(a(".s-error-triangle"))]}),k=g.html('<span class="s-expander s-fa"></span>'),r=g.html('<span class="s-i-loading-failed">{s.w.item-loading-failed}</span>'),l=new g('<div class="{classes}">{icon:html}</div>'),h=g.html('<span class="s-no-summary-icon"><i class="alm alm-noicon"></i></span>'),u=g.html('<span class="s-no-summary">&hellip;</span>'),s=new g('<a class="s-summary s-item-link" href="{url}">{summary}</a>'),q=new g('<span class="s-summary">{summary}</span>'),x=new g('<span class="s-ds">-</span><span class="s-item-description">{description:html}</span>'),t=new g('<span class="aui-lozenge aui-lozenge-subtle{lozengeClass}">{label}</span>'),w=new g('<i class="{classes}"></i>'),v={};v[d.ISSUE]="s-fa s-fa-ellipsis-h";v[d.FOLDER]="alm alm-fw alm-folder";v[d.STRUCTURE]="alm alm-structure";v[d.COMPONENT]="s-jira-project-config-icon s-jira-project-config-icon-component";v[d.GROUP]="s-jira-project-config-icon s-jira-project-config-icon-group";v[d.CONFLUENCE_PAGE]="alm alm-fw alm-pages";v[d.SPRINT]="alm alm-fw alm-sprint";v[d.TEMPO_ACCOUNT]="alm alm-fw alm-tempo-account";v[d.TEXT]="alm alm-fw alm-folder";var C=
b.baseClass("DefaultRenderer",{renderCell:function(a,b){var c=a._row.semantics===d.Semantics.TITLE,e= !1!==b.icons,f=this.isLozengeShown(b),k=this.isDescriptionShown(b),g=a.isNotAccessible(),m=a._getDepthOffset(),u=b.showAutomation?n(this.getAutomationHtml(a,b)):"",c=c?"":n(this.getExpanderHtml(a,b));e?(e=this.getIconHtml(a,b),e=l.renderHtml({classes:"s-summary-icon",icon:e||h}),e=n(e)):e="";f={cellOffset:m,automation:u,expander:c,icon:e,loadError:g?r:"",summary:g?"":n(this.getSummaryHtml(a,b)),lozenge:f&& !g?n(this.getLozengeHtml(a,b)):"",description:k&& !g?n(this.getDescriptionHtml(a,b)):"",editError:n(this.getEditErrorHtml(a,b))};return p.renderHtml(f)},isLozengeShown:function(a){return a.lozenge},isDescriptionShown:function(a){return!1!==a.description},getAutomationHtml:function(a,b){},getExpanderHtml:function(a,b){return k},getIconHtml:function(a,b){var c=a.getAttributeValue(e.ICON_HTML);if(!c){var f=v[d.getItemType(a.getItemId())];f&&(c=w.renderHtml({classes:f}))}return c},getSummaryHtml:function(a,b){var c=n(a.getAttributeValue(e.SUMMARY_TEXT));if(!c)return u;var d=a.getAttributeValue(e.URL_TEXT);return d?s.renderHtml({url:d,summary:c}):q.renderHtml({summary:c})},
getLozengeHtml:function(a,b){var c=a.getAttributeValue(e.BASIC_GENERATION_INFO);if(!c)return "";var d=c.label,c=c.creator;if(!d)return "";var f="";"extender"===c?f=" aui-lozenge-complete":"grouper"===c&&(f=" aui-lozenge-moved");return t.renderHtml({lozengeClass:f,label:d})},getDescriptionHtml:function(a,b){var c=n(a.getAttributeValue(e.DESCRIPTION_HTML));if(!c)return "";600<c.length&&(c=c.substring(0,600));return x.renderHtml({description:c})},getEditErrorHtml:function(a,b){var c=a._cellEditor,e=c&&c.hw();return e&&(c.hS()||c.jq())?m.renderHtml({title:e,offset:a._getDepthOffset()+22}):null},collectAdditionalAttributes:function(a,b){}}),z=new g('<a class="s-summary s-item-link issue-link" data-issue-key="{key}" href="{url}">{summary}</a>'),F=b.subClass("IssueRenderer",C,{getSummaryHtml:function(a,b){var c=a.getAttributeValue(e.SUMMARY_TEXT),d=a.getAttributeValue(e.URL_TEXT),f=a.getAttributeValue(e.KEY_TEXT);return c&&d&&f?z.renderHtml({summary:c,key:f,url:d}):this._super.getSummaryHtml.call(this,a,b)},collectAdditionalAttributes:function(a,b){a.requireAttribute(e.KEY_TEXT)}}),A=b.subClass("GeneratorRenderer",C,{getSummaryHtml:function(b,c){var d=b.getAttributeValue(
e.EXTENDED_SUMMARY_HTML);return(d=a.getGeneratorSummaryHtml(b,d))||this._super.getSummaryHtml.call(this,b,c)},collectAdditionalAttributes:function(a,b){b.showAutomation&&a.requireAttribute(e.EXTENDED_SUMMARY_HTML)}}),D=new g('<ul class="labels"><li><a class="lozenge" href="#"><span>{label}</span></a></li></ul>'),G=w.renderHtml({classes:"s-fa s-fa-tag"});g=b.subClass("LabelRenderer",C,{getSummaryHtml:function(a,b){var c=a.getAttributeValue(e.SUMMARY_TEXT);return c?D.renderHtml({label:c}):""},getIconHtml:function(a,b){return G}});var B=w.renderHtml({classes:"alm alm-loop"}),K=b.subClass("LoopRenderer",C,{getIconHtml:function(){return B}});b=b.subClass("StatusRenderer",C,{getSummaryHtml:function(a,b){return a.getAttributeValue(e.EXTENDED_SUMMARY_HTML)},collectAdditionalAttributes:function(a,b){a.requireAttribute(e.EXTENDED_SUMMARY_HTML)}});var J=new C,O={};O[d.GENERATOR]=new A;O[d.ISSUE]=new F;O[d.LABEL]=new g;O[d.LOOP_MARKER]=new K;O[d.STATUS]=new b;return{getCellViewHtml:function(a,b){var c=a&&a.getItemId(),c=d.getItemType(c);return(c&&O[c]||J).renderCell(a,b)},collectRequiredAttributes:function(a,b){c(a,b,J);f.each(O,function(c){c.collectAdditionalAttributes(a,b)})},canRender:
function(a){var b=a.getValue(e.SUMMARY_TEXT);a=a.getValue(e.EXTENDED_SUMMARY_HTML);return!(!b&& !a)}}});define("structure/widget/columns/NotesColumn","almworks/jquery almworks/util/Util almworks/util/Template almworks/util/I18n structure/widget/ui/column/EditableColumn structure/api/ColumnConfigurator structure/api/ColumnType structure/api/SpecOption structure/widget/ui/editor/CellEditor".split(" "),function(f,b,g,d,e,a,n,c,p){function m(a){return b.extend({},h,{params:{structureId:a,name:"notes"}})}function k(a){return a.structure._panel.getStructureId()}function r(a,c,e,d){b.addSuper(p,this)(a,c);this.structureId=e;this.updateEditStats=d}var l=namespace("almworks.structure.appevents"),h={id:"itemProperty",format:"text"};f=b.subClass("NotesColumnType",n,{createSwitchTypePreset:function(a){return{key:"notes",params:{}}},createAddColumnPresets:function(a){return[b.extend(this.createSwitchTypePreset(a),{presetName:b.text("s.w.notes.column-type.name")})]},createConfigurator:function(a,b){return b&&"notes"===b.key?new s({context:a,spec:b}):null},createColumn:function(a,b){return b&&"notes"===b.key?new u({context:a,spec:b}):null}});var u=b.subClass("NotesColumn",e,{getDefaultName:
b.returnConst(b.text("s.w.notes.column-type.name")),isUniversal:b.returnTrue,isStructureDependent:b.returnTrue,canShrinkWhenNoSpace:b.returnTrue,collectRequiredAttributes:function(a){if(0!==k(this.context)){var b=m(k(this.context));a.requireAttribute(b)}},getSortAttribute:function(){return{id:"itemProperty",format:"order",params:{structureId:k(this.context),name:"notes"}}},getCellValueHtml:function(a){var c=m(k(this.context));return b.htmlEscape(a.getAttributeValue(c))||""},createCellEditor:function(a){if(0===k(this.context))return null;var b=this.context.structure._panel.bD();return new r(a,this,k(this.context),function(){b.fireEvent(l.gS,"columns.notes.update")})},isAutoSizeAllowed:b.returnTrue});b.extend(r.prototype,p.prototype,{jh:function(){var a=this.hG.panel.getAttributeValue(this.rowId,m(this.structureId));a||(a="");var b=new g('<textarea name={attrId} rows="4" cols="20" class="s-notes-editor">{notes}</textarea>');this.iX(b.render$({notes:a,attrId:"itemproperty.notes"}));this.hv.addClass("s-e-complex s-notes-editor-panel");return!0},ge:function(){var a=this.gg();this.ig(m(this.structureId),a&&a.itemProperty);this.updateEditStats()},hL:b.returnTrue});var s=b.subClass(
"NotesConfigurator",a,{init:function(){this.spec.key="notes";this.spec.params||(this.spec.params={})},getDefaultColumnName:function(){return b.text("s.w.notes.column-type.name")},getColumnTypeName:function(){return b.text("s.w.notes.column-type.name")},getGroupKey:function(){return "structure"},getOptions:function(){return[new q({text:d.text("s.w.notes.description")})]}}),q=b.subClass("LabelOption",c,{init:function(a){this.text=a.text;this.template=a.template||new g('<div class="description">{text}</div>')},createInput:function(a){this.section$=this.template.render$({text:this.text});a.append(this.section$)}});return{key:["notes"],columnType:new f}});(function(){function f(a,b){this.displayMessage=a;this.additionalInformation=b}var b=namespace("almworks.structure"),g=namespace("almworks.structure.error"),d=namespace("almworks.structure.appevents"),e=namespace("almworks.util"),a=namespace("almworks.structure.$");e.extend(g,{AppError:f,eC:function(a){function c(a){if(a)if(l)k.push(a),g.fireEvent(d.dF,a,m);else{var b=a.displayMessage||"";a.additionalInformation&&(b+=" "+a.additionalInformation);e.error(b)}}var g=a.eventBus,m=this,k=[],r=[],l=b.modes.STRUCTURE_BETAMODE;e.extend(this,{
getErrors:function(){return k.slice(0)},reportError:c,dismissError:function(){if(k.length){var a=k.splice(0,1);r.push(a[0]);g.fireEvent(d.cR,a[0],m)}},dismissAllErrors:function(){e.addAll(r,k);var a=k;k=[];g.fireEvent(d.cR,a,m)}});l&&e.setErrorSink(function(a){c(new f(e.text("sw.error.js"),a))})},fg:function(b){function c(){v.stop().animate({height:0},400,"swing",function(){v.css("display","none");x.find(".st-error-details-link a").text(e.text("sw.errorpanel.showdetails"))})};function f(){var a=v.find(".st-error-details-view");v.stop().css("display","block");l();v.animate({height:a.outerHeight(!0)},400,"swing",function(){x.find(".st-error-details-link a").text(e.text("sw.errorpanel.hidedetails"))})}function g(){v.is(":animated")||(v.is(":visible")?c():f())}function k(){var a=q.getErrors();if(0===a.length)x.data("error")&&x.stop().data("error",null).animate({bottom: -x.height(),opacity:0},400,"swing");else{var b=a[0],c=x.data("error"),d=1<a.length;d&&(a=a.length-1,a=1===a?e.text("sw.errorpanel.moreerror1"):e.text("sw.errorpanel.moreerrors",a),x.find(".st-more-error-text").text(a));c===b?(w.css("display",d?"block":"none"),h()):c?x.animate({bottom: -x.height(),opacity:0},250,"swing",
function(){r(b,d)}):r(b,d)}}function r(b,c){x.data("error",b);w.css("display",c?"block":"none");x.find(".st-error-text").text(b.displayMessage);x.find(".st-error-details-link").css("display",b.additionalInformation?"block":"none");x.find(".st-error-details-view").val(b.additionalInformation||"");x.find(".st-error-details-view").scrollTop(0);0<v.height()&& !b.additionalInformation&&(v.stop().css({height:0,display:"none"}),x.find(".st-error-details-link a").text(e.text("sw.errorpanel.showdetails")));var d=e.getClientWidth(a("body")),f=t.width(),d=d-(t.outerWidth(!0)-f);c&&(d-=w.outerWidth(!0));t.width(d);x.animate({bottom:0,opacity:.85},500,"swing")}function l(){var b=x.find("textarea"),c=e.getClientWidth(b.parent());a.browser.webkit&&b.width(c-28);e.setOuterWidth(b,c)}function h(){l();if(x.data("error")){var b=e.getClientWidth(a("body")),c=t.width(),b=b-(t.outerWidth(!0)-c);w.is(":visible")&&(b-=w.outerWidth(!0));b!=c&&t.animate({width:b+"px"},400,"swing")}}var u= !0,s=b.eventBus,q=b.errorCentral,x=a("#st-error-panel");x.length||(x=a(
'<div id="st-error-panel">  <div style="width: 9999px">    <div class="st-top-error">      <div class="s-ui-icon s-ui-icon-alert"></div>      <div class="st-error-actions">        <div class="s-ui-icon s-ui-icon-circle-close"></div>        <div class="st-error-details-link"><a href="#">'+e.text("sw.errorpanel.showdetails")+'</a></div>      </div>      <span class="st-error-text"></span>    </div>    <div class="st-more-errors">      <div class="st-error-actions">        <div class="st-close-all"><a href="#">'+e.text("sw.errorpanel.dismissall")+'</a></div>      </div>      <span class="st-more-error-text"></span>    </div>  </div>  <div class="st-error-details">    <textarea class="st-error-details-view ajs-dirty-warning-exempt" wrap="off" readonly>    </textarea>  </div></div>'),x.appendTo(a("body")),x.css({opacity:0,bottom: -x.height()}),x.find(".st-error-details-link a").click(function(a){g();a.preventDefault();a.stopImmediatePropagation();return!1}),x.find(".st-close-all a").click(function(a){q.dismissAllErrors();a.preventDefault();a.stopImmediatePropagation();return!1}),x.find(".st-top-error .s-ui-icon-circle-close").click(function(a){q.dismissError();a.preventDefault();
a.stopImmediatePropagation()}),x.find(".s-ui-icon-circle-close").hover(function(){a(this).addClass("st-hover")},function(){a(this).removeClass("st-hover")}),x.find("textarea").focus(function(){a(this).select()}));var t=x.find(".st-top-error"),w=x.find(".st-more-errors"),v=x.find("div.st-error-details");t.click(g);k();h();s.addListener(new e.Life,this);this[d.dF]=function(){var a=u;"function"===typeof a&&(a=e.safeCall(a)|| !0);"dismiss"===a?q.dismissAllErrors():a&&k()};this[d.cR]=k;this[d.av]=h;this.setEnabled=function(a){u=a}}})})();define("structure/widget/GlobalSequence",[],function(){return new function(){this._sequence=1;this.next=function(){return this._sequence++}}});define("structure/widget/URLController","underscore structure/widget/spec/SpecController structure/widget/ui/layout/LayoutManager almworks/util/Cell almworks/util/JSON almworks/util/Util".split(" "),function(f,b,g,d,e,a){function n(b){var c={};b&&(a.startsWith(b,"?")&&(b=b.substring(1)),b.split("&").forEach(function(a){a=a.split("=");2===a.length&&(c[decodeURIComponent(a[0])]=decodeURIComponent(a[1]))}));return c}var c=window.history,p=namespace("almworks.structure");return function(m){function k(b,c,e){var d=
window.location.search,d=a.setUrlParameter(d,"s",r(b)),d=a.setUrlParameter(d,"rs",r(c));null!=e&&(d=a.setUrlParameter(d,"v",e?e:null));return b?d:null}function r(a){if(!a)return null;var c=b.getUntransformedSpec(a);a.pinnedItem&&(c.pinnedItem=a.pinnedItem);return c.hasOwnProperty("structureId")&&1===Object.keys(c).length?c.structureId:e.stringify(c)}function l(){if(!A){var a=O.value()+z;document.title!==a&&(document.title=a)}}function h(b){var e=window.location.hash,d=window.location.search+e;e||(e="#");e=b+e;if(b){if(G&& !f.isEqual(n(window.location.search),n(b))|| !G&&e!==d)try{D&&G?c.pushState(null,"",e):c.replaceState(null,"",e)}catch(h){a.warn("exception when updating history",h)}G= !0}D&&f.defer(l);D=A= !1}function u(){if(!A){var a=window.location.search;"?"!==a&&(a=n(a),f.isEqual(a,n(J.value()))||(q(a,!0),x(a),t(a)))}}function s(){m.setInitiallySelectedIssueFromLocation();var a=n(window.location.search);a.s|| !m.config.currentStructureId||a.p||(a.s=m.config.currentStructureId);m.az.installPerspective(a.p,f.partial(q,a,!1));x(a);t(a);v.setValue(!0)}function q(b,c,d){function f(c,h){var l;if(l=b[h]){var k=a.toIntSafe(l);l=k?{structureId:k}:e.parse(l)}else l=d?
c.getSpecController().readPerspectiveSpec(d):null;l&&(l.pinnedItem||(l.pinnedItem=null),d&&l.transforms&&delete l.transforms,c.setSpec(l))}f(m.master,"s");f(m.slave,"rs");c&&(c=g.SINGLE_PANEL_LAYOUT,b.rs?c=g.TWO_PANEL_LAYOUT:b.v&&(c=g.HISTORY_PANEL_LAYOUT),F.switchLayout(c));w.setValue(!0)}function x(b){(b=b.view)&&m.setInitialView(a.toIntSafe(b))};function t(b){(b=b.v)&&m.showHistory(a.toIntSafe(b))}var w=new a.Cell(!1),v=new a.Cell(!1),C=new a.Cell(w,v,a.and);this.initializedCell=C;if(p.modes.GADGET||p.modes.GH_TAB||p.modes.ISSUE_PAGE||p.modes.PCV_PAGE)C.setValue(!0),m.az.installPerspective(0,a.noop);else{var z=" - "+document.title;f.defer(s);if(c){var F=m.layoutManager,A,D,G,C=new d(F.layoutCell,function(){return m.slave.isPerspectiveReady()}),B=new d(m.slave.getSpecController().bw(),C,function(a,b){return b?a:null}),K=new d(m.slave.getInfoCell(),C,function(a,b){return b?a:void 0}),J=(new d(m.master.getSpecController().bw(),B,m.bF.forcedVersionCell,k)).pipeChanges(function(){A= !0}).pipeDebounced({wait:10,waitInit:10,immediateCall: !1},h),O=(new d(m.master.getInfoCell(),K,F.layoutCell,F.externalPanelDescriptorCell,function(b,c,e,d){function f(b){return b&&b.name?b.name:a.text(
"sw.structure.unknown.name")}b=f(b);c=d&&d.titleText||(g.TWO_PANEL_LAYOUT===e&&void 0!==c?f(c):null);return b+(c?" | "+c:"")})).pipeDebounced({wait:10,waitInit:10,immediateCall: !1},l);(new d(m.master.settingsKey,m.slave.settingsKey,C,function(a,b,c){return[a,c?b:null]})).pipeChanges(function(){D= !0});window.onpopstate=u}}}});define("structure/widget/jira/LogoutNotification",["almworks/util/Util"],function(f){var b=namespace("JIRA.Messages",!1),g=namespace("almworks.structure.ajsbridge");return{show:function(){if(b&&b.showErrorMsg){var d=g.localURL("/login.jsp")+"?os_destination="+encodeURIComponent(g.currentURL());b.showErrorMsg(f.renderTemplate("{s.w.error.http.401:html,loginUrl}",{loginUrl:d}),{closeable: !0,timeout:0})}}}});define("structure/widget/EffectNotifications",["underscore","jira/message","almworks/util/Template"],function(f,b,g){return{showEffects:function(d){d=f.filter(d,function(a){return!(!a.external|| !a.description)});var e=f.groupBy(d,"generatorRowId");f.each(d,function(a){a=a.generatorRowId;var d=e[a];d&&(delete e[a],1===d.length?b.showSuccessMsg(g.html("{description}",d[0])):2===d.length?b.showSuccessMsg(g.html("{description}<br>{s.w.effect.1.more,more}",
d[0])):b.showSuccessMsg(g.html("{description}<br>{s.w.effect.n.more,more}",d[0],{more:d.length-1})))})},showProblems:function(d){d=f.filter(d,function(a){return! !a.description});var e=f.groupBy(d,"generatorRowId");f.each(d,function(a){var d=a.generatorRowId;if(a=e[d])delete e[d],5>=a.length?d=f.reduce(a,function(a,b){return a+(a?"<br>":"")+g.html("{description}",b)},""):(d=f.reduce(f.first(a,4),function(a,b){return a+(a?"<br>":"")+g.html("{description}",b)},""),d=g.html("{messages:html}<br>{s.w.effect-problem.n.more,more}",{messages:d,more:a.length-4})),b.showErrorMsg(d)})}}});define("structure/widget/WidgetConfig",["almworks/jquery","almworks/util/Util"],function(f,b){var g=namespace("almworks.structure");return function(d){this.minCachedRows=50;this.preloadRowsFactor=f.browser.msie?1:2;this.height=200;this.minRows=2;this.maxRows=0;this.levelOffset=32;this.showClosed="dim";this.showToolbar= !0;this.callback=null;this.pollInterval=1E4;this.inactivePollInterval=6E4;this.boostedPollInterval=1E3;this.boostDuration=6E3;this.userInactivityThreshold=3E5;this.uploadDelay=500;this.hideable=this.fixFooterBottom= !1;this.rowCacheSize=250;this.forProject=d.forProject;this.initialViewId=
this.forceViewId=0;this.currentStructureId=null;this.forceReadOnly= !1;this.forceLayout=g.modes.ISSUE_PAGE||g.modes.GH_TAB?"single":null;this.slaveConfig=this.masterConfig={areJiraActionsDisabled:"remote"===g.modes.GADGET||g.modes.GH_TAB?b.returnTrue:function(){return! !g.modes.ISSUE_DETAILS}};this.singlePanel= ! !(g.modes.GADGET||g.modes.ISSUE_PAGE||g.modes.GH_TAB);this.getFixedRowHeight=b.returnConst(33);this.getDepthOffset=function(b){return b*this.levelOffset+12};this.showIssueDetails= !1;this.getMinHeight=function(){return this.minRows*this.getFixedRowHeight()};this.getMaxHeight=function(){return this.maxRows*this.getFixedRowHeight()};d&&b.extend(this,d)}});define("structure/widget/model/ApplicatorForest",["structure/widget/model/ForestDecorator","structure/widget/model/ForestUpdateEvent","structure/widget/model/DataForest"],function(f,b,g){function d(){function a(a){try{a(m)}catch(b){e.error("error applying change "+a+": "+b,b)}}function d(){if(r)l= !0;else{var b=p.source?p.source.as():[];m.jy();try{m.aH(b);for(var b=0,c=k.length;b<c;b++)a(k[b])}finally{m.ap()}}}function c(a){if(!a)return-1;a=e.indexOf(k,a);0<=a&&(k.splice(a,1),r||k.length?d():(e.safeCall(
p.decoratingCallback),p.source&&d()));return a}f.call(this);var p=this,m=new g,k=[],r=0,l= !1;m.events.addListener(new e.Life,b.E,function(a){p.fire(a.from,a.to,a.count)});this[b.E]=d;e.extend(this,{sourceUpdated:function(a){d()},add:function(b){if(b){var c=k.length||p.source;k.push(b);r?l= !0:c?a(b):e.safeCall(p.decoratingCallback)}},remove:c,replace:function(a,b){if(a)if(b){var f=e.indexOf(k,a);0<=f&&(k[f]=b,d())}else c(a)},size:function(){return m.size()},row:function(a){return m.row(a)},indexOf:function(a){return m.indexOf(a)},ai:function(){return 0<k.length},clear:function(){k.length&&(k=[],r||e.safeCall(p.decoratingCallback),d())},al:function(a){a?0===r++ &&(l= !1):0>= --r&&(l&&(! !k.length^ ! !p.source&&e.safeCall(p.decoratingCallback),d()),l= !1)}})}var e=namespace("almworks.util");e.extend(d.prototype,f.prototype);return d});define("structure/widget/model/DataForest",["underscore","structure/widget/model/Forest"],function(f,b){function g(a){function g(a){a=v[a];return void 0===a? -1:a}function c(a,b,c){t.check();if(!a|| !a.length)return!1;b=m(b,c);if(!b)return!1;c=b.targetDepth-a[0].getDepth();if(0!==c){for(var e=[],d=0,f=a.length;d<f;d++)e.push(a[d].aC(c));a=e}p(a,
b.targetIndex);t.check();return!0}function p(a,b){t.check();if(a&&a.length){0>b&&(b=0);b>w.length&&(b=w.length);if(b===w.length)d.addAll(w,a);else{var c=w.slice(0,b);d.addAll(c,a);d.addAll(c,w.slice(b));w=c}for(c=b;c<w.length;c++)v[w[c].id]=c;t.check();c=t.gQ(b);t.fire(c,b,b-c+a.length)}}function m(a,b){var c= -1;if(a&&(c=t.indexOf(a),0>c))return null;var e=0>c?0:t.row(c).getDepth()+1,d=c+1;if(b){var f=t.indexOf(b);0<=f&&(f=t.ak(f,e),0<=f&&t.aI(f)===c&&(d=t.bH(f)))}return{underIndex:c,targetIndex:d,targetDepth:e}}function k(a,b,c){a=t.indexOf(a);if(0>a)return!1;var e=t.bH(a);b=m(b,c);if(!b||b.underIndex>=a&&b.underIndex<e)return!1;r(a,b);return!0}function r(a,b){var c=b.targetIndex,e=b.targetDepth,f=b.underIndex;t.check();var h=t.bH(a);c==h&&(c=a);if(c!=a||e!=w[c].getDepth())if(c>a&&c<=h)d.assert(!1,a+" "+h+" "+c);else{var f=0>f?Math.min(c,t.gQ(a)):Math.min(f,t.gQ(a)),l,k= -1,g= -1;for(l=c-1;0<=l;l--)if(l>=a&&l<h)l=a;else{var m=w[l].getDepth();if(m==e&& -1==g&&(g=l,0===e))break;if(m==e-1){k=l;break}}if(0<e&&0>k)throw d.assert(!1,a+" "+h+" "+c+" "+e),Error("bad target depth");l=e-w[a].getDepth();var n,p,k=function(a,b,c,e){for(var d=b;d<c;d++)w[a+d-b]=n[d-p].aC(e)};c<=a?(n=w.slice(
p=c,e=h),k(c,a,h,l),k(c+h-a,c,a,0)):(n=w.slice(p=a,e=c),k(a,h,c,0),k(a+c-h,a,h,l));for(l=p;l<e;l++)v[w[l].getId()]=l;t.check();p=Math.min(p,f);t.fire(p,e,e-p)}}function l(a,b,c,e,d){function f(){k=d<n?e[d]: -1;0<=k&&(g=t.bH(k))}function l(a){var b;if(p)for(b=m;b<a;++b)p.push(w[b]);else c=h(c,w,m,a)}var k,g,m,n=e.length;m=a;f();var p=null;for(c>a&&(p=[]);m<b&&0<=k&&k<b;)l(k),d+=1,m=g,f();l(b);p&&h(c,p,0,p.length);return d}function h(a,b,c,e){for(var d;c<e;++c)d=b[c],w[a]=d,v[d.id]=a,a+=1;return a}function u(a){t.check();d.isArray(a)?(a=d.addAll([],a),a.sort(e)):a=[a];var b=a[0],c=t.gQ(b),f,h,l,k,g,m,n=0;f=0;for(h=a.length;f<h;f++)if(b=a[f],k=w[b])for(g=k.getDepth(),m=b,l=w.length;m<l;m++){k=w[m];if(m>b&&k.getDepth()<=g)break;v[k.getId()]= -1;w[m]=null;n++}b=w.slice(0,a[0]);f=a[0];for(h=w.length;f<h;f++)w[f]&&b.push(w[f]);w=b;f=a[0];for(h=w.length;f<h;f++)v[w[f].getId()]=f;t.check();t.fire(c,m,m-c-n)}function s(a){t.check();for(var b={},c=a.length,e=w.length,d=c,f= -1,h=0;h<c;h++){var l=a[h];b[l.getId()]=h;if(h>=e|| !l.isSame(w[h]))d=Math.min(h,d),f=Math.max(h+1,f)}if(c===e&&d===c)return this;h=f-d;c!==e&&(f=w.length,h=a.length-d);w=a;v=b;t.check();a=t.gQ(d);t.fire(a,f,h+(d-a));
return this}function q(a,b,e,d){var f=a[b],h=f.getId();0<=t.indexOf(h)?k(h,e,d):c([f.aC(-f.getDepth())],e,d);e=f.getDepth();d=a.length;b++;for(f=0;b<d&&a[b].getDepth()>e;){var l=a[b].getId();b=q(a,b,h,f);f=l}return b}b.call(this);var x=d.extend({},this),t=this,w=[],v={};d.extend(this,{size:function(){return w.length},row:function(a){return 0<=a&&a<w.length?w[a]:null},indexOf:g,report:function(){var a={},b=x.report(a),c;for(c in v)if(v.hasOwnProperty(c)){var e=v[c];-1!==e&&a.items[c]!==e&&(b+="[DataForest] inconsistent index for row #"+c+" - stored ["+e+"], actual ["+a.items[c]+"]\n")}return b},clear:function(){t.check();var a=w.length;w=[];v={};t.check();t.fire(0,a,0)},append:function(a){p(a,w.length)},cP:c,moveSubtreesById:function(a,b,c){if(!a.length)return null;var p=m(b,c);if(!p)return null;t.check();var u=a.length,q=p.underIndex,r=p.targetIndex,s=p.targetDepth,x=a.map(g).sort(e),O,v,U=Math.min(x[0],r),P=0,Y=0,N=0,L= !0;for(v=0;v<u;++v){O=x[v];if(O<N){L= !1;break}N=t.bH(O);if(O<=q&&q<N)return t.moveSubtreesById(f.without(a,t.rowId(O)),b,c);O<r?P+=N-O:Y+=N-O}q=Math.max(N,r);if(!L){d.debug(
"DataForest.moveSubtreesById(): movedRoots are not normalized, falling back to moving one-by-one: ",a,b,c,v);for(p=0;p<u;p++)k(a[p],b,c),c=a[p];return{start:U,end:q}}a:{b= -1;for(N=U;N<q;++N){v=w[N].depth;if(0===v)break;if(0>b||v<b)b=v}if(0>b)d.assert(0===w[U].depth,w[U].depth),b=U;else{d.assert(0<b,b+" "+U+" "+q+" "+w);for(N=U-1;0<=N;--N)if(w[N].depth===b-1){b=N;break a}d.assert(!1);b=0}}0<=p.underIndex&&p.underIndex<b&&(b=p.underIndex);c=[];for(p=0;p<u;++p)for(v=t.indexOf(a[p]),N=t.bH(v),L=s-w[v].depth;v<N;)c.push(w[v++].aC(L));v=l(U,r,U,x,0);0<Y&&l(r,q,r+Y,x,v);h(r-P,c,0,c.length);t.check();t.fire(b,q,q-b);return{start:U,end:q}},dk:function(a){a=t.indexOf(a);0<=a&&u(a)},oW:function(a){var b,c,e,d=[];b=0;for(c=a.length;b<c;b++)e=t.indexOf(a[b]),0<=e&&d.push(e);d.length&&u(d)},removeSubtreesAtIndexes:u,aH:s,bo:function(a,b,e){t.check();if(!a|| !a.length)return!1;var f;a:{f=0;for(var h=a.length;f<h;f++)if(t.contains(a[f].getId())){f= !1;break a}f= !0}if(f)return c(a,b,e);if(b){f=t.indexOf(b);if(0>f)return!1;a:{f=d.flipSet(t.aG(f));for(var h=0,l=a.length;h<l;h++)if(f[a[h].getId()]){f= !0;break a}f= !1}if(f)return!1}t.jy();try{var k=a.length;for(f=0;f<k;){var g=a[f].getId();f=q(a,f,
b,e);e=g}}finally{t.ap()}t.check();return!0},eachRow:function(a){w.forEach(a)}});a&&a.length&&s(a)}var d=namespace("almworks.util"),e=function(a,b){return a-b};d.extend(g.prototype,b.prototype);return g});define("structure/widget/model/DecoratorSwitchForest",["structure/widget/model/ForestDelegator"],function(f){function b(b,e){function a(a){n.debugName&&g.debug(n.debugName+" switch decorating "+a);a?(e.setSource(b),n.setSource(e)):(n.setSource(b),e.setSource(null))}f.call(this);var n=this,c= ! !e.ai();a(c);e.cs(function(){var b= ! !e.ai();b!==c&&(c=b,a(c))})}var g=namespace("almworks.util");g.extend(b.prototype,f.prototype);return b});define("structure/widget/model/ExclusionForest",["structure/widget/model/RowFilteringForest","structure/widget/model/ForestUpdateEvent"],function(f,b){function g(){f.call(this);var e=new d.Lifecycle,a=this,g=null;d.extend(this,{setExcludeFrom:function(c){if(g===c)return a;g=c;e.cycle();c?(a.setFilter(function(a,b){return!c.contains(b.rowId(a))}),c.events.addListener(e.life(),b.E,function(b){a.cn()})):a.setFilter(d.returnTrue);return a}})}var d=namespace("almworks.util");d.extend(g.prototype,f.prototype);return g});define(
"structure/widget/model/FilteredForest",["structure/widget/model/ForestDecorator","structure/widget/model/ForestUpdateEvent"],function(f,b){function g(){function e(){var b=m.length,c=p.source;if(!c&&0<b)return "len "+b+" no source";if(!c)return null;for(var c=c.size(),e= -1,d=0;d<b;d++){var f=a(m[d]);if(f<=e)return "["+d+"] "+e+" "+f;if(f>=c)return "["+d+"] "+f+" m "+c;e=f}return null}function a(a){return 0<=a?a: -a-1}function g(b){return a(m[b])}function c(b){if(p.source){var c=0===b.from?0:a(d.binarySearch(b.from,0,m.length,g,d.compareNumbers)),f=a(d.binarySearch(b.to,c,m.length,g,d.compareNumbers));p.debugName&&d.debug(p.debugName+" got update "+b.from+".."+b.to+":"+b.count+" filtered "+c+".."+f);var h=b.count-(b.to-b.from);if(h)for(var u=f,s=m.length;u<s;u++){var q=m[u];m[u]=0>q?q-h:q+h}u=f<m.length?p.source.rowDepth(a(m[f])):0;h=[];s=b.from;q=p.filter(p.source,s,s+b.count);for(b=s+b.count-1;b>=s;b--){var x=p.source.row(b),t=q[b],x=x.getDepth();if(t||u>x)u=x,h.push(t?b: -b-1)}if(!(f<=c)||h.length){s=c;if(h.length)for(b=a(h[h.length-1]),u=p.source.row(b).getDepth(),s=0<s?a(m[s-1]): -1;0<u;)if(b=p.source.aI(b),u--,b>s)h.push(-b-1);else break;if(!(0>=c))for(b=h.length?
p.source.rowDepth(a(h[h.length-1])):f<m.length?p.source.rowDepth(a(m[f])):0,u=c-1;0<=u;u--){s=m[u];if(0<=s)break;p.source.row(-s-1).getDepth()>=b&&c--}b=c;if(f-b===h.length)for(u=0,s=f-1;s>=b;s--,u++)m[s]=h[u];else{s=[];d.addAll(s,m,0,b);for(u=h.length-1;0<=u;u--)s.push(h[u]);d.addAll(s,m,f);m=s}p.debugName&&d.debug(p.debugName+" updated to {"+m.join(",")+"}");d.assertionsEnabled()&&(b=e())&&d.error(b);p.fire(c,f,h.length)}}}f.call(this);var p=this,m=[];this[b.E]=function(a,b){b!==p.source?d.assert(!1,b):c(a)};d.extend(this,{size:function(){return m.length},row:function(b){var c=p.source;return c?c.row(a(m[b])):null},indexOf:function(a){var b=p.source;if(!b)return-1;a=b.indexOf(a);a=d.binarySearch(a,0,m.length,g,d.compareNumbers);return 0>a? -1:a},sourceUpdated:function(a){var b=p.source;b?c({from:0,to:a,count:b.size()}):(m=[],p.fire(0,a,0))},update:c,cn:function(){if(p.source){var a=p.source.size();c({from:0,to:a,count:a})}}})}var d=namespace("almworks.util");d.extend(g.prototype,f.prototype,{filter:function(b,a,d){return{}}});return g});define("structure/widget/model/Forest",["structure/widget/model/ForestUpdateEvent","structure/widget/model/ForestIndexer","almworks/util/Util"],
function(f,b,g){function d(){function b(c,e,p){a.debugName&&g.debug(a.debugName+" fire "+c+".."+e+":"+p+" ["+a.size()+"]");d.fireEvent(f.E,new f(c,e,p),a)}var a=this,d=new g.Observable,c=null,p=0;g.extend(this,{jy:function(){p++;c||(c={from:Number.MAX_VALUE,to:0,delta:0})},ap:function(){if(!(0< --p)&&c){a.check();var d=c.from,f=c.to,g=c.delta;c=null;d<=f&&b(d,f,f-d+g)}},fire:function(a,d,f){if(d<a)g.assert(!1,"to "+d+" from "+a);else if(d!==a||0!==f)c?(c.from=Math.min(a,c.from),c.to=Math.max(d-c.delta,c.to),c.delta+=f-(d-a)):b(a,d,f)},events:d,report:function(b){for(var c={},e=0,d="",f=a.size(),g=0;g<f;g++){var n=a.row(g),p=n.getId();if("number"===typeof c[p])d+="duplicate row #"+p+" - ["+c[p]+"],["+g+"]\n";else{c[p]=g;var x=a.indexOf(p);x!==g&&(d+="inconsistent indexOf for row #"+p+" - actual ["+g+"], indexOf ["+x+"]\n")}n=n.getDepth();0>n&&(d+="invalid depth "+n+" ["+g+"]\n");n>e+1&&(d+="invalid depth change "+e+"->"+n+" ["+g+"]\n");e=n}b&&(b.items=c);return d},check:function(){if(g.assertionsEnabled()&& !c){var b=a.report();if(b){var e=a.debugName;if(!e)try{e=a.constructor.name}catch(d){}g.error('Forest "'+(e||"?")+'" consistency check failed:\n'+b)}}},debugName:null})}g.extend(
d.prototype,{size:function(){g.pvc()},row:function(b){g.pvc()},indexOf:function(b){g.pvc()},isEmpty:function(){return 0===this.size()},rowId:function(b){return(b=this.row(b))&&b.getId()},rowDepth:function(b){return(b=this.row(b))&&b.getDepth()},contains:function(b){return 0<=this.indexOf(b)},gz:function(b){if(0>b||b+1>=this.size())return null;var a=this.row(b+1);b=this.row(b);return a&&b?a.getDepth()===b.getDepth()+1?a.getId():null:null},cG:function(b){b=b?this.indexOf(b): -1;return 0>b?0:this.gz(b)||0},hasChildren:function(b){return! !this.cG(b)},il:function(b){return! !this.gz(b)},aG:function(b){if("number"!==typeof b||0>b||b>=this.size())return null;var a=this.row(b);if(0===a.getDepth())return[a.getId()];b=this.aG(this.aI(b));if(!b|| !b.push)return b;b.push(a.getId());return b},getPathsByItemId:function(b){if(!b||"string"!==typeof b)return[];for(var a=[],d=this.size(),c,f=0;f<d;f++)(c=this.row(f))&&c.itemId===b&&a.push(this.aG(f));return a},getPath:function(b){return b?this.aG(this.indexOf(b)):null},bL:function(b){b=this.aI(this.indexOf(b));return 0>b?null:this.row(b).getId()},aL:function(b){b=this.indexOf(b);return 0>b?null:this.row(b)},aI:function(b){if(0>b||b>=this.size())
return-1;var a=this.row(b).getDepth();if(0===a)return-1;for(var d=b-1;0<=d;d--)if(this.row(d).getDepth()===a-1)return d;g.assert(!1,b);return-1},dX:function(b){if(b>=this.size())return-1;for(var a=b;0<=a;a--)if(0===this.row(a).getDepth())return a;g.assert(!1,b);return-1},ak:function(b,a){if(0>b)return-1;var d=this.row(b).getDepth()-a;if(0>d)return-1;for(var c=0;c<d;c++)b=this.aI(b);return b},bH:function(b){var a=this.row(b).getDepth(),d=this.size();for(b+=1;b<d&& !(this.row(b).getDepth()<=a);b++);return b},eh:function(b,a){if(0>b||0>a)return!1;for(var d=b;a<d;)if(d=this.aI(d),d==a)return!0;return!1},fD:function(b,a){for(;0<=b&&this.row(b).getDepth()!==a;)b--;return b},as:function(){for(var b=[],a=this.size(),d=0;d<a;d++)b.push(this.row(d));return b},cloneRows:function(){for(var b=[],a,d=this.size(),c=0;c<d;c++)a=this.row(c),b.push(a.clone());return b},dg:function(b,a){var d=a||[],c=this.indexOf(b);if(0>c)return d;for(var f= -this.rowDepth(c),g=this.bH(c);c<g;c++)d.push(this.row(c).aC(f));return d},dI:function(b){if(!b&&0!==b)return null;var a=this.size();if(0>b||b>a)return null;if(0===b)return{under:0,after:0};var d=b===a? -1:this.aI(b),c=0>d?0:this.rowId(d),f=0;d<b-1&&(a=b===a?0:
this.rowDepth(b),b=this.ak(b-1,a),f=this.rowId(b));return{under:c,after:f}},cf:function(b,a){var d=this.size();if(0>b||b>d)return null;if(0===b)return 0===a?{under:0,after:0}:null;if(b<d&&this.rowDepth(b)>a)return null;var c= -1,d=0;if(0<a){c=this.ak(b-1,a-1);if(0>c)return null;d=this.rowId(c)}var f=0;c<b-1&&(c=this.ak(b-1,a),f=this.rowId(c));return{under:d,after:f}},normalizeIdMap:function(e){if(!e)return[];var a,d,c=[],f={},m=new b(this);for(a in e)if(e.hasOwnProperty(a)&&e[a]){var k=this.indexOf(a);if(!(0>k)){var r=m.ow(a);for(d=r.length-1;0<d&& !e[r[d]];d--);if(!(0<d))try{var l=g.toInt(a);c.push(l);f[l]=k}catch(h){g.warn("normalizeIdMap problem",h)}}}1<c.length&&c.sort(function(a,b){return f[a]-f[b]});return c},dB:function(b){for(var a=[],d=0,c=b.length;d<c;d++)this.dg(b[d],a);return a},cD:function(b){return(new(require("structure/widget/model/DataForest"))).aH(this.dB(b))},aD:function(){for(var b=[],a=0,d=this.size();a<d;a++)b.push(this.rowId(a));return b},fc:function(b){for(var a=0,d=0,c=this.size();d<c;d++)b(this.rowId(d))&&a++;return a},getSizeCell:function(){var b=this.bB;if(b)return b;var b=(new g.Cell).setValue(this.size()),a=this,d=g.delayed(10,function(){b.setValue(
a.size())});this.events.addListener(new g.Life,f.E,d);return this.bB=b},onChange:function(b){this.events.addListener(new g.Life,f.E,b);return this},fH:function(b,a){var d=0>b? -1:a?b:this.aI(b),d=0>d?0:this.rowId(d),c=0;if(a){var f=this.bH(b)-1;f>b&&(f=this.ak(f,this.rowDepth(b)+1),c=this.rowId(f))}else c=0>b?0:this.rowId(b);return{under:d,after:c}},dU:function(b){var a=b?this.indexOf(b): -1;return b&&0>a?0:this.ec(a)},ec:function(b){var a;if(0<=b){a=this.bH(b)-1;if(a<=b)return 0;b=this.rowDepth(b)+1}else{a=this.size()-1;if(0>a)return 0;b=0}a=this.ak(a,b);return 0>a?0:this.rowId(a)},getBeforeForAfter:function(b,a){var d;if(0===a){if(0===b)return this.size()?this.rowId(0):0;d=this.indexOf(b);return 0>d?null:this.gz(d)||0}d=this.indexOf(a);if(0>d)return null;var c=this.rowDepth(d),f=this.size();for(d++;d<f;d++){var g=this.row(d),k=g.getDepth();if(k===c)return g.getId();if(k<c)break}return 0},ds:function(b,a){var d=b?this.indexOf(b): -1;if(b&&0>d)return 0;var c=a?this.indexOf(a): -1;if(0>c)return this.ec(d);if(c<=d+1)return 0;var f=0>d?0:this.rowDepth(d)+1;if(this.rowDepth(c)<f)return this.ec(d);c=this.ak(c,f);if(c<=d+1)return 0;c=this.ak(c-1,f);return c<=d?0:this.rowId(c)},eY:
function(b){var a=b&&b.length;if(a){for(var d=1E9,c= -1,f=0;f<a;f++){var g=this.indexOf(b[f]);0>g||(g<d&&(d=g),g>c&&(c=g))}c<d||(d=this.gQ(d),this.fire(d,c+1,c-d+1))}},gQ:function(b){var a=this.aI(b);return 0>a?b:a},fI:function(b){for(var a=this.aG(b)||[],d=0,c=a.length;d<c;d++)a[d]=this.row(this.indexOf(a[d]));d=b+1;for(c=this.bH(b);d<c;d++)a.push(this.row(d));return a},hf:function(){var b,a,d,c=[];b=0;for(a=this.size();b<a;b++)d=this.row(b),0===d.getDepth()&&c.push(d.getId());return c},lG:function(b){var a=this.row(b),d,c;if(!a)return-1;a=a.getDepth();for(d=b-1;0<=d;d--){c=this.row(d).getDepth();if(c===a)return d;if(c<a)return-1}g.assert(0==b,b);return-1},findNextFocusAfterDeletion:function(b){for(var a=null,d=0,c=b.length;d<c;d++){var f=this.indexOf(b[d]);if(0<=f){var g=this.rowDepth(f),k=this.bH(f);(k=k<this.size()?this.row(k):null)&&k.getDepth()===g?a=k.getId():0<f&&(k=this.row(f-1),k.getDepth()<g?a=k.getId():(f=this.ak(f-1,g),0<=f&&(a=this.rowId(f))))}}return a},getChildren:function(b){if(0===b)return this.hf();var a=this.indexOf(b);if(0>a)return null;b=this.rowDepth(a+1);for(var d=this.size(),c=[],a=a+1;a<d&& !(this.rowDepth(a)<b);a++)this.rowDepth(a)===b&&c.push(this.rowId(
a));return c},getRowsWithItemId:function(b){var a,d=this.size(),c=[],f;if(b)for(a=0;a<d;a++)(f=this.row(a))&&f.itemId===b&&c.push(f.getId());return c},selectDistinct:function(b){for(var a={},d=0,c=this.size();d<c;d++){var f=b(this.row(d));f&&(a[f]= !0)}return a}});d.encode=function(b){var a="";if(b)for(var d=0,c=b.size();d<c;d++)0<d&&(a+=","),a+=b.row(d).encode();return a};d.equals=function(b,a){if(!b)return!a;if(!a)return!1;var d=b.size();if(d!==a.size())return!1;var c,f,g;for(c=0;c<d;c++)if(f=b.row(c),g=a.row(c),f.getId()!==g.getId()||f.getDepth()!==g.getDepth())return!1;return!0};return d});define("structure/widget/model/ForestDecorator",["structure/widget/model/Forest","structure/widget/model/ForestUpdateEvent"],function(f,b){function g(){f.call(this);this.source=null;var e=this,a=new d.Lifecycle;this.setSource=function(b){var c=this.source&&this.source.size()||0;a.cycle();(this.source=b)&&b.events.addListener(a.life(),e);e.debugName&&d.debug(e.debugName+" decorator source updated old["+c+"] new["+(this.source&&this.source.size()||0)+"]");this.sourceUpdated(c);return this};this[b.E]=function(){d.pvc()}}var d=namespace("almworks.util");d.extend(g.prototype,f.prototype,{
sourceUpdated:function(b){},ai:d.returnTrue,cs:function(b){this.decoratingCallback=b}});return g});define("structure/widget/model/ForestDelegator",["structure/widget/model/ForestDecorator","structure/widget/model/ForestUpdateEvent"],function(f,b){function g(e){f.call(this);var a=this;d.extend(this,{sourceUpdated:function(b){var c=a.source?a.source.size():0;a.fire(0,b,c)},size:function(){return a.source?a.source.size():0},row:function(b){return a.source?a.source.row(b):null},indexOf:function(b){return a.source?a.source.indexOf(b): -1}});this[b.E]=function(b){a.fire(b.from,b.to,b.count)};e&&this.setSource(e)};var d=namespace("almworks.util");d.extend(g.prototype,f.prototype);return g});define("structure/widget/model/ForestIndexer",[],function(){var f=namespace("almworks.util");return function(b,g,d){function e(){var c=[],e= -1,f,r,l;a=[];n=[];f=0;for(r=b.size();f<r;f++){l=b.rowDepth(f);if(l<e)for(;e>l;e--)c[e]=0;a[f]=c[l-1]||g||0;n[f]=c[l]||0;c[l]=b.rowId(f);e=l}0<d&&(n[0]=d)}var a=null,n=null,c=null;f.extendOwn(this,{getUnder:function(b){a||e();return a[b]},oE:function(a){a=b.indexOf(a);return 0>a? -1:this.getUnder(a)},ow:function(a){var b=this.oE(a),c=[];if(0<=b)for(c.push(a);0<b;)
c.push(b),b=this.oE(b);return c},getAfter:function(a){n||e();a=n[a];if(c)for(;c.hasOwnProperty(a);)a=c[a];return a},replaceAfter:function(a,b){c||(c={});c[a]=b}})}});define("structure/widget/model/ForestIndex",["almworks/util/Util"],function(f){return function(b){function g(){d={};for(var e=0;e<b.size();e++)d[b.row(e).itemId]= !0}var d;return f.extend(this,{getSource:function(){return b},update:function(){d&&g()},containsItem:function(b){d||g();return d.hasOwnProperty(b)}})}});define("structure/widget/model/ForestUpdateEvent",[],function(){function f(f,d,e){b.assert(0<=d-f);b.assert(0<=e);this.from=f;this.to=d;this.count=e}var b=namespace("almworks.util");f.E="onFUE";return f});define("structure/widget/model/Row",["structure/widget/GlobalSequence"],function(f){function b(b,e){this.id=b;this.depth=e;this.sequence=f.next()}var g=namespace("almworks.util");b.prototype={getId:function(){return this.id},getDepth:function(){return this.depth},clone:function(){return g.extend({},this)},aC:function(b){if(0===b)return this;var e=this.getDepth()+b;if(0>e)throw Error("invalid depth "+this+" delta "+b);b=this.clone();b.depth=e;return b},isSame:function(b){return b===this}};return b});define(
"structure/widget/model/RowFilteringForest",["structure/widget/model/FilteredForest"],function(f){function b(){f.call(this);var b=this,e=null;g.extend(this,{filter:function(a,b,c){var d={};if(!e)return d;for(;b<c;b++)d[b]=e(b,a);return d},setFilter:function(a){e=a;b.cn();g.safeCall(b.decoratingCallback);return b},ai:function(){return e&&e!==g.returnTrue}})}var g=namespace("almworks.util");g.extend(b.prototype,f.prototype);return b});define("structure/widget/model/ItemRow",["structure/widget/model/Row","almworks/util/Util"],function(f,b){function g(d,e,a){b.assert("number"===typeof d);b.assert("number"===typeof e);b.assert(a||0<d,d);b.assert(0<=e,e);f.call(this,d,e)}b.extend(g.prototype,f.prototype,{toString:function(){return ""+this.getId()+":"+this.getDepth()},clone:function(b){b||(b=this.getId());b=new g(b,this.getDepth(),0>this.getId());"undefined"!==typeof this.itemId&&(b.itemId=this.itemId);"undefined"!==typeof this.semantics&&(b.semantics=this.semantics);return b},isSame:function(b){return b instanceof g&&b.id===this.id&&b.depth===this.depth},encode:function(){var b=this.id+":"+this.depth;this.itemId&&(b+=":"+encodeURIComponent(this.itemId));this.semantics&&(b+=":"+
this.semantics);return b},getItemId:function(){return this.itemId}});g.decode=function(d){d=d.match(/^(\d+):(\d+)(?::(.+?))(?::(\d+))?$/);if(!d)return null;var e=new g(b.toInt(d[1]),b.toInt(d[2]));e.itemId=decodeURIComponent(d[3]);e.semantics=b.toIntSafe(d[4],0);return e};return g});define("structure/widget/model/CollapsibleForest",["structure/widget/model/FilteredForest"],function(f){function b(b,a){f.call(this);var n=this;this[d.bu]=function(a){n.debugName&&g.debug(n.debugName+" update rowIds ["+(a&&a.length)+"]");var b=n.source;if(b){var d=1E9,e= -1;if(a)for(var f=0,l=a.length;f<l;f++){var h=b.indexOf(a[f]);0>h||h>=d&&h<e||(d=Math.min(d,h),e=Math.max(e,b.bH(h)))}else d=0,e=b.size();e>d&&n.update({from:d,to:e,count:e-d})}};g.extend(this,{filter:function(a,d,f){var g={};if(d>=f)return g;for(var n=a.dX(d);n<f;)n>=d&&(g[n]= !0),b.isExpanded(a.row(n).getId())?n++ :n=a.bH(n);return g}});a.addListener(new g.Life,this)}var g=namespace("almworks.util"),d=namespace("almworks.structure.appevents");g.extend(b.prototype,f.prototype);return b});define("structure/widget/model/ItemFilteringForest",["underscore","structure/widget/model/RowFilteringForest"],function(f,b){function g(e){b.call(
this);var a=this,g=e.widget.anchorIssue||0,c=e.bh(),p=e.rootPaths,m={},k=[],r={},l=e.widget.bF.lg;a.setFilter(function(a,b){var d=b.row(a),e=d.getId();if(0>e||r[e]||g&&e===g||c&&c.isEditingRow(e))return!0;var m=p.value();if(m&&m.some(function(a){return f.contains(a,e)}))return!0;if((m=l.value())&&m.changes)for(a=0;a<m.changes.length;a++){var t=m.changes[a];if(t&&f.contains(t.parentPathFrom,e)||t&&f.contains(t.parentPathTo,e))return!0}for(var m= !0,t=0,w=k.length;m&&t<w;t++)m=k[t](e,d);return m});d.extend(this,{gy:function(b,c,e){if(m[b]!==c){(m[b]=c)&&(c.ci=e||0);b=[];for(var f in m)if(m.hasOwnProperty(f)&&(c=m[f])){e=c.ci||0;for(var g=0,l=b.length;g<l&& !(e<(b[g].ci||0));g++);b=d.arrayInsert(b,g,c)}k=b;a.cn();d.safeCall(a.decoratingCallback)}},ai:function(){return 0<k.length},pinIssue:function(a){r[a]= !0},removePins:function(){r={}}})}var d=namespace("almworks.util");d.extend(g.prototype,b.prototype);return g});define("structure/widget/model/ColumnsModel",["almworks/util/Util","almworks/jquery","structure/widget/ui/column/ColumnUtil"],function(f,b,g){var d=namespace("almworks.structure.appevents"),e=namespace("almworks.structure.api");return function(a){function n(){var a=
s.vd.value().spec;if(a&&(a=a.columns)){for(var e=[],g=a.length,k=0;k<g;k++){var n=c(a[k]);n&&e.push(n)}b.when.apply(b,e).then(function(){q=f.arrayFilter(f.toArray(arguments),function(a){return! !a});x=f.mapArray(q,function(a){return a.csid});m(!0,!1,null);h.fireEvent(d.ko,l,{columns: !0,columnWidths: !0})})}}function c(a){if(!a)return null;var b=a.csid;if(!b)return null;(b=x[b])&&(b.isColumnOfType(a.key)&&f.deepEquals(a,b.getColumnSpec())||(b=null));b||(b=p(a));return b}function p(a){var c=e.ColumnType.getColumnTypeForKey(a.key);if(!c)return f.warn("cannot create column ["+a.key+"] - no column type registered"),null;var d=b.Deferred(),h=null;g.loadTypeMetadata(c,"column",t).then(function(d){return(h=c.createColumn(g.extendMetadata(f.extendOwn({},t),d),a))?g.loadMetadata(h.getMetadataRequests()):b.Deferred().reject().promise()}).done(function(a){g.extendMetadata(h.context,a)}).always(function(){d.resolve(h)});return d.promise()}function m(a,b,c){if(!f.isEmptyOrFalsy(x)){var e=s.vd.value().widths;if(!f.isEmptyOrFalsy(e)){var g=e.manual||{},k=e.preferred||{};f.eachOwn(x,function(a){var b=this[a];b.setWidth(g[a]||null);b.isAutoSizeAllowed()&&(b._preferredWidth=k[a]||null)});a||
h.fireEvent(d.ko,l,{columnWidths: !0,manualResize:b,kC:c})}}};function k(b){var c,d,e,f,h,g,l=null;c=0;for(d=q.length;c<d;c++)if(e=q[c],e.isAutoSizeAllowed()){f=e.csid;if(b)if(b(e))e._isAutoSized= !0,e._stretchedWidth&&(e._stretchedWidth=null);else continue;else if(e._isAutoSized){l=l||{};l[f]=0<e._preferredWidth?e._preferredWidth:null;continue}h=a.columnClass(c);g=a.panel$.find("div.td."+h+" span.value");g.length&&(h=a.panel$.find("div.th."+h+" div.celldiv span.value"),g=r(g,h),0<g&&(l=l||{},l[f]=g,e._isAutoSized= !0))}return l}function r(a,b){var c=0,d=0,e;a.each(function(){c=Math.max(c,this.clientWidth)});0<c&&(d=b.length&&b.outerWidth(!0),d=Math.min(d,90),d=Math.max(c+32,60,d),e=90<=d?10:5,d=Math.ceil(d/e)*e);return d}var l=this,h=f.nn(a.bD()),u=a.bW(),s={vd:u.mR()},q=[],x={},t=g.createColumnContext(a);a.widget.jiraConfig.load(function(){s.vd.pipe(function(a,b){f.assert(a);b&&a.spec===b.spec?(m(!1,a.ey.manual!==b.ey.manual,a.kC),a.kC=null):n()});var a={};a[d.kE]=function(){var a=k(null);f.isEmptyOrFalsy(a)||u.df({preferred:a},null)};a[d.mh]=function(a){var b,c={},d={},e;a&&a.length?(a=f.flipSet(a),e=function(b){return a[b.csid]},b=k(e),f.eachOwn(a,function(a){c[a]=null;d[a]=b&&
b[a]||null})):(e=s.vd.value().widths,f.eachOwn(e.manual,function(a){c[a]=null}),f.eachOwn(e.preferred,function(a){d[a]=null}),e=f.returnTrue,b=k(e),f.extendOwn(d,b));u.df({manual:c,preferred:d},e)};a[d.STRUCTURE_CHANGED]=function(){q.some(function(a){return a.isStructureDependent()})&&h.postEvent(d.ko,l,{columns: !0})};h.addListener(new f.Life,a)});f.extend(this,{getColumns:function(){return q},eV:function(){return f.find(q,function(a){return a.isColumnOfType("main")})},gj:function(){var a=this.eV();return 0>a?null:q[a]}})}});(function(f){f=namespace("almworks.structure");namespace("almworks.util").extend(f,{ForestUpdateEvent:require("structure/widget/model/ForestUpdateEvent"),Row:require("structure/widget/model/Row"),Forest:require("structure/widget/model/Forest"),DataForest:require("structure/widget/model/DataForest"),ForestDecorator:require("structure/widget/model/ForestDecorator"),FilteredForest:require("structure/widget/model/FilteredForest"),RowFilteringForest:require("structure/widget/model/RowFilteringForest"),ApplicatorForest:require("structure/widget/model/ApplicatorForest"),ForestDelegator:require("structure/widget/model/ForestDelegator"),DecoratorSwitchForest:require(
"structure/widget/model/DecoratorSwitchForest"),ExclusionForest:require("structure/widget/model/ExclusionForest"),ForestIndexer:require("structure/widget/model/ForestIndexer"),bP:require("structure/widget/model/ItemRow"),CollapsibleForest:require("structure/widget/model/CollapsibleForest"),fq:require("structure/widget/model/ItemFilteringForest")})})();define("structure/widget/forests/ForestCache","structure/widget/model/DataForest structure/widget/model/ApplicatorForest structure/widget/model/DecoratorSwitchForest almworks/util/Objects almworks/jquery almworks/util/ObjMap almworks/util/Util almworks/util/JSON".split(" "),function(f,b,g,d,e,a,n,c){function p(a,c){this._spec=a;this._eventBus=c;this._lastUsed=this._refCountWithAffected=this._refCount=0;this.fu=new f;this.cZ=new b;this.cd=new g(this.fu,this.cZ);this._versionCell=new n.Cell({signature:0,version:0});this.dN=e.Deferred();this._forestPromise=this.dN.promise();this._loadError=null}function m(a,b){this._cached=a;this.bj=b}function k(b){this._eventBus=b;this._cache=new a;this._life=new n.Life;var c=this;b.addListener(this._life,r.POLL_RESULT,function(a){a=a&&a.forests;n.isArray(a)&&n.eachValue(a,function(a){var b=a&&a.spec;(
b=b&&c._cache.get(b))&&b.applyUpdate(a)})})}var r=namespace("almworks.structure.appevents");p.prototype.retain=function(a){a&&this._refCountWithAffected++;1=== ++this._refCount&&this._eventBus.fireEvent(r.FOREST_SPEC_ACTIVATED,this._spec,this.getVersion())};p.prototype.release=function(a){a&&this._refCountWithAffected--;0=== --this._refCount&&(this._lastUsed=Date.now(),this._eventBus.fireEvent(r.FOREST_SPEC_DEACTIVATED,this._spec,this.getVersion()))};p.prototype.isActive=function(){return 0<this._refCount&& !this._loadError};p.prototype.getSpec=function(){return this._spec};p.prototype.getForest=function(){return this.fu};p.prototype.dC=function(){return this.cZ};p.prototype.gP=function(){return this.cd};p.prototype.getForestPromise=function(){return this._forestPromise};p.prototype.getVersion=function(){return this.getVersionCell().value()};p.prototype.getVersionCell=function(){return this._versionCell};p.prototype.isCollectingAffectedRows=function(){return 0<this._refCountWithAffected};p.prototype.applyUpdate=function(a){var b= !1,d=this.getVersion(),e=a.version;if(!e||a.error)a.error&&n.warn("server error when loading forest "+c.stringify(this._spec)+": "+a.error.code+" "+
a.error.message);else{if(e.signature===d.signature&&e.version<=d.version)return;try{if(a.total)this.fu.aH(a.rows),b= !0;else if(!n.deepEquals(a.fromVersion,d)){if(a.fromVersion&&a.fromVersion.signature===d.signature&&a.fromVersion.version<d.version)return;n.warn("base version mismatch when downloading update for "+c.stringify(this._spec)+": expected "+c.stringify(d)+", received "+c.stringify(a.fromVersion))}else if(a.empty)b= !0;else if(a.incremental){n.assert(e.signature===d.signature);this.fu.jy();try{this.aY=this.isCollectingAffectedRows()?{}:null,n.eachValue(a.changes,n.withThis(this,this.applyChange)),this.aY&&(this._eventBus.fireEvent(r.AFFECTED_ROWS_IN_UPCOMING_CHANGE,this._spec,this.aY),this.aY=null)}finally{this.fu.ap()}n.assert(e.version===d.version+a.changes.length);b= !0}}catch(f){n.error("problem when updating forest "+c.stringify(this._spec),f)}}b?(this._versionCell.setValue(e),"pending"===this.dN.state()&&this.dN.resolve(this._spec)):0===d.signature?(this._loadError= !0,n.warn("Failed to load forest "+c.stringify(this._spec)),"pending"===this.dN.state()&&this.dN.reject()):this._versionCell.setValue({signature:0,version:0});return b};p.prototype.applyChange=function(
a){var b=a.op;if("add"===b)this.applyAdd(a.rows,a.under,a.after);else if("move"===b)this.applyMove(a.rowIds,a.under,a.after);else if("reorder"===b)this.applyReorder(a.under,a.rowIds);else if("remove"===b)this.applyRemove(a.rowIds);else throw Error("unrecognized update operation "+b);};p.prototype.applyAdd=function(a,b,c){this.fu.cP(a,b,c);if(b=this.aY){c=0;for(var d=a.length;c<d;c++)b[a[c].getId()]= !0}};p.prototype.applyMove=function(a,b,c){var d=this.fu,e=this.aY;b=d.moveSubtreesById(a,b,c);if(e&&b&&(a=b.start,b=b.end,!(0>a)))for(;a<b;a++)e[d.rowId(a)]= !0};p.prototype.applyReorder=function(a,b){this.applyMove(b,a,0)};p.prototype.applyRemove=function(a){for(var b=this.fu,c=this.aY,d=[],e=0;e<a.length;e++){var f=b.indexOf(a[e]);if(0<=f){if(c){var g=c,k=b,m=f,n=b.bH(f);if(!(0>m))for(;m<n;m++)g[k.rowId(m)]= !0}d.push(f)}}b.removeSubtreesAtIndexes(d)};m.prototype.unsubscribe=function(){if(this._cached)try{this._cached.release(this.bj)}finally{this._cached=null}};m.prototype.getForest=function(){return this._cached?this._cached.getForest():null};m.prototype.dC=function(){return this._cached?this._cached.dC():null};m.prototype.gP=function(){return this._cached?this._cached.gP():null};
m.prototype.getForestPromise=function(){return this._cached?this._cached.getForestPromise():null};m.prototype.getVersion=function(){return this._cached?this._cached.getVersion():null};m.prototype.getVersionCell=function(){return this._cached?this._cached.getVersionCell():null};k.prototype.subscribe=function(a,b){a=e.extend(!0,{},a);b= ! !b;var c=this._cache.get(a);c||(c=new p(a,this._eventBus),this._cache.put(a,c));c.retain(b);return new m(c,b)};k.prototype.getActiveSpecs=function(){var a=[];this._cache.each(function(b){b.isActive()&&a.push({spec:b.getSpec(),version:b.getVersion()})});return a};k.prototype.getCurrentVersion=function(a){return(a=this._cache.get(a))&&a.getVersion()};k.prototype.getItemIdByRowId=function(a,b){var c=this._cache.get(a);if(!c)return null;var c=c.getForest(),d=c.indexOf(b);return 0>d?null:c.row(d).itemId};k.prototype.dC=function(a){return(a=this._cache.get(a))&&a.dC()};k.prototype.gP=function(a){return(a=this._cache.get(a))&&a.gP()};return k});define("structure/widget/poll/Deserializer",["underscore","structure/widget/model/ItemRow"],function(f,b){function g(a,b){var c=[];k.eachValue(a,function(a){c.push(d(a,b))});return c}function d(a,b){var c={spec:
a.spec,fromVersion:a.fromVersion,version:a.version},d=a.formula,f=a.updates,g=a.error;if(d)c.total= !0,c.rows=e(d,b);else if(f){c.incremental= !0;var d=[],f=f.split("|"),k,m;for(k=0;k<f.length;k++)(m=n(f[k],b))&&d.push(m);c.changes=d}else c.empty= !0;g&&(c.error={},c.error.code=g.code||0,c.error.message=g.message,c.error.localizedMessage=g.localizedMessage||c.error.message,c.error.error=g.error);return c}function e(c,d){var e=/^(\d+):(\d+):(.+?)(?::(\d+))?$/,f=[],g=c.split(","),m,n,p;for(m=0;m<g.length;m++)if(n=g[m].match(e))p=new b(k.toInt(n[1]),k.toInt(n[2])),p.itemId=a(n[3],d),p.semantics=k.toIntSafe(n[4],0),f.push(p);return f}function a(a,b){if(a.match(/^\d+$/))return a;var c=a.match(/^(\d+)\/(\d+)$/),d;return c?(d=b[c[1]])?d+"/"+c[2]:null:(c=a.match(/^(\d+)\/\/(.+)$/))?(d=b[c[1]])?d+"//"+decodeURIComponent(c[2]):null:null}function n(a,b){var d=a.match(/^a\.(\d+)\.(\d+)\.(.+)/);if(d)return{op:"add",rows:e(d[3],b),under:k.toInt(d[1]),after:k.toInt(d[2])};if(d=a.match(/^m\.(\d+)\.(\d+)\.([0-9,]+)$/))return{op:"move",rowIds:c(d[3]),under:k.toInt(d[1]),after:k.toInt(d[2])};if(d=a.match(/^o\.(\d+)\.([0-9,]+)$/))return{op:"reorder",under:k.toInt(d[1]),rowIds:c(d[2])};if(d=a.match(
/^r\.([0-9,]+)$/))return{op:"remove",rowIds:c(d[1])};k.warn("unrecognized forest change "+a);return null}function c(a){return k.convertArray(a.split(","),k.toInt)}function p(a,b){var c={fromVersion:a.fromVersion,version:a.version},d=a.updated;""===d?c.empty= !0:"*"===d?c.total= !0:(c.incremental= !0,c.updated=m(d,b));return c}function m(b,c){var d=[],e=b.split(","),f,g;for(f=0;f<e.length;f++)(g=a(e[f],c))&&d.push(g);return d}var k=namespace("almworks.util");return{parsePollResponse:function(a){var b=a.itemTypes,c={},d=a.forestUpdates;d&&(c.forests=g(d,b));if(d=a.itemsUpdate)c.items=p(d,b);c.extensionData=a.extensionData;return c},parseForestUpdates:g,parseForestUpdate:d,parseItemForest:e,parseItemsUpdate:p,parseItemList:m,parseItemId:a}});define("structure/widget/poll/Poller","structure/widget/poll/Deserializer underscore jira/util/users/logged-in-user structure/widget/jira/LogoutNotification almworks/util/Util structure/api/StructureCoreExtensionRegistry".split(" "),function(f,b,g,d,e,a){var n=namespace("almworks.structure"),c=namespace("almworks.structure.appevents"),p=e.requireGlobal("JSON");return function(m){function k(){0<K&&B<D&&(U=Date.now()+K)}function r(){var a;!J.isLive(
)||n.modes.DEVMODE||P||l()||X&& !E.value()?a= !1:(a=Date.now(),a=a<U&&a>=V+B? !0: !I&&m.fk.isLoading()||a<V+D||M&&ba&&a<V+G? !1: !0);a&&h(!0,null);return a}function l(){return Y||N||fa||ma.isPollBlocked()||L&& !I? !0: !1}function h(a,d){var e= !d;d=d||u();d=b.filter(d,s);if(d.length){var f=n.ajax.RESOURCES2g.POLL;n.modes.GADGET||(f+="?loggedIn="+A);f=new C.Task(f,n.ajax.DOWNLOAD,b.partial(t,a),w);f.type="POST";var h=b.reduce(d,x,{});f.data=p.stringify(h);f.chainComplete(function(){b.each(d,q);e&&(V=Date.now());v.fireEvent(c.POLL_FINISHED)});C.addTask(f)}};function u(){var a=z.getActiveSpecs();a.push({spec:"items",version:F.getItemsVersion()});var c=ma.getExtensionRequests();b.isEmpty(c)||a.push({extensionRequests:c});return a}function s(a){for(var b=0;b<O.length;b++)if(e.deepEquals(a,O[b]))return!1;O.push(a);return!0}function q(a){for(var b=0;b<O.length;b++)if(e.deepEquals(a,O[b]))return O.splice(b,1),!0;return!1}function x(a,b){"items"===b.spec?(e.assert(!a.items),a.items={version:b.version}):b.jobId?a.jobId=b.jobId:b.extensionRequests?a.extensionRequests=b.extensionRequests:a.forests?a.forests.push(b):a.forests=[b];return a}function t(a,d){a&&l()||(0<I&&I--,d.jobId?b.defer(
function(){h(a,[{jobId:d.jobId}])}):(d=f.parsePollResponse(d))&&v.fireEvent(c.POLL_RESULT,d))}function w(a,b,f){0<I&&I--;401===a.status?(J.detach(),d.show()):e.warn("poll failed ("+a.status+") - "+b);v.fireEvent(c.POLL_ERROR,a,b,f)}var v=m.eventBus,C=m.ajax,z=m.forestCache,F=m.attributeManager,A= !g.isAnonymous(),D=m.config.pollInterval,G=m.config.inactivePollInterval,B=m.config.boostedPollInterval,K=m.config.boostDuration,J=new e.Life,O=[],V=0,U=0,P= !1,Y= !1,N= !1,L= !1,fa= !1,X= !1,M= !1,ba= !0,E=new e.Cell(!1),I=0,ma=a;(function(){var a=b.debounce(k,1E3),d=b.debounce(k,100),e={};e[c.bX]=function(a){P= !a};e[c.dz]=function(){Y= !0};e[c.aN]=function(a,b,c){Y=a.cu()};e[c.ISSUE_DETAILS_EDIT_STARTED]=function(){N= !0};e[c.ISSUE_DETAILS_EDIT_STOPPED]=function(){I=2;N= !1;a()};e[c.JIRA_DIALOG_SHOWN]=function(){L= !0};e[c.gJ]=function(){L= !1;d()};e[c.aE]=function(b){(fa= !b.isIdle())||a()};e[c.jx]=function(b){X= !b;b&&(r()||a())};e[c.cX]=function(){M= !0};e[c.cj]=function(){M= !1;r()};e[c.IFRAME_BLUR]=function(){ba= !0};e[c.IFRAME_FOCUS]=function(){ba= !1;r()};e[c.kD]=d;e[c.FOREST_SPEC_ACTIVATED]=b.partial(h,!1,null);e[c.REQUEST_POLL]=b.partial(h,!1);v.addListener(J,e)})();(function()
{if(0<D){var a=window.setInterval(r,500);J.addDetach(function(){window.clearInterval(a)})}})();this.poll=h;this.iQ=E}});define("structure/widget/attributes/ForestValueCache","almworks/jquery underscore almworks/util/Objects almworks/util/ObjMap almworks/util/ObjSet structure/widget/GlobalSequence structure/widget/attributes/Attributes structure/widget/model/DataForest structure/widget/model/Items".split(" "),function(f,b,g,d,e,a,n,c,p){var m=namespace("almworks.util"),k=function(){function a(b,c){this.setValue(b,c)}f.extend(a.prototype,{setValue:function(a,c,d){d&&m.deepEquals(this._value,a)&&(d=0);this._value=a;b.isEmpty(c)?delete this._trail:this._trail=c;this.setInvalidated(!1);d&&(-1===this._flashTime?delete this._flashTime:this._flashTime=d)},getValue:function(){return this._value},getTrail:function(){return this._trail},markNotLoadable:function(){this._notLoadable= !0},isNotLoadable:function(){return! !this._notLoadable},setInvalidated:function(a){a?this._invalidated= !0:delete this._invalidated},isInvalidated:function(){return! !this._invalidated},setFlashSuppressed:function(){this._flashTime= -1},shouldFlash:function(a){return this._flashTime&&this._flashTime>=a},
removeOldFlashing:function(a){0<this._flashTime&&this._flashTime<a&&delete this._flashTime},getDirtyValue:function(){return this._dirtyValue},setDirtyValue:function(b){this._dirtyValue=b;this.getValue=a.prototype.getDirtyValue},hasDirtyValue:function(){return this.getValue===a.prototype.getDirtyValue},clearDirtyValue:function(){this.hasDirtyValue()&&(delete this._dirtyValue,delete this.getValue);return!1}});return a}(),r=function(){function b(c){this.rowId=c;this.bO=new d;this.dataOutdated=this.dirty=this._innaccessible= !1;this.dataSequence=a.next()}f.extend(b.prototype,{bQ:function(a){if(!g.isObject(a))throw Error("bad attribute spec: "+a);return this.bO.get(a)},getValue:function(a){return(a=this.bQ(a))?a.getValue():void 0},hasValue:function(a){return void 0!==this.getValue(a)},markNotLoadable:function(a){var b=this.bQ(a);b||(b=new k(void 0),this.bO.put(a,b));b.markNotLoadable()},getStringValue:function(a){return(a=this.getValue(a))&&a.toString|| !1===a?a.toString():""},setValue:function(b,c,d,e){var f=this.bO.get(b);f?f.setValue(c,d,e):(f=new k(c,d),this.bO.put(b,f));this.dataSequence=a.next()},setServerValue:function(a,b,c,d){a&&this.setValue(a,b,c,d)},jC:function(b,c){var d=
this.bQ(b);d||(d=new k(void 0),d.setInvalidated(!0),this.bO.put(b,d));d.setDirtyValue(c);this.dirty= !0;this.dataSequence=a.next();return!0},fP:function(b){if(!this.dirty)return!1;b=this.bQ(b);if(!b|| !b.clearDirtyValue())return!1;this.dirty= ! !this.bO.find(function(a){return a.hasDirtyValue()});this.dataSequence=a.next();return!0},deleteValue:function(a){this.bO.remove(a)},isNotLoadable:function(a){return(a=this.bQ(a))?a.isNotLoadable(): !1},isNotAccessible:function(){return! !this._innaccessible},isOutdated:function(){return this.dataOutdated},eB:function(){this.bO.each(function(a){a.setInvalidated(!0)});this.dataOutdated= !0},inaccessible:function(){this._innaccessible= !0;this.bO=new d;this.dataSequence=a.next()},invalidateAttribute:function(a){(a=this.bQ(a))&&a.setInvalidated(!0)},isAttributeInvalidated:function(a){return(a=this.bQ(a))?a.isInvalidated(): !1},hV:function(a){(a=this.bQ(a))&&a.setFlashSuppressed()},shouldFlash:function(a,b){var c=this.bQ(a);return c?c.shouldFlash(b): !1},removeOldFlashing:function(a){this.bO.each(function(b){b.removeOldFlashing(a)})},iW:function(){return! !this.dirty},nA:function(){return this.externalDirty},copyData:function(a,b){var c=this;
a.bO.each(function(a,d){b&& !b(d)||c.setValue(d,a.getValue(),a.getTrail())})},toString:function(){return "{"+this.rowId+"}"}});return b}();return function(a,g,k,s){function q(a){var b=A[a];b||(b=new r(a),A[a]=b);return b}function x(a){m.assert(0>a);delete A[a]}function t(a){a=A[a];if(!a)return!1;a.eB();return!0}function w(b,c,d,e){var f=A[b];f&&(f.invalidateAttribute(c),e&&f.hV(c));d&&d.add(a,b);return c}function v(a,c){D.each(function(a,c){1===a.length&&"SIMPLE"===a[0]||b.each(A,function(a,b){w(b,c,null,!0)})});var d=[];b.each(a.rows,function(a){d.push(a.clone())});B.aH(d);c.setTotal()}function C(c,d){if(!b.isEmpty(c)){B.jy();var e=[];b.each(c,function(b){var c=b.op;("add"===c||"move"===c||"reorder"===c)&&b.under&&e.push(b.under);"add"===c&&b.rows.forEach(function(b){t(b.getId())&&d&&d.add(a,b.getId())});if("remove"===c||"move"===c)for(c=0;c<b.rowIds.length;c++){var f=B.bL(b.rowIds[c]);f&&e.push(f)}z(b)});B.ap();F(e,d)}}function z(a){var b=a.op;"add"===b?B.cP(a.rows,a.under,a.after):"move"===b||"reorder"===b?B.moveSubtreesById(a.rowIds,a.under,"reorder"===b?0:a.after):"remove"===b&&B.oW(a.rowIds)}function F(a,c){if(!b.isEmpty(a)){var d=[],e=[];D.each(function(a,c){b.contains(a,
"AGGREGATE")&&d.push(c);b.contains(a,"PROPAGATE")&&e.push(c)});if(d.length||e.length){var f=m.flipSet(a),g={},h={};b.each(f,function(a,c){var d=B.indexOf(c),e=B.aI(d),f=e;for(h[d]= !0;-1<f&& !b.has(h,f);)h[f]= !0,f=B.aI(f);f=e;if(!b.has(g,f)){e=[];g[f]=e;for(var k=0<=f?B.bH(f):B.size(),d=f+1;d<k;d++)e.push(B.rowId(d))}});b.each(b.keys(h),function(a){for(var b=0;b<d.length;b++)w(B.rowId(a),d[b],c)});b.each(b.flatten(b.values(g)),function(a){for(var b=0;b<e.length;b++)w(a,e[b],c)})}}}var A={},D=new d,G=g.subscribe(a),B=new c(G.getForest().cloneRows()),K=G.getVersion(),J=b.throttle(m.delayed(k+100,function(){var a=(new Date).getTime();b.each(A,function(b){b.removeOldFlashing(a)})}),s);f.extend(this,{getRowData:function(a){return A[a]},requireRowData:q,prepareRowDataForNew:function(a,b){m.assert(0>a);q(a).setValue(n.SUMMARY_TEXT,b||"")},kJ:function(a,b,c){m.assert(0>a);var d=A[a];if(d){var f=function(a){return a&&a.id&&c[a.id]};if(b.sample&&"clone"===b.mode)(a=A[b.sample])&&d.copyData(a,f);else{var g=new e;d.bO.each(function(a,b){f(b)&&g.add(b)});b.pid?d.setValue(n.PROJECT_ID,""+b.pid):g.add(n.PROJECT_ID);b.issuetype?d.setValue(n.ISSUETYPE_ID,""+b.issuetype):g.add(n.ISSUETYPE_ID);
g.each(function(a){d.setValue(a,"")})}}},replaceRowData:function(a,b){var c=A[a];if(!c)return!1;if(!b)return m.assert(0>a,a),x(a),!1;var d=q(b);c.bO.each(function(a,b){d.setValue(b,a.getValue())});d.eB();0>a&&x(a);return!0},removeRowData:x,getRowAttributeValue:function(a,b){var c=A[a];return c?c.getValue(b):void 0},jC:function(a,b,c){return(a=A[a])?a.jC(b,c): !1},fP:function(a,b){var c=A[a];return c?c.fP(b): !1},hs:function(a,b){var c=A[a];c&&c.dirty&&(c.bO.each(function(a,c){a.hasDirtyValue()&&(b&&(a._value=a._dirtyValue,a.setInvalidated(!0),a.setFlashSuppressed()),a.clearDirtyValue())}),c.dirty= !1)},invalidateByForestUpdate:function(a,b){a&&(K=a.version,a.empty||(a.total?v(a,b):C(a.changes,b)))},invalidateByItemsUpdate:function(c,d){if(c.total)b.each(A,function(a,b){t(b)});else{var e=c.updated;if(!b.isEmpty(e)){var f=[];B.eachRow(function(a){a=a.itemId;if(p.isLoopMarker(a)){var c=B.row(B.indexOf(p.getLongId(a)));b.contains(e,c&&c.itemId)&&f.push(a)}});e=e.concat(f);b.each(A,function(c,f){var g=B.row(B.indexOf(f));if(g){var h=A[f];b.contains(e,g.itemId)?(h.eB(),d.add(a,f)):b.each(e,function(a){h.bO.each(function(c,e){b.contains(c.getTrail(),a)&&w(f,e,d)})})}});for(var g=[],h=
B.size(),k=0;k<h;k++){var m=B.row(k);b.contains(e,m.itemId)&&g.push(m.id)}F(g,d)}}},getForestSpec:function(){return a},applyValueUpdate:function(a,c,d,f){if(!b.isEmpty(a)&& !b.isEmpty(c)){b.isArray(d)||(d=[]);b.isArray(f)||(f=[]);var g=Date.now()+k,h,l,n,p,q;q=m.flipSet(d);var r={};for(h=0;h<a.length;h++)p=a[h],(n=A[p])&& !n.dirty&&(n.dataOutdated= !1,q[p]?r[p]= !0:n.inaccessible());var s=new e;for(h=0;h<f.length;h++){n=f[h];q=n.attribute;s.add(q);var t=n.values;D.put(q,n.trailMode);var x=n.trails;for(l=0;l<d.length;l++)if(p=d[l],r[p]){var F=t[l],z=x[l];n=A[p];n.setServerValue(q,F,z,g)}}for(h=0;h<c.length;h++)if(q=c[h],!s.contains(q))for(l=0;l<a.length;l++)p=a[l],(n=A[p])&&(n.dirty||n.isNotAccessible()||n.markNotLoadable(q));J()}},unsubscribe:function(){G.unsubscribe()},getForestVersion:function(){return K},markAllRowsWithItemExternalDirty:function(a){var b={};B.getRowsWithItemId(a).forEach(function(a){var c=A[a];c&&(c.externalDirty= !0,b[a]= !0)});return b},clearExternalDirty:function(a){b.each(a,function(a,b){var c=A[b];c&&(c.externalDirty= !1)})}})}});define("structure/widget/attributes/AttributeSpecNormalization",["underscore","almworks/util/Util"],function(f,b){function g(a,b)
{var m=b,k,n;for(k in a)if(a.hasOwnProperty(k)){m= !1;n=a[k];if(!1===n||null===n||0===n||void 0===n)return!0;if(e(n)){if(0===n.length||d(n))return!0}else if(f.isObject(n)&&g(n,!0))return!0}return m}function d(a){var b,m=a.length;for(b=0;b<m;b++){var k=a[b];if(k)if(e(k)){if(d(k))return!0}else if(f.isObject(k)&&g(k,!1))return!0}return!1}function e(a){return "number"===typeof a.length&&f.isArray(a)}function a(b){var d,g,k= !1,r;for(d in b)b.hasOwnProperty(d)&&(g=b[d],(r= !1===g||null===g||0===g||void 0===g)||(e(g)?0===g.length?r= !0:n(g):f.isObject(g)&&(r= !a(g))),r?delete b[d]:k= !0);return k}function n(b){var d,g=b.length,k;for(d=0;d<g;d++)(k=b[d])&&(e(k)?n(k):f.isObject(k)&&a(k))}return{normalizeSpec:function(c){if(!c|| !c.hasOwnProperty("params"))return c;if(!c.params)return c=b.clone(c),delete c.params,c;if(!g(c.params,!0))return c;c=b.deepClone(c);a(c.params)||delete c.params;return c}}});define("structure/widget/attributes/AttributeManager",
"underscore almworks/jquery almworks/util/Objects almworks/util/ObjMap almworks/util/ObjSet almworks/util/Util almworks/util/JSON structure/widget/GlobalSequence structure/widget/attributes/Attributes structure/widget/attributes/ForestValueCache structure/widget/columns/MainColumn structure/widget/attributes/AttributeSpecNormalization structure/widget/spec/SpecController".split(" "),function(f,b,g,d,e,a,n,c,p,m,k,r,l){function h(a,b){if(!g.isObject(a))throw Error("bad attribute spec: "+a);if(!p.isDisplayed(b)&& !p.isUnfiltered(b)&& !g.isObject(b))throw Error("bad forest spec: "+b);}var u=namespace("almworks.structure.appevents"),s=function(){function a(){this.bv=new e;this.bE=new e;this._map=new d}b.extend(a.prototype,{requireAttribute:function(a,b){a&&(h(a,b),a=r.normalizeSpec(a),p.isDisplayed(b)?this.bv.add(a):p.isUnfiltered(b)?this.bE.add(a):this._map.require(b,function(){return new e}).add(a))},copy:function(){var b=new a;b.bv.addAll(this.bv);b.bE.addAll(this.bE);this._map.each(function(a,c){b._map.put(c,new e(a))});return b},addAll:function(a){if(a){var b=this;b.bv.addAll(a.bv);b.bE.addAll(a.bE);a._map.each(function(a,c){b._map.require(c,function(){return new e}).addAll(a)})}}
,isEmpty:function(){return this.bv.isEmpty()&&this.bE.isEmpty()&&this._map.isEmpty()},toString:function(){var a="";this.bv.isEmpty()||(a="displayed: "+this.bv);this.bE.isEmpty()||(a&&(a+="; "),a+="unfiltered: "+this.bE);this._map.each(function(b,c){b&& !b.isEmpty()&&(a&&(a+="; "),a+=g.idString(c)+": "+b)});return a}});return a}(),q=function(){function a(b,c,d,e,f,g){this._displayedRowData=b;this._unfilteredRowData=c;this._rowDataMap=d;this._shouldRender=e;this._dataSequence=this.aU(g||0);this._notAccessible=f}function c(a,b){if(!b)return a;var d=b.dataSequence;return a<d?d:a}b.extend(a.prototype,{getValue:function(a,b){var c=this.aR(a,b);return c?c.getValue(r.normalizeSpec(a)):void 0},hasValue:function(a,b){var c=this.aR(a,b);return c?c.hasValue(r.normalizeSpec(a)): !1},aU:function(a){var b=a,b=c(b,this._displayedRowData),b=c(b,this._unfilteredRowData);this._rowDataMap.each(function(a){b=c(b,a)});return b},getDataSequence:function(){return this._dataSequence},shouldRender:function(){return this._shouldRender||this._notAccessible},shouldFlash:function(a,b,c){return(b=this.aR(a,b))?b.shouldFlash(r.normalizeSpec(a),c): !1},isNotAccessible:function(){return this._notAccessible},aR:
function(a,b){h(a,b);return p.isDisplayed(b)?this._displayedRowData:p.isUnfiltered(b)?this._unfilteredRowData:this._rowDataMap.get(b)}});return a}(),x=function(){function c(a,b){this._index= ++l;this.bJ=this.bS=null;this.bp=[];this._handlers=[];this.bV=a;this._eventBus=b;this._completelyLoaded={}}function g(a,b){return!b||a.size()>b.size()? !0: ! !a.find(function(a,c){return!b.hasKey(c)})}function h(a,b){return!b||a.size()>b.size()? !0: ! !a.find(function(a){return!b.contains(a)})}var l=0;b.extend(c.prototype,{setDisplayedForestSpec:function(b){a.deepEquals(b,this.bS)||(this.bS=b,this.bp=[],this._completelyLoaded={},this.bV._maybeForestSpecUnused())},setUsedAttributes:function(a){var b=this._getAttrMap();a.requireAttribute(p.SUMMARY_TEXT);this.bJ=a.copy();a=this._getAttrMap();var c= !b||a.size()>b.size();c||a.find(function(a,d){var e=b.get(d);return c=h(a,e)});c&&(this._completelyLoaded={},this._eventBus.postEvent(u.VALUES_REQUIRED));g(b,a)&&this.bV._maybeForestSpecUnused()},getUsedAttributes:function(){return this.bJ&&this.bJ.copy()},setUsedRows:function(b){var c=a.flipSet(this.bp);this.bp=a.numericKeys(b);var d={};f.each(this.bp,function(a){c[a]||(d[a]= !0)});f.isEmpty(d)||
this._eventBus.postEvent(u.VALUES_REQUIRED);return a.numericKeys(d)},getUsedRows:function(){return this.bp.slice()},addDataUpdateHandler:function(a,b){this._handlers.push(a);var c=this;b&&b.life&&(b=b.life());b&&b.addDetach(function(){c._handlers=f.without(c._handlers,a)})},getValueAccessor:function(a){var b=this.bS;if(this.dj()|| !f.contains(this.bp,a))return null;var c=this.bV,e=c.aR(b,a),g;if(this.cw()){g=c.dh(b);var h=c._getMappedRowId(g,a,b);g=c.aR(g,h)}var l=new d;this.bJ._map.each(function(d,e){var f=c._getMappedRowId(e,a,b),f=c.aR(e,f);l.put(e,f)});var h=e&&k.canRender(e),m=e&&e.isNotAccessible();return new q(e,g,l,h,m,c._mappingSequences[a]||0)},fillTempRowData:function(b,c,d){if(!this.dj()&&b&& !b.dj()&&c&&d&&(f.contains(this.bp,d)||this.bp.push(d),this._copyRowData(b.bS,c,this.bS,d),this.cw())){var e=this.bV.dh(b.bS);if(b=this.bV._getMappedRowId(e,c,b.bS))c=this.bV.dh(this.bS),this._copyRowData(e,b,c,d),a.deepEquals(this.bS,c)||(e=this.bV._rowMaps.require(c,function(){return new t}),e.forwardMap[d]=d,(b=e.backwardMap[d])||(b=e.backwardMap[d]={}),b[d]= !0)}},_dataUpdated:function(a){f.isEmpty(a)||f.each(this._handlers,function(b){b(a)})},cw:function(){return this.bJ? !
this.bJ.bE.isEmpty(): !1},cI:function(a){var b=this;if(!a.isFull()&& !b.dj()&& !f.isEmpty(b.bp)){var c=b.bJ.bv,d=b.bS,e;b.cw()&&(e=this.bV.dh(d));f.each(b.bp,function(g){if(!(!g||0>g||a.isFull()||f.has(b._completelyLoaded,g))){var h=b.cJ(a,g,c,d);if(e){var l=b.dG(a,e,g,d),h=h||void 0===l;l&&(h=b.cJ(a,l,b.bJ.bE,e)||h)}b.bJ._map.each(function(c,e){var f=b.dG(a,e,g,d);h=h||void 0===f;f&&(h=b.cJ(a,f,c,e)||h)});h||(b._completelyLoaded[g]= !0)}})}},cJ:function(a,b,c,d){var e=this.bV.el(d,b);if(e.isNotAccessible())return!1;var f=e.isOutdated(),g= !1,h=a.eE(),l=this.bV.isForestSpecCoherent(d);c.each(function(c){!h&&g|| !f&&e.hasValue(c)&& !e.isAttributeInvalidated(c)||e.isNotLoadable(c)||(l&&a.requireValue(d,b,c),g= !0)});return g},dG:function(b,c,d,e){if(a.deepEquals(c,e))return d;e=this.bV._rowMaps.require(c,function(){return new t});if(f.has(e.forwardMap,d))return b=e.forwardMap[d],0<=b?b:0;b.requireMapping(c,d)},dn:function(c){if(!c.isEmpty()&& !this.dj()){var d=this;if(c.total)d._completelyLoaded={};else{var e=this.cW(),g={};c.data.each(function(c,h){var l=a.deepEquals(h,d.bS),k;if(!l){var m=d.bV._rowMaps.get(h);if(m)k=m.backwardMap;else return}e.contains(h)&&f.each(c,function(a,c){l?
g[c]= !0:k&&b.extend(g,k[c])})});f.each(g,function(a,b){delete d._completelyLoaded[b]})}}},cW:function(){var a=new e;if(this.dj())return a;a.add(this.bS);if(this.cw()){var b=this.bV.dh(this.bS);a.add(b)}this.bJ._map.each(function(b,c){a.add(c)});return a},_getAttrMap:function(){var a=new d;if(this.dj())return a;a.put(this.bS,new e(this.bJ.bv));if(this.cw()){var b=this.bV.dh(this.bS);a.require(b,function(){return new e}).addAll(this.bJ.bE)}this.bJ._map.each(function(b,c){a.require(c,function(){return new e}).addAll(b)});return a},_copyRowData:function(a,b,c,d){c&&d&&a&&b&&(a=this.bV.aR(a,b))&&this.bV.el(c,d).copyData(a)},dj:function(){return!this.bS|| !this.bJ||this.bJ.isEmpty()},toString:function(){return "subscription#"+this._index}});return c}(),t=function(){function a(){this.forwardMap={};this.backwardMap={}}b.extend(a.prototype,{eW:function(a,b,c){var d=this;f.isEmpty(a)||(c&&b&&c.length===b.length?f.each(a,function(a){var e=f.indexOf(b,a);if(0<=e){if(e=c[e],d.forwardMap[a]=e){var g=d.backwardMap[e];g||(g=d.backwardMap[e]={});g[a]= !0}}else d.forwardMap[a]= -1}):this.markAllNotLoadable(a))},markAllNotLoadable:function(a){var b=this;f.each(a,function(a){b.forwardMap[a]= -1})}});
return a}(),w=function(){function a(){this.data=new d;this.total= !1}b.extend(a.prototype,{setTotal:function(){this.total= !0},add:function(a,b){this.data.require(a,function(){return{}})[b]= !0},isEmpty:function(){return!this.total&&this.data.isEmpty()}});return a}(),v=function(){function g(b,c,e,f,h){this._eventBus=b;this.dm=c;this._transformRegistry=e;this._flashTimeout=f;this.cp=h;this._subscriptions=[];this._caches=new d;this.cF={signature:0,version:0};this._rowMaps=new d;this._mappingSequences={};this.dO=new d;this._delayedReloadValues=a.delayed(10100,function(){this._eventBus.fireEvent(u.VALUES_REQUIRED)},this);this._init()}b.extend(g.prototype,{subscribe:function(a){var b=this._subscriptions,c=new x(this,this._eventBus);b.push(c);a&&a.addDetach(function(){b=f.without(b,c)});return c},getAttributeValue:function(a,b,c){return(a=this.aR(a,b))?a.getValue(r.normalizeSpec(c)):void 0},getItemsVersion:function(){return this.cF},collectAllUsedAttributes:function(a){f.each(this._subscriptions,function(b){a.addAll(b.bJ)})},fillRequestMatrix:function(a){f.each(this._subscriptions,function(b){b.cI(a)})},isForestSpecCoherent:function(a){var b=this.dO.get(a);if(!b)return!0;if(b>=Date.now()
)return!1;this.dO.remove(a);return!0},updateValues:function(c,d){function e(a){(a=k.backwardMap[a])&&b.extend(l,a)}var g=this;if(!f.isEmpty(c)){var h=g._ignoreUpdate(d),l={},k;f.each(c,function(c){if(c&&c.forestSpec&& !f.isEmpty(c.requestedRowIds)){var d=g._getForestCache(c.forestSpec);if(d){var m=d.getForestVersion();m&&c.forestVersion.signature===m.signature?c.forestVersion.version<m.version||h||(d.applyValueUpdate(c.requestedRowIds,c.requestedAttributes,c.receivedRowIds,c.attributeDataList),b.extend(l,a.flipSet(c.requestedRowIds)),(k=g._rowMaps.get(c.forestSpec))&&f.each(c.receivedRowIds,e)):g.cY(c.forestSpec)}}});f.isEmpty(l)||f.each(g._subscriptions,function(a){a._dataUpdated(l)})}},updateMapping:function(b,d,g,h){var l=this;if(b&& !l._ignoreUpdate(h)&& !f.isEmpty(d)&& !f.isEmpty(g)){var k=new e;f.each(b.mappings,function(a){if(a&&a.forestSpec){k.add(a.forestSpec);var c=l._rowMaps.get(a.forestSpec);c&&c.eW(d,b.rows,a.mappedRows)}});f.each(g,function(a){k.contains(a)||(a=l._rowMaps.get(a))&&a.markAllNotLoadable(d)});f.each(b.rows,function(a){l._mappingSequences[a]=c.next()});f.each(this._subscriptions,function(c){c._dataUpdated(a.flipSet(b.rows))})}},ig:function(a,b,c,d){var e=
void 0===d;if(a=e?this._getForestCache(a):this.ed(a))c=r.normalizeSpec(c),e?a.fP(b,c):a.jC(b,c,d)},clearAllDirtyFields:function(a,b,c){(a=this._getForestCache(a))&&a.hs(b,c)},prepareRowDataForNew:function(a,b,c){this.ed(a).prepareRowDataForNew(b,c)},kJ:function(a,b,c,d){this.ed(a).kJ(b,c,d)},markAllRowsWithItemExternalDirty:function(b){var c={};this._caches.each(function(d){d=d.markAllRowsWithItemExternalDirty(b);a.extend(c,d)});return c},clearExternalDirty:function(a){this._caches.each(function(b){b.clearExternalDirty(a)})},_init:function(){var a=this,b={};b[u.POLL_RESULT]=function(b){a.cN(b)};b[u.REPLACE_ROW_IDS]=function(b,c,d){var e= !1;a._caches.each(function(a,f){if(l.areUntransformedSpecsEqual(d,f))for(var g=0,h=b.length;g<h;g++)e|=a.replaceRowData(b[g],c[g])});e&&a._eventBus.postEvent(u.VALUES_REQUIRED)};a._eventBus.addListener(null,b)},cN:function(a){if(a){var b=new w;this.di(a.forests,b);this.du(a.items,b);f.each(this._subscriptions,function(a){a.dn(b)});a=this.de(a.forests);b.isEmpty()&& !a||this._eventBus.postEvent(u.VALUES_REQUIRED)}},di:function(a,b){var c=this;f.each(a,function(a){if(a&&a.spec){var d=c._getForestCache(a.spec);d&&d.invalidateByForestUpdate(a,b)}})},
du:function(a,b){a&&(this.cF.signature!==a.version.signature&&(this._rowMaps=new d),this.cF=a.version,a.empty||(a.total&&b.setTotal(),this._caches.each(function(c){c.invalidateByItemsUpdate(a,b)})))},_getForestCache:function(a){return this._caches.get(a)},ed:function(a){var b=this._getForestCache(a);if(b)return b;b=new m(a,this.dm,this._flashTimeout,this.cp);this._caches.put(a,b);return b},aR:function(a,b){var c=this._getForestCache(a);return c?c.getRowData(b):null},el:function(a,b){return this.ed(a).requireRowData(b)},_getMappedRowId:function(b,c,d){if(a.deepEquals(b,d))return c;b=this._rowMaps.get(b);return b?(c=b.forwardMap[c])&& -1!==c?c:0:0},_ignoreUpdate:function(a){var b=this.cF;return a.signature!==b.signature||a.version<b.version},_maybeForestSpecUnused:function(){var a=new e;f.each(this._subscriptions,function(b){b=b.cW();a.addAll(b);b.each(function(b){a.add(l.getUntransformedSpec(b))})});var b=new e;this._caches.each(function(c,d){a.contains(d)||(c.unsubscribe(),b.add(d))});var c=this;b.each(function(a){c._caches.remove(a)})},dh:function(a){var c={};b.extend(c,a);delete c.transforms;a=f.reject(a.transforms,this._transformRegistry.isFilter);f.isEmpty(a)||(c.transforms=a);
return c},cY:function(b){a.warn("incoherent forest spec: "+n.stringify(b));this.dO.put(b,Date.now()+1E4);this._delayedReloadValues()},de:function(a){if(this.dO.isEmpty())return!1;var b=this,c= !1;f.each(a,function(a){a&&a.spec&&a.total&&(a=l.getSpecForAttributes(a.spec),b.dO.hasKey(a)&&(c= !0,b.dO.remove(a)))});return c}});return g}();v.AttributeSet=s;v.RowMap=t;return v});define("structure/widget/attributes/DataLoader","underscore almworks/jquery almworks/util/ObjMap almworks/util/ObjSet structure/widget/poll/Deserializer structure/widget/attributes/RequestLoader".split(" "),function(f,b,g,d,e,a){function n(d){function g(){var a=x.loadingCell.value(),b=t.loadingCell.value();if(!a|| !b){var d=new k(a?0:100,b?0:100);w.fillRequestMatrix(d);a||h(d._missingValueMap);b||(a=d._missingMapping,f.isEmpty(a.rowSet)||(b={},b.forestSpecs=a.specSet.toArray(),b.rows=m.numericKeys(a.rowSet),t.load(c.ajax.RESOURCES2g.MAPPING,b,m.curry(s,b))))}}function h(a){if(!a.isEmpty()){var b=[];a.each(function(a,c){var d={};d.forestSpec=c;d.rows=m.numericKeys(a.rowSet);d.attributes=a.attrSet.toArray();b.push(d)});x.load(c.ajax.RESOURCES2g.VALUE,{requests:b},m.curry(n,b))}}function n(a,b){function c(a){
return a?e.parseItemList(a,k):[]}var d,g,h,l,k,p={version:0,signature:0};if(b&&b.responses){var q=b.responses;k=b.itemTypes;var u=[];m.assert(a.length===q.length);b.itemsVersion&&(p=b.itemsVersion);for(d=0;d<q.length;d++){h=a[d];l=q[d];var r=[],s=l.data;if(s&&s.length)for(g=0;g<s.length;g++){var t=s[g],x=f.map(t.trails,c),v=t.trailMode,t={attribute:t.attribute,values:t.values||[],trails:x,trailMode:v&&v.split(",")||[]};r.push(t)}u.push({forestSpec:l.forestSpec,requestedRowIds:h.rows,requestedAttributes:h.attributes,receivedRowIds:l.rows||[],attributeDataList:r,forestVersion:l.forestVersion})}w.updateValues(u,p)}else d=f.map(a,function(a){return{forestSpec:a.forestSpec,requestedRowIds:a.rows,requestedAttributes:a.attributes,receivedRowIds:[],attributeDataList:[]}}),w.updateValues(d,p)}function s(a,b){var c={rows:b.rows,mappings:[]};f.each(b.mappings,function(a){a&&a.forestSpec&&c.mappings.push({forestSpec:a.forestSpec,mappedRows:a.mappedRows||[]})});w.updateMapping(c,a.rows,a.forestSpecs,b.itemsVersion)}var q=d.eventBus,x=new a(d,this),t=new a(d,this),w=d.attributeManager,v=new m.Cell(x.loadingCell,t.loadingCell,m.or);v.pipeChanges(function(){q.fireEvent(
p.ROW_DATA_LOADING_STATE_CHANGED)});d=m.delayed(25,g);q.addListener(new m.Life,p.VALUES_REQUIRED,d);b.extend(this,{loadData:g,isLoading:function(){return v.value()}})}var c=namespace("almworks.structure"),p=namespace("almworks.structure.appevents"),m=namespace("almworks.util"),k=function(){function a(b,c){this._maxValueRowCount=b;this._maxMappingRowCount=c;this._missingValueMap=new g;this._missingMapping={rowSet:{},specSet:new d};this._mappingRowCount=this._valueRowCount=0}b.extend(a.prototype,{requireValue:function(a,b,c){a&&b&&c&&this.eE()&&(a=this._missingValueMap.require(a,function(){return{rowSet:{},attrSet:new d}}),a.attrSet.add(c),f.has(a.rowSet,b)||(a.rowSet[b]= !0,this._valueRowCount++))},requireMapping:function(a,b){if(a&&b&&this.fz()){this._missingMapping.specSet.add(a);var c=this._missingMapping.rowSet;f.has(c,b)||(c[b]= !0,this._mappingRowCount++)}},eE:function(){return this._valueRowCount<this._maxValueRowCount},fz:function(){return this._mappingRowCount<this._maxMappingRowCount},isFull:function(){return!this.eE()&& !this.fz()}});return a}();n.RequestMatrix=k;return n});define("structure/widget/attributes/RequestLoader",["underscore","almworks/jquery",
"almworks/util/Util"],function(f,b,g){var d=namespace("almworks.structure");return function(e,a){function n(a,b){var c=g.httpErrorReport(a,b);l.reportError(new d.error.AppError(g.text("sw.error.data-load",c.title),"\n\n"+c.details))}function c(a,b,c){a=new r.Task(a,d.ajax.DOWNLOAD,g.curry(p,a,c),m);a.type="POST";a.data=d.apputil.ct(b);r.addTask(a)}function p(b,d,e){e.jobId?f.defer(function(){c(b,{jobId:e.jobId},d)}):(g.safeCall(d,void 0,e),h.setValue(!1),u=0,a.loadData())}function m(b,c,d){u++;3600<=u||k(b,c)?n(b,c):(s=1>=u?1E3:Math.min(2*s,6E4),g.warn("data loading failed, backing off for "+s),setTimeout(function(){h.setValue(!1);a.loadData()},s))}function k(a,b){var c=a&&a.status||0;return 500===c||404===c}var r=e.ajax,l=e.errorCentral,h=new g.Cell(!1),u=0,s=0;b.extend(this,{load:function(a,b,d){h.value()||(h.setValue(!0),c(a,b,d))},loadingCell:h})}});define("structure/widget/clipboard/Clipboard","structure/widget/model/Rows structure/widget/model/Forest structure/widget/model/DataForest structure/widget/model/ForestUpdateEvent structure/widget/attributes/AttributeManager almworks/util/JSON almworks/util/Util underscore".split(" "),function(f,b,g,d,e,a,n,c){function p(e){
function f(){var b=l.getStored("clip")||null;if(b=a.safeParse(b)){var d=b.from,e=b.ids,g=b.cut;if(d&&c.isObject(d.spec)&&c.isNumber(d.signature)&&c.isArray(e)&&(c.isBoolean(g)||c.isUndefined(g)))return b}return null}function m(){var a=z.getVersion().version;if(0<a&&F.isEmpty())K.setValue(null);else{var d=K.value(),e=f();if(e){var h=w.subscribe(e.from.spec);h.getForestPromise().done(function(l){c.defer(c.bind(h.unsubscribe,h));if((e=f())&&n.deepEquals(l,e.from.spec))if(h.getVersion().signature!==e.from.signature)K.setValue(null);else{l=h.gP();var m=c.map(e.ids,c.bind(l.indexOf,l)),p=c.object(e.ids,m),m=c.filter(e.ids,function(a){return 0<=p[a]});e.ids=c.sortBy(m,function(a){return p[a]});l=e.cut?r(e.ids,l):k(e.ids,l);l.length?(e.forest=new g(l),d&&0!==a&&d.cut===e.cut&&n.deepEquals(d.from.spec,e.from.spec)&&b.equals(d.forest,e.forest)||K.setValueForced(e)):A.isEmpty()||K.setValue(null)}})}else K.setValue(null)}}function x(a){l.bG.call(this,void 0,[p.CLIPBOARD_SPEC]);this.spec={action:"add",forest:b.encode(a)};this.forestAdjustment=function(b){b.aH(a?a.as():[])}}var t=e.ad,w=e.forestCache,v=e.eventBus,C=e.attributeManager.subscribe(),z=w.subscribe(p.CLIPBOARD_SPEC),F=z.getForest(),A=
z.gP(),D=new g,G=new n.Lifecycle,B,K=(new n.Cell).pipeChanges(function(a){var b=K.value();b?l.setStored("clip",l.apputil.ct({cut:b.cut,from:b.from,ids:b.ids})):l.setStored("clip","");l.setStored("clip","",!0);G.cycle();D.clear();a?(D.append(a.forest.as()),t.enqueue(new x(a.forest)),C.setUsedRows(n.flipSet(a.forest.aD())),B&&B.unsubscribe(),(B=a.cut?w.subscribe(a.from.spec):null)&&B.gP().events.addListener(G,d.E,n.delayed(10,m))):(B&&B.unsubscribe(),A.isEmpty()||t.enqueue(new x(null)))}),J=(new n.Cell).pipeChanges(function(a,b){v.fireEvent(h.be,b,a)});D.events.addListener(new n.Life,d.E,function(){J.setValue(D.aD())});z.getForestPromise().done(function(){m();z.getVersionCell().pipeDebounced({wait:100,waitInit:100,immediateCall: !1},function(a){0===a.version&&F.clear();m()})});A.events.addListener(null,d.E,function(){var a=K.value();A.isEmpty()?D.clear():a&&D.aH(a.forest.as())});t.aF({dw:function(b){b=b[0];if(!(b instanceof x))return null;var c;b.jobId?(c={jobId:b.jobId},b.jobId=null):c={spec:p.CLIPBOARD_SPEC,version:z.getVersion(),actions:[b.spec]};return{count:1,cB: !0,url:l.ajax.RESOURCES2g.FOREST.UPDATE,data:a.stringify(c)}}});n.extend(x.prototype,l.bG.prototype,{bN:function(a){
return this.forestAdjustment}});return n.extend(this,{getForest:function(){return D},getCutFrom:function(){var a=K.value();return a&&a.cut&&B&&{rowIds:a.forest.hf(),spec:a.from.spec,version:B.getVersion()}},getSpecFrom:function(){var a=K.value();return a&&a.from.spec},isCutMode:function(){var a=K.value();return a&&a.cut},contains:function(a){return this.getForest().contains(a)},clear:function(){K.setValue(null)},fillAttributeValues:function(a,b){for(var c=0,d=D.size();c<d;c++){var e=D.rowId(c);a.fillTempRowData(C,e,b?b[e]:e)}},putRows:function(a,b,c,d){var e=c.getVersionedSpec();a={cut:d,ids:a,forest:new g(b),from:{spec:n.extend({},e.spec),signature:e.version.signature}};C.setDisplayedForestSpec(c.getSpecForAttributes());C.setUsedAttributes(c.getAttributeSubscription().getUsedAttributes());K.setValue(a)}})}function m(a,b){var c=n.flipSet(a),d,e,f,g,h,l;if(!a.length)return c;d=b.indexOf(a[0]);if(0>d)return c;e=b.indexOf(a[a.length-1]);if(e<d)return c;for(f=g= -1;d<=e;d++)if(h=b.row(d),l=h.getId(),h=h.getDepth(),h<=f?f=g= -1:h<=g&&(g=h-1),c[l]){if(0>l)return null;if(0>f)f=g=h,c[l]=0;else{if(h>g+1)return null;g=h;c[l]=h-f}}return c};function k(a,b){var c=m(a,b);if(!c)return[];var d=
[],e,f;a.forEach(function(a){e=b.aL(a);f=c[a];"number"===typeof f&&0<=f&&(a=new l.bP(a,f,0>a),a.itemId=e.itemId,d.push(a))});return d}function r(a,b){var c=[],d={};a.forEach(function(a){d[a]||b.dg(a).forEach(function(a){d[a.getId()]||(d[a.getId()]= !0,c.push(a))})});return c}var l=namespace("almworks.structure"),h=namespace("almworks.structure.appevents");p.getRowsForCopy=k;p.getRowsForCut=r;p.CLIPBOARD_SPEC={type:"clipboard"};return p});define("structure/ui/details/ItemDetails","almworks/jquery underscore almworks/util/JSON almworks/util/LRUCache almworks/util/Template almworks/util/Util structure/widget/attributes/Attributes structure/widget/model/Items structure/widget/model/PageId structure/widget/ui/editor/EditorUtil structure/widget/util/NavigationHint almworks/util/I18n".split(" "),function(f,b,g,d,e,a,n,c,p,m,k,r){function l(a){this.value=a;this.visible=3===a}function h(){var a=H.selectedIssue.value();return a&&a.id}function u(){var a=H.bk.value();return a&&a.pageId}function s(){return H.issueRowId.value()||H.confluencePageRowId.value()}function q(b){var c=new f.Deferred;c.resolve(a.renderTemplate('<span class="{iconClasses}"></span>',{iconClasses:b}));return c.promise()}
function x(){a.eachOwn(H,function(a){H[a].debug(pa?a:null)})}function t(a){H.enabled.setValue(b.isBoolean(a)?a: !H.enabled.value())}function w(){function b(){la.Meta&& !la.Meta.get("viewissue-max-cache-size")&&la.Meta.set("viewissue-max-cache-size",za.IssueViewerMaxCacheSize);aa.Issues.Application.start();ja.application=aa.Issues.Application;ja.issueModule=aa.Issues.Application.request("issueEditor");ja.viewIssueData=ja.issueModule.viewIssueData;ja.saveInProgressManager=ja.issueModule.saveInProgressManager;ja.getEditIssueController=a.returnConst(ja.issueModule);ja.getIssueId=function(){return ja.issueModule.model&&ja.issueModule.model.getId()};ja.getIssueEntity=function(){return ja.issueModule.model&&ja.issueModule.model.getEntity()}}function c(){aa.Issues.Application.on("issueEditor:saveSuccess",function(a){aa.trigger(aa.Events.ISSUE_REFRESHED,[a.issueId])});aa.Issues.Application.on("issueEditor:saveError",function(a){a.deferred||aa.trigger(aa.Events.ISSUE_REFRESHED,[a.issueId])});aa.Issues.FocusShifter.init();ja.issueModule.setContainer(ua)}if(aa.Issues.Application)b(),c();
else throw "Cannot initialize issue viewer: JIRA Javascript objects not found. Perhaps this version of JIRA is not supported.";}function v(){var b={getSelectedIssue:function(){var a=H.selectedIssue.value();return new aa.Issues.SimpleIssue({id:a&&a.id,key:a&&a.key})},getSelectedIssueId:h,getSelectedIssueKey:a.withThis(H.issueKey,H.issueKey.value),hasSavesInProgress:function(){return ja.saveInProgressManager.hasSavesInProgress()},isCurrentlyLoadingIssue:function(){return ja.issueModule.isCurrentlyLoading()||Ba.shouldBlockActions()},isSelectedIssueAccessible:function(){var a=H.enabled.value(),b=H.selectedIssue.value();return! !(a&&b&&b.key)},issueIsVisible:function(){return H.visibility.value().visible},nextIssue:a.noop,prevIssue:a.noop,openFocusShifter:function(){H.visibility.value().visible&&aa.Issues.FocusShifter.show()},getFieldsOnSelectedIssue:function(){var a=ja.getEditIssueController();return(a=a&&a.getFields())&&a.length?a:void 0},editFieldOnSelectedIssue:function(a){var c=b.getFieldsOnSelectedIssue();(c=(a=c&&c.get(a))&&a.isEditable())&&ja.issueModule.editField(a);return c},refreshSelectedIssue:function(a){return H.visibility.value().visible?ja.issueModule.refreshIssue(a):(
new la.$.Deferred).resolve().promise()},returnToSearch:a.noop,showInlineIssueLoadError:function(){var a=namespace("JIRA.Components.IssueViewer.Templates.Body").errorsLoading({});namespace("JIRA.Messages").showErrorMsg(a,{closeable: !0})},switchLayouts:a.noop,isQueryValid:a.returnTrue,isFullScreenIssueVisible:a.returnTrue,viewSelectedIssue:a.noop,toggleFilterPanel:a.noop,updateIssue:a.noop,waitForSavesToComplete:function(){var a=new la.$.Deferred;window.setTimeout(function(){aa.Issues.Api.hasSavesInProgress()?aa.bind(aa.Events.INLINE_EDIT_SAVE_COMPLETE,function(){aa.Issues.Api.hasSavesInProgress()||a.resolve()}):a.resolve()},10);return a},focusSearch:function(){},toggleFullscreenIssue:function(){}};a.extendOwn(namespace("Issues.Api",aa),b);aa.Issues.LayoutPreferenceManager||(aa.Issues.LayoutPreferenceManager={getPreferredLayoutKey:a.returnConst("split-view"),setPreferredLayoutKey:a.noop})}function C(){if("undefined"===typeof Fa){var b=f("body").attr("data-version");if(b){var c=b.indexOf("."),b=a.toIntSafe(b.substring(0,c),0);Fa= !b||7<=b}else Fa= !0}return Fa}function z(b){function c(){var b;try{b=window.require("dndattachment/dropzones/AttachmentsDropZone")}catch(d){}if(b){var e=
b.prototype&&b.prototype.connectContainer;e&&(b.prototype.connectContainer=function(){if(this){e.apply(this,arguments);try{var b=this.$windowMask;b.detach();la.$(y[0]).append(b);b.addClass("s-show-on-dnd")}catch(c){a.warn("problem relocating drag-and-drop window mask",c)}}})}}function d(b){try{aa.Issues.Application.on("issueEditor:linkToIssue",function(c){c=c&&c.issueKey;try{var d=oa.issueURL(c);d&&(k.saveNavigationHint(b.master,c),window.location.href=d)}catch(e){a.warn("could not navigate to "+c,e)}})}catch(c){a.warn("cannot set up navigation workaround",c)}}(function(){aa.Issues.overrideIssueDialogs({getIssueId:h,isNavigator: !0,updateIssue:function(a){var b=H.enabled.value()&&h();return(b?G(s(),b,a):(new la.$.Deferred).reject()).promise()}})})();aa.Dialogs.BeforeShowIssueDialogHandler&&aa.Dialogs.BeforeShowIssueDialogHandler.add(aa.Issues.Api.waitForSavesToComplete);(function(){la.KeyboardShortcut&&la.KeyboardShortcut.addIgnoreCondition(function(a,b,c){return "issueaction"===c&&aa.Issues.Api.isCurrentlyLoadingIssue()})})();(function(){var b=f(document).find("fieldset.hidden input[title=baseURL]"),b=b.length?b.attr("value"):null,c=namespace("AJS.Meta",!1);a.debug("baseUrl="+b);
b&&c&&(new a.Cell(H.issueKey,H.enabled,function(a,b){return b?a:null})).pipeChanges(function(a){c.set("viewissue-permlink",b+"/browse/"+(a||""))})})();(function(){ua.on("focus","#addcomment textarea",function(){Ea.scrollTop(Ea.prop("scrollHeight"))})})();(function(){function a(b){delete ha.unhandledSaveErrors[b]}ga(ja.saveInProgressManager,"saveError",function(a,b,c,d){ha.unhandledSaveErrors[a]={fields:c,response:d}});(function(){ja.issueModule._showSaveError&&(ja.issueModule._showSaveError=function(a){var b=(new aa.Components.IssueEditor.Views.SaveError(a)).render();ja.issueModule.listenTo(b,{issueLinkClick:function(a){var b=a.id;a=a.key;t(!0);h()!==b?Z(b,H.forestPanel.value()):F({id:b,key:a})},close:function(){ja.issueModule.stopListening(b)}})})})();ga(ja.saveInProgressManager,"saveSuccess",a);da(aa,"inlineEditCancelled",function(){var b=ja.getIssueId();b&&a(b)})})();(function(){H.enabled.pipe(function(a){a||ja.issueModule.model&&ja.issueModule.model.resetToDefault&&ja.issueModule.model.resetToDefault()})})();(function(){if(ja.issueModule.issueController){var b=ja.issueModule.issueController,c=b._createViews;f.isFunction(c)&&(b._createViews=a.withThis(b,function(){var b=c.apply(
this,arguments);this.headerView&&f.isFunction(this.headerView._updateWindowTitle)&&(this.headerView._updateWindowTitle=a.noop);return b}))}})();(function(){function b(a,c){function d(){e&&(window.clearTimeout(e),e=null)}var e=null;this.schedule=function(){d();e=window.setTimeout(c,a)};this.cancel=d}var c=new b(1E3,a.curryThis(y,y.addClass,Ga.loading));(new a.Cell(H.visibility,function(a){return!a.is(l.ITEM_LOADED)})).pipe(function(a){y.removeClass(Ga.loading);c.cancel();a&&c.schedule()});var d=new b(500,a.curryThis(y,y.addClass,Ga.opaque));(new a.Cell(H.visibility,function(a){return!a.is(l.ITEM_LOADED)||a.isAny(l.DISABLED,l.DIFFERENT_ROW,l.RESIZING)})).pipe(function(a){y.toggleClass(Ga.disable,a);a?H.visibility.value().is(l.RESIZING)||(H.visibility.value().is(l.DIFFERENT_ROW)?(y.removeClass(Ga.opaque),d.schedule()):(y.addClass(Ga.opaque),d.cancel())):(y.removeClass(Ga.opaque),d.cancel())})})();(function(){H.visibility.pipe(function(a){(a=a.is(l.oI))&&y.removeClass(Ga.allTypeClasses);y.toggleClass(Ga.typeNone,a)});new a.ElementClassToggler(H.selectedIssue,Ga.typeIssue,y);new a.ElementClassToggler(H.bk,Ga.typePage,y)})();C()&&(c(),d(b))}function F(a){var b=
ha.unhandledSaveErrors[a.id];(b?Ja:A)(a,b)};function A(b,c){H.visibility.applyUpdate(W.remove,l.ITEM_LOADED|l.DIFFERENT_ROW);ha.pb.cycle();D(b,c).pipe(function(){var c=new la.$.Deferred;ha.pb.life().addDetach(a.withThis(c,c.reject));var d=ha.nU[b.id];return d?(c.always(function(){d.state.applyUpdate(ca.remove,Ia.WAITING_FOR_DETAILS)}),V(c)):c.resolve()}).always(function(){H.visibility.applyUpdate(W.add,l.ITEM_LOADED)})}function D(b,c){var d,e;e=ja.issueModule.loadIssue(b);c&&ja.issueModule.fieldsLoader?(d=new la.$.Deferred,ja.issueModule.fieldsLoader.once("fieldsLoaded",function(e){e.fields&&e.fields.length&&(ja.issueModule.eventBus?ja.issueModule.eventBus.trigger("saveError",b.id,c.fields,c.response):a.warn("Cannot display stored unhandled save error"));d.resolve()})):d=e;return d}function G(a,b,c){var d=new la.$.Deferred,e=aa.Issues.Utils.getUpdateCommandForDialog(c);e.key=e.key||H.issueKey.value();e.id=e.id||b;b=e.id;c=e.key;d.always(function(){e.message&&aa.Issues.showNotification(e.message,e.key)});K(a,b,d,!0);O(b,c,e);ka.eventBus.fireEvent(qa.ISSUE_DETAILS_EDIT_STOPPED);ka.eventBus.fireEvent(qa.kD);return d}function B(b,c,d,e,f,g){var h=d[e];h&&h.state.value()?(g&&a.warn(
"ItemDetails: new update for",c,e,"expunging old update"),h.future?U(f,h.future):h.future=f):(d[e]=h={rowId:b,future:f,state:(new a.Cell(Ia.WAITING_FOR_DETAILS|Ia.WAITING_FOR_STRUCTURE)).pipeChanges(function(a){a||(h.future&&h.future.resolve(),h===d[e]&&delete d[e])}).debug(pa&&"pendingUpdate#"+c+" "+e)},pa&&a.debug("Added pendingUpdate#"+c+" "+e))}function K(a,b,c,d){B(a,"issue",ha.nU,b,c,! !d)}function J(a,b,c){B(a,"issue",ha.pendingPageUpdates,b,c,!1)}function O(b,c,d){if(b&&c){d=d||{action:aa.Issues.Actions&&aa.Issues.Actions.UPDATE||"update",id:b};var e=ja.viewIssueData.pendings[c];if(e&&"pending"===e.state())e.always(a.curry(O,b,c,d));else{var e=ha.nU[b],g,h=ja.getIssueEntity();!ja.issueModule.isCurrentlyLoading()&&h&&h.id===b?(ja.issueModule.refreshIssue(d),g=V(new f.Deferred)):h&&(g=ja.viewIssueData.get(c,!0,a.extend(d,{issueEntity:h,reason:d.action,detailView: !0})));e&&g.done(a.curryThis(e.state,e.state.applyUpdate,ca.remove,Ia.WAITING_FOR_DETAILS))}}}function V(a){if(ja.issueModule.issueLoader){var b=ja.issueModule.issueLoader._updatingPromise;return U(a,b&&b._getPending())}return a}function U(b,c){return c.done(b.resolve&&a.withThis(b,b.resolve)).fail(b.reject&&
a.withThis(b,b.reject))}function P(){function d(b,h){var l=b&&h&&h.bs().aL(b),l=l&&l.getItemId(),k=c.getIssueIdFromItemId(l),m=c.getPageIdFromItemId(l),n=r;r=k;pa&&a.debug("onFocusedRowUpdated rowId:",b,"item:",l,"oldIssueId:",n,"panel:",h.panelId);h!==ka.pageManager.getFocusedPanelCell().value()||ka.widget.dJ.isDragging()||(e(b,h)||(m=k=null),f(n,k,h)&&g(b,k,m,h))}function e(a,b){var c= ! !a;ha.ov.cycle();a&& !Y(b,a)&&(c= !1,b&&b.getAttributeSubscription().addDataUpdateHandler(function(c){c&&c[a]&&d(a,b)},ha.ov));return c}function f(a,b,c){return a&&a===h()&&a!==b&& !ja.issueModule.canDismissComment()?(window.setTimeout(function(){Z(a,c);aa.Issue.CommentForm&&aa.Issue.CommentForm.focus()},100),!1): !0}function g(b,c,e,f){ha.waitForItemIconLife.cycle();ha.oB.cycle();if(0<c){e=f.getRowKey(b);c={id:c,key:e,rowId:b,panel:f};if(e)m(H.selectedIssue.value(),c)||q();else{f.getAttributeSubscription().addDataUpdateHandler(function(a){a&&a[b]&&d(b,f)},ha.oB);var h=window.setTimeout(a.curry(q,"noKey"),1E3);ha.oB.life().addDetach(function(){window.clearTimeout(h)});q(null,!0)}H.selectedIssue.setValue(c);H.bk.setValue(null);n(a.text("s.w.item.details.title.issue"));p("issue",b,f)}else e&& !c?(
c={rowId:b,pageId:e,panel:f},k()&&(c.unlicensed= !0),m(H.bk.value(),c)||(q(),n(a.text("s.w.item.details.title.page")),p("page")),c.unlicensed&&q(ka.widget.jiraConfig.isAdmin()?"pagesLicenseError.admin":"pagesLicenseError",null,!0),H.bk.setValue(c),H.selectedIssue.setValue(null)):(q(0>b?"newItem":b?"detailsUnsupported":"noFocused"),n(a.text("s.w.item.details.title.other")),p("other"),H.selectedIssue.setValue(null),H.bk.setValue(null))}function k(){var a=ka.widget.jiraConfig.getConfluenceConfigCell().value();return a? !1===a.licensed: !1}function m(c,d){var e=b.omit(c,"panel"),f=b.omit(d,"panel");return a.deepEquals(e,f)}function n(b){xa.html(a.renderTemplate('<span class="st-details-title-text">{title}</span>',{title:b}))};function p(a,b,c){Da[a](b,c).always(function(a){wa.html(a)})}function q(a,b,c){ta(a,c);b?H.visibility.setValue(H.visibility.value().add(l.oI).remove(l.ITEM_LOADED)):a?H.visibility.applyUpdate(W.add,l.oI|l.ITEM_LOADED):H.visibility.setValue(H.visibility.value().remove(l.oI).add(l.DIFFERENT_ROW))}var r=null;ka.eventBus.addListener(ra,qa.eu,function(a,b,c){d(a,c)});ka.pageManager.getFocusedPanelCell().pipeChanges(ra,function(a){var b=a.ao().bc();d(b,a)})}function Y(
a,b){return! !(b&&a&&a.hasSummary(b))}function N(){function b(c,f){c&&f?(ja.issueModule.abortPending(),la.InlineDialog.current&&la.InlineDialog.current.hide(),d(),f.key&&(F(f),e(f.rowId))):c||(la.$(function(){try{ja.issueModule.beforeHide()}catch(b){var c=a.getStackTrace(b).join("\n");!c&&b&&b.stack&&(c=""+b.stack);a.warn("Caught a JS error while hiding issue details:",b,"\n",c)}la.InlineDialog.current&&la.InlineDialog.current.hide()}),H.visibility.applyUpdate(W.remove,l.oA))};function d(){var a=ja.getEditIssueController();(a=a&&a.getFields())&&a.each(function(a){a.blurEdit()})}function e(a){if(a){var b=ka.master.ae();a=b.indexOf(a);0<=a&&(f(b,a-1),f(b,a+1))}}function f(a,b){if(0<=b&&b<a.size()){var d=a.row(b);d&&c.isIssue(d.getItemId())&&(d=ka.master.getRowKey(d.getId()))&&ja.viewIssueData.get(d,!1,{prefetch: !0})}}H.selectedIssue.pipeDebounced({wait:500,waitRebound:500,waitInit:0,fireAlways: !0,immediateCall: !1},function(a){b(H.enabled.value(),a)});H.enabled.pipe(!0,function(a){b(a,H.selectedIssue.value())})}function L(b){ha.waitForPageUrlLife.cycle();var c=b.rowId;ka.master.getAttributeValuePromise(ha.waitForPageUrlLife.life(),c,n.URL_TEXT).always(function(b){var d=H.bk.value()
;d&&d.rowId===c&& !d.unlicensed&&(b?(pa&&a.debug("started loading confluence page",b),fa(b,d.pageId),ha.bq={pageId:p.parse(d.pageId).pageId,job:window.setTimeout(function(){pa&&a.debug("confluencePageLoadTimeout");na.empty();H.visibility.applyUpdate(W.add,l.ITEM_LOADED|l.oI);ta("confluence.loadTimeout");ha.pageIframesCache.removeValue(d.pageId)},za.ConfluencePageLoadTimeoutMs)}):(a.warn("page with no url row:",c,g.stringify(d)),H.visibility.applyUpdate(W.add,l.ITEM_LOADED|l.oI),ta("confluence.noUrl")))})}function fa(b,c){b=b.replace("pages/viewpage.action","plugins/servlet/structure-frame");var d=Ha.render$({pageId:c}),e=na.find("#"+d.attr("id"));a.assert(1>=e.length,"unexpected count(",e.length,") of iframes for pageId=",c);e.remove();d.appendTo(na);d.attr("src",b);ha.pageIframesCache.putValue(c,d[0])}function X(){function b(a,c){if(a&&c)if(c.unlicensed)H.visibility.applyUpdate(W.remove,l.DIFFERENT_ROW);else{H.visibility.applyUpdate(W.remove,l.ITEM_LOADED|l.DIFFERENT_ROW);ha.bq&&(window.clearTimeout(ha.bq.job),ha.bq=null);var d=na.children("iframe:visible"),e=d[0],g=ha.pageIframesCache.getValue(c.pageId);g===e&&e?H.visibility.applyUpdate(W.add,l.ITEM_LOADED):(sa(d,{name:
"saveDraft"}),d.hide(),g?(f(g).show(),H.visibility.applyUpdate(W.add,l.ITEM_LOADED)):L(c))}}H.bk.pipeDebounced({wait:500,waitRebound:500,waitInit:0,fireAlways: !0,immediateCall: !1},function(a){b(H.enabled.value(),a)});H.enabled.pipe(!0,function(a){b(a,H.bk.value())});(function(){Q("load",function(a,b){if(ha.bq&&ha.bq.pageId===a.pageId||"*"===a.pageId){var c=H.bk.value();c&&(H.visibility.applyUpdate(W.add,l.ITEM_LOADED),(c=ha.pendingPageUpdates[c.pageId])&&c.state.applyUpdate(ca.remove,Ia.WAITING_FOR_DETAILS));ha.bq&&window.clearTimeout(ha.bq.job);if("*"===a.pageId){try{var d=b.source.parent}catch(e){}d&&ha.pageIframesCache.removeMatching(function(a,b){return b.contentWindow===d})}ha.bq=null}})})();(function(){ha.pageIframesCache.onEntryRemoved=function(b,c){var d=H.enabled.value()&&H.bk.value(),d=b!==(d&&d.pageId);pa&&a.debug("Expunged old iframe for page #",b,d?", removing iframe from DOM":"");d&&f(c).remove()}})();ra.addDetach(a.withThis(ha.pageIframesCache,ha.pageIframesCache.clear));(function(){Q("focus",function(){ka.eventBus.fireEvent(qa.IFRAME_FOCUS)});Q("blur",function(){ka.eventBus.fireEvent(qa.IFRAME_BLUR)})})()}function M(){(function(){function d(b){var c=
H.enabled.value()&&H.selectedIssue.value(),e=c&&c.key&&c.id,f=e&&c.rowId;e&&b(f)&&(b=ka.widget.attributeManager.getItemsVersion(),a.deepEquals(b,ha.lastDataVersion)||(ha.lastDataVersion=a.clone(b),O(e,c.key)))}function e(a,d){var f;b.each(ha.nU,function(b,e){var h=b.rowId&&a(b.rowId);h||(f||(f=g(a,d,c.ISSUE)),h=f(e));h&&b.state.applyUpdate(ca.remove,Ia.WAITING_FOR_STRUCTURE)})}function f(a,d){var e;b.each(ha.pendingPageUpdates,function(b,f){var h=b.rowId&&a(b.rowId);h||(e||(e=g(a,d,c.CONFLUENCE_PAGE)),h=e(f));h&&b.state.applyUpdate(ca.remove,Ia.WAITING_FOR_STRUCTURE)})}function g(a,b,d){return function(e){return b.getRowsWithItemId(c.toItemId(d,e)).some(a)}}ka.master.getAttributeSubscription().addDataUpdateHandler(function(a){var b=ka.master.aT(),h=function(b){return a[b]};d(h);e(h,b);f(h,b);ha.pageIframesCache.removeMatching(g(h,b,c.CONFLUENCE_PAGE))},ra)})();(function(){da(aa,"Dialog.show inlineEditStarted",a.curryThis(ka.eventBus,ka.eventBus.fireEvent,qa.ISSUE_DETAILS_EDIT_STARTED));da(aa,"lockPanelRefreshing",function(a,b){"addcommentmodule"===b&&ka.eventBus.fireEvent(qa.ISSUE_DETAILS_EDIT_STARTED)});da(aa,"Dialog.hide inlineEditCancelled unlockPanelRefreshing",a.curryThis(
ka.eventBus,ka.eventBus.fireEvent,qa.ISSUE_DETAILS_EDIT_STOPPED))})();(function(){var b=new a.Lifecycle;ka.eventBus.addListener(ra,qa.ISSUE_DETAILS_EDIT_STOPPED,function(){b.cycle();var a=2,c=h(),d=ha.nU[c];d&&(d.state.pipe(b,function(a){a||b.cycleEnd()}),ka.eventBus.addListener(b,qa.POLL_FINISHED,function(){(a-=1)||d.state.applyUpdate(ca.remove,Ia.WAITING_FOR_STRUCTURE)}))})})();(function(){da(aa,"Dialog.beforeHide",function(a,b,c,d){var e=aa.Dialog.current;if("cancel"!==c&&"esc"!==c&&e&&"clone-issue-dialog"===d&&(a=H.enabled.value()&&h(),b=ha.nU[a],a&& !b))return G(s(),a,e).always(function(){e.hide()}),!1})})();(function(){function a(b){var c=b.update;c&&(b.update=function(a,d){var e;a:{if((e=a&&(a.issueId||a.issue&&a.issue.id))&&d)if(d.fieldsSaved&& !ka.master.bh().cu()){ha.pi[e]=d.fieldsSaved;e= !0;break a}else ha.pi[e]&&(d.fieldsSaved=ha.pi[e],delete ha.pi[e]);e= !1}e||c.call(b,a,d)})}ja.issueModule.model&&ja.issueModule.editIssueController&&(a(ja.issueModule.model),a(ja.issueModule.editIssueController))})()}function ba(){function c(a){var d=ka.master.aS();b.each(a,function(a,b){d.aM(b,!0)})}(function(){function b(){d.po(k).pipe(n.cycle(),c)}function c(b){switch(b){case null:
H.visibility.applyUpdate(W.remove,l.DISABLED);break;case m.RowEditStates.EDITING:H.visibility.applyUpdate(W.add,l.DISABLED);break;case m.RowEditStates.SUCCESS:e&&(H.visibility.applyUpdate(W.remove,l.ITEM_LOADED),K(k,e,(new f.Deferred).always(function(){H.enabled.value()&&h()===e&&H.visibility.applyUpdate(W.add,l.ITEM_LOADED)}))),g&&(H.visibility.applyUpdate(W.remove,l.ITEM_LOADED),L(H.bk.value()),J(k,g,(new f.Deferred).always(function(){H.enabled.value()&&u()===g&&H.visibility.applyUpdate(W.add,l.ITEM_LOADED)})));case m.RowEditStates.CANCEL:H.visibility.applyUpdate(W.remove,l.DISABLED);break;default:a.warn("Unknown issue edit state",b)}}var d=ka.master.bh(),e,g,k,n=new a.Lifecycle;H.visibility.pipeChanges(function(c,d){c.is(l.ITEM_LOADED)&&d&& !d.is(l.ITEM_LOADED)&&(e=h(),g=u(),a.assert(null==e||null==g,"only one variant is allowed: ",e,g),k=s(),b())});ka.master.bD().addListener(ra,qa.dz,function(a,c){c===k&&b()})})();(function(){var a={};ga(ja.saveInProgressManager,"savingStarted",function(b){var d=ka.widget.attributeManager.markAllRowsWithItemExternalDirty(""+b);c(d);a[b]=d});ga(ja.saveInProgressManager,"saveSuccess saveError",function(b){ka.eventBus.fireEvent(
qa.ISSUE_DETAILS_EDIT_STOPPED);ka.eventBus.fireEvent(qa.kD);var d=a[b];d&&(ka.widget.attributeManager.clearExternalDirty(d),c(d),delete a[b])})})()}function E(){H.enabled.pipeChanges(function(a){ya.modes.ISSUE_DETAILS=a? !0:null;ka.eventBus.fireEvent(qa.STRUCTURE_PAGE_CHANGED)})}function I(b){function c(a){return function(b){b.ctrlKey||b.metaKey||b.shiftKey||a.call(this,b)&&b.preventDefault()}}(function(){var c="up down left right pageup pagedown home end space".split(" ");a.addAll(c,f.map(c,function(a){return "ctrl+"+a}));c.push("shift+space");c=f.map(c,a.keyboardCodeFromString);b.keyboardManager.addCustomController({accept:function(b,d){if(d===y[0]||f.contains(y[0],d))return!a.contains(c,a.keyboardCodeFromEvent(b))}})})();(function(){Q("action",function(a){(a=a.action)&&ka.master.bD().fireEvent(qa.ACTION,a)})})();(function(){var c=la.$("#s-tb-layout-menu");(function(){function b(c,d,e){a.warn("Could not get preferred issue link action:",d,e)}new a.AjsDropdown2RadioPresenter(H.issueLinkAction,c,"issueLinkAction",!0);var d=new ya.ajax.AJAX,e=ya.ajax.RESOURCES.CONFIG_WIDGET+"/issueLinkAction",f= !1;ya.ajax.doAjax({url:ya.ajsbridge.localURL(e),type:"GET",dataType:"text",timeout:3E4,
success:function(a){H.issueLinkAction.value()||(f= !0,H.issueLinkAction.setValue(a))},error:b});H.issueLinkAction.pipeChanges(ra,function(c){if(f)f= !1;else{var g=new d.Task(e,ya.ajax.UPLOAD,function(){a.debug("successfully set issueLinkAction to "+c)},b);g.type="POST";g.data=c;g.contentType="text/plain; charset=UTF-8";d.addTask(g)}})})();(function(){var b=f("#s-issueDetails-menu-trigger"),c=new a.Cell(H.enabled,H.issueKey,function(a,b){return!a&& !b});new a.ElementAttributeSetter(c,b,"aria-disabled",function(a){return a?"true":null},!0);new a.ElementClassToggler(c,Ga.disable,b)})();(function(){(new a.Cell(b.bF.visibleCell,H.enabled,function(a,b){var c;a&&(c="history");b&&(c="details");return c})).pipe(function(a){var b= ! !a,d=c.find("div[data-section=issueLinkAction]"),e=d.find(".aui-dropdown2-heading, a");e.attr("aria-disabled",b);b?(d.attr("title",r.text("sw.widget.dp.option.disabled-in-+"+a+"+.title")),e.addClass("aui-dropdown2-disabled")):(d.attr("title",""),e.removeClass("aui-dropdown2-disabled"))})})()})();(function(){ka.eventBus.addListener(ra,qa.BEFORE_CLICK,function(a){var c=a.link$.closest("a[href]");c.blur();if(c.hasClass("s-item-link")&& !b.bF.visibleCell.value())if(
H.enabled.value()|| !b.pageManager.getFocusedPanel().isPrimary())a.prevent= !0;else{var c=H.issueLinkAction.value(),d=H.bk.value(),d=H.forestPanel.value()||d&&d.panel;"showDetails"===c&&d&&d.isPrimary()&&t(!0);"openIssuePage"!==c&&(a.prevent= !0)}})})();(function(){f("#st-details-close-btn").on("mousedown mouseup",function(a){a.stopPropagation();a.preventDefault();"mouseup"===a.type&&t(!1);return!1})})();(function(){function b(c){var f=c.type||c,h=T();if("focusout"===f){h=c.target===y[0]||c.target===ua[0];if(c.relatedTarget===document|| !la.$(c.relatedTarget).is("input#shifter-dialog-field")|| !h)return;h= !0}if(h||d)d|=e[f];g.cycleEnd();pa&&a.debug(f,"focusedBefore =",d,"|",a.debugElem(document.activeElement))};function c(b){var h= !1,l=(b.type||b)+(b.namespace?"."+b.namespace:"");if("focusout"===l&&b.target!==document)if(la.$(b.target).is("input#shifter-dialog-field"))h=b.relatedTarget!==document&&la.$(b.relatedTarget).is(":input");else return;"hideLayer"===l&&b.target===document&&f(b.target.activeElement).is(":input")||(b=d& ~e[l],pa&&a.debug(l,"focusedBefore =",d,"newFocusedBefore =",b,"fromFocusShifterToInput = ",h),!d||b||h||H.visibility.pipeOnce(g.cycle(),function(a){
return a.visible},Ka),d=b)}ua.add(Ea).on("focusin focusout",function(a){a="focusin"===a.type;!a||H.visibility.value().visible||H.focused.value()||Aa(!1);H.focused.setValue(a)});Q("focus",a.curryThis(H.focused,H.focused.setTrue));Q("blur",a.curryThis(H.focused,H.focused.setFalse));H.focused.pipe(a.curryThis(y,y.toggleClass,Ga.focused));ja.issueModule.bind("fieldSubmitted",Ka);ja.issueModule.bind("replacedFocusedPanel",Ka);da(aa,"inlineEditBlurred inlineEditCancelled",Ka);var d= !1,e={beforeShow:1,"Dialog.beforeHide":1,showLayer:2,hideLayer:2,focusout:4,structureEdit:8};da(aa,"beforeShow showLayer focusout",b);da(aa,"Dialog.beforeHide hideLayer focusout",c);var g=new a.Lifecycle;ka.master.bh().hE().pipeChanges(function(a,d){a&& !d?b("structureEdit"): !a&&d&&c("structureEdit")})})();(function(){(function(){la.$(document).on("click","#attachment-sorting-options a,#attachment-sorting-order-options a,#subtasks-show-all,#subtasks-show-open",c(function(a){if(!this.href|| !window.parseUri)return!1;var b=window.parseUri(this.href);b.queryKey&&(ja.issueModule.updateIssueWithQuery(b.queryKey),la.$(this).parents("ul").find("a.aui-checked").removeClass("aui-checked"),la.$(this).addClass(
"aui-checked"));a.stopPropagation();return!0}))})();(function(){la.$(document).on("click",".subtask-reorder a",c(function(a){if(!this.href)return!1;la.$.ajax({type:"GET",data:{disableRedirect: !0},url:this.href}).done(function(){aa.Issues.Api.refreshSelectedIssue({reason:aa.Issues.Actions.UPDATE})}).fail(function(a){aa.Messages.showErrorMsg(aa.SmartAjax.buildSimpleErrorContent(a),{closeable: !0})});a.stopPropagation();return!0}))})()})();b.globalActions.register("toggleIssueDetailsNoFocus",function(){Aa(!1);t()})}function ma(){ia(function(){var b=a.requireOptional("structure/page/issue/TimeTrackingController");b&&(ka.issuePageTT=new b(ka.widget.getPrimaryStructureIdCell(),new a.Cell(H.issueRowId,function(a){return{rowId:a}})),ka.issuePageTT.trackStructureUpdates(ka.eventBus),ka.issuePageTT.loadTimeTracking())})}function R(){function b(a){ka.eventBus.fireEvent(qa.gS,a)}function c(){return ".details"+(H.enabled.value()?"On":"Off")}(function(){ka.master.bD().addListener(ra,qa.eu,function(){b("focusedRowChanged"+c())})})();(function(){da(aa,"inlineEditStarted",a.curry(b,"inlineEdit.issueViewer"));ka.master.bD().addListener(ra,qa.dz,function(){b("inlineEdit.structureBoard"+c())})})();b(
"issueDetails.issueLinkAction."+H.issueLinkAction.value())}function S(){a.eachValue(H,function(b){ra.addDetach(a.withThis(b,b.dispose))});ra.addDetach(function(){ja.viewIssueData.reset();ja.issueModule.dismiss()})}function ga(b,c,d){b.bind(c,d,ha);ra.addDetach(a.curryThis(b,b.unbind,c,d,ha))}function da(b,c,d){b.bind(c,d);ra.addDetach(a.curryThis(b,b.unbind,c,d))}function ia(a){H.visibility.pipeOnce(ra,function(a){return a.visible},a)}function T(){return H.enabled.value()&&H.focused.value()}function Aa(b){pa&&a.debug("details: setFocused",b);b?ua.is(":visible")?(pa&&a.debug("focusing issueContainer$"),a.focus(ua)):na.is(":visible")?(a.focus(y),sa(na.children("iframe:visible"),{name:"focus"})):a.debug("ItemDetails: nothing to focus"):(na.children("iframe:visible").blur(),a.blur())}function Z(a,b){var c=va(a,b);c?b.ao().focusRow(c,!0):b.ao().eJ([])}function va(a,c){var d=c.bs(),e=b.find(ha.recentlyShownIssues,function(b){return b&&b.id===a&&0<=d.indexOf(b.rowId)});if(e)return e.rowId;e=d.getRowsWithItemId(""+a);return e.length?e[0]:null}function Q(b,c){var d=za.ConfluenceMsgPrefix+b,e=function(b){var e=b&&b.data;e&&e.name===d&&(pa&&a.debug("processing confluence message",g.stringify(
e)),c(e,b))};window.addEventListener("message",e,!1);ra.addDetach(function(){window.removeEventListener("message",e,!1)})}function sa(b,c){c.name=za.ConfluenceMsgPrefix+c.name;b.each(function(){var b;try{b=this.contentWindow.frames[0]}catch(d){pa&&a.debug("cannot get inner iframe for confluence page details",d);return}b?b.postMessage(c,"*"):a.warn("Failed to send",c,"to Confluence iframe: could not find it in the wrapper iframe")})};function ta(b,c){$.empty();b&&(c?la.messages.error:la.messages.info).call(la.messages,"#st-issue-details .st-issue-details-stub",{title:a.text("s.issueDetails.stub.title.+"+b+"+"),body:a.text("s.issueDetails.stub.body.+"+b+"+"),closeable: !1})}var ya=namespace("almworks.structure",!1);namespace("almworks.structure.apputil",!1);var qa=namespace("almworks.structure.appevents",!1),aa=window.JIRA,la=window.AJS,oa=namespace("almworks.structure.ajsbridge",!1),pa= !1,Fa,y=a.generateDom("div","a",function(a,b){return a("#st-issue-details")(a(".st-focus-decoration"),a(".st-details-header")(a(".st-details-title")(a(".st-details-title-icon"),a(".st-details-title-text")),a(".st-details-new-window-url"),a(".st-details-close")(b("#st-details-close-btn",{href:"#"}))),
a(".st-loading-layer"),a(".st-issue-details-stub"),a(".st-page-details-viewport.st-details-viewport")(a(".st-disable-layer"),a(".st-page-details-container")),a(".st-issue-details-viewport.st-details-viewport",{tabindex: -1})(a(".st-issue-details-client")(a(".st-disable-layer"),a(".st-issue-container-parent.split-view")(a(".issue-container")))))}),ua=y.find(".issue-container"),Ea=y.find(".st-issue-details-viewport");y.find(".st-page-details-viewport");var na=y.find(".st-page-details-container"),$=y.find(".st-issue-details-stub"),xa=y.find(".st-details-title-text"),wa=y.find(".st-details-title-icon"),ra=new a.Life;a.extend(l,a.extend(l.prototype,{add:function(a){return new l(this.value|a)},remove:function(a){return new l(this.value& ~a)},is:function(a){return! !(this.value&a)},isAny:function(){return b.any(arguments,a.withThis(this,l.prototype.is))},ITEM_LOADED:1,oA:2,DISABLED:4,oI:8,DIFFERENT_ROW:16,RESIZING:32}));var W={add:function(a){return this.value().add(a)},remove:function(a){return this.value().remove(a)}},ca={add:function(a){return this.value()|a},remove:function(a){return this.value()& ~a}},H={enabled:new a.Cell(!1),visibility:new a.Cell(new l(0)),focused:new a.Cell(!1),
selectedIssue:new a.Cell(null),bk:new a.Cell(null),confluencePageRowId:null,issueKey:null,issueRowId:null,forestPanel:null,issueLinkAction:new a.Cell(null)},ja={},ka={widget:null,master:null,eventBus:null,pageManager:null,issuePageTT:null},Ga={disable:"st-disable",opaque:"st-opaque",loading:"st-loading",focused:"st-focused",typeNone:"st-type-none",typeIssue:"st-type-issue",typePage:"st-type-page"};Ga.allTypeClasses=[Ga.typeIssue,Ga.typePage].join(" ");var ha={initialized: !1,oB:new a.Lifecycle,ov:new a.Lifecycle,waitForPageUrlLife:new a.Lifecycle,waitForItemIconLife:new a.Lifecycle,bq:null,nU:{},pendingPageUpdates:{},pb:new a.Lifecycle,unhandledSaveErrors:[],pi:[],lastDataVersion:null,recentlyShownIssues:[],pageIframesCache:new d(10,10)},Ia={WAITING_FOR_DETAILS:1,WAITING_FOR_STRUCTURE:2},za={IssueViewerMaxCacheSize:100,MaxRecentIssues:20,ConfluenceMsgPrefix:"structure.confluence.",ConfluencePageLoadTimeoutMs:2E4},Da={issue:function(a,b){return b.getAttributeValuePromise(ha.waitForItemIconLife.life(),a,n.ICON_HTML)},page:a.returnConst(q("alm alm-fw alm-pages")),other:a.returnConst(q("aui-icon aui-icon-small aui-iconfont-info"))},Ba={initialize:function(b){b.div$.after(y);ka.widget=
b;ka.master=b.master;ka.eventBus=b.eventBus;ka.pageManager=b.pageManager;H.issueKey=H.selectedIssue.fieldSubCell("key");H.issueRowId=H.selectedIssue.fieldSubCell("rowId");H.confluencePageRowId=H.bk.fieldSubCell("rowId");H.forestPanel=H.selectedIssue.fieldSubCell("panel");H.selectedIssue.pipeChanges(function(b){if(b){var c=ha.recentlyShownIssues;b=c.unshift(a.clone(b));b>za.MaxRecentIssues&&c.splice(za.MaxRecentIssues,b-za.MaxRecentIssues)}});x();try{w(),v(),z(b),P(),N(),X(),M(),ba(),E(),I(b),ma(),R(),S(),ha.initialized= !0}catch(c){a.error(c)}},toggleEnabledAndFocus:function(){if(!H.selectedIssue.value()&& !H.bk.value())return!1;H.enabled.value()||ia(Ka);t();return!0},enabledCell:H.enabled,visibleCell:H.visibility.fieldSubCell("visible"),focusedCell:new a.Cell(H.enabled,H.focused,a.and),onResize:function(a){H.visibility.applyUpdate(a?W.add:W.remove,l.RESIZING)},hk:function(){H.visibility.applyUpdate(W.add,l.oA)},onWidthChange:function(a){var b=C()?ua:y;b.toggleClass("skinny",900>a);b.toggleClass("very-skinny",600>a)},panel$:y,issueContainer$:ua,isFocused:T,setFocused:Aa,shouldBlockActions:function(){var a=H.visibility.value();return a.is(l.oA)&& !a.visible},isValidFocusedRowId:Y,
die:function(){ra.detach()},setDebug:function(a){pa=a;x()}},Ja=a.delayed(10,A),Ha=new e('<iframe id="s-confluence-page-{pageId}" name="structure-confluence-page-{pageId}"></iframe>'),Ka=a.curry(Aa,!0);return Ba});define("structure/widget/ui/panel/AnimatedRowsBuffer",["almworks/util/Objects","almworks/util/Collections","underscore"],function(f,b,g){function d(){this._animated={}}var e= !0;f.extend(d.prototype,{aO:function(a){a&&e&&(g.isArray(a)?a.length&&(f.extend(this._animated,b.flipSet(a)),this._animated[0]= !0):"number"===typeof a?(this._animated[a]= !0,this._animated[0]= !0):f.extend(this._animated,a))},mw:function(){var a=this._animated;this._animated={};return a},clear:function(){this._animated={}}});d.setAddingAnimatedRowsEnabled=function(a){e=a};return d});define("structure/widget/ui/panel/AbstractErrorPopup",["almworks/jquery","underscore","almworks/util/Util"],function(f,b,g){var d=namespace("almworks.structure.appevents"),e=namespace("almworks.structure");return function(a){this.popup=null;var f=this,c=new g.Cell(0),p=new g.Cell(!1),m=new g.Cell(c,p,function(a,b){return b?a:0});a.eventBus.addListener(new g.Life,d.dr,b.throttle(function(){f.popup&&f.popup.refresh()},50));
g.extendOwn(this,{getHeightCell:g.returnConst(m),getHasErrorsCell:g.returnConst(p),init:function(a){f.popup=a},showPopup:function(){f.popup&&f.popup.show()},hidePopup:function(){f.popup&&(f.popup.hide(),f.popup.remove(),f.popup=null,c.setValue(0))},hideCallback:b.bind(p.setValue,p,!1),initCallback:function(){if(!c.value()){var b=f.popup.height(),d=a.pageManager.getHeaderHeight();e.modes.GADGET?c.setValue(b/.75-d):c.setValue(b-d)}p.setValue(!0)}})}});define("structure/widget/ui/panel/DecisionPanel","almworks/jquery underscore almworks/util/Template almworks/util/Util aui/inline-dialog structure/widget/ui/panel/AbstractErrorPopup".split(" "),function(f,b,g,d,e,a){var n=namespace("almworks.structure");return function(b){function p(a,d){return e(b.footerWarning$.find("i"),"stDecisionPanel",function(b,c,e){var f=a.result;c=g.build$("div","span",function(a,b){return a(".st-dp-inner-dlg")(b(".st-dp-icon.aui-icon",{"data-bind-id":"icon$"}),a(".st-dp-message",{"data-bind-id":"message$"}),a(".st-dp-options",{"data-bind-id":"options$"}),a(".st-dp-buttons",{"data-bind-id":"buttons$"}))}).getBindings();var h=f.interactions,f=f.error;if(h&&h.length){c.icon$.addClass("st-dp-icon-ask");var h=h[0],
f=h.parameter,n=h.values;m(c,a,d,h,"ask");"0:Confirm"!==f&&"0:CreateAnyway"!==f||1!==n.length?3>=n.length?k(c,a,f,n):r(c,a,f,n):l(c,a,f,n[0]);u(c,a,d)}else f&&(c.icon$.addClass("st-dp-icon-err"),m(c,a,d,f,"err"),s(c,a,d));b.html(c.all$);e();return!1},{gravity:"s",persistent: !0,noBind: !0,width:G,offsetX: -41,showDelay:100,hideCallback:J.hideCallback,initCallback:J.initCallback})}function m(a,b,c,e,g){var h=e.row,l=e.itemDescription,k=e.itemUrl||"#",m=d.toIntSafe(e.itemCount,1)-1,n=b.spec.action||b.action;b.spec.item?(n=b.result.itemId?"created":"create",g="ask"):b.spec.cutFrom&&(n="cut");l=d.text("sw.dp.+"+n+"+.+"+(0>=m?"0":1==m?"1":"n")+"+.+"+g+"+.html",d.htmlEscape(l),d.htmlEscape(k),m);e=d.renderTemplate("{message}",e);g=d.text("sw.dp.message.+"+g,l,e);g=f(d.renderTemplate("<p>{html:html}</p>",{html:g}));a.message$.append(g);var p=c.bn(),q=c.ao();g.find("a").click(function(a){if(!d.modifiersFromEvent(a))return c.isSpec(b.forestSpec)&&(a=c.bs(),a.contains(h)&&(a=a.getPath(a.bL(h)),q.by(a,!0),p.io(h),p.animateRowById(h))),!1})}function k(a,b,c,d){var e=g.build("button",function(a){return a(".aui-button.aui-button-subtle.st-dp-option")("{iconHtml:html} {message}")});d.forEach(
function(d){a.options$.append(e.render$(d).click(h(b,c,d.value)))})}function r(a,b,c,e){var f=g.build$("form","select","option",function(a,b,c,d){return a(".aui")(b(".select",{"data-bind-id":"select$"})(d.forEach(e,function(a,b){return c({value:""+b})(a.message)})))}).getBindings();a.options$.append(f.all$);a.buttons$.append(g.build$("button",function(a){return a(".aui-button.aui-button-primary")("{sw.dp.btn.apply}")}).click(function(){var a=d.toIntSafe(f.select$.val()[0],-1);0<=a&&e[a]&&h(b,c,e[a].value)()}))}function l(a,b,c,d){a.options$.remove();a.buttons$.append(g.build("button",function(a){return a(".aui-button")("{message}")}).render$(d).click(h(b,c,d.value)))}function h(a,d,e){return function(){a.appendParameter(d,e);a.hasMoreInteractions()?x(a,!0):b.ad.retryWithDecision(a)}}function u(a,b,c){a.buttons$.append(g.build$("button",function(a){return a(".aui-button.aui-button-link")("{sw.dp.btn.cancel}")}).click(q(b,c)))}function s(a,b,c){a.options$.remove();a.buttons$.append(g.build$("button",function(a){return a(".aui-button")("{sw.dp.btn.acknowledge}")}).click(q(b,c)))}function q(a,d){return function(){if(0>a.tempRowId){var e=d.bh();e&&e.cancelSpecifiedRowEdit(a.tempRowId)}
b.ad.acknowledgeFailed(a)}}function x(a){a&&a.result?(A=a.actionId,D=a.getPanel()||b.master,J.hidePopup(),z(),J.init(p(a,D)),F.show(a.actionId,d.text("s.w.action.footer-warning.msg"),d.text("s.w.action.footer-warning.title"),t),C(),v()||t()):t()}function t(){J.popup&&(B=Date.now(),J.popup.is(":visible")?w(J.popup):J.showPopup())}function w(a){var b=a.find(".st-dp-inner-dlg");b.stop(!0,!0).animate({backgroundColor:"#f05c75"},200,"swing").animate({backgroundColor:"#f5f5f5"},800,"swing",function(){b.css({backgroundColor:""})})}function v(){var a=D.bh();return!(!a|| !a.isReallyEditingNow())}function C(){z();K=window.setInterval(function(){12E4<=Date.now()-B&& !v()&&t()},1E3)}function z(){K&&(window.clearInterval(K),B=0,K=null)}d.addSuper(a,this)(b);var F=b.footerWarning,A,D,G=n.modes.GADGET?400:500,B=0,K=null,J=this;d.extend(this,a.prototype,{show:x,close:function(a){a&&(F.hide(a.actionId),A===a.actionId&&(J.hidePopup(),z(),D=A=null))}})}});define("structure/widget/ui/grid/RowRenderer",["underscore","almworks/jquery","structure/widget/model/Items","almworks/util/Util"],function(f,b,g,d){return function(e){function a(a,b){a.stop(!0,!1).addClass("s-bganimation").animate({backgroundColor:
b},{duration:200,easing:"swing",complete:function(){if(d.onPage(a)){var b=a.parent().css("background-color")||"#ffffff";a.animate({backgroundColor:b},{duration:800,easing:"swing",complete:function(){a.removeClass("s-bganimation").css("background-color","")}})}else a.removeClass("s-bganimation").css("background-color","")}})}function n(a){return a&& !(0===a.indexOf("s-type-")||0===a.indexOf("s-sema-"))}var c=e.af(),p=e.bh(),m={getRowId:function(){return this._row.getId()},getMeta:function(){return this._row.meta},getAttributeValue:function(a,b){return this._valueAccessor.getValue(a,b)},getRowValueAccessor:function(a){return e.getAttributeSubscription().getValueAccessor(a)},isNotAccessible:function(){return this._valueAccessor.isNotAccessible()},getItemId:function(){return this._row.itemId},isIssue:function(){return g.isIssue(this.getItemId())},repaintWhen:function(a){if("pending"===a.state()){var b=this.getRowId();a.always(function(){e.aS().aM(b)})}},_cell$:null,_row$:null,_valueAccessor:null,_row:null,_cellEditor:null,_panel:e,_getDepthOffset:function(a){f.isNumber(a)||(a=this._row.getDepth());e.getTitleRow()&&a--;return e.widget.config.getDepthOffset(Math.max(0,a))}},k={
_valueAccessor:null,_now:0,isAttributeFlashed:function(a,b){return this._valueAccessor.shouldFlash(a,b,this._now)}},r=/[^a-zA-Z0-9_\-]/g,l=d.flipSet(g.Semantics,function(a){return a.toLowerCase()});this.render=function(f,u,s){if(u&&f&&s){var q=s.semantics,x=g.getItemType(s.itemId),t="",w="";x&&((t=d.tail(x,"com.almworks.jira.structure:type-"))&&(x=t),t="s-type-"+x.replace(r,"-"));q&&(w=l[q])&&(w="s-sema-"+w);var q=d.getClasses(f),x=t&&0<=q.indexOf(t),v= !w||0<=q.indexOf(w);x&&v||(q=q.filter(n),t&&q.push(t),w&&q.push(w),f.attr("class",q.join(" ")));w=c.getColumns();t=f.children();if(!t.length){t="";for(q=0;q<w.length;q++)t+='<div class="td '+e.columnClass(q)+'"></div>';f.append(t);t=f.children()}q=p&&p.isEditingRow(s.getId());if(v=(x=u.shouldRender()||0>s.getId()||q)&&d.onPage(f))k._valueAccessor=u,k._now=(new Date).getTime();for(var C=t.length,z=0;z<w.length;z++){var F=w[z],A;z>=C?(A=b('<div class="td '+e.columnClass(z)+'"></div>'),f.append(A)):A=b(t[z]);if(x){var D=q&&p.getCellEditor(s.getId(),F.getCsid()),G=f,B=u,K=s,J=D;m._cell$=A;m._row$=G;m._valueAccessor=B;m._row=K;m._cellEditor=J;try{F.render(m)}catch(O){d.warn("cannot render column "+F.getName(),O),A.empty()}finally{
m._cell$=null,m._row$=null,m._valueAccessor=null,m._row=null,m._cellEditor=null}if(v)if(D&&D.jb())a(A,"#ffbbbb");else if(v){var V;try{V=F.shouldFlash(k)}catch(U){d.warn(U)}V&&a(A,"#ffffbb")}}}k._valueAccessor=null;k._now=0;z<C&&t.slice(z).remove()}}}});define("structure/widget/ui/grid/TRCache","almworks/jquery underscore structure/widget/ui/grid/RowRenderer structure/widget/attributes/AttributeManager almworks/util/Util structure/widget/model/Items".split(" "),function(f,b,g,d,e,a){function n(c,h){function m(a,b){return!b|| !e.onPage(b)}function n(b,c){var d=F.aL(c),d=d&&a.getIssueIdFromItemId(d.getItemId());0<d&&b.attr("rel",d)}function p(a,c,d,f,g){var h=J.getValueNoLRU(a);if(!h)return!1;c=x(h,a,c,d,f,g);if(b.isBoolean(c))return c;m(a,h)||e.warn("TRCache: possible problem: displayed row cannot be updated: "+a+" ("+c+")");return!1}function x(a,b,d,f,g,h){g=F.aL(b)||C.aL(b)||g;if(!g)return "not-in-forest";e.assert(g.id==b,g.id+" "+b);h=c.getAttributeSubscription().getValueAccessor(b)||h;if(!h)return "not-subscribed";var k=h.getDataSequence(),k=g.sequence>k?g.sequence:k;if(!f&&k===G[b])return!1;G[b]=k;v.render(a,h,g);d&&A.fireEvent(r.bY,a);return!0}function t(a,f){if(f.columns){
var g=a.getColumns(),k=new d.AttributeSet;b.each(h,function(a){k.requireAttribute(a)});b.each(g,function(a){try{a.collectRequiredAttributes(k)}catch(b){e.error("Error while collecting required attributes. Column: "+a.getName()+", error: "+b)}});c.getAttributeSubscription().setUsedAttributes(k);J.removeMatching(m);w()}}function w(){J.forEach(function(a,b){x(b,e.toInt(a),!0,!0,null)});A.fireEvent(r.kE)}var v=new g(c),C=c.aT(),z=c.bd(),F=c.bs(),A=c.bD(),D=c.panelId,G={},B={},K="t"+c.sequence+"_",J=f.extend(new e.LRUCache(c.widget.config.rowCacheSize),{isExpungePossible:m}),O=e.delayed(25,function(){var a=B;B={};for(var b in a)if(a.hasOwnProperty(b)){var c=e.toIntSafe(b,0);0!==c&&p(c,!0,!1)}});this.tableRowTR=function(a,b,c,d){var e=J.getValue(a);e||(d=f("<div></div>"),d.addClass("tr "+D+"fullwidth"),d.attr("id",K+a),n(d,a),e=d,J.putValue(a,e),d= !0);d&&p(a,!1,!0,b,c);return e};this.getCachedRowTR=function(a){return J.getValue(a)};this.TRByRowId=function(a){var b=k.apputil.fJ(a);b||e.warn("rowr: bad rowId "+a);return f("#"+(K+b))};this.aM=function(a,b){J.getValueNoLRU(a)&&(delete G[a],b?(B[a]= !1,p(a,!0,!0)):(B[a]= !0,O()))};this.setUsedRows=function(a){a=c.getAttributeSubscription()
.setUsedRows(a);b.each(a,function(a){p(a,!0,!1)})};this.forEachRow=function(a){J.forEach(a)};c.getAttributeSubscription().addDataUpdateHandler(function(a){var b=e.numericKeys(a);if(b&&b.length){for(a=0;a<b.length;a++)p(b[a],!0,!1);setTimeout(function(){z.eY(b)},50);A.fireEvent(r.kE)}});this[r.ko]=t;this[r.REPLACE_ROW_IDS]=function(a,b,d){if(c.isUntransformedSpec(d)){d=0;for(var e=a.length;d<e;d++){var f=b[d],g=J.removeValue(a[d]);g&&f&& !J.getValueNoLRU(f)&&(g.attr("id",K+f),n(g,f),J.putValue(f,g))}}};this[r.FOREST_UPDATE_DISPLAYED]=function(a,b){if(a&&b)for(var c=a.from+a.count,d=a.from;d<c;d++){var e=b.row(d);p(e.id,!0,!1)}};this[r.bu]=function(a){b.each(a,function(a){p(a,!0,!0)})};A.addListener(new e.Life,this);t(c.af(),{columns: !0})}function c(a){return p(a[0])};function p(a){if(!a)throw Error("no element");a=a.id||f(a).attr("id");if(!a)throw Error("no id");var b=a.indexOf("_");if(0>b)throw Error("bad id "+a);return e.toInt(a.substring(b+1))}function m(a){if(!a)return null;a=f(a).closest(".tr");return a.length?c(a):null}var k=namespace("almworks.structure"),r=namespace("almworks.structure.appevents");f.extend(n,{getRowIdFromTR:c,getRowIdFromTRElement:p,getRowIdFromParentTR:m})
;k.getRowIdFromParentTR=m;return n});define("structure/widget/ui/view/ViewIdWrapper",["underscore","almworks/util/Util","structure/widget/perspective/CellBasedValueWrapper"],function(f,b,g){function d(a,d,c,e,f){b.addSuper(g,this)(f,a.widget);this.prefix=d;this.storage=a.widget.storage;this.lE=c;this.panel=a;this.defaultValue=e}var e=namespace("almworks.structure");b.extend(d.prototype,g.prototype,{key:function(){return this.prefix+".view"},perspectiveDisabled:function(){return!this.lE},serialize:b.asString,deserialize:b.toIntSafe,importModel:function(a){var b=this;0>a&& !this.forced&& !e.iJ(a)&&(a=0);if(a)this.valueCell.setValue(a);else{this.valueCell.setValue(0);var c=this.panel.getPanelSettingsKey();c&&this.panel.widget.jT.mD(c,function(a){c===b.panel.getPanelSettingsKey()&&(a||(a=e.FALLBACK_VIEW_ID),b.valueCell.setValue(a))})}}});return d});define("structure/widget/ui/view/ViewModificationsWrapper",["underscore","almworks/util/Util","structure/widget/perspective/StoredValueWrapper","structure/widget/perspective/StorageUtil"],function(f,b,g,d){function e(d,c,e,f){b.addSuper(g,this)(d.widget,d.panelName);this.viewId=c;this.prefix=e;this.bA=f;this.sessionOnly=a.iJ(c)}var a=
namespace("almworks.structure");b.extend(e.prototype,g.prototype,{key:function(){return this.bA?this.prefix+"view.mods":"view."+this.viewId+".mods"},serialize:function(a){if(!a)return "";a=f.pluck(a,"options");return d.serializeObject({mods:a})},deserialize:function(a){try{var c=d.deserializeObject(a);if(c&&"object"===typeof c&&c.mods&&c.mods.length)return c.mods}catch(e){b.warn("Cannot restore value",e)}return[]},defaultValue:[]});return e});define("structure/widget/ui/view/ViewWidthsWrapper",["underscore","almworks/util/Util","structure/widget/perspective/StoredValueWrapper","structure/widget/perspective/StorageUtil"],function(f,b,g,d){function e(a,d,e,f){b.addSuper(g,this)(a.widget,a.panelName);this.viewId=d;this.prefix=e;this.bA=f;this.sessionOnly=n.iJ(d)}function a(a){if(!a||"object"!==typeof a)return{};var d=n.MIN_COLUMN_WIDTH,e=n.MAX_COLUMN_WIDTH;b.eachOwn(a,function(a){"manual"===a||"preferred"===a?b.eachOwn(this[a],function(a){var b=this[a];"number"===typeof b&&b>=d&&b<=e||delete this[a]}):delete this[a]});return a}var n=namespace("almworks.structure");b.extend(e.prototype,g.prototype,{key:function(){return this.bA?this.prefix+"view.widths":"view."+this.viewId+".widths"},
deserialize:function(c){try{return a(d.deserializeObject(c))}catch(e){b.warn("Cannot restore value",e)}},defaultValue:{}});return e});define("structure/widget/ui/view/RecentViewsModel",["underscore","almworks/util/Util","structure/widget/perspective/StoredValueWrapper"],function(f,b,g){function d(a){b.addSuper(g,this)(a.widget);this.panel=a;this.recents=null;this.restore()}var e=namespace("almworks.structure");b.extend(d.prototype,g.prototype,{key:function(){return this.panel.panelName+".view.recent"},perspectiveDisabled: !0,serialize:function(a){return a.join("|")},deserialize:function(a){return "string"!==typeof a?null:f.filter(f.map(a.split("|"),b.toIntSafe),b.truthy)},defaultValue:[],importModel:function(a){this.recents=a},bf:function(){return this.recents},recordRecent:function(a){if(!(!a||0>a&& !e.iJ(a))){var d=this.bf(),c=b.indexOf(d,a);0!==c&&(0<c&&d.splice(c,1),a=b.addAll([],[a]),b.addAll(a,d,0,Math.min(d.length,14)),this.setValue(a))}}});return d});define("structure/widget/ui/state/UIStateBase",["underscore","almworks/util/Util","structure/widget/ui/state/UIStateSerializer","structure/widget/perspective/StorageManager","structure/widget/perspective/StoredValueWrapper"],
function(f,b,g,d,e){function a(d,c){b.addSuper(e,this)(d.widget,d.panelName);this.panel=d;this.options=c;var g=d.widget.storage;this.saveImmediate=f.bind(g.save,g,this);this.saveDelayed=b.delayed(a.storeDelay,this.saveImmediate)}b.extend(a.prototype,e.prototype,{importModel:b.pvc,bf:b.pvc,clear:b.noop,restore:function(a){f.defer(f.bind(e.prototype.restore,this,a))},prepareRowIds:function(a){return g.serialize(a,this.panel.bs(),this.options.groupLevelsCell.value(),this.options.signatureCell.value())},restoreRowIds:function(a){try{if(a)return g.deserialize(a,this.panel.bs(),this.options.groupLevelsCell.value(),this.options.signatureCell.value())}catch(c){b.warn("Cannot restore value",c)}return null},perspectivePath:b.pvc,save:function(a){a?this.saveImmediate():this.saveDelayed()},validatePerspectiveRows:function(a){var c=[];if(!b.isArray(a))return c;for(var d,e=0;e<a.length;e++){var f=a[e];"number"!==typeof f?d||(d= !0,this.panel.widget.az.iw(this.perspectivePath())):0<=f&&c.push(f)}return c},getStoreKeyCell:function(a){var c=this;return new b.Cell(c.options.panelSettingsKeyCell,function(b){var d=c.options.syncPrefix()+c.panel.panelName+"."+a;return b?d+"."+b:null})}});a.storeDelay=
500;return a});define("structure/widget/ui/state/ExpansionModel",["underscore","almworks/util/Util","structure/widget/ui/state/UIStateBase"],function(f,b,g){function d(a,d,e){return f.isFinite(b.asNumber(a))&&a>=d&&a<=e}function e(a,d){b.addSuper(g,this)(a,d);this.panel=a;this.expansionLevel=0;this.expanded={};this.forceExpanded=null;this.key=this.getStoreKeyCell("uistate.expansion")}var a=namespace("almworks.structure.appevents"),n=namespace("almworks.structure");b.extend(e.prototype,g.prototype,{clear:function(){this.expansionLevel=0;this.expanded={}},isExpanded:function(a){if(this.panel.getTitleRow()==a)return!0;var b=this.expanded[a];return!0===b|| !1===b?b:this.isDefaultExpanded(a)},isDefaultExpanded:function(a){a=this.panel.bs().aL(a);return! !a&&a.getDepth()<this.expansionLevel},fe:function(a){return this.panel.getTitleRow()==a? !0: !(!this.forceExpanded|| !this.forceExpanded[a])},updateForceExpanded:function(a){this.forceExpanded=null;if(a&&a.length){for(var d=[],e=0;e<a.length;e++){var f=a[e],g=f.length-1;0<g&&(f=f.slice(0,g),g=b.flipSet(f),this.forceExpanded?b.extendOwn(this.forceExpanded,g):this.forceExpanded=g,d=d.concat(f))}this.by(d,!0)}},aP:function(){
return f.reduce(this.expanded,function(a,b,d){return a+"."+(b?"+":"-")+d},""+this.expansionLevel,this)},by:function(a,d){"undefined"===typeof d&&(d= !0);d= ! !d;var e= !1;b.isArray(a)?a.forEach(function(a){this.setExpanded0(a,d)&&(e= !0)},this):e=this.setExpanded0(a,d);e&&this.saveChangedAndFire(a)},setExpanded0:function(a,b){return "number"!==typeof a&&"string"!==typeof a||this.isExpanded(a)===b|| !b&&this.fe(a)? !1:(b===this.isDefaultExpanded(a)?delete this.expanded[a]:this.expanded[a]=b,!0)},cC:function(a){this.setExpansionLevel(a?1E4:0)},adjustExpansionLevel:function(a){if(d(a,-1E4,1E4)){var b=this.expansionLevel,e=this.getMaxDepth();0>a&&(b=Math.min(b,e));b+=a;b>=e&&(b=1E4);this.setExpansionLevel(b)}},getMaxDepth:function(){for(var a=this.panel.bs(),b=0,d=0,e=a.size();d<e;d++)b=Math.max(b,a.rowDepth(d));return b},setExpansionLevel:function(a){a=Math.max(0,a);a=Math.min(1E4,a);if(d(a,0,1E4)){var e=0;a!==this.expansionLevel&&(e=a-this.expansionLevel,this.expansionLevel=a);var g={};e&&0!==a&&1E4!==a&&f.each(this.expanded,function(a,b){a&& !this.isDefaultExpanded(b)&&0<e&&(g[b]=a)},this);b.extendOwn(g,this.forceExpanded);a= !1;b.deepEquals(g,this.expanded)||(this.expanded=g,a= !0)
;(e||a)&&this.saveChangedAndFire()}},getExpansionLevels:function(){return{current:this.expansionLevel,maximum:this.getMaxDepth()}},cleanUp:function(){var a=this.panel.bd(),b= !1,d;for(d in this.expanded)this.expanded.hasOwnProperty(d)&& !a.contains(d)&&(delete this.expanded[d],b= !0);return b},aB:function(a,b){function d(e){e&&e.hasOwnProperty(a)&&(b&&(e[b]=e[a]),delete e[a])}d(this.expanded);d(this.forceExpanded)},ensurePathVisible:function(b){for(var d= !1,e=0,f=b.length-1;e<f;e++){var g=b[e];this.isExpanded(g)||(d=this.expanded[g]= !0)}d&&this.panel.bD().fireEvent(a.bu)},cutPathToExpanded:function(a){if(a&&a.length)for(var b=0,d=a.length-1;b<d;b++)if(!this.isExpanded(a[b])){a=a.slice(0,b+1);break}return a},lastExpandedRow:function(a){return f.last(this.cutPathToExpanded(a))},saveChangedAndFire:function(b){this.saveDelayed();b?this.panel.bD().fireEvent(a.bu,"number"===typeof b||"string"===typeof b?[b]:b):this.panel.bD().fireEvent(a.bu)},importModel:function(a){a&&(this.clear(),a=this.restoreRowIds(a),this.expansionLevel=b.toIntSafe(a.expansionLevel,0),this.expanded=n.apputil.validateRowMap(a.expanded),this.saveChangedAndFire())},bf:function(){return this.prepareRowIds({
expansionLevel:this.expansionLevel,expanded:this.expanded})},perspectivePath:function(){return this.panel.panelName+".uiState.expansion"}});return e});define("structure/widget/ui/state/SelectionModel",["almworks/jquery","underscore","almworks/util/Util","structure/widget/ui/state/UIStateBase"],function(f,b,g,d){function e(a,b){g.addSuper(d,this)(a,b);var c=this;this.panel=a;this.eventBus=a.bD();this.userSelect=p;this.hideUnselectedOn=(new g.Cell(!1)).pipeChanges(function(a){c.userSelect.hideUnselected=a})}function a(a){return{selected:c.apputil.validateRowMap(a.selected),defaultSelected: ! !a.defaultSelected,hideUnselected: ! !a.hideUnselected}};var n=namespace("almworks.structure.appevents"),c=namespace("almworks.structure"),p={defaultSelected: !1,selected:{},hideUnselected: !1};e.createDefault=function(a){return{defaultSelected: ! !a,selected:{},hideUnselected: !1}};e.createSelected=function(a){return{defaultSelected: !1,selected:a,hideUnselected: !1}};g.extend(e.prototype,d.prototype,{key:function(){return c.modes.GADGET?"":this.panel.panelName+".uistate.selection"},defaultValue:p,sessionOnly: !0,bf:function(){return this.prepareRowIds(this.userSelect)},importModel:function(a){
this.setMultiSelection(this.restoreRowIds(a));this.hideUnselectedOn.setValue(! !a.hideUnselected&&this.isAnythingSelected(this.panel.dH()))},restoreSelection:function(a,c){this.clear();if(a){var d=this;this.restore(function(a){a&&(b.isFunction(c)&&c(),d.eventBus.fireEvent(n.am))})}else b.isFunction(c)&&c()},clear:function(){this.userSelect=f.extend(!0,{},this.defaultValue)},perspectivePath:function(){return this.panel.panelName+".uiState.selection"},isSelected:function(a){if(a==this.panel.getTitleRow())return!1;a=this.userSelect.selected[a];return!0===a|| !1===a?a:this.userSelect.defaultSelected},toggleSelected:function(a){if(a&&a!=this.panel.getTitleRow()){var b= !this.isSelected(a);b===this.userSelect.defaultSelected?delete this.userSelect.selected[a]:this.userSelect.selected[a]=b;this.multiSelectUpdated()}},setMultiSelection:function(b){var c=this.userSelect;this.userSelect=g.deepClone(a(b));g.deepEquals(c,this.userSelect)||this.multiSelectUpdated()},multiSelectUpdated:function(a){this.save(!1);a||this.eventBus.fireEvent(n.am)},setSelectAll:function(a){this.importModel(e.createDefault(a))},toggleSelectAll:function(){this.setSelectAll(!this.isEverythingSelected(this.panel.bs()))}
,kz:function(a){var b=0,c,d=a.size(),e=this.userSelect;if(e.defaultSelected)for(c in b=d,e.selected){if(e.selected.hasOwnProperty(c)&&(!1===e.selected[c]&&a.contains(c)&&b--,0===b))break}else for(c in e.selected)if(e.selected.hasOwnProperty(c)&&(e.selected[c]&&a.contains(c)&&b++,b>=d))break;return b},kT:function(a){var b,c,d,e,f=this.panel.getTitleRow();if(this.userSelect.defaultSelected)for(b=[],c=0,d=a.size();c<d;)e=a.rowId(c),e===f|| !1===this.userSelect.selected[e]?c++ :(b.push(e),c=a.bH(c));else b=a.normalizeIdMap(this.userSelect.selected),f&&(a=b.indexOf(f),0<=a&&b.splice(a,1));return b},getSelected:function(a){var c=[],d,e,f,n,p,q=this.panel.getTitleRow();if(this.userSelect.defaultSelected)for(d=0,e=a.size();d<e;d++)f=a.rowId(d),!1!==this.userSelect.selected[f]&&f!==q&&c.push(f);else p={},b.each(this.userSelect.selected,function(b,d){b&&d!=q&&(n=a.indexOf(d),0<=n&&(c.push(g.toIntSafe(d)),p[d]=n))}),1<c.length&&c.sort(function(a,b){return p[a]-p[b]});return c},isAnythingSelected:function(a,b){var c,d,e,f=this.panel.getTitleRow(),g=this.userSelect;if(g.defaultSelected){c=0;for(d=a.size();c<d;c++)if(e=a.rowId(c),0<e&&e!==b&&e!==f&& !1!==g.selected[e])return!0;return!1}for(
e in g.selected)if(g.selected.hasOwnProperty(e)&&e!=b&&e!=f&&g.selected[e]&&a.contains(e))return!0;return!1},isEverythingSelected:function(a){var b,c,d,e=this.panel.getTitleRow(),f=this.userSelect;if(!f.defaultSelected){b=0;for(c=a.size();b<c;b++)if(d=a.rowId(b),d!=e&& !f.selected[d])return!1;return!0}for(d in f.selected)if(f.selected.hasOwnProperty(d)&&a.contains(d)&& !1===f.selected[d])return!1;return!0},cleanUp:function(){var a= !1,b=this.panel.bd(),c;for(c in this.userSelect.selected)this.userSelect.selected.hasOwnProperty(c)&& !b.contains(c)&&(delete this.userSelect.selected[c],a= !0);return a},aB:function(a,b){var c=this.userSelect.selected;c.hasOwnProperty(a)&&(b&&(c[b]=c[a]),delete c[a]);this.multiSelectUpdated(!0)},fireIfNoSelection:function(){this.isAnythingSelected(this.panel.bs())||this.eventBus.fireEvent(n.am)}});return e});define("structure/widget/ui/state/FocusModel",["underscore","almworks/util/Util","structure/widget/ui/state/UIStateBase","structure/widget/ui/state/SelectionModel"],function(f,b,g,d){function e(a,c,d,e){b.addSuper(g,this)(a,c);this.panel=a;this.expansionModel=d;this.selectionModel=e;this.eventBus=a.bD();this.selectionAnchor=this.forcedFocusedPath=
this.focusCandidate=this.focusedPath=null;this.key=this.getStoreKeyCell("uistate.focus")}function a(a,b){var c=this.focusedPath;this.focusedPath=a=this.expansionModel.cutPathToExpanded(a);b&&(this.forcedFocusedPath=a);this.save();var c=f.last(c),d=this.bc();c!==d&&(this.focusCandidate=this.panel.ae().findNextFocusAfterDeletion([d]),this.selectionAnchor=d,this.eventBus.fireEvent(p.eu,d,c,this.panel,b),this.selectionModel.fireIfNoSelection())}function n(a,c,d){a&&(c=b.indexOf(a,c),0<=c&&(d?a[c]=d:a=0<c?a.slice(0,c):null));return a}function c(a){var b=a[0];return(a=a[1])&&a.getPath?a.getPath(b):b}var p=namespace("almworks.structure.appevents"),m=namespace("almworks.structure");b.extend(e.prototype,g.prototype,{clear:function(){this.selectionAnchor=this.forcedFocusedPath=this.focusedPath=null},bf:function(){return this.prepareRowIds({focusedPath:this.focusedPath})},importModel:function(a){a&&a.focusedPath||(a={focusedPath:[]});a=this.restoreRowIds(a);var b=this.bc();this.clear();this.focusedPath=m.apputil.validateRowArray(a.focusedPath);this.forcedFocusedPath=this.focusedPath=this.getValidFocusedPath(this.focusedPath);this.selectionAnchor=a=this.bc();this.focusCandidate=this.panel.ae()
.findNextFocusAfterDeletion([this.bc()]);this.expansionModel.ensurePathVisible(this.focusedPath||[]);this.eventBus.fireEvent(p.eu,a,b,this.panel,!0)},ml:function(){return this.focusedPath},bc:function(){var a=this.focusedPath;if(!a|| !a.length)return null;a=f.last(a);return "number"!==typeof a?(b.warn("selected row nan: "+a),null):a},getForcedFocusedRow:function(){return this.forcedFocusedPath&&this.forcedFocusedPath.length?f.last(this.forcedFocusedPath):null},eJ:function(b,d){a.call(this,c(arguments),!1)},kK:function(b,d){a.call(this,c(arguments),!0)},restoreFocus:function(){var a=this.panel.ae(),b=this.bc();if(0>a.indexOf(b))if(b=this.focusCandidate,0<=a.indexOf(b))this.eJ(b,a);else{var b=this.ml(),c=null;if(b)for(var d=b.length-1;0<=d&& !(c=a.getPath(b[d]));d--);c?this.eJ(c):a.isEmpty()||this.eJ(a.rowId(0),a)}},ensureHasFocusedRow:function(a){this.bc()||a.isEmpty()||this.eJ([a.rowId(0)])},getValidFocusedPath:function(a){for(var b=this.panel.bs(),c=a.length-1;0<=c;--c){var d=b.getPath(a[c]);if(d)return d}return[]},focusRow:function(a,b,c){a=this.panel.bs().getPath(a);var e=null;if(!a)return!1;b&&1<a.length&&this.expansionModel.by(a.slice(0,a.length-1));if(c){b=this.panel.ae();
var f=this.expansionModel.lastExpandedRow(a),e=b.indexOf(f);if(!(0>e)){var g,m=this.selectionAnchor;b.contains(m)||((m=this.panel.bs().getPath(m))?(m=this.expansionModel.cutPathToExpanded(m),m=m[m.length-1]):(m=this.bc())&&b.contains(m)|| !(0<b.size())||(m=b.rowId(0)),this.selectionAnchor=m&&0<m?m:null);if(g=m){m={};if(f!=g)for(g=b.indexOf(g),f=Math.min(e,g),e=Math.max(e,g);f<=e;f++)m[b.rowId(f)]= !0;this.selectionModel.setMultiSelection(d.createSelected(m))}}e=this.selectionAnchor}this.kK(a);c&&(this.selectionAnchor=e);return!0},aB:function(a,b){var c=this.bc();this.focusedPath=n(this.focusedPath,a,b);this.forcedFocusedPath=n(this.forcedFocusedPath,a,b);if(c===a){var d=this;window.setTimeout(function(){d.bc()===b&&d.eventBus.fireEvent(p.eu,b,a,d.panel,!1)},0)}},perspectivePath:function(){return this.panel.panelName+".uiState.focus"}});return e});define("structure/widget/ui/state/ScrollModel",["underscore","almworks/util/Util","structure/widget/ui/state/UIStateBase","structure/widget/ui/UIUtil"],function(f,b,g,d){function e(c,d,e){b.addSuper(g,this)(c,d);this.panel=c;this.key=a.modes.ISSUE_PAGE?null:this.getStoreKeyCell("uistate.scroll");this.focusModel=e;this.value=n}var a=
namespace("almworks.structure"),n={scrolledPath:[],rowScroll:0,viewPortScroll:0};b.extend(e.prototype,g.prototype,{setRowScroll:function(a){if("number"===typeof a)a=this.panel.ae().indexOf(a);else{a=this.panel;var b=this.focusModel.bc(),b=a.ae().indexOf(b);a=a.bn().cE();a=b>a.to||b<a.from? -1:b}var e=this.panel,b=e.bn().cE();0>a&&(a=b.from+1);if(a>b.to||a<b.from)a=null;else{var f=e.widget.config.getFixedRowHeight(),g=b.pxto-b.pxfrom,e=e.ae(),l=e.size()*f,l=d.getViewportPositionRatio(l,g,b.pxfrom,1E4),h=e.size()-1;a=0>h||0===b.from||b.to===h?{scrolledPath:[],rowScroll:0,viewPortScroll:l}:{scrolledPath:e.getPath(e.rowId(a)),rowScroll:d.getViewportPositionRatio(g,f,a*f-b.pxfrom,1E4),viewPortScroll:l}}a&&(this.value=a)},restoreScroll:function(a){a||(a=this.value);if(a&&a.scrolledPath){var b=f.last(a.scrolledPath);this.key&&(b&& -1!=this.panel.ae().indexOf(b)?a&&"number"===typeof a.rowScroll&&(a=a.rowScroll/1E4,this.panel.bn().io(b,a)):this.panel.bn().setViewPortScroll(a.viewPortScroll/1E4))}},clear:function(){this.value=n},importModel:function(a){this.clear();a&&(this.value=a=this.restoreRowIds(a),this.restoreScroll(a))},bf:function(){return this.prepareRowIds(this.value)},
perspectivePath:function(){return this.panel.panelName+".uiState.scroll"}});return e});define("structure/widget/ui/state/UIStateModel","underscore almworks/util/Util structure/widget/perspective/StorageUtil structure/widget/ui/state/ExpansionModel structure/widget/ui/state/FocusModel structure/widget/ui/state/SelectionModel structure/widget/ui/state/ScrollModel".split(" "),function(f,b,g,d,e,a,n){var c=namespace("almworks.structure"),p=namespace("almworks.structure.appevents");return function(m){function k(a){var b=0;f.each(a.transforms,function(a){(a=a&&a.module&&m.widget.generatorRegistry.findGenerator(a.module))&&"grouper"===a.type&&b++});a.title&&b++;return b}function r(a){t.value()&&f.each([v,w,C,z],function(b){b.save(a)})}function l(a){var b=v.kT(a);if(!b.length){var c=C.bc();a.contains(c)&&b.push(c)}return b}var h=new b.Life,u=m.bD(),s=new b.Cell,q=new b.Cell,x=b.lazy(function(){return c.modes.GADGET&&window.name?window.name+".":c.modes.GH_TAB?"ghTab.":""}),t=new b.Cell(""),x={syncPrefix:x,panelSettingsKeyCell:t,groupLevelsCell:s,signatureCell:q},w=new d(m,x),v=new a(m,x),C=new e(m,x,w,v),z=new n(m,x,C),F=m.widget.ad.og(),A=new b.Lifecycle,x=f.partial(r,!0),D=f.bind(
n.prototype.setRowScroll,z);this[p.cK]=b.seq(D,x);this[p.REPLACE_ROW_IDS]=function(a,b,c){if(m.isUntransformedSpec(c)){c=0;for(var d=a.length;c<d;c++){var e=a[c],f=b[c];C.aB(e,f);w.aB(e,f);v.aB(e,f)}}};u.addListener(h,this);m.bd().events.addListener(h,c.ForestUpdateEvent.E,function(){if(!(0<m.pinnedItem.value()||c.modes.HISTORY||F.value())){var a=v.cleanUp();w.cleanUp()&&(a= !0);a&&v.multiSelectUpdated(!0)}});m.bs().events.addListener(h,c.ForestUpdateEvent.E,function(){u.postEvent(p.am,"forest")});m.rootPaths.pipe(w.updateForceExpanded.bind(w));b.extend(this,{isExpanded:f.bind(d.prototype.isExpanded,w),by:f.bind(d.prototype.by,w),cC:f.bind(d.prototype.cC,w),adjustExpansionLevel:f.bind(d.prototype.adjustExpansionLevel,w),setExpansionLevel:f.bind(d.prototype.setExpansionLevel,w),getExpansionLevels:f.bind(d.prototype.getExpansionLevels,w),aP:f.bind(d.prototype.aP,w),bc:f.bind(e.prototype.bc,C),ml:f.bind(e.prototype.ml,C),eJ:f.bind(e.prototype.eJ,C),kK:f.bind(e.prototype.kK,C),getForcedFocusedRow:f.bind(e.prototype.getForcedFocusedRow,C),ensureHasFocusedRow:f.bind(e.prototype.ensureHasFocusedRow,C),restoreFocus:f.bind(e.prototype.restoreFocus,C),setRowScroll:D,restoreScroll:function(a)
{void 0===a&&(a=b.noop);z.restore(b.seq(a,function(){u.fireEvent(p.UI_STATE_LOADED,m)}))},clear:function(){w.clear();v.clear();C.clear()},isSelected:function(a){return v.isSelected(a)? !0:a!==C.bc()||v.isAnythingSelected(m.bs())? !1:"auto"},isEverythingSelected:f.bind(a.prototype.isEverythingSelected,v),isAnythingSelected:f.bind(a.prototype.isAnythingSelected,v),toggleSelected:f.bind(a.prototype.toggleSelected,v),selectSubtrees:function(b){var c=l(b),d={},e,f,g,h;e=0;for(f=c.length;e<f;e++)if(g=c[e],h=b.indexOf(g),0<=h)for(g=h,h=b.bH(h);g<h;g++)d[b.rowId(g)]= !0;v.setMultiSelection(a.createSelected(d))},selectRoots:function(c){c=l(c);c=1===c.length&&c[0]==C.bc()?{}:b.flipSet(c);v.setMultiSelection(a.createSelected(c))},jo:f.bind(a.prototype.setSelectAll,v,!1),focusRow:function(a,b,c){C.focusRow(a,b,c);z.setRowScroll(a)},toggleSelectAll:f.bind(a.prototype.toggleSelectAll,v),kT:l,getSelected:function(a){var b=v.getSelected(a);if(!b.length){var c=C.bc();a.contains(c)&&b.push(c)}return b},mp:function(a){var b=v.kz(a);return 0<b?b:a.contains(C.bc())?1:0},kz:f.bind(a.prototype.kz,v),hideUnselectedOn:v.hideUnselectedOn,syncState:function(a,b){this.restoreState(this.syncSpec(a,b))},
unsyncState:function(){r(!0);A.cycle()},lb:function(a,b){a[m.panelName]=f.extend({},a[m.panelName],{uiState:{}});f.each([v,w,C,z],b)},importState:function(a){f.each([v,w,C,z],function(b){m.widget.storage.setValueFromSpec(a,b)});v.restoreSelection(! !v.bf(),f.bind(m.restoreScroll,m))},restoreState:function(a){t.value()&&(v.clear(),w.restore(),C.restore(),z.restore(),v.restoreSelection(a,f.bind(m.restoreScroll,m)))},syncSpec:function(a,b){var c=this,d=b.value();if(d){var e=g.getStorageKey(a),f=t.value(),f= ! !e&&(!f||e===f);t.setValue(e);q.setValue(d.signature);s.setValue(k(a));b.fieldSubCell("signature").pipeChanges(A.life(),function(a){q.setValue(a);c.restoreState(!0)});return f}}})}});define("structure/widget/ui/state/UIStateSerializer",["underscore","almworks/util/Util","structure/widget/model/Rows"],function(f,b,g){function d(d,a,f){this.forest=d;this.groupLevels=Math.max(0,b.asNumber(a,0));this.signature=b.asNumber(f,0)}f.extend(d.prototype,{serializeStateObject:function(d){var a={groupLevels:this.groupLevels,signature:this.signature};f.each(d,function(d,c){b.isObject(d)?a[c]=this.serializeRowMap(d):f.isArray(d)?a[c]=this.serializeRowPath(d):a[c]=d},this);return a},
deserializeStateObject:function(d){this.groupsIn=Math.max(0,b.asNumber(d.groupLevels,0));delete d.groupLevels;this.sameSignature=this.signature&&this.signature===b.asNumber(d.signature,0);delete d.signature;var a={};f.each(d,function(d,c){f.isArray(d)?a[c]=this.deserializeRowMap(d,"selected"===c):b.isObject(d)?a[c]=this.deserializeRowPath(d):a[c]=d},this);void 0!==a.expansionLevel&&(a.expansionLevel=b.asNumber(a.expansionLevel,0)+(this.groupLevels-this.groupsIn),a.expansionLevel=Math.max(0,a.expansionLevel));return a},serializeRowMap:function(b){var a=[],d=[],c,f,g,k;c=0;for(f=this.forest.size();c<f;c++)g=this.forest.row(c),k=g.getId(),g=g.getDepth(),d[g]=k,b.hasOwnProperty(k)&&a.push([{rowId:k,path:this.serializePath(d,g+1)},b[k]]);return a},deserializeRowMap:function(b,a){var d={};b.forEach(function(b){this.deserializeRowId(b[0],a).forEach(function(a){d[a]=b[1]},this)},this);return d},serializeRowPath:function(b){for(var a=this.forest,d=b.length-1;0<=d;d--){var c=b[d];if(a.contains(c))return this.serializeRowId(c)}return{}},deserializeRowPath:function(b){var a=this.deserializeRowId(b,!0);if(!a.length&&b.path&&b.path.length)for(var d=b.path.length-1;0<d&&(a=this.deserializeRowId({
path:b.path.slice(0,d)},!0),!a.length);d--);return a.length?this.forest.getPath(a[0])||[a[0]]:[]},serializeRowId:function(d){var a={rowId:b.toInt(d)};if(d=this.forest.getPath(d))a.path=this.serializePath(d,d.length);return a},serializePath:function(b,a){var d=[],c,f;for(c=0;c<a;c++)f=this.forest.aL(b[c]),d.push([f.itemId,f.semantics]);return d},deserializeRowId:function(d,a){var f=b.asNumber(d.rowId,0);if(f){if(this.sameSignature)return this.forest.contains(f)?[f]:[];if(g.isPersistentRow(f)&&this.forest.contains(f))return[f]}var c=d.path;if(!c|| !c.length)return[];var p={};this.eachPath(function(b,d,e){if(this.matchWithSkips(c,b,d))return p[e]= !0,!a});if(!b.isEmpty(p)|| !this.groupsIn||this.groupsIn!==this.groupLevels)return b.numericKeys(p);var m=0;this.eachPath(function(a,b,d){a=this.sameGroupsScore(c,a,b);a>m?(p=[d],m=a):a&&a===m&&p.push(d)});return m?a?[p[0]]:p:[]},eachPath:function(b){var a=this.forest,d=[],c,f,g;c=0;for(f=a.size();c<f&&(g=a.rowDepth(c),d[g]=c,!1!==b.call(this,d,g+1,a.rowId(c)));c++);},matchWithSkips:function(b,a,d){for(var c=this.groupLevels-this.groupsIn,f=0,g=0;f<b.length&&g<d;)if(this.rowMatches(b[f],a[g]))f++,g++;else if(0<c)c--,g++;else if(0>c)c++,f++;
else return!1;return f===b.length&&g===d},sameGroupsScore:function(b,a,d){var c=this.groupLevels,f;if(b.length!==d||d<=c)return 0;for(f=c;f<d;f++)if(!this.rowMatches(b[f],a[f]))return 0;a=a.slice(0,c);var g=1;for(f=0;f<c;f++)for(d=0;d<a.length;d++)if(this.rowMatches(b[f],a[d])){g++;a.splice(d,1);break}return g},rowMatches:function(b,a){var d=this.forest.row(a);return d.itemId===b[0]&&d.semantics===b[1]}});d.serialize=function(b,a,f,c){return(new d(a,f,c)).serializeStateObject(b)};d.deserialize=function(b,a,f,c){return(new d(a,f,c)).deserializeStateObject(b)};return d});define("structure/widget/ui/panel/PanelBanners","jquery almworks/jquery structure/widget/perspective/CellBasedValueWrapper almworks/util/Template almworks/util/Cell almworks/util/Util".split(" "),function(f,b,g,d,e,a){function n(b,c,d){a.addSuper(g,this)(b,d.widget,d.panelName);return a.extend(this,g.prototype,{key:c,defaultValue: !1,serialize:a.asString,deserialize:a.asBoolean,perspectivePath:c})}var c=d.load("structure.widget.ui.panel.panel-banner");return function(b){function d(g,m){function q(){w.value()?v.is(":visible")&&C.setValue(v.outerHeight(!0)):C.setValue(0)}function r(b,c,d){b=v.find("."+b);b.toggle(! !d)
;c.cycle();d&&c.life().bind(b,"click",function(b){b.preventDefault();b.stopPropagation();w.setValue(!1);a.safeCall(d,this);return!1})}if(!m)throw Error("options must not be null");var t=m.order,w=m.toggleCell;if("number"!==typeof t)throw Error("options must contain an order");var v=c.render$({kind:m.kind||""}),C=(new e(0)).pipeChanges(h),z=new a.Lifecycle,F=new a.Lifecycle;w||(w=new e(!1));var A=new e(!1);(new e(w,A,function(a,b){return a&& !b})).pipeChanges(function(a){a&&f.toggle(!0);v.toggle(a);v.attr("data-visible",a);f.find('.s-pb-banner[data-visible="true"]').length||f.hide();q()});v.find(".s-pb-banner-content").append(g);return a.extend(this,{banner$:v,remove:function(){w.setValue(!1);f.remove(v);var a=l.indexOf(this);-1!==a&&l.splice(a,1)},toggle:a.withThis(w,w.setValue),toggleCell:w,relayout:q,setClosingButtons:function(a){r("s-pb-hide",z,a&&a.hide);r("s-pb-close",F,a&&a.close);return this},getModel:a.lazy(function(){var a=m.modelKey;if(!a)throw Error("options must contain modelKey");return new n(w,a+"."+b.panelId,b)}),setStrictHide:function(a){A.setValue(a)},height:function(){return C.value()},order:function(){return t}})}var f=b.panel$.find(".s-pb-container"),g=(new e(0)
).pipeChanges(function(){f.toggle(0<g.value())}),l=[],h=a.bottlenecked(10,function(){g.setValue(f.is(":visible")?f.outerHeight(!0):0)});return a.extend(this,{appendBanner:function(a,b){for(var c=new d(a,b),e= -1,g=c.order(),h=0;h<l.length&& !(l[h].order()>g);h++)e=h;-1===e?(f.prepend(c.banner$),l.splice(0,0,c)):(l[e].banner$.after(c.banner$),l.splice(e+1,0,c));return c},relayout:function(){l.forEach(function(a){a.relayout()})},heightCell:g})}});define("structure/widget/ui/panel/QuickTransformationsBanner","underscore jquery almworks/jquery almworks/util/Template almworks/util/Cell almworks/util/Util structure/widget/ui/UIUtil structure/widget/transform/Transform almworks/util/JSON structure/widget/generator/GeneratorUtil".split(" "),function(f,b,g,d,e,a,n,c,p,m){var k=namespace("almworks.structure"),r=namespace("almworks.structure.apputil");return function(l){function h(){R.toggle(!1);Object.keys(fa).forEach(function(a){X[a].setValue(!1);delete fa[a]});ba= !1}function u(a){if(a.transforms){var b=[];a.transforms.filter(function(a){return a.quick}).forEach(function(a){b.push(a.quick.id);fa.hasOwnProperty(a.quick.id)||(fa[a.quick.id]=a.id,X.hasOwnProperty(a.quick.id)&&
X[a.quick.id].setValue(!0),R.toggle(!0))});Object.keys(fa).filter(function(a){return!f.contains(b,a)}).forEach(function(a){delete fa[a];X.hasOwnProperty(a)&&X[a].setValue(!1)})}else Object.keys(fa).forEach(function(a){delete fa[a];X.hasOwnProperty(a)&&X[a].setValue(!1)});s();R.relayout()}function s(){var a=E.copySpec();if(a.transforms){var b= !1;a.transforms.filter(function(a){return a.hasOwnProperty("quick")&& !X.hasOwnProperty(a.quick.id)}).forEach(function(a){delete fa[a.quick.id];delete a.quick;b= !0});b&&E.setTransforms(a.transforms)}}function q(a){return I.find(".aui-button[data-qtid="+a+"]")}function x(a){var b=Y.getTransformerType(a.key),c=b.createTransformer(a);c.init(a);c.setTransform(a);return c.getIconHtml()||b.getIconHtml()}function t(){R.banner$.find(".s-pb-toolbar").find(".s-pb-edit").toggle(l.isAdminable())};function w(b,c){b?k.ajax.doAjax({url:k.ajsbridge.localURL(k.ajax.RESOURCES2g.quickTransforms(b)),type:"GET",dataType:"json",success:function(d){d?d.forEach(F):v(b);t();a.safeCall(c)},error:function(c,d,e){a.warn("Unable to retrieve quick transformations for Structure",b,"(",d,e,")")}}):(t(),v("jql"),a.safeCall(c))}function v(b){F({module:
"com.almworks.jira.structure:filter-jql",params:P,key:c.Type.FILTER,quick:{id:J(b),name:a.text("s.w.widget.qt.+unresolved+.label")}});F({module:"com.almworks.jira.structure:filter-jql",params:{jql:"assignee = currentUser()"},key:c.Type.FILTER,quick:{id:J(b),name:a.text("s.w.widget.qt.+assigned2me+.label")}});C(b,"assignee","s.w.widget.qt.+byassignee+.label");C(b,"status","s.w.widget.qt.+bystatus+.label");C(b,"fixVersions","s.w.widget.qt.+byversion+.label");F({module:"com.almworks.jira.structure:extender-subtasks",params:{},key:c.Type.EXTENDER,quick:{id:J(b),name:a.text("s.w.widget.qt.+subtasks+.label")}})}function C(b,d,e){F({module:"com.almworks.jira.structure:grouper-field",params:{fieldId:d},key:c.Type.GROUPER,quick:{id:J(b),name:a.text(e)}})}function z(b){var c=a.find(L,function(a){return a.quick.id===b});return 0<=c?L[c]:null}function F(a){if(a.quick){L.push(a);var b=B(a,{liClass:"s-qf-toggle"});ma.append(b);I.hasClass("edit-mode")&&K(a);b=(new r.initAUIToggleButton(b.find(".aui-button"))).pipeChanges(function(b){if(b){if(!fa.hasOwnProperty(a.quick.id)){var c=z(a.quick.id);c&&E.addTransform(c)}}else(c=fa[a.quick.id])&&E.removeTransform(c);I.find(".s-qf-dropdown[data-qtid="+
a.quick.id+"]").attr("aria-pressed",b)});X[a.quick.id]=b;fa.hasOwnProperty(a.quick.id)&&X[a.quick.id].setValue(!0);return b}}function A(a){a.stopPropagation();a.preventDefault();if("true"!==g(this).attr("aria-disabled"))return D(!I.hasClass("edit-mode")),!1}function D(a){R.banner$.find(".s-pb-edit").toggleClass("pressed",a);I.toggleClass("edit-mode",a);a?L.forEach(K):I.find(".s-qf-dropdown").closest("li").remove()}function G(a){var b="string"===typeof a?a:a.quick.id;L=L.filter(function(a){return a.quick.id!==b});q(b).closest("li").remove();X[b].setValue(!1);delete X[b];delete fa[b]}function B(b,c){return g(a.renderTemplate('<li class="{liClass}"><div class="aui-button aui-button-compact s-qf automation-on-warning {buttonClass}" data-key="{key}" data-module="{module}" data-params="{params}" data-qtid="{id}" aria-disabled="{disable}"><span class="{iconClass}">{icon:html}</span><span class="s-qf-name">{name}</span></div></li>',{params:p.stringify(b.params),key:b.key,module:b.module,icon:x(b),name:b.quick.name,id:b.quick.id,liClass:c.liClass||"",buttonClass:c.buttonClass||"",iconClass:c.iconClass||"",disable:M}))}function K(a){var b=n.createDraggableButton(B(a,{liClass:"s-qf-edit",
buttonClass:"s-qf-dropdown aui-dropdown2-trigger aui-dropdown2-trigger-arrowless",iconClass:"s-ph-tr-icon"}));b.find(".aui-button").attr("aria-owns","edit-qf-popup-"+l.panelName).attr("aria-haspopup","true").append('<i class="s-fa s-fa-fw s-fa-caret-down s-qf-menu"/>').attr("aria-pressed",fa.hasOwnProperty(a.quick.id));ma.append(b)};function J(a){var b=a+"-";return b+(Math.max(0,f.max(L.map(function(a){return parseFloat(a.quick.id.substring(b.length))})))+1)}function O(){var b=E.bw().value().structureId;b&&k.ajax.doAjax({url:k.ajsbridge.localURL(k.ajax.RESOURCES2g.quickTransforms(b)),contentType:"application/json; charset=UTF-8",type:"PUT",data:p.stringify(L),error:function(c,d,e){a.warn("Unable to save quick transformations for Structure",b,"(",d,e,")")}})}function V(){var b=a.find(L,function(a){return "com.almworks.jira.structure:filter-jql"===a.module&&a.params.jql===P.jql});0<=b&&U(b)()}function U(a){return function(){if(a<L.length){var b=L[a];if(b.quick){var c=q(b.quick.id);if(c&&"true"===c.attr("aria-disabled"))return;c=R.toggleCell.value();b=X[b.quick.id];b.setValue(!b.value());Object.keys(X).some(function(a){return X[a].value()})?c||(R.toggle(!0),ba= !0):ba&&R.toggle(!1)}}
return!0}}var P={jql:"resolution is empty"},Y=l.widget.transformRegistry,N={},L=[],fa={},X={},M= !1,ba= !1;N["delete"]=function(a){G(a);O();R.relayout()};N.toggle=function(a){X.hasOwnProperty(a)&&(a=X[a],a.setValue(!a.value()))};N.edit=function(b){var c=a.find(L,function(a){return a.quick.id===b});if(!(0>c)){var d=L[c];if(d){var e="quickTransform=true&moduleKey="+encodeURIComponent(d.module)+"&params="+encodeURIComponent(p.stringify(d.params))+"&quickTransformName="+encodeURIComponent(d.quick.name);m.showEditGeneratorDialog(e,null,function(a){a=f.extend({},d,{quick:{id:d.quick.id,name:a.quickTransformName},params:f.omit(a,"quickTransform","quickTransformName")});L[c]=a;var e=q(b);e.find("span.s-qf-name").text(a.quick.name);e.find("i.alm").replaceWith(x(a));O();X.hasOwnProperty(b)&&X[b].value()&&E.updateTransform(f.extend({},a,{id:fa[b]}))})}}};var E=l.getSpecController(),I=g('<div class="s-ph-quick-transformations s-ph-transforms-scrollable"><ul class="s-ph-transforms ui-sortable"></ul></div>'),ma=I.find("ul"),R=l.getPanelBanners().appendBanner(I,{order:1,modelKey:"ph.quick.transforms",kind:"s-transform"});R.toggleCell.pipeChanges(function(a){!a&&h()});(function(){var a=l.ah();
a.register("toggleUnresolved",V);for(var b=1;9>=b;b++)a.register("quick-transform.toggle."+b,U(b-1));a.register("toggleQuickTransform",function(){R.toggle(!R.toggleCell.value());return!0})})();(function(){R.setClosingButtons({close:h});var b=R.banner$.find(".s-pb-toolbar");b.prepend(a.renderTemplate('<a href="#" class="s-pb-edit" title="{title}" style="display: none;"><i class="alm alm-edit-small"/></a>',{title:a.text("s.w.widget.qt.edit.title")}));b.find(".s-pb-edit").on("click",A);l.getInfoCell().pipeOnce(a.identity,function(){t()})})();(function(){var c=(new d('<div id="{id}" class="edit-qf-popup aui-dropdown2 aui-style-default" data-dropdown2-alignment="left"><ul class="aui-list-truncate"></ul></div>')).render$(b,{id:"edit-qf-popup-"+l.panelName}),e=c.find("ul");e.append(a.renderTemplate('<li><a href="#" data-action="toggle">{s.w.widget.qt.toggle.action}</a></li>'));e.append(a.renderTemplate('<li><a href="#" data-action="edit">{s.w.widget.qt.edit.action}</a></li>'));e.append(a.renderTemplate('<li><a href="#" data-action="delete">{s.w.widget.qt.delete.action}</a></li>'));I.append(c);c.on("click","a",function(){var a=g(this),b=I.find(".s-qf-dropdown.aui-dropdown2-active"),a=
a.data("action");if(N.hasOwnProperty(a)&&(b=b.data("qtid"),void 0!==b))N[a](b)})})();E.bw().pipeDebounced({wait:10,waitInit:10,immediateCall: !1},function(a,b){b&&(a.structureId&&a.structureId===b.structureId||a.sQuery&&b.sQuery&&a.sQuery.type===b.sQuery.type)?u(a):(L.forEach(G),D(!1),w(a.structureId,function(){fa={};u(a)}))});(new e(l.widget.automationOn,l.widget.bF.visibleCell,a.or)).pipeChanges(function(a){M=a;I.find(".aui-button").attr("aria-disabled",a);R.banner$.find(".s-pb-edit").attr("aria-disabled",a)});n.sortableBanner(ma,{item:"li.s-qf-edit",done:function(a,b){if(0<=a&&a<L.length&&0<=b&&b<L.length&&a!==b){var c=L[a];L.splice(a,1);L.splice(b,0,c);O();c=ma.find(".s-qf-toggle");a<b?c.eq(a).insertAfter(c.eq(b)):c.eq(a).insertBefore(c.eq(b))}}});return a.extend(this,R,{addTransform:function(a,b){if(l.isAdminable()){var c=E.bw().value();if(c&&c.structureId){var d=f.pick(a,"module","params","key");d.quick={id:J(c.structureId),name:b};F(d);O();a.id&&E.replaceTransform(a.id,d)}}}})}});define("structure/widget/ui/panel/MultiSelectionBanner","almworks/jquery underscore almworks/util/Util almworks/util/Template almworks/util/Binding structure/widget/model/Items".split(" "),function(
f,b,g,d,e,a){var n=namespace("almworks.structure.apputil"),c=namespace("almworks.structure.appevents"),p=d.load("structure.widget.ui.panel.panel-multi-selection"),m=g.text("sw.widget.ms.hide.remove.tooltip");return function(d){function f(a){var b=d.bs(),c=h.bc(),e=b.indexOf(c),g=b.size(),l;a=a?1: -1;for(var m=e+a;m!=e;m+=a){0>m&&(m=g-1);m>=g&&(m=0);var n=b.rowId(m);if(h.isSelected(n)){l=n;break}}h.focusRow(l||c)}function l(){v.setValue(!1);w.toggle(!1);h.jo()}var h=d.ao(),u=d.ah(),s=p.render$(),q=e.getBindings(s),x=q["bulk-change-btn"],t,w=d.getPanelBanners().appendBanner(s,{order:100,modelKey:"ph.multi.selection",kind:"s-m-selection"});w.toggleCell.pipeChanges(function(a){a||l()});var v=n.initAUIToggleButton(q["hide-unselected-btn"],h.hideUnselectedOn);w.install=function(){this.getModel().restore();this.banner$.find(".s-pb-close").attr("title",m)};d.bD().addListener(new g.Life,c.am,function(){var c=d.dH();if(h.isAnythingSelected(c)){w.toggle(!0);var e=h.getSelected(c);if(b.isEqual(e,t))return;t=e;var f=b.size(e),f=2>f?g.text("s.w.widget.ms.selected.+1+"):g.text("s.w.widget.ms.selected.+n+",f);q["selected-items-info"].text(f);for(var f=void 0,l= !1,m=0;m<e.length;m++){var n=c.aL(
e[m]),n=a.getIssueIdFromItemId(n.getItemId());if((f=f||n)&&n&&f!==n){l= !0;break}}l?x.removeAttr("aria-disabled"):x.attr("aria-disabled",!0)}else w.toggle(!1);return!0});q["previous-selection-btn"].on("click",function(){f(!1)});q["next-selection-btn"].on("click",function(){f(!0)});x.on("click",function(a){u.action("bulkChange",a)});w.setClosingButtons({close:l});return g.extend(this,w)}});define("structure/widget/ui/panel/RecentItemsWarningBanner",["almworks/jquery","underscore","almworks/util/Util","almworks/util/Template","almworks/util/Binding"],function(f,b,g,d,e){var a=d.load("structure.widget.ui.panel.panel-recent-items-warning");return function(b){var c=a.render$(),d=e.getBindings(c),f=new g.Cell(!1);b.getPanelBanners().appendBanner(c,{order:3,modelKey:"ph.recent.items.warning",toggleCell:f});g.extend(this,{showForSpec:function(a){a=a&&a.sQuery&& !a.sQuery.query&&a.sQuery.type;d.recentItemsWarningText.text(g.text("s.w.recent.items.banner.text.+"+a));f.setValue(! !a)}})}});define("structure/widget/ui/panel/header/QueryInput",
"jquery almworks/jquery almworks/util/AwesomeTextarea almworks/util/Template almworks/util/Cell almworks/util/BrowserState almworks/util/Util structure/widget/ui/Tooltip".split(" "),function(f,b,g,d,e,a,n,c){var p=namespace("almworks.structure"),m=namespace("almworks.structure.ajsbridge"),k=namespace("almworks.structure.jqlutil");return function(a,f){function h(){var a=O.value();return q()&&a?d.build("p",function(b){return[a.map(function(a){return b()(a)})]}).renderHtml():""}function u(a){function c(a,d){if(a===K.value()){var e=d?d.errors:null,f= ! !e&& ! !e.length;O.setValue(f?e: !1);f||q()&&O.value()||a&&b.trim(a)===b.trim(B.value())||B.setValue(a)}}q()&&a?b.getJSON(m.localURL(p.ajax.RESOURCES2g.QUERY.VALIDATE),{q:a,type:J.value()},n.curry(c,a)):c(a)}function s(){var a=A.text();a&& !O.value()&&A.hasClass("jqlerror")&&O.setValue([a])}function q(){var a=J.value();return "jql"===a||"sjql"===a}function x(){var b=a.data("jqlAutocomplete");b&&(b.disable(),b.dropdownController.dropdown.remove(),a.data("jqlAutocomplete",null))}function t(){"jql"===J.value()&&w()}function w(){k.loadSearchData().always(function(){x();if("jql"===J.value()){var b=k.createAutocomplete({fieldID:z,errorID:F,
updateParseIndicator:s,completeField:function(){Y.updateCell(Y.getViewValue())}});b&&(a.data("jqlAutocomplete",b),b.enable())}})}f||(f={});var v,C=new n.Lifecycle,z=a.attr("id"),F=z+"-jql-error",A=(new d('<div id="{id}"></div>')).render$({id:F}),D=(new d('<i class="s-fa s-fa-check-circle error-status s-tooltip"></i>')).render$(),G=(new d('<i class="s-fa s-fa-times-circle st-query-clear" title="{sw.widget.ph.query.clear}"></i>')).render$(),B=f.queryCell||new e,K=new e,J=f.typeCell||new e,O=f.errorCell||new e(!1),V=new e(!1),U=n.delayed(100,function(){var b=a.prop("scrollHeight")-a.innerHeight(),c= ! !(a.is(":focus")&&0<b);V.setValue(c);if(c&&(c=a.prop("selectionStart"))){var d=a.val().length;c>=d-1&&a.scrollTop(b)}});a.on("blur focus",U);var P=n.delayed(50,function(){var b=J.value();a.attr("placeholder",n.text("sw.widget.ph.option.+"+b+"+.placeholder"));u(K.value());"jql"===b?w():x()}),Y=new n.TextPresenter(K,a);return n.extend(this,{init:function(){C.cycle();a.wrap('<div class="st-query-input"><div></div></div>');a.parent().prepend(D).append(G).append(A);a.on("keypress",function(b){return 13!==b.keyCode||(b=a.data("jqlAutocomplete"),b&&b.dropdownController.displayed)? !0:(
K.setValueForced(a.val()),n.safeCall(f.onEnterPressed),!1)});B.pipe(C,n.curryThis(K,K.setValue));J.pipe(C,P);(new e(O,J,function(a){return q()? ! !a:null})).pipe(C,function(a){null===a?D.removeClass("s-fa-check-circle s-fa-exclamation-circle s-success s-error").addClass("s-fa-quote-left"):D.removeClass("s-fa-quote-left").toggleClass("s-fa-check-circle s-success",!a).toggleClass("s-fa-exclamation-circle s-error",a)});K.pipeDebounced(C,{waitInit:500,wait:500,immediateCall: !1},u);v=new g(a);v.height.pipeChanges(C,t);G.on("click",function(){K.setValue(null);a.focus();return!1});var b=n.lazy(function(){var a=p.apputil.getScrollBarSize().width;return 6<a?a-3:a});K.pipe(C,U);V.pipe(C,function(a){G.css("right",a?parseInt(G.css("right"),10)+b():"")});c.options(D,{title:h});return this},relayout:function(){v&&a.is(":focus")&&v.updateHeight();U()},setType:function(a){J.setValue(a)},getError:function(){return O.value()},getQuery:function(){return B.value()}})}});define("structure/widget/ui/panel/header/SQueryOption",["underscore","almworks/util/Template","structure/widget/ui/panel/header/QueryInput","almworks/util/Util"],function(f,b,g,d){var e={jql:'<i class="alm alm-fw alm-jql-query"></i>',
text:'<i class="alm alm-fw alm-text-query"></i>',cql:'<i class="alm alm-fw alm-cql-query"></i>'};return function(a,f,c){a+="-query-option-input";var p=(new b('<textarea id="{id}" name="jqlQuery" rows="1" class="s-ph-primary-input ajs-dirty-warning-exempt focus-select-end focused"></textarea>')).render$({id:a}),m=new g(p,{queryCell:f,typeCell:c,onEnterPressed:function(){p.blur()}});return{label:function(){return d.text("sw.widget.ph.tool.search.short.+"+c.value())},iconHtml:function(){return e[c.value()]},relayout:m.relayout,focus:d.withThis(p,p.focus),show:function(a){p.hide();p.appendTo(a);m.init();p.show()},isInputFocused:function(){return p.is(":focus")},getQuery:function(){return{query:f.value()||"",type:c.value()}}}}});define("structure/widget/ui/panel/header/ClipboardOption",["almworks/util/Util"],function(f){return function(b){return{label:f.text("sw.widget.ph.tool.clipboard"),iconHtml:'<i class="s-fa s-fa-fw s-fa-clipboard"></i>',show:function(f){b.setSpec({type:"clipboard"})}}}});define("structure/widget/ui/panel/header/ProjectOption",["almworks/util/Util"],function(f){var b=namespace("almworks.structure");return function(g){f.assert(b.modes.getStructurePageId()===
b.PAGE_IDS.PROJECT,"project page id expected");return{label:f.text("sw.widget.ph.tool.project"),iconHtml:'<i class="s-fa s-fa-fw s-fa-rocket"></i>',show:f.noop,getQuery:function(){return g}}}});define("structure/widget/ui/panel/header/StructureSelector","jquery almworks/jquery underscore structure/widget/ui/panel/header/SQueryOption structure/widget/ui/panel/header/ClipboardOption structure/widget/ui/panel/header/ProjectOption structure/widget/ui/UIUtil almworks/util/Template almworks/util/Binding almworks/util/Cell almworks/util/Util".split(" "),function(f,b,g,d,e,a,n,c,p,m,k){var r=namespace("almworks.structure"),l=namespace("almworks.structure.ajsbridge"),h=namespace("almworks.structure.appevents"),u=c.load("structure.widget.ui.panel.panel-structure-selector");return function(s){function q(a){(a=M[a])&&a.focus&&a.focus()}function x(a){g.delay(function(){t(a)},10);return!1}function t(a){if(!s.canChangePanelState())return!1;Q.setValue(a);q(a);return!0}function w(a,b){var c=M[b],d=M[a];d&&(F(d.label,d.iconHtml),d!==c&&(ia.empty(),k.safeCall(d.show,d,ia)))}function v(a){if(a)if(a.structureId)Q.setValue(null),C(a.structureId);else if(ga.removeAttr("title"),a.sQuery)if(
a.sQuery.projectQuery)Q.setValue("project");else{m.prototype.multiUpdate(!0);try{va.setValue(a.sQuery.query),Q.setValue(a.sQuery.type)}finally{m.prototype.multiUpdate(!1)}}else a.hasOwnProperty("type")&&Q.setValue(a.type)}function C(a,b){var c={structureId:a};k.deepEquals(N.bw().value(),c)||(ia.empty(),b&&(F(b,'<i class="alm alm-fw alm-structure"></i>'),s.setSpec(c)))}function z(a){a&&s.setSpec({sQuery:a})}function F(a,b){g.isFunction(a)&&(a=a());g.isFunction(b)&&(b=b());var c=k.renderTemplate((b||"")+"{label}",{label:a});ga.html(c);da.html(c);ya.setValue(Math.ceil(da.outerWidth(!0))+1)}function A(a){if(void 0!==a){ia.empty();var b=a&&a.name||k.text("sw.widget.ph.unknown.structure");a=a&&a.description;a=b+(a?" - "+a:"");F(b,'<i class="alm alm-fw alm-structure"></i>');ga.attr("title",a)}}function D(a){a&&K(r.ajax.RESOURCES2g.STRUCTURE+"/recents?id="+a,"POST")}function G(a,b){if(b&&b.items&&b.items.length){var c=B(a,b.items);c&&S.find(".s-ph-insert-sections-before").before(c);return!0}return!1}function B(a,b){var d=ta.value();d&&"sw.widget.ph.section.favorites"!==a&&(b=b.filter(function(a){return a.id!==d}));return b.length?c.build("div","ul","li","a","i",function(c,d,e,f,g,h){
return[c(".aui-dropdown2-section.s-ph-recent-fav-sections")(h.tag("strong")()(h.i18n(a)),d(".aui-list-truncate.structure-list")(h.forEach(b,function(a){return e()(f({href:P(a),rel:a.id,class:"structure-link",title:a.name})(g({class:"alm alm-fw alm-structure"}),a.abbreviatedName))})))]}).render$():null}function K(a,b,c,d){r.ajax.doAjax({url:l.localURL(a),dataType:"json",type:b,timeout:3E4,success:c,error:d})}function J(a,b){var c=k.toIntSafe(s.widget.getAnchorIssue()),d=r.ajax.RESOURCES2g.STRUCTURE_LIST;c&&(d+="?anchorIssue="+c);K(d,"GET",function(b){k.safeCall(a,this,O(b))},b)}function O(a){function b(a,f){var g={items:[],more:0};if(!a)return g;var h=c;a.forEach(function(a){var b=d[a];b&&(g.items.push(b),a===e&&h++)});g.items.length>h&&g.items.splice(h,g.items.length-h);f>h&&(g.more=f-h);return g}var c=k.toIntSafe(a.maxItems,10),d=V(a.structures),e=s.getStructureId(),f={};a.recent&&(f.recent=b(a.recent));a.favorites&&(f.favorites=b(a.favorites,k.toIntSafe(a.totalFavorites)));a.defaults&&(f.defaults=b(a.defaults));a.anchorIssue===k.toIntSafe(s.widget.getAnchorIssue())&&(f.anchorIssue=a.anchorIssue,f.containingAnchor=b(a.containingAnchor,k.toIntSafe(a.totalContainingAnchor)));
return f}function V(a){var b={};if(!a)return b;g.each(a,function(a){var c=k.toIntSafe(a.id);0<c&&(a=k.extend({},a),a.abbreviatedName=k.abbreviateLabel(a.name||"["+c+"]"),a.description=a.description||"",b[c]=a)});return b}function U(){E||(E= !0,I=null,ba+=2E4<=ba?0:1E3,J(aa,k.delayed(ba,U)))}function P(a){return l.localURL("/secure/StructureBoard.jspa?s="+a.id)}function Y(){function a(c){var d=S.find("li:visible a");if(d.length){var e= -1;d.each(function(a){if(b(this).is(".active"))return e=a,!1});0>e?e=0<c?0:d.length-1:(e+=c,e=Math.max(0,Math.min(e,d.length-1)));d.removeClass("active aui-dropdown2-active").eq(e).addClass("active aui-dropdown2-active")}}function d(a){f.empty();(a=a.structures)&&a.length?(m.text(k.text("sw.widget.ph.section.found")),m.removeClass("s-not-found")):(m.text(k.text("sw.generic.not-found")),m.addClass("s-not-found"));a&&a.forEach(function(a){f.append((new c('<li><a href="{url}" rel="{id}" class="structure-link">{name}</a></li>')).render$({url:P(a),id:a.id,name:a.name}))})}function e(){f.empty();m.text(k.text("sw.widget.ph.section.search.error"))}var f=X["structure-search-results"],h=f.parent(),l=X["search-structure-input"],m=X["structure-search-status"],q=
 !(!r.modes.ISSUE_PAGE&& !r.modes.GH_TAB);n.AJS$Bind(S,"aui-dropdown2-show",function(){sa.setValue(null);g.defer(function(){l.focus()})});n.AJS$Bind(l,"keydown",function(b){if(b&&b.target&&S.is(":visible")){var c=b.keyCode;if(27===c||9===c)ga.trigger("aui-button-invoke");else if(38===c)a(-1);else if(40===c)a(1);else if(13===c)S.find("li:visible a.active").trigger("click");else return;b.preventDefault();b.stopPropagation()}});new k.TextPresenter(sa,b(l));sa.pipeBottlenecked(250,function(a){var b=S.find(".s-ph-recent-fav-sections"),c= !a,g=c&& !q;n.toggleDropdownListItems(b,c);n.toggleDropdownListItems(T,g);n.toggleDropdownListItems(Aa,g&&Z.value());h.toggle(! !a);a?K(r.ajax.RESOURCES2g.STRUCTURE+"?limit=20&name="+encodeURIComponent(a),"GET",d,e):f.empty()})}var N=s.getSpecController(),L=s.panelId+"-options",fa=u.render$(f,{optionsId:L}),X=p.getBindings(fa),M={},ba=0,E,I,ma,R,S=X["#"+L],ga=X["options-selector"],da=X["options-selector-shadow"],ia=X["option-controls"],T=X.tools,Aa=S.find("a[data-option=cql]").closest("li"),Z=s.widget.jiraConfig.getConfluenceConfigCell().fieldSubCell("licensed"),va=new m,Q=new m,sa=new m,ta=new m(N.bw(),function(a){return a?a.structureId:0}),ya=new m(0)
,L=new m(Q,ya,function(a,b){return Math.max(100,a?b+180:b)});M.text=M.jql=M.cql=new d(s.panelId,va,Q);if(r.modes.getStructurePageId()===r.PAGE_IDS.PROJECT){var qa=s.getSpecController().getProjectPageSpec();qa||k.error("project page should be defined");M.project=new a(qa.sQuery)}else qa=S.find('a[data-option="project"]').closest("li"),n.toggleDropdownListItems(qa,!1);M.clipboard=new e(N);n.AJS$Bind(S,"click","a[data-option]",function(){return x(b(this).data("option"))});n.AJS$Bind(S,"hover","a.structure-link",function(){I=b(this).attr("rel")});n.AJS$Bind(S,"hover","li a",function(){S.find("li a").removeClass("active aui-dropdown2-active");b(this).addClass("active aui-dropdown2-active")});n.AJS$Bind(S,"click","a.structure-link",function(a){var c=this;g.delay(function(){if(s.canChangePanelState()){var a=b(c).attr("rel"),a=k.toIntSafe(a);D(a);var d=b('a.structure-link[rel="'+a+'"]').first();d.length&&(d=d.first().text(),C(a,d))}},10);a.preventDefault();return!1});n.AJS$Bind(ga,"mousedown",function(){S.is(":visible")||U()});s.ah().register("selectStructure",function(){if(r.modes.GADGET)return!1;S.is(":visible")||(ga.trigger("aui-button-invoke"),U())});s.ah().register("toggleQuery",
function(){if(r.modes.GADGET||r.modes.ISSUE_PAGE||r.modes.GH_TAB)return!1;var a=Q.value(),b=a&&g.contains(["text","jql","cql"],a)&&M[a];if(b&& !b.isInputFocused())return b.focus(),!0;a="text"===a?"jql":"jql"===a&&Z.value()?"cql":"text";return t(a)});var aa=function(a){var c=s.getStructureId(),d=r.modes.getStructurePageId();!s.isPrimary()||d!==r.PAGE_IDS.BOARD&&d!==r.PAGE_IDS.BOARD_WITH_DETAILS||D(c);E= !1;R===c&&k.deepEquals(ma,a)||(R=c,ma=a,ba=0,S.find(".s-ph-recent-fav-sections").remove(),G("sw.widget.ph.section.containingAnchor",a.containingAnchor),c=G("sw.widget.ph.section.recent",a.recent),d=G("sw.widget.ph.section.favorites",a.favorites),c&&d||G("sw.widget.ph.section.defaults",a.defaults),a=b("a.active",S),a.length||(I&&(a=b('li a[rel="'+I+'"]',S).first()),a.length||(a=b("li a",S).first()),a.addClass("active aui-dropdown2-active")))};s.widget.eventBus.addListener(null,h.be,function(a,c){var d=c?c.length:0;b(".s-ph-cb-size",T).toggle(0!=d).text(d)});return k.extend(this,{install:function(a){fa.appendTo(a);Q.pipe(w);N.bw().pipe(v);(new m(va,Q,function(a,b){var c=M[b];return c?k.safeCall(c.getQuery,c):null})).pipeChanges(z);(new m(ta,s.getInfoCell(),function(a,b){return null===
b?null:b&&a&&b.id===a?b:void 0})).pipeDebounced({wait:10,waitInit:10},A);Y();U()},relayout:function(){var a=M[Q.value()];a&&a.relayout&&a.relayout()},focusQuery:function(){Q.value()&& !va.value()&&q(Q.value())},setSingleStructureMode:function(a){k.toggleAttr(ga,"aria-disabled",! !a)},desiredWidthCell:L})}});define("structure/widget/ui/panel/header/PanelHeader","almworks/jquery jquery underscore almworks/util/Template almworks/util/Binding almworks/util/DOMUtils almworks/util/JSON structure/widget/ui/panel/header/QueryInput almworks/util/Keyboard structure/widget/spec/SpecController structure/widget/transform/Transform structure/widget/transform/Filter structure/widget/ui/panel/QuickTransformationsBanner structure/widget/ui/panel/MultiSelectionBanner structure/widget/ui/panel/RecentItemsWarningBanner structure/widget/ui/panel/header/StructureSelector almworks/util/Util structure/widget/ui/panel/header/SearchModel structure/widget/ui/panel/header/TwoPanelModeWrapper structure/widget/ui/Tooltip structure/widget/ui/UIUtil structure/widget/ui/GeneratorsDropDown almworks/util/CellPresenter structure/widget/generator/GeneratorUtil".split(" "),function(f,b,g,d,e,a,n,c,p,m,k,r,l,h,u,s,q,x,
t,w,v,C,z,F){var A=namespace("almworks.structure");namespace("almworks.structure.jqlutil");var D=namespace("almworks.structure.apputil"),G=namespace("almworks.structure.appevents"),B=q.requireOptional("structure/page/issue/IssuePageParams"),K=d.load("structure.widget.ui.panel.panel-header"),J=d.load("structure.widget.ui.panel.panel-search"),O=d.load("structure.widget.ui.panel.panel-transforms"),V={relayout:q.noop,model:(new q.Cell).setConstant(!1),getModel:function(){return this},restore:q.noop,perspectivePath:null,bf:q.returnFalse,toggle:q.noop,setClosingButtons:q.noop,toggleCell:(new q.Cell).setConstant(!1),showForSpec:q.noop,install:q.noop,addTransform:q.noop,setStrictHide:q.noop},U=0;return function(P){function Y(c,e){function h(c,e,na){function Ma(a){q.Cell.prototype.multiUpdate(!0);try{a?(Ca&&Ca!==m&&Ca.toggle.setValue(!1),Ca=m,ea.search.setValue(!1),ea.query.setValue(p.query.value()),ea.queryType.setValue(p.type.value()),T()):Ca&&Ca.getTransformer()===p&&(Ca=null),ea.filter.setValue(a)}finally{q.Cell.prototype.multiUpdate(!1)}}function N(){oa();s=(new d('<div class="aui-button aui-button-compact"><span class="s-ph-tr-icon"></span><span class="s-ph-tr-label"></span>'+(
c.permanent?"":'<i class="alm alm-close s-ph-filter-remove"></i>')+"</div>")).render$(b);x=f(".s-ph-filter-remove",s);w=f(".s-ph-tr-icon",s);var a=new q.Cell(!1);D.initAUIToggleButton(s,a);p.query.pipe(function(a){s.toggle(! !a)});p.type.pipe(function(){w.html(p.getIconHtml())});m.toggle=a;s.click(function(){"true"!==s.attr("aria-disabled")&&Ma(a.value())});a.pipeChanges(function(a){a||p.query.value()||k()});x.click(function(){a.value()&&(ea.filter.setValue(!1),Ca=null);return!1})}function J(){s=(new d('<div class="aui-button aui-button-compact s-qf"><span class="s-ph-tr-icon"></span><span class="s-ph-tr-label"></span><i class="alm alm-close s-ph-filter-remove"></i></div>')).render$(b);x=f(".s-ph-filter-remove",s);w=f(".s-ph-tr-icon",s);s.click(function(){s.blur()})}function A(){var g=ra.findGenerator(c.module),g=g&&g.notConfigurable,l="tr-holder-"+U++,m=p.createConfigurator$(),n=(new d('<div class="aui-dropdown2-section s-ph-dd-buttons"><ul class="aui-list-truncate"></ul></div>')).render$(),u=(new d('<li><a href="#"><i class="s-fa s-fa-fw s-fa-edit"></i>{sw.widget.ph.transforms.edit}</a></li>')).render$(),r=(new d(
'<li style="display: none;"><a href="#"><i class="s-fa s-fa-fw s-fa-star"></i>{sw.widget.ph.transforms.toQuick}</a></li>')).render$();x=(new d('<li><a href="#"><i class="s-fa s-fa-fw s-fa-trash"></i>{sw.widget.ph.transforms.remove}</a></li>')).render$();t=(new d('<div id="{holderId}" class="aui-dropdown2 aui-style-default s-ph-dropdown s-transforms-dd" data-dropdown2-alignment="left" style="z-index: 20;"></div>')).render$(b,{holderId:l});s=(new d('<div class="aui-button aui-button-compact aui-dropdown2-trigger aui-dropdown2-trigger-arrowless" aria-owns="{holderId}" aria-haspopup="true"><span class="s-ph-tr-icon">{iconHtml:html}</span><span class="s-ph-tr-label">{label}</span><i class="s-fa s-fa-fw s-fa-caret-down"></i></div>')).render$(b,{holderId:l,label:e||y.getActionLabel(),iconHtml:p.getIconHtml()||y.getIconHtml()});r.on("click",L);u.on("click",z);ua.pipe(function(a){a=a&&a.params;v.toggleDropdownListItems(u,a);v.toggleDropdownListItems(r,a&&P.isAdminable());a&&(u.removeAttr("style"),r.removeAttr("style"))});m&&t.append(m);a.focus(document.body);C.build(P.widget,c.key,t,function(){var a=f(this).find("a"),b=a.data("module"),c=a.data("params"),d= !c,e=ua.value();e&&e.params&&
e.module===b&&(c=q.extend({},e.params,c));m&&(c=p.applyConfiguration(m,c));h({key:a.data("key"),module:b,params:c},a.data("label"),d)});l=n.find("ul");!g&&l.append(u);l.append(r);l.append(x);P.getInfoCell().pipe(function(){var a=c.module&&P.isAdminable();v.toggleDropdownListItems(r,a);a&&r.removeAttr("style")});t.append(n);Ha.append(t);t.on("aui-dropdown2-show aui-dropdown2-hide",function(a){a="aui-dropdown2-show"===a.type;s.isDropdownVisible=a;if(!a){var b=ua.value();b&&b.module||k()}oa(a)})}function L(){Na.addTransform(g.extend({},c,{id:u}),Y.value())}function z(){var a="moduleKey="+encodeURIComponent(c.module);u&&(a+="&params="+encodeURIComponent(n.stringify(ua.value().params)));F.showEditGeneratorDialog(a,null,function(a){c&&(a={key:c.key,module:c.module,params:a},u?p.setTransform(a):h(a,e))})}ea.appendingHolder.setValue(!0);try{u=c.id||u;p=y.createTransformer(c);p.init(c);var ua=p.getTransformCell();s&&s.remove();t&&(t.remove(),t=null);if(c.quick)J();else if(p.isInstanceOf(r.QueryFilterTransformer))N();else if(!c.module||c.params&& !na)A();else{l();z();return}Y.forceUpdate();var B=v.createDraggableButton(s);$&&$.replaceWith(B);$=B;x.on("click",k);s.addClass(
"automation-on-warning");c&&c.key&&c.module?p.setTransform(c):t&&q.delayed(10,function(){s.trigger("aui-button-invoke")})();m.toggle&& !c.params&&(m.toggle.setValue(!0),Ma(!0));ua.pipe(function(a){a&&a.module&&a.params?(a=f.extend(!0,{},a),u&&(a=f.extend(a,{id:u})),s.toggleClass("s-qf",! !a.quick),e=a.quick&&a.quick.name||ra.suggestLabel(a),f.when(e).always(function(a){Y.setValue(a||""===a?a:y.getLabel()||"")}),f(".s-ph-tr-icon",s).html(p.getIconHtml()||y.getIconHtml()),t&&t.is(":visible")&&s.trigger("aui-button-invoke"),w&&w.html(p.getIconHtml()||y.getIconHtml()),u=ha.saveTransform(a).id):null===a&&l()})}finally{ea.appendingHolder.setValue(!1)}c.permanent&&(q.assert(!g.isEmpty(x),"no remove button allowed for permanent transformation"+n.stringify(c)),x.unbind("click"),s.unbind("click"))}function l(){u&&(ha.removeTransform(u),u=0)}function k(){$.remove();t&&t.remove();var a;a:{for(a=0;a<Ba.length;a++)if(Ba[a]===m)break a;a= -1}-1<a&&Ba.splice(a,1);l();Pa.relayout();return!1}var m=this,p,u,s,t,x,w,$,y=W.getTransformerType(c),Y=(new q.Cell(e)).pipe(function(a){s&&(a||""===a)&&f(".s-ph-tr-label",s).text(a)});if(!y)throw Error("transform type is not found for transform "+c);h(c,e);
return q.extend(this,{remove:k,disable:function(a){x&&x.toggle(!a);s.attr("aria-disabled",a)},getElement$:function(){return $},getLabel:function(){return Y.value()},getTransformerType:function(){return y},getTransformer:function(){return p},getTransformId:function(){return u},getTransform:function(){return f.extend(!0,{id:this.getTransformId()},p.getTransformCell().value())},isPermanent:function(){return! !c.permanent}})}function N(a){if(a&&a.hasOwnProperty("query")&&a.type){Oa= !0;try{q.Cell.multiUpdate(function(){ea.query.setValue(a.query);ea.queryType.setValue(a.type);ea.search.setValue(!0);ea.filter.setValue(!1)})}finally{Oa= !1}}else da()}function L(a){a=g.isObject(a);var b=ha.isTransformable();f(".s-ph-transforms-container",Ha).toggle(a&&b);Qa.toggle(a&&b&&(ea.search.value()||ea.filter.value()));f(".s-ph-filter-saveas,.s-ph-filter-empty-space",Ka).toggle(P.isAdminable());I().toggle(a)}function fa(a){a&&(Ia=a);var b= ! !(Ia&&Ia.transforms&&Ia.transforms.length);Da["transforms-btn"].toggleClass("s-ph-transforms-active",b).toggleClass("aui-button-subtle",!b);oa();if(a&& !ea.specChangeLocked.value()){ea.search.value()&&Q(ea.query.value());ea.pin.setValue(! !a.pinnedItem);var c=
m.isTransformable(a);Za.setValue(c);f(".s-ph-transforms-container",Ha).toggle(c);Qa.toggle(c&&(ea.search.value()||ea.filter.value()));["pin","transforms-btn","quick-transforms-btn","search-btn"].forEach(function(a){Da[a].toggle(c)});Da["modes-btn"].toggle(P===xa.slave&&c);if(c)if(a.transforms)X(a.transforms)&&ba(a.transforms);else for(;Ba.length;)Ba[0].remove();Xa.showForSpec(a)}}function X(a){if(a.length===Ba.length){var b=Ba.map(Y.getTransform);if(q.deepEquals(b,a))return!1}return!0}function M(a){["add-transform","filter-btn","pin","search-type","search-save-as"].forEach(function(b){Da[b].attr("aria-disabled",a)});a&&ea.filter.value()&&(ea.filter.setValue(!1),Ca=null);Ua.sortable("option","disabled",a);Ba.forEach(function(b){b.disable(a)})}function ba(a){ea.updatingHolders.setValue(!0);try{var b=[];a.forEach(function(a){for(var c,d=b.length,e=0;e<Ba.length;e++)if(Ba[e].getTransformId()===a.id){c=Ba[e];c.getTransformer().setTransform(a);b.push(c);break}b.length===d&&(W.getTransformerType(a)&&(c=new Y(a)),c&&b.push(c))});Ua.find('li:not(".s-ph-add-transform-btn-li")').remove();Ba.forEach(function(a){-1===b.indexOf(a)&&a.remove()});Ba=[];b.forEach(ua)}finally{
ea.updatingHolders.setValue(!1),M(xa.automationOn.value())}}function E(){P!==xa.master&&(Da["modes-btn"].toggle(!0),Da["modes-btn"].on("click",function(){Va.setValue(Va.value()===t.ALL?t.EXCLUDE:t.ALL)}))}function I(){return Da["view-selector"]}function ma(){var a=Ha.find(".s-ph-right-toolbar").outerWidth(!0);if(0<a){var b=I(),c=b.find("span.s-view-name"),d=c.is(":visible"),a=a+(d?0:c.outerWidth(!0)),a=a+(d|| !b.hasClass("s-view-adjusted")?0:b.find(".s-adjusted-mark").outerWidth(!0)),a=Math.ceil(a)+1;ea.toolbarWidth.setValue(a)}}function R(){var a=I(),b=a.find("span.s-view-name");H.lX().pipe(function(c){var d=c&&c.name||"";b.text(d);var e=c&&c.description||"";0>(c&&c.id)?c=e:(e&&(e=" - "+e),c=q.text("s.w.view.current.title")+" "+d+e);a.attr("title",c);ma()});H.ku().pipe(function(b){a.toggleClass("s-view-adjusted",b);ma()})}function S(){ea.transforms.setValue(!1)}function ga(){S();Ba.length&&ha.setTransforms(g.chain(Ba).filter(function(a){return a.isPermanent()}).map(Y.getTransform).value());ea.filter.setValue(!1);Ca&&ea.search.setValue(!0);Ca=null}function da(){q.Cell.multiUpdate(function(){ea.search.setValue(!1);ea.filter.setValue(!1);Ca=null})}function ia(){ea.filter.value()&&
Ca&&(Ca.remove(),Ca=null);da()}function T(){!ha.isInitialized()||ea.query.value()&&Oa||g.defer(function(){Ra.focus()})}function Aa(){var a=A.modes.getStructurePageId();return a==A.PAGE_IDS.BOARD||a==A.PAGE_IDS.BOARD_WITH_DETAILS||a==A.PAGE_IDS.PROJECT}function Z(){var a=Da["search-btn"],b=Da["search-type-options"],d=Da["search-type"];(new c(Ra,{queryCell:ea.query,errorCell:ea.queryError,typeCell:ea.queryType})).init();Da["search-save-as"].click(function(a){a.preventDefault();"true"!==f(this).attr("aria-disabled")&&va()});D.initAUIToggleButton(a,ea.search);a.click(function(){ea.query.setValue(null);ja.postEvent(G.gS,"search.toggle")});ea.search.pipeChanges(function(a){a&&T()});(new q.Cell(ea.search,ea.filter,ha.bw(),function(a,b,c){return(a||b)&&m.isTransformable(c)})).pipe(q.seq(Qa.toggle,function(a){a&&T()}));ha.bw().pipeChanges(function(a){a= !m.isTransformable(a);Pa.setStrictHide(a);Na.setStrictHide(a)});(new q.Cell(ea.search,ea.query,ea.queryError,function(a,b,c){return a?c?void 0:b:null})).pipeDebounced({wait:500,waitInit:500},function(a){a&&Q(a)}).pipeChanges(function(a){!a&&Q(null)});b.on("click","a",function(){ea.queryType.setValue(f(this).attr("rel"))});
ea.queryType.pipeChanges(function(a){d.text(q.text("sw.transform.query.+"+a+"+.type"));T();Ca&&Ca.toggle.value()&&(Ca.getTransformer().error.setValue(!1),Ca.getTransformer().type.setValue(a));ea.search.value()&&Q(ea.query.value())});P.ah().register("focusSearch",function(){if(A.modes.ISSUE_PAGE||A.modes.GH_TAB)return!1;if(ea.search.value()||ea.filter.value())if(Ra.is(":focus")){var a=ea.queryType.value();ea.queryType.setValue("text"===a?"jql":"jql"===a?"sjql":"text")}else Ra.focus();else ea.search.setValue(!0);return!0});P.ah().register("toggleSearchFilter",function(){if(A.modes.ISSUE_PAGE||A.modes.GH_TAB)return!1;var a=Da["filter-btn"];a&&a.is(":visible")&&a.click();return!0});if(Qa.banner$)Qa.banner$.on("structure:cancelMode",function(a){if(ea.search.value()||ea.filter.value())return ia(),a.preventDefault(),a.stopPropagation(),!1});Ra.on("keydown",function(a){13===p.keyboardCodeFromEvent(a)&&Ra.blur()})}function va(){var a=r.QueryFilterTransformer.createTransformSpec(ea.query.value(),ea.queryType.value()),b="quickTransform=true&moduleKey="+encodeURIComponent(a.module)+"&params="+encodeURIComponent(n.stringify(a.params));F.showEditGeneratorDialog(b,null,function(b){
Na.addTransform(g.extend(a,{params:g.omit(b,"quickTransform","quickTransformName")}),b.quickTransformName)})}function Q(a){var b=null;if(a&& !ea.queryError.value()){var c=P.copySpec();c.transforms||(c.transforms=[]);var d=ea.queryType.value();(a=r.QueryFilterTransformer.createTransformSpec(a,d))&&a.params&&(a.params.hard= !0,c.transforms.push(a),b=c)}P.getFilter().filterRowsBySpec(b);sa()}function sa(){var a=P.getFilter();a.onSearchResultsReady(function(){var b=P.ao().bc();if(!a.isRowMatching(b)){var c=ta(P.ae(),b,a);c||(c=ta(P.bs(),b,a));c&&P.ao().focusRow(c,!0,!1)}})}function ta(a,b,c){b=a.indexOf(b);var d;if(0>b)return 0;d=c.findMatchingIndex(1,a,b);c=c.findMatchingIndex(-1,a,b);c=0>d?0>c? -1:c:0>c?d:b-c<d-b?c:d;return 0>c?0:a.rowId(c)}function ya(){var a=Da["filter-btn"];D.initAUIToggleButton(a,ea.filter);a.click(function(){if("true"!==a.attr("aria-disabled"))if(ea.search.setValue(!ea.filter.value()),ea.filter.value()){var b=r.QueryFilterTransformer.createTransformSpec(ea.query.value(),ea.queryType.value()),c=f("input",Da["search-container"]),b=new Y(b);ua(b);Ca&&Ca.toggle.setValue(!1);b.toggle.setValue(!0);Ca=b;ea.search.setValue(!1);ea.filter.setValue(!0);c.focus()}else Ca&&(
Ca.remove(),Ca=null)});ea.filter.pipeChanges(function(a){a&&T();Ca&&Ca.toggle.setValue(a);Qa.setClosingButtons({hide:a&&da,close:ia})});ea.search.pipeChanges(function(a){a&&ea.filter.setValue(!1)});ea.query.pipeDebounced({wait:500,waitInit:500},function(a){Ca&&Ca.toggle.value()&&Ca.getTransformer().query.setValue(a)});ea.queryError.pipeChanges(function(a){Ca&&Ca.toggle.value()&&Ca.getTransformer().error.setValue(a)})}function qa(){if(A.modes.ISSUE_PAGE||A.modes.GH_TAB){var a=d.load("structure.widget.ui.panel.issue-and-gh-toolbar").render$({toolbarMenuId:wa+"-toolbar-menu"});Ha.find(".s-ph-right-toolbar").prepend(a);e.saveBindings(a,Da);var b={},a=a.find("a[data-action]");ja.addListener(new q.Life,G.ly,function(a,c){var d=b[a];d&&(d.toggleClass("disabled",!c),d.attr("aria-disabled",!c))});a.each(function(){var a=f(this),c=a.data("action");b[c]=a;ja.fireEvent(G.mt,c)});a.on("click",function(a){a.preventDefault();ja.fireEvent(G.ACTION,f(this).data("action"));return!0})}}function aa(){D.bindAUIToggleButtonState(Da.pin,ea.pin);if(A.modes.ISSUE_PAGE||A.modes.GH_TAB){var a=Da["place-pinned"];ea.pin.pipe(function(b){a.toggle(!b)});a.click(function(){a.blur()});if(A.modes.ISSUE_PAGE&&B){
var b=a.find("span");B.getIssuePageParamsCell().pipe(function(c){c&&c.issueKey&&(a.addClass("s-ph-labeled"),b.text(" "+q.text("sw.widget.act.btn.place",c.issueKey)))})}}}function la(){var a=Da["transforms-btn"];D.initAUIToggleButton(a,ea.transforms);w.options(a,{className:function(){return Ia&&Ia.transforms&&Ia.transforms.length&&"st-cgen-hint"},title:function(){var a="",b=Ba.filter(function(a){return! !a.getTransformId()});b.length&&(a=d.build("p","span","ul","li",function(a,c,d,e,f){return[a()("{sw.widget.ph.transforms.tooltip.title}"),d()(b.map(function(a){return e()(c(".s-summary-icon")(c(".s-generator-icon")(f.html(a.getTransformer().getIconHtml()||a.getTransformerType().getIconHtml()))),c(".generator-summary")(a.getLabel()))}))]}).renderHtml());return a}});ha.bw().pipe(function(b){w.toggle(a,! !(b&&b.transforms&&b.transforms.length))})}function oa(a){a=a|| ! !(Ia&&Ia.transforms&&Ia.transforms.length);Da["add-transform"].find("span").text(a?"":q.text("sw.widget.ph.transforms.label"))}function pa(a){Da["add-transform"].css({visibility:a?"visible":"hidden"})}function Fa(){Sa.install(Ha.find(".s-ph-option-container"));var a;A.modes.ISSUE_PAGE||A.modes.GH_TAB?(a=(new q.Cell)
.setConstant(!0),I().addClass("s-small")):(a=new q.Cell(ea.width,ea.toolbarWidth,Sa.desiredWidthCell,function(a,b,c){return a-b<c}),new z.ElementClassToggler(a,"s-small",I()));(new q.Cell(ea.width,ea.toolbarWidth,a,function(a,b,c){return(c? -1:1)*Math.ceil(Math.max(a-b,0))})).pipeChanges(function(){Sa.relayout()})}function y(){var a=Da["transform-types"];[k.Type.FILTER,k.Type.SORTER,k.Type.GROUPER,k.Type.EXTENDER].forEach(function(b){var c=W.getTransformerType(b);c&&(b=(new d('<li><a href="#">{iconHtml:html}{label}</a></li>')).render$({iconHtml:c.getIconHtml(),label:c.getLabel()}),b.appendTo(a),f("a",b).click(function(){pa(!1);q.delayed(20,q.curry(pa,!0))();ua(new Y({key:c.getKey()}))}))})}function ua(a){Ba.push(a);Ua.find(".s-ph-add-transform-btn-li").before(a.getElement$());ea.transforms.value()&&Pa.relayout();Ca&&Ca!==a&&a.toggle&&Ca.getTransformId()===a.getTransformId()&&(a.toggle.setValue(Ca.toggle.value()),Ca=a)}function Ea(a,b){var c=a&&b&&(a.structureId&&b.sQuery||a.sQuery&&b.structureId);Ga=a&&b&&a.structureId&&b.structureId&&a.structureId!==b.structureId||c?b:Ga;c=Da["transform-types"];c.find("li.s-ph-prev-transforms").remove();Ga&& !g.isEmpty(Ga.transforms)&&c.append(Ma)
}function na(){ea.width.setValue(Ha.width())}function $(){Aa()&&(Z(),ya());qa();aa();la();E();R();y();Fa();D.initAUIToggleButton(Da["quick-transforms-btn"],Na.toggleCell);Na.getModel().restore();Ta.install();ha.bw().pipe(q.seq(fa,na,Ea));Da["transform-types"].on("click",".s-ph-prev-transforms",function(){Ga&&ha.appendTransformsFromSpec(Ga)});P.getInfoCell().pipe(q.seq(L,na));(new q.Cell(xa.automationOn,xa.bF.visibleCell,q.or)).pipe(M);A.modes.GADGET||(Wa.restore(N),Pa.getModel().restore());ea.height.setValue(Ha.outerHeight(!0));xa.eventBus.addListener(null,G.ar,na)}var xa=P.widget,wa=P.panelId,ra=xa.generatorRegistry,W=xa.transformRegistry,ca=P.getPanelBanners(),H=P.bW(),ja=P.bD(),ka=xa.config.singlePanel,Ga=null,ha=P.getSpecController(),Ia,za=f("div.head",P.panel$),Da={},Ba=[],Ja={transformationsId:wa+"-transformations",filterQueryId:wa+"-filter-query",jqlErrorId:wa+"-jql-error",searchTypeOptionsId:wa+"-search-type-options",viewsId:wa+"-views",viewsContainerId:wa+"-views-container"},Ha=K.render$(Ja),Ka=J.render$(Ja),La=O.render$(Ja),Ma=(new d('<li class="s-ph-prev-transforms"><a href="#"><i class="s-fa s-fa-fw s-fa-plus"></i>{sw.widget.ph.transforms.addFromPrev}</a></li>'))
.render$();e.saveBindings(Ha,Da);e.saveBindings(Ka,Da);e.saveBindings(La,Da);Ha.find(".aui-dropdown2").each(function(){D.installEventBus(this,P.bD())});A.modes.ISSUE_PAGE?Ha.find(".s-ph-transforms-container").after('<div id="s-board-toolbar"></div>').remove():A.modes.GH_TAB&&Ha.find(".s-ph-transforms-container").remove();Ha.appendTo(za);var ea={width:new q.Cell(0),toolbarWidth:new q.Cell(0),height:new q.Cell(0),sQuery:new q.Cell(null),pin:new q.Cell(!1),transforms:new q.Cell(!1),search:new q.Cell(!1),filter:new q.Cell(!1),query:new q.Cell(null),queryError:new q.Cell(!1),queryType:new q.Cell("text"),appendingHolder:new q.Cell(!1),updatingHolders:new q.Cell(!1)},Oa= !1,Pa=ka?V:ca.appendBanner(La,{order:1,toggleCell:ea.transforms,modelKey:"ph.transforms",kind:"s-transform"}).setClosingButtons({hide:S,close:ga}),Qa=ka?V:ca.appendBanner(Ka,{order:2,kind:"s-transform"}).setClosingButtons({close:ia}),Na=ka?V:new l(P),Ta=A.modes.GADGET||A.modes.GH_TAB?V:new h(P),Xa=ka?V:new u(P);ea.width.pipeChanges(q.withThis(ca,ca.relayout));var Ua=Da.transforms,Ra=Da["#"+Ja.filterQueryId],Ca,Za=new q.Cell(!1),Va=new q.Cell(null),Ya=new t(Va,xa);xa.config.overrideTwoPanelMode?(Ya.forced= !0,ca=
xa.config.overrideTwoPanelMode,ca!==t.EXCLUDE&&(ca=t.ALL),Va.setValue(ca)):Ya.restore();var Wa=new x(P),Sa=new s(P);ea.specChangeLocked=new q.Cell(ea.appendingHolder,ea.updatingHolders,q.or);(new q.Cell(Va,Za,function(a,b){return b?a:t.ALL})).pipeChanges(function(a){if(P!==xa.master){var b=P.getFilter();if(a===t.EXCLUDE){var c=(P===xa.master?xa.slave:xa.master).gP();b.filterItems(c,!1)}else b.filterItems(null,!1);b=Da["modes-btn"];c=b.find("i");c.removeClass();b.removeClass("s-mode-exclude");var d="alm alm-compare",e="sw.widget.ph.two-panels-mode.default";a===t.EXCLUDE&&(d="alm alm-intersect",e="sw.widget.ph.two-panels-mode.hide",b.addClass("s-mode-exclude"));c.addClass(d);b.attr("title",q.text(e))}});(new q.Cell(ea.query,ea.queryType,ea.search,function(a,b,c){return c&&g.isString(a)?{query:a,type:b}:x.OFF})).pipeChanges(function(a){Wa.setValue(a)});Y.getTransform=function(a){return a.getTransform()};v.sortableBanner(Ua,{item:'li:not(".s-ph-add-transform-btn-li")',done:function(a,b){if(0<=a&&a<Ba.length&&0<=b&&b<Ba.length){var c=Ba[a];Ba.splice(a,1);Ba.splice(b,0,c);var d=Ba.map(Y.getTransform),c=ha.copySpec().transforms;c.length!==d.length&&(d=g.filter(c,function(a){return!
g.findWhere(d,{id:a.id})}).concat(d));ha.setTransforms(d)}}});A.modes.GH_TAB?Ha.find('[data-hide-on~="gh"]').remove():A.modes.ISSUE_PAGE&&Ha.find('[data-hide-on~="issue"]').remove();g.defer(function(){xa.layoutManager.kY(P).pipeOnce(q.identity,$)});return q.extend(this,{getViewsContainer$:function(){return Da["#"+Ja.viewsId]},getViewSelector$:I,getHeightCell:function(){return ea.height},lb:function(a,b){a[P.panelName].panelHeader={};b(Wa);b(Pa.getModel());b(Na.getModel());b(Ta.getModel());P!==xa.master&&b(Ya)},focusQuery:g.bind(Sa.focusQuery,Sa),setSingleStructureMode:g.bind(Sa.setSingleStructureMode,Sa),setSearchState:N,importState:function(a){g.each([Wa,Pa.getModel(),Na.getModel()],function(b){xa.storage.setValueFromSpec(a,b)});N(Wa.bf())}})}});define("structure/widget/ui/panel/header/SearchModel",["underscore","almworks/util/Util","structure/widget/perspective/StoredValueWrapper"],function(f,b,g){function d(e){b.addSuper(g,this)(e.widget,e.panelName);this.value=d.OFF}d.OFF={type:"off"};b.extend(d.prototype,g.prototype,{key:function(){return this.panelName+".ph.search"},defaultValue:d.OFF,importModel:function(b){this.value=b},bf:function(){return this.value},perspectivePath:
function(){return this.panelName+".panelHeader.search"}});return d});define("structure/widget/ui/panel/header/TwoPanelModeWrapper",["underscore","almworks/util/Util","structure/widget/perspective/CellBasedValueWrapper","structure/widget/perspective/StorageUtil"],function(f,b,g,d){function e(a,d){b.addSuper(g,this)(a,d)}e.ALL="all";e.EXCLUDE="exclude";b.extend(e.prototype,g.prototype,{key:d.SECONDARY_PANEL_NAME+".ph.panel.mode",defaultValue:e.ALL,isPerspectiveMandatory:b.returnConst(!1),serialize:b.identity,deserialize:b.identity,perspectivePath:d.SECONDARY_PANEL_NAME+".panelHeader.twoPanelMode"});return e});define("structure/widget/ui/toolbar/AutomationMenu","almworks/jquery jquery structure/widget/model/Items almworks/util/Template structure/widget/spec/SpecController structure/widget/ui/GeneratorsDropDown structure/widget/generator/GeneratorUtil".split(" "),function(f,b,g,d,e,a,n){function c(a,b,c,d,e){m.bG.call(this,e);this.spec={forest:e.getVersionedSpec(),items:{},parameters:{},rowId:c,under:d.under,after:d.after,before:d.before,item:{type:g.GENERATOR,values:{moduleKey:a,params:b}}};this.cz()}var p=namespace("almworks.util"),m=namespace("almworks.structure"),k=namespace(
"almworks.structure.apputil"),r=m.cA,l=namespace("almworks.structure.appevents"),h=window.AJS;p.extend(c.prototype,m.bG.prototype,{action:"add",aj:function(){return this.spec},bN:function(a){return this.forestAdjustment},getAffectedRows:function(){return[this.spec.rowId]},aB:function(a,b){var c=this.spec;return c.under===a||c.after===a||c.before===a?(c.under===a&&(c.under=b),c.after===a&&(c.after=b),c.before==a&&(c.before=b),!0): !1},cz:function(){var a=this.spec;this.forestAdjustment=function(b){var c=0===a.under?0:b.rowDepth(b.indexOf(a.under))+1,c=new m.bP(a.rowId,c,!0);b.cP([c],a.under,a.after)}}});return function(u){var s=u.ad,q=p.nn(u.pageManager),x=u.generatorRegistry;return p.extend(this,{install:function(t){function r(a){var c="s-tb-gen-options-"+a.getKey(),e=(new d('<button class="aui-button aui-dropdown2-trigger aui-dropdown2-trigger-arrowless" id="s-tb-generator-type" aria-owns="{owns}" aria-haspopup="true">{iconHtml:html}&nbsp;{label:html}</button>')).render$(b,{label:a.getActionLabel(),owns:c,iconHtml:a.getIconHtml()});p.focus(document.body);D.parent().find("#s-tb-automation-plus").replaceWith(e);p.delayed(10,function(){e.trigger("aui-button-invoke")})()}function v(c,
d){var e=A.render$(b,{id:d});a.build(u,c.getKey(),e,function(){var a;a=f(this);a=a.is(":visible")?a.find("a"):a.parent().find("li:visible a");a.size()&&C(a.data("module"),a.data("params"))})&&(t.div$.find(".aui-toolbar2-inner").append(e),e.on("aui-dropdown2-show aui-dropdown2-hide",function(a){"aui-dropdown2-show"!==a.type&&D.parent().find(".aui-dropdown2-trigger").replaceWith(F)}))}function C(a,b){function d(b){var g=e.aZ().nextTemporaryRowId();u.attributeManager.prepareRowDataForNew(e.getVersionedSpec().spec,g,function(){var c=x.findGenerator(a),d=x.findPreset({module:a,params:b});return p.text("s.w.generator.+"+c.type+"+.summary",d?d.label:c.label)}());s.enqueue(new c(a,b,g,f,e))}var e=q.getFocusedPanel();if(e){var f={},h=e.bs(),l=e.ao().bc(),k=l?h.indexOf(l): -1,m= -1!==k&&h.row(k),l=m?m.getId():0;m&&g.isGenerator(m.itemId)?(k=l?h.aI(k): -1,f.under=0>k?0:h.rowId(k),f.after=l):(f.under=l,f.after=0);f.before=h.getBeforeForAfter(f.under,f.after);b?d(b):(h="moduleKey="+encodeURIComponent(a),(l=e.getStructureId())&&(h+="&structureId="+l),n.showEditGeneratorDialog(h,null,function(a){d(a)})||p.warn("cannot show generator dialog"))}}var z=u.automationOn||new p.Cell(!1),F=(new d(
'<button class="aui-button aui-dropdown2-trigger aui-dropdown2-trigger-arrowless" id="s-tb-automation-plus" title="{sw.widget.act.btn.automation.add}" aria-owns="s-tb-gen" aria-haspopup="true"><i class="s-fa s-fa-plus"></i></button>')).render$(),A=new d('<div id="{id}" class="aui-style-default aui-dropdown2 s-tb-gen-options" data-aui-alignment="bottom left"></div>'),D=f("#s-tb-automation",t.div$);k.initAUIToggleButton(D,z);u.bF.visibleCell.pipe(p.curry(p.toggleAttr,D,"aria-disabled"));var G;u.eventBus.addListener(new p.Life,l.AUTOMATION_OFF_REQUIRED,function(){u.bF.visibleCell.value()||("true"!==m.getStored("show.automation.warn.popup")?(G||(G=h.InlineDialog(h.$(D[0]),"automation-on-warning",function(a,b,c){b=d.load("structure.widget.ui.toolbar.automation-on-warning").render$();b.find(".aui-button").on("click",function(){m.setStored("show.automation.warn.popup","true");G.hide()});a.html(b);c()},{noBind: !0,offsetX: -D.width(),hideCallback:function(){u.ni.popupHidden(G);D.stop().css({backgroundColor:"#F66",color:"#FFF"}).animate({backgroundColor:"#CCC",color:"#636363"},100,function(){D.css({color:"","background-color":""})})}})),D.stop().css({backgroundColor:"#ccc",color:"#636363"})
.animate({backgroundColor:"#F66",color:"#fff"},100),G.show(),u.ni.lV(G,G.hide)):D.stop().css({backgroundColor:"#ccc"}).animate({backgroundColor:"#F66",color:"#FFF"},200).animate({backgroundColor:"#ccc",color:"#636363"},400,function(){D.css({color:"","background-color":""})}))});var B=(new p.Cell(q.getFocusedPanelCell(),function(a){return a&&new p.Cell(a.getSpecController().bw(),function(a){return!(!a|| !e.isStructure(a))})})).flatten(!1),K=(new p.Cell(q.getFocusedPanelCell(),function(a){return!a||new p.Cell(a.eN(),a.getReadOnlyCell(),p.or)})).flatten(!1),J=(new p.Cell(q.getFocusedPanelCell(),function(a){return a&&a.getInfoCell()||{}})).flatten(!1).field("automationAccessAllowed");J.pipe(function(a){D.toggleClass("automation-off",!a)});(new p.Cell(z,B,K,J,function(a,b,c,d){return!(!a|| !b||c|| !d)})).pipe(function(a){var b=D.parent();a?b.append(F):b.find("#s-tb-automation-plus").detach();t.revalidateSize()});x.whenReady(function(){var a=t.div$.find("#s-tb-gen .aui-list-truncate");x.getKinds().forEach(function(b){var c=x.getKindInfo(b);c&&(v(c,"s-tb-gen-options-"+b),b=(new d('<li><a href="#" title="{title}">{iconHtml:html}&nbsp;{label}</a></li>')).render$({iconHtml:c.getIconHtml(),
label:c.getLabel(),title:c.getTitle()}),b.appendTo(a),f("a",b).click(function(){r(c)}))})});s.aF({dw:function(a,b){function d(a){return! !(0>a||b&&b[a])}var e=a[0];if(!(e instanceof c))return null;var f;if(e.jobId)f={jobId:e.jobId},e.jobId=null;else{f=e.spec;if(d(f.under)||d(f.after)||d(f.before))return null;f.forest.version=u.forestCache.getCurrentVersion(f.forest.spec);f.items.version=u.attributeManager.getItemsVersion()}return{count:1,url:m.ajax.RESOURCES2g.ITEM.CREATE,data:m.apputil.ct(f),cB: !0,es:function(a){if(a=a.itemId)f.item.itemId=a}}}});return z},moveNew:function(a,b,d){var e=null;s.updateActions(function(f){if(e|| !(f instanceof c)||f.state!==r.STATE_PENDING&&f.state!==r.STATE_BLOCKING)return!0;f.spec.rowId===a&&(f.spec.under=b,f.spec.after=d,f.spec.before=f.panel.bs().getBeforeForAfter(b,d),f.cz(),f.spec.parameters={},e=f);return!0});e&&s.retryWithDecision(e);return! !e}})}});define("structure/widget/ui/GeneratorsDropDown","almworks/jquery jquery underscore almworks/util/Template almworks/util/Util structure/widget/ui/UIUtil".split(" "),function(f,b,g,d,e,a){return{build:function(n,c,p,m){var k=n.generatorRegistry.getGenerators(c);if(k.length){var k=k.filter(function(
a){return! !a.label&& !a.notConfigurable}),r=n.generatorRegistry.getPresets(c).concat(k);if(r.length){if(1<r.length){var l=d.load("structure.widget.ui.panel.search-container").render$({class:"s-tb-search-container"}),h=(new e.Cell(null)).pipeBottlenecked(100,function(b){b=b&&b.toLowerCase();var c= !1;f(".s-tb-gen-preset",p).each(function(){var d=f(this),e= !b|| -1!=d.text().toLowerCase().indexOf(b);c=c||e;a.toggleDropdownListItems(d,e)});f(".active",p).removeClass("active aui-dropdown2-active");f(".s-tb-gen-preset a:not(.disabled)",p).first().addClass("active aui-dropdown2-active");var d=p.find(".s-not-found");b&& !c?d.show():d.hide()});new e.TextPresenter(h,f("input",l));p.append(l);p.on("aui-dropdown2-show",function(){h.setValue(null);g.defer(function(){f("input",l).focus()})})}n=d.build("div","ul","li","a",function(a,b,c,d){return[a(".aui-dropdown2-section.s-tb-gen-container")(b(".aui-list-truncate")(r.map(function(a){return c(".s-tb-gen-preset")(d({href:"#",title:a.params?a.description||a.label:null,"data-label":a.label,"data-key":a.type,"data-module":a.module,"data-params":a.params&&JSON.stringify(a.params)})(a.params?a.label:a.label+"..."))})))]}).render$(b);n.appendTo(p);
n.on("click","li > a",function(a){a.preventDefault()});n.on("click","li",m);p.append((new d('<span class="s-generator-notfound s-not-found" style="display: none">{sw.generic.not-found}</span>')).render$());return!0}}return!1}}});define("structure/widget/ui/QuickActions",["almworks/jquery","underscore","almworks/util/Template","almworks/util/Util","structure/widget/perspective/StoredValueWrapper"],function(f,b,g,d,e){var a=namespace("almworks.structure"),n=namespace("almworks.structure.appevents"),c={},p= !1;return function(m){function k(){this._restoredValue&&this._restoredValue.length&&(this.setSearchValue(this._restoredValue),C.val(this._restoredValue),C.select())}function r(a){var b=z.find(".selected");1===b.length&&(b=b.data("key"))&&(q(!0),m.bD().fireEvent(n.ACTION,b,a))}function l(a){var b=z.find(".selected");if(b.length){var c=a(b);b.removeClass("selected");a=c.length?c:a()}else a=z.find("li:first");a&&(a.addClass("selected"),a.length&&(b=a.position().top-z.position().top,0>b&&z.scrollTop(z.scrollTop()+b),a=b+a.outerHeight(),a>z.height()&&z.scrollTop(a-(z.height()-z.scrollTop()))))}function h(){l(function(a){return a?a.next("li"):z.find("li:first")})}function u(){l(function(
a){return a?a.prev("li"):z.find("li:last")})}function s(a){return f(window).height()-a.position().top-a.outerHeight()-10}function q(a){a&&t&&t.focus();f("#s-quick-actions").remove()}d.addSuper(e,this)(m.widget);var x,t;a.keymap();if(!p){p= !0;var w=function(a,b){var e,f;a.title?e=a.title:(f="s.action.+"+b+"+.name",e=d.text(f));if(e!==f){if(e in c)throw Error("Duplicate action: "+b+' ("'+e+'")');c[e]={key:b,action:a}}};b.map(m.widget.globalActions.actionMap(),w);b.map(m.ah().actionMap(),w)}var v=g.build("div","ul","li","a","input",function(a,b,c,e,f){return[a("#s-quick-actions")(a(".s-qa-search")(f(".s-qa-input",{type:"text",placeholder:d.text("s.action.generic.title")})),b(".s-qa-list")())]}).render$(f),C=v.find(".s-qa-input"),z=v.find(".s-qa-list");z.on("mousemove",function(a){a=f(a.target).closest("li");a.length&& !a.hasClass("selected")&&(z.find(".selected").removeClass("selected"),a.addClass("selected"))});z.on("click","li",r);C.on("blur",b.throttle(q,50,{leading: !1}));C.on("keyup",b.debounce(function(a){"keyup"===a.type&&this.setSearchValue(f(a.target).val().toLowerCase())}.bind(this),50));C.on("keydown",function(a){if("keydown"===a.type)switch(a.keyCode){case 13:r(a);break;
case 40:return h(),!1;case 38:return u(),!1}});return d.extend(this,e.prototype,{key:"quickActionsText",show:function(){var a=f("body");t=a.find(":focus");a.append(v);var c=this;b.defer(function(){c.restore(k.bind(c));v.find(".s-qa-input").focus();v.addClass("go")})},hide:q,bf:function(){return this._restoredValue},importModel:function(a){this._restoredValue=a},setSearchValue:function(d){d!==x&&(z.empty(),1<d.length?(z.css("max-height",s(v)),b.filter(c,function(b,c){var e=c.toLowerCase().indexOf(d);if(0<=e){var g= !b.action.hasOwnProperty("update")||b.action.update(void 0,void 0,{}),h=d.length,l=b.key,k=c.substr(0,e),m=c.substr(e,h),e=c.substr(e+h),g='<li data-key="'+l+'"'+(g?"":' class="disabled"')+'><span class="name">'+k+"<b>"+m+"</b>"+e+"</span>",l=a.apputil.actionFormattedShortcut(l,!0),l=f(g+(l?'<span class="shortcut">'+l+"</span>":"")+"</li>");z.append(l)}}),h(),this.setValue(d)):this._restoredValue&&this.setValue(""),x=d)}})}});define("structure/widget/ui/toolbar/ExportMenu","underscore almworks/jquery almworks/util/Template almworks/util/Util almworks/util/Functions almworks/util/JSON".split(" "),function(f,b,g,d,e,a){function n(c){var e=c.master.getSpecController()
.copySpecForRest();b("#s-tb-export-extensions").find("a").each(function(){var c=b(this),f=c.data("export-url");if("string"===typeof f)if(e){var g=a.stringify(e),h=f.indexOf("${forestSpec}"),f=0<=h?f.substring(0,h)+encodeURIComponent(g)+f.substring(h+13):d.setUrlParameter(f,"forestSpec",g);c.attr("href",f)}else c.attr("href","#")})}var c= !1;return{installDynamicExportMenu:function(a){a.jiraConfig.getExportLinksCell().pipe(function(m){b("#s-tb-export-extensions").remove();m.length&&(b("#s-tb-export-options").append(g.build("div","ul","li","i","a",function(a,b,c,d,e,f){return[a("#s-tb-export-extensions.aui-dropdown2-section")(b(".aui-list-truncate")(f.forEach(m,function(a){var b={href:"#","data-export-url":a.url,"data-action":"export-"+a.moduleKey,target:"_blank"};a.title&&(b.title=a.title);return c()(e(b)(d({"class":a.iconClasses||"s-fa s-fa-fw s-fa-sign-out"}),f.nbsp,a.label))})))]}).render$()),c?n(a):(c= !0,a.master.getSpecController().bw().pipe(e.curry(n,a))),f.each(m,function(b){a.globalActions.register("export-"+b.moduleKey,d.returnFalse)}))})}}});define("structure/widget/ui/toolbar/Toolbar",
"underscore almworks/jquery jquery almworks/util/Util almworks/util/Template almworks/util/Cell structure/widget/ui/toolbar/SelectedToolBarModel structure/widget/ui/layout/LayoutManager structure/widget/ui/Tooltip structure/widget/ui/UIUtil almworks/util/Functions structure/widget/ui/toolbar/ExportMenu".split(" "),function(f,b,g,d,e,a,n,c,p,m,k,r){var l=namespace("almworks.structure"),h=namespace("almworks.structure.apputil"),u=namespace("almworks.structure.appevents"),s=new e('<div class="s-toolbar-container"><div class="aui-toolbar2"><div class="aui-toolbar2-inner"></div></div><div class="inner-panel" style="display: none;"></div></div>');return function(p){function x(){var a=g("#s-tb-expand");a.on("aui-dropdown2-show",function(){var c=G.getFocusedPanel();if(!c)return!1;var e=c.ao().getExpansionLevels();b("a",a).each(function(){var a=b(this),c=d.toIntSafe(a.data("level"),-1);a.toggleClass("checked aui-dropdown2-checked",c==e.current);a.toggle(c<=e.maximum||c==e.current||1E4==c)})});a.on("click","a",function(a){if(!G.getFocusedPanel())return!1;var c=d.toIntSafe(b(this).data("level"),-1);0<=c&&z("expandLevel",a,{level:c});a.preventDefault();return!1})}function t(){
p.storage.whenReady(function(){var a={automation:p.automationMenu.install(J)},b=new d.Cell(a.automation,function(a){return a?n.AUTOMATION:n.NONE});B=new n(p);b.pipeChanges(function(a){B.setValue(a)});B.restore(function(b){w(b,a)})})}function w(b,c){a.multiUpdate(function(){b===n.AUTOMATION?c.automation.setValue(!0):c.automation.setValue(!1)})}function v(){function a(b,d,e){function f(){g.attr("aria-pressed",e.apply(this))}var g=c.find("button[data-action="+b+"]");f();A.register(b,function(){d.apply(this,arguments);f()})}if(!V){V= !0;var c=e.load("structure.widget.ui.toolbar.debug-toolbar").render$();K.filter(".aui-toolbar2-primary").append(c);c.on("click","button",function(a){var c=b(this);c.blur();z(c.data("action"),a)});A.register("_poll",function(){D.fireEvent(u.REQUEST_POLL)});a("_toggleDebugMode",function(){l.modes.DEVMODE= !l.modes.DEVMODE},function(){return l.modes.DEVMODE});a("_toggleBlockAjax",function(){l.modes.BLOCK_AJAX= !l.modes.BLOCK_AJAX;l.modes.BLOCK_AJAX||p.ajax.gH()},function(){return l.modes.BLOCK_AJAX});A.register("_throwException",function(){window.setTimeout(function(){(void 0).shoot()},50)});A.register("_logError",function(){d.error("what what?")})}}
function C(){var a=p.layoutManager,e=b("#s-tb-layout"),f=e.find("i"),g;new d.Cell(a.layoutCell,a.externalPanelDescriptorCell,function(b,h){var l;switch(b){case c.TWO_PANEL_LAYOUT:l="alm-split-layout";break;case c.DETAILS_PANEL_LAYOUT:l="alm-detailed-layout";break;case c.HISTORY_PANEL_LAYOUT:l="alm-history";break;default:l=h&&h.icon||"alm-single-layout"}f.removeClass().addClass("alm "+l);l=a.getNextLayout();g=d.text("s.w.layout.tooltip",d.text("s.w.layout.+"+b+"+.label"),d.text("s.w.layout.+"+l+"+.label"));e.attr("title",g)});e.click(function(){e.blur();a.switchLayout()})}function z(a,b,c){if(!a)return!0;var d=G.getFocusedPanel();(d?d.bD():D).fireEvent(u.ACTION,a,b,c);return!b|| !b.consumed}function F(a,c,e){e=e||new d.Cell(!1);var f=s.render$(),g=b(".inner-panel",f),l;b(".aui-toolbar2-inner",f).append(a);c&&h.initAUIToggleButton(c,e);(function(a){m.connectToolbarActions(a,D,{actionUpdated:function(a,b,c){return!c.panel||c.panel===G.getFocusedPanel()},getPerformEventBus:function(){var a=G.getFocusedPanel();return a&&a.bD()}})})(f);(function(a){p.jiraConfig.getConfluenceConfigCell().pipe(function(b){var c=a.find("#s-create-page-button").closest("li");m.toggleDropdownListItems(c,b&&
b.licensed)})})(a);return d.extend(this,{div$:f,toggle:e,appendToolbar:function(a,c,e){var k=b(a,f);if(!k.length)throw Error("element is not found "+a);var m=new d.Lifecycle;D.addListener(new d.Life,u.nl,function(a){m.cycle();a.getReadOnlyCell().pipe(m.life(),function(a){b("button",c).attr("aria-disabled",! !a)})});var n=new F(c,k,e);n.toggle.pipeChanges(function(a){a?((a=l)&&a.div$.detach(),g.append(n.div$),l=n,a&&a!==n&&a.toggle.setValue(!1),h.bU(!0,g,p,d.returnConst(30),!0)):l===n&&h.bU(!1,g,p,d.returnConst(30),!0)});return n},revalidateSize:function(){O&&O(!0)}})}var A=p.globalActions,D=p.eventBus,G=d.nn(p.pageManager),B=null,K=e.load("structure.widget.ui.toolbar.widget-toolbar").render$(),J=new F(K),O=d.createResponsiveWidthCallback(J.div$,["","small-right","small","tiny"],function(){function a(c){var d=c.outerWidth(!0)-c.width();return f.reduce(c.children(":visible"),function(a,c){return a+b(c).outerWidth(!0)},d)}return a(J.div$.find(".aui-toolbar2-primary"))+a(J.div$.find(".aui-toolbar2-secondary"))});l.modes.ISSUE_PAGE||l.modes.GH_TAB||(b("#s-board-toolbar").append(J.div$),b(window).resize(O),x(),t(),C(),k.delayed(200,k.curry(O,!0))());l.modes.DEVMODE&&v();A.register(
"debugActions",function(){l.modes.DEVMODE= !0;v()});r.installDynamicExportMenu(p);var V= !1;return d.extend(this,{lb:function(a,b){b(B)}})}});define("structure/widget/ui/toolbar/SelectedToolBarModel",["underscore","almworks/util/Util","structure/widget/perspective/StoredValueWrapper"],function(f,b,g){function d(e){b.addSuper(g,this)(e);var a=d.NONE;b.extend(this,g.prototype,{importModel:function(b){a=b},bf:function(){return a},key:"toolbar",defaultValue:d.NONE,serialize:b.identity,deserialize:b.identity,perspectivePath:"toolbar"})}d.NONE="none";d.AUTOMATION="automation";return d});define("structure/widget/ui/page/PanelWidthModel",["underscore","almworks/util/Util","structure/widget/perspective/StoredValueWrapper"],function(f,b,g){function d(a,e,c,f){b.addSuper(g,this)(a);this.action=c;this.defaultValue=Math.floor(1E4*f);this.widthCell=new b.Cell(f);this.key="page."+c+".width";this.active= !1;var m=this;e.pipe(function(a){a&&m.restore()});this.widthCell.pipeChanges(b.delayed(d.storeDelay,function(a){m.setValue(Math.floor(1E4*a))}))}function e(a){a=b.toIntSafe(a);return 0<a&&1E4>a?a/1E4:null}b.extend(d.prototype,g.prototype,{isPerspectiveMandatory:b.returnConst(!1),bf:function(){
var a=this.widthCell.value();return Math.floor(1E4*a)},importModel:function(a){this.widthCell.setValue(e(a))},perspectivePath:function(){return "pageManager."+this.action+".width"},getWidthCell:function(){return this.widthCell}});d.storeDelay=100;return d});define("structure/widget/ui/page/FocusedPanelModel",["underscore","almworks/util/Util","structure/widget/perspective/StorageUtil","structure/widget/perspective/CellBasedValueWrapper"],function(f,b,g,d){function e(a,c){b.addSuper(d,this)(a,c);this.widget=c}function a(a){return a===g.PRIMARY_PANEL_NAME?g.SECONDARY_PANEL_NAME:g.PRIMARY_PANEL_NAME}b.extend(e.prototype,d.prototype,{key:"page.focused.panel",defaultValue:g.PRIMARY_PANEL_NAME,serialize:b.identity,deserialize:b.identity,perspectivePath:"pageManager.focusedPanel",resolvePanelByName:function(a){return a===g.SECONDARY_PANEL_NAME?this.widget.slave:this.widget.master},toggle:function(){this.importModel(a(this.bf()))},getPanel:function(){return this.resolvePanelByName(this.bf())},otherPanel:function(b){return this.resolvePanelByName(a(b.panelName))}});return e});define("structure/widget/ui/layout/LayoutManager",
"jquery structure/widget/perspective/CellBasedValueWrapper structure/ui/details/ItemDetails almworks/util/Util almworks/util/BrowserState almworks/util/Template structure/api/SecondaryPanelRegistry".split(" "),function(f,b,g,d,e,a,n){function c(a,c,e){d.addSuper(b,this)(a,c);a="layout."+m.modes.getStructurePageId();d.extend(this,b.prototype,{key:a,defaultValue:"single",serialize:d.identity,deserialize:d.identity,perspectivePath:"layout"});e&&this.forceValue(e)};function p(a){function b(){function c(a){return function(){if(m.modes.GADGET||m.modes.ISSUE_PAGE||m.modes.GH_TAB)return!1;z.setValue(a);return!0}}a.globalActions.register("layout.single",c("single"));a.globalActions.register("layout.double",c("double"));a.globalActions.register("layout.details",c("details"));a.globalActions.register("layout.history",c("history"));var e=5;a.initialized.pipeOnce(d.truthy,function(){n.onRegisterPanel(function(b,f){var g="layout."+b,h=f.toggleActionText,h=d.extend({perform:c(b)},h?{title:h}:{});a.globalActions.register(g,h);h=e++;a.installKeyAction(a,"ctrl+alt+"+h,g);a.installKeyAction(a,"ctrl+alt+num_"+h,g)})})}function p(b){z.pipeChanges(s);z.pipe(new d.Life,!0,function(a){A.setValue(G[a])});
"double"!==b||a.slave.hasSpec()?s(b):z.setValue("single")}function s(b,c){if(b)try{switch(C= !0,v=("details"===c||"history"===c||G[c]?null:c)||v,b){case "single":w.hideSecondaryPanel();break;case "double":w.showSlavePanel();break;case "details":w.showDetailsPanel();break;case "history":w.showHistoryPanel();break;default:var d=G[b];if(!d){w.hideSecondaryPanel();break}w.showExternalPanel(b,d);a.jiraConfig.load(function(){a.jiraConfig.getExtensionAvailableCell(d.key).value()||z.value()!==b||z.setValue(c?c:"single")});break}}finally{C= !1}}function q(b,c){switch(b){case a.master:return!0;case a.slave:return "double"===c;case g:return "details"===c;case a.bF:return "history"===c;default:return!1}}function x(b){C||(b=b||t(),("double"!==z.value()||a.slave.canChangePanelState())&&z.setValue(b))}function t(){var b=z.value();return "details"!=b||a.config.showIssueDetails?"single"===b?"double":"single":"double"}var w=a.pageManager,v,C= !1,z=new d.Cell,F,A=new d.Cell,D=new c(z,a,a.config.forceLayout),G={};setTimeout(function(){z.pipeChanges(function(){a.eventBus.postEvent(k.gS,"layout.switch")})},3E3);(function(){var c=new d.Life;(new d.Cell(a.master.getSpecController().bw(),
a.slave.getSpecController().bw(),function(a,b){return b?"double":a?"single":null})).pipeDebounced(c,{wait:10,waitInit:10,immediateCall: !1},function(a){c.detach();v=a});n.onRegisterPanel(function(a,b){G[a]=b;e.windowLoaded.always(function(){var c=f("#s-tb-layout-menu").find('[data-section="layoutMode"]'),e=c.find(d.format('a[data-value="{0}"]',a));e.length?e.parents("li").toggle(!0):(e=b.menuItemText,r.render$({layoutName:a,layoutTitle:e?e:a}).appendTo(c.find(".aui-list-truncate")),z.value()==a&&F&&F.sync())})});e.windowLoaded.always(function(){var b=f("#s-tb-layout-menu");a.config.showIssueDetails&&(b.find(d.format('a[data-value="{0}"]',"details")).parents("li").toggle(!0),b.find(d.format('a[data-value="{0}"]',"showDetails")).parents(".aui-dropdown2-section").toggle(!0));F=new d.AjsDropdown2RadioPresenter(z,b,"layoutMode",!1)});D.restore(p);g.enabledCell.pipeChanges(function(a){x(a?"details":v)});a.bF.visibleCell.pipeChanges(function(a){x(a?"history":v)});n.onRegisterPanel(function(a,b){b.controlCell.pipeChanges(function(b){x(b?a:v)});z.value()===a&&(A.setValue(b),s(a))});b()})();return d.extendOwn(this,{layoutCell:z,externalPanelDescriptorCell:A,switchLayout:x,getNextLayout:t,
isPerspectiveReady:function(b){return b===a.master||b===a.slave&&"single"!==z.value()&&"history"!==z.value()},lb:function(a,b){b(D)},isVisible:function(a){return q(a,z.value())},kY:function(a){return new d.Cell(z,function(b){return q(a,b)})}})}var m=namespace("almworks.structure"),k=namespace("almworks.structure.appevents"),r=new a('<li><a class="aui-dropdown2-radio" href="javascript:void(0);" data-value="{layoutName}">{layoutTitle}</a></li>');p.SINGLE_PANEL_LAYOUT="single";p.TWO_PANEL_LAYOUT="double";p.DETAILS_PANEL_LAYOUT="details";p.HISTORY_PANEL_LAYOUT="history";return p});define("structure/widget/ui/layout/PanelSwapper",["almworks/jquery","underscore","almworks/util/Util","structure/widget/ui/layout/LayoutManager"],function(f,b,g,d){var e=namespace("almworks.structure.appevents"),a=namespace("almworks.structure");return function(n){function c(){var a=g.deepClone(n.master.getSpecController().bw().value()),b=g.deepClone(n.slave.getSpecController().bw().value());g.Cell.multiUpdate(function(){a.transforms&&delete a.transforms;b.transforms&&delete b.transforms;n.master.setSpec(b);n.slave.setSpec(a)})}function p(){var a=n.master.bW().mA(),b=n.slave.bW().mA(),c=a.value();
g.Cell.multiUpdate(function(){a.setValue(b.value());b.setValue(c)})}function m(a){b.each(["ph.multi.selection","ph.quick.transforms","ph.transforms"],function(b){b=g.deref(a,b);if(null!==b){var c=b.p1;b.p1=b.p2;b.p2=c}})}function k(a,b){var c=a.ao(),d=c.restoreState,e=c.restoreFocus;c.restoreFocus=g.noop;c.restoreState=function(){try{c.importState(b)}finally{c.restoreState=d,c.restoreFocus=e}}}function r(){g.Cell.multiUpdate(function(){h.setValue(!0);q.setValue(!1);l.setValue(2)})}var l=new g.Cell(0),h=new g.Cell(!1),u=f.Deferred(),s=null,q=new g.Cell(!1),x=(new g.Cell(l,h,function(a,b){return 0<a||b})).pipe(function(a){a||(u.resolve(),s=null,q.setValue(!1))});n.globalActions.register("swapPanels",{perform:function(){if(!x.value())try{r();s=n.az.createPerspective().spec;u=f.Deferred();var a=s,b=a.primary;a.primary=a.secondary;a.secondary=b;m(a);a=s;k(n.master,a);k(n.slave,a);c();p();a=s;n.master.getPanelHeader().importState(a);n.slave.getPanelHeader().importState(a);n.pageManager.tabFocusPanel()}finally{h.setValue(!1)}},update:function(){return a.modes.getStructurePageId()===a.PAGE_IDS.BOARD&&n.layoutManager&&n.layoutManager.layoutCell.value()===d.TWO_PANEL_LAYOUT&& !n.master.bh()
.fQ()&&(!n.slave|| !n.slave.bh().fQ())&&0===f(".aui-dropdown2:visible, .st-col-edit:visible, .st-col-add:visible, .aui-dialog:visible, .aui-inline-dialog:visible").length}});var t=new g.Life;n.eventBus.addListener(t,e.UI_STATE_LOADED,function(){s&&l.setValue(Math.max(0,l.value()-1))});n.eventBus.addListener(t,e.STRUCTURE_CHANGED,function(){q.setValue(!0)});n.eventBus.addListener(t,e.STRUCTURE_NOT_CHANGED,function(){q.value()||(n.master.ao().restoreState(),n.slave.ao().restoreState())})}});define("structure/widget/ui/layout/FullScreenController",["jquery","almworks/jquery","almworks/util/Util","structure/widget/perspective/CellBasedValueWrapper","almworks/util/BrowserState"],function(f,b,g,d,e){function a(a,c,e){g.addSuper(d,this)(a,c);g.extend(this,d.prototype,{key:e,defaultValue: !1,serialize:function(a){return a?"true":"false"},deserialize:function(a){return "true"===a},perspectivePath:e,restorePromise:function(){var a=b.Deferred();this.restore(function(b){a.resolve(b)});return a.promise()}})};function n(a){var d=this;g.Cell.multiUpdate(function(){d.cell&&d.cell.setValue(a);d.hoverCell&&d.hoverCell.setFalse();d.dropdownCell&&d.dropdownCell.setValue(b(c()).is(":visible"))})}
function c(){var a=[];b("#s-board-toolbar").find(".aui-dropdown2-trigger").each(function(){var c=b(this).attr("aria-controls");c&&a.push("#"+c)});return a.join(",")}function p(a,b,c,d,e,f){g.addSuper(g.AjsDropdown2CheckboxPresenter,this)(a,d,e,f);this.hoverCell=b;this.dropdownCell=c}function m(a,b,c,d,e){g.addSuper(g.CellPresenter,this)(a,d,e);this.hoverCell=b;this.dropdownCell=c}function k(a,b,c,d){return a?b?c||d?"tbhov":"tboff":"tbon":"normal"}var r=namespace("almworks.structure");g.extend(p.prototype,g.AjsDropdown2CheckboxPresenter.prototype,{updateCell:n});g.extend(m.prototype,g.CellPresenter.prototype,{updateView:function(a){this.view.toggleClass("s-fa-angle-down",! !a).toggleClass("s-fa-angle-up",!a)},getViewValue:function(){return!(!this.view||this.view.hasClass("s-fa-angle-up"))},subscribeToViewEvents:function(a){var b=this,c=function(){b.view.toggleClass("s-fa-angle-up s-fa-angle-down");b.viewChanged()};this.view.on("click",c);a.addDetach(g.curryThis(this.view,this.view.off,"click",c))},updateCell:n});return function(d){function h(a,c,d,e,f){function g(){e()&&(l=window.setTimeout(f,d))}function h(){l&&e()&&(window.clearTimeout(l),l=0)}var l=0;c?b(a).hover(g,h):b(a).hover(
h,g)}function u(){function a(){b(c()).is(":visible")?(d&&(window.clearTimeout(d),d=0),F.setTrue()):F.value()&& !d&&(d=window.setTimeout(function(){F.setFalse();d=0},500))}var d=0;a();f(window).on("aui-dropdown2-show aui-dropdown2-hide",g.delayed(0,a))}function s(){b("body").on("click",function(a){z.value()&&a&&a.target&& !b(a.target).closest(".s-board-header").length&&z.setFalse()})}function q(){d.globalActions.register("fullScreen.toggle",function(){n.call({cell:t,hoverCell:z,dropdownCell:F},!t.value())})}function x(){return r.modes.getStructurePageId()===r.PAGE_IDS.BOARD||r.modes.ISSUE_DETAILS&& !r.modes.PCV_PAGE}var t=new g.Cell,w=new a(t,d,"fullScreen"),v=new g.Cell,C=new a(v,d,"toolbarOff"),z=new g.Cell(!1),F=new g.Cell(!1),A=new g.Cell(t,v,z,F,k);e.windowLoaded.always(function(){if(x()){new p(t,z,F,f("#s-tb-layout-menu"),"fullScreen",!1);new m(v,z,F,b("#s-tb-toggle-button"),!1);var a=g.curryThis(z,z.value),c=g.compose(a,g.not),d=g.curryThis(z,z.setTrue),e=g.curryThis(z,z.setFalse);h("#s-tb-hover-gl",!0,200,c,d);h("#s-board-toolbar",!0,0,c,d);h("#s-tb-unhover-gl,header.s-board-header",!1,1E3,a,e);u();s();q()}else f("#s-tb-layout-menu").find('[data-section="layoutMode2"]')
.remove()});b.when(w.restorePromise(),C.restorePromise()).done(function(){x()&&(d.pageManager.switchFullScreenMode("normal",A.value(),!1),A.pipeChanges(function(a,b){d.pageManager.switchFullScreenMode(b,a,!0)}))});g.extendOwn(this,{lb:function(a,b){b(w);b(C)}})}});define("structure/widget/ui/page/PageManager","jquery almworks/jquery underscore almworks/util/Util structure/widget/ui/page/PanelWidthModel structure/widget/ui/page/FocusedPanelModel structure/widget/ui/layout/PanelSwapper structure/ui/details/ItemDetails".split(" "),function(f,b,g,d,e,a,n,c){var p=namespace("almworks.structure.appevents"),m=namespace("almworks.structure"),k={normal:41,tbon:0,tboff:0,tbhov:0},r={normal:60,tbon:44,tboff:6,tbhov:44},l=d.extend({},r,{tbhov:6}),h={normal:15,tbon:7,tboff:7,tbhov:7};return function(u){function s(a,b){function c(){ra&&ra===l&&U()}var f=va&&a[0].toUpperCase(),h=b.controlCell||new d.Cell,l=d.extendOwn(this,{shown: !0,onResize:d.noop,oK:null,widthCell:null,debugName:f,toggle:function(a){h.setValue(a);a?(this.start&&(this.start(),delete this.start),ga.show(),b.panel$.show(),this.widthCell.recalculate(),Y(!0),U(),b.hk&&b.hk()):(ga.css("left",-9999),ga.hide(),b.panel$.hide(),
b.afterHide&&b.afterHide())}},b,function(){var l=b.defaultWidth/S.width(),l=new e(u,h,a,l),k=l.getWidthCell(),m=new d.Cell(k,function(a){return v(a*S.width(),b.minWidth)});k.pipeChanges(function(){g.defer(c)});va&&(k.debug(f+".storedWidth"),m.debug(f+".width"));return{oK:k,widthCell:m,widthModel:l}}());return l}function q(){if(!S.is(":animated")){var a=S.height();w(a-Ea());K(a)}}function x(a,b){a.panel$.toggleClass("st-focused",b)}function t(a){d.assert(a&&a.panel$);var b=H.otherPanel(a),c=a.ao(),e=c.bc(),f= !1;x(a,!0);x(b,!1);R.fireEvent(p.nl,a);if(!e){var g=a.ae();g.isEmpty()||(c.eJ([g.rowId(0)]),f= !0)}f||a.bD().fireEvent(p.eu,e,b.ao().bc(),a,!1)}function w(a){T.height(a-pa.heightCell.value());Aa.height(a-Fa.heightCell.value())}function v(a,b,c){c||(c=S.width());a=Math.max(a,b);c=c-a-ya();c=(wa?wa.minWidth:0)-c;0<c&&(a=Math.max(a-c,b));return Math.round(a)}function C(a){va&&d.debug("setFullWindowHeight("+a+")");var c=b(window).height(),e=z(),f=c-e;va&&d.debug("currentHeight:",S.height(),"windowHeight:",c,"otherHeight:",e,"h:",f);return O(f,a)}function z(){var a=0;b('header[role="banner"],.st-pcv-head,header nav,.st-focus-decoration,div.foot').each(function(){var c=b(this);c.is(
":visible")&&(a+=c.outerHeight(!0))});var a=a+F(),c=b("#page").find("div#announcement-banner");c.is(":visible")&&(a+=c.outerHeight(!0),(c=c.find("#structure").outerHeight(!0)+c.find("header.s-board-header").outerHeight(!0))&&(a-=c));return a}function F(){if(b("body").hasClass("s-tb-hover"))return l.tbhover;var a=b("header.s-board-header");return a.is(":visible")?a.outerHeight(!0):0}function A(){if(ka&&b.contains(ka[0],S[0]))return ka;ka=null;S.parents().each(function(){var a=b(this),c=a.css("overflow"),d=a.css("overflow-y");if("auto"===c||"scroll"===c||"auto"===d||"scroll"===d)return ka=a,!1});ka||(ka=b("body"));return ka}function D(a,c){var e=0,f=a.parentsUntil(c).andSelf();f.each(function(){var a=b(this),c=a.css("margin-bottom"),a=a.css("padding-bottom");c&&(c=parseInt(c,10));c&&(e+=c);a&&(a=parseInt(a,10));a&&(e+=a)});f.nextAll().each(function(){var a=b(this),c=a.is(":visible")?a.outerHeight(!0):0;if(0<c&&"absolute"!==a.css("position")){var f=a.css("float");f&&"none"!==f?d.warn("cannot set container height: trailing float elements not supported"):(a=a.css("display"),"block"!==a?d.warn("cannot set container height: trailing elements with display:"+a+" not supported"):e+=c)}});
return e}function G(){va&&d.debug("setContainerWindowHeight()");var a=A(),b=a.height();if(b){var c=S.offset(),e=ka.offset(),f=Math.ceil(c&&c.top||0)-Math.floor(e&&e.top||0),a=D(S,a),g=b-a-f;va&&d.debug("containerHeight="+b+", precedingHeight="+f+", trailingHeight="+a+", containerPos="+m.apputil.ct(e)+", pagePos="+m.apputil.ct(c)+", h="+g);O(g,!1)}}function B(a){va&&d.debug("setPageHeight0("+a+")");S.height(a);var b=a-Ea();w(b);K(a);ra.updateVertical();R.fireEvent(p.dr);aa.setValue(b)}function K(a){J("height",a-1)}function J(a,b){Z.css(a,b);ia.css(a,b);for(var c in ma)ma[c].panel$.css(a,b)};function O(a,c,e){va&&d.debug("setPageHeight("+a+", "+c+")");var f=u.config.getMinHeight();0>f&&(f=0);var g=Math.max(ta,f),h=S.height(),l=Ea(),k=Math.min(g,Math.max(f,a-l))+l,m=b.Deferred();h<f||h>g|| !c?(B(k),m.resolve()):S.stop(!0,!0).animate({height:k},{duration:e||100,easing:"swing",queue: !1,step:function(a,b){w(a-Ea());K(a);ra.updateVertical()},complete:function(){B(k);m.resolve()}});return m.promise()}function V(a){var b=ta;ta=1E7;var c=u.master.getPanelContentHeight(),e=u.slave.getPanelContentHeight(),c=new d.Cell(c,e,Math.max),e=u.footerWarningHeightCell,f=u.master.bh().fS(),g=
u.master.bn().hM;a=a?new d.Cell(u.master.eg().fO(),u.slave.eg().fO(),Math.max):(new d.Cell).setValue(0);var h="window"!==u.config.height?pa.heightCell:(new d.Cell).setValue(0);(new d.Cell(c,a,f,g,h,e,function(a,c,d,e,f,g){return Math.max(c,d,f+Math.min(b+e,a),g)})).pipe(function(a){O(a+Ea(),!1)})}function U(){b.each(P(),function(a,b){b.el$.css(b.css)});R.fireEvent(p.ar)}function P(){var a=[];if(ra.shown){var b=S.width();if(0>=b)a.push({el$:da,css:{width:"100%"}},{el$:ga,css:{left: -9999}},{el$:ra.panel$,css:{left: -9999}});else{var c=Math.max(Math.ceil(ra.widthCell.value()),0),d=ya(),b=b-c-d,e=Math.max(b,wa?wa.minWidth:0);e>b&&(c-=e-b);a.push({el$:da,css:{left:0,width:e}},{el$:ga,css:{left:e}},{el$:ra.panel$,css:{left:e+d,width:c}})}}else a.push({el$:da,css:{left:0,width:"100%"}});return a}function Y(a){var c;"window"===Q?c=C(!a&& !W):"container"===Q&&G();ra.updateVertical();return c||b.Deferred().resolve().promise()}function N(){u.div$.is(":visible")&&R.fireEvent(p.av)}function L(a){ca.setValue(a.panelName)}function fa(){return ra.tabFocusPanel()}function X(a){ra.toggle(!1);ra=a;a.toggle(!0);S.toggleClass("single-panel",a===wa);a=ra.mainPanelBottomGap||0;u.master.bn()
.issueAreaExtraHeight.setValue(a)}function M(a,c,d,e){if("normal"!==a&&"normal"!==c)return b.when();var g=b("#header"),h=g.find(".aui-header");if(!g.length|| !h.length)return b.when();var l=(a=k[c])&&"";if(!d)return h.css({height:l}),b.when();g.show();return h.stop(!0,!0).animate({height:a},e).promise().done(function(){g.css({display:""});h.css({height:l});"normal"===c&&f(window).trigger("resize")})}function ba(a,c,e,f){var g=b("header.s-board-header"),l=b("#s-board-toolbar"),k=g.find(".s-toolbar-container");if(!(g.length&&l.length&&k.length&&e))return b.when();var m="tbhov"===a||"tbhov"===c,n=r[c];e=h[a];var p=h[c];a=n===r[a]?b.when():g.stop(!0,!0).animate({minHeight:n,height:n},d.extend({},f,{step:function(a,b){if("height"===b.prop){if(m){var c=Math.max(0,Math.min(a-2*p,30));k.css({height:c})}g.css("overflow","visible")}}})).promise().done(function(){g.css({minHeight:"",height:"",overflow:""});m&&k.css({height:""})});f=p===e?b.when():l.stop(!0,!0).animate({paddingTop:p,paddingBottom:p},f).promise().done(function(){l.css({paddingTop:"",paddingBottom:""})});return b.when(a,f)}function E(a,c,e,f){if(!e)return b.when();e=S.height();var h=l[c]-l[a],m=k[c]-k[a],n={};"tbhov"!==a||
"tbon"!==c&&"normal"!==c||(n.marginTop=h);if(0!==h||0!==m)n.height=e-h-m;return g.isEmpty(n)?b.when():S.stop(!0,!0).animate(n,d.extend({},f,{step:function(a,b){"height"===b.prop?(w(a-Ea()),K(a),ra.updateVertical()):J(b.prop,a)}})).promise().done(function(){S.css({marginTop:""});J("marginTop","")})}function I(a){return function(){b("body").toggleClass("s-full-screen-mode","normal"!==a).toggleClass("s-tb-collapsed","tboff"===a).toggleClass("s-tb-hover","tbhov"===a)}}var ma={},R=d.nn(u.eventBus),S=u.div$.find(".st-page"),ga=u.div$.find(".st-splitter"),da=u.div$.find(".st-master"),ia=u.bF.panel$,T=da.find(".main"),Aa=u.slave.panel$.find(".main"),Z=c.panel$,va= !1,Q=u.config.height;"window"!==Q&&"model"!==Q&&"model+selectors"!==Q&&"container"!==Q&&(Q=d.toIntSafe(Q,0),0>=Q&&(Q="model"));var sa="window"===Q||"container"===Q,ta=u.config.getMaxHeight();if(!ta||0>ta)ta=1E7;var ya=d.lazy(function(){return ga.outerWidth()}),qa=d.lazy(function(){return da.find(".sechead").outerHeight(!0)}),aa=(new d.Cell).setValue(0),la=u.master.getPanelHeader(),oa=u.slave.getPanelHeader(),pa=u.master.getPanelBanners(),Fa=u.slave.getPanelBanners(),y=(new d.Cell(la.getHeightCell(),oa.getHeightCell(),Math.max))
.pipeChanges(q),ua=d.lazy(function(){if(m.modes.GADGET)return 0;var a=da.find(".s-ph-container"),b=a.height();d.assert(0<b);return a.parent().outerHeight(!0)-b}),Ea=function(){return qa()+y.value()+ua()};pa.heightCell.pipeChanges(q);Fa.heightCell.pipeChanges(q);var na=function(){function a(){c.panel$.addClass("st-sticky")}var b=new s("details",{cellNoValue: !1,controlCell:c.enabledCell,panel$:c.panel$,start:function(){c.panel$.resize(a);b.widthCell.pipe(c.onWidthChange)},hk:c.hk,focusPanel:function(a){a=a!==u.master;c.setFocused(a);x(u.master,!a)},tabFocusPanel:function(){c.setFocused(!c.isFocused())},updateVertical:a,onResize:c.onResize,defaultWidth:1200,minWidth:425});return b}(),$=function(){return new s("history",{cellNoValue: !1,controlCell:u.bF.visibleCell,panel$:u.bF.panel$,start:function(){u.bF.visibleCell.setValue(!0)},hk:d.noop,afterHide:function(){u.bF.visibleCell.setValue(!1)},focusPanel:d.noop,tabFocusPanel:d.noop,updateVertical:function(){var a=u.bF.panel$;a.find(".s-h-entries").css("height",a.height()-a.find(".s-h-header").outerHeight()+"px")},onResize:d.noop,defaultWidth:300,minWidth:200})}(),xa=function(){var a=u.slave;return new s("secondary",{cellNoValue: !1,
panel$:a.panel$,start:d.withThis(a,a.start),focusPanel:t,tabFocusPanel:function(){H.toggle();return!0},updateVertical:d.noop,defaultWidth:S.width()/2,minWidth:500})}(),wa=function(){return{toggle:function(a){a&&(na.toggle(!1),xa.toggle(!1),$.toggle(!1),U(),L(u.master))},shown: !1,panel$:b([]),focusPanel:t,tabFocusPanel:d.returnFalse,updateVertical:d.noop,onResize:d.noop,oK:new d.Cell(0),widthCell:new d.Cell(0),minWidth:500,lb:d.noop,debugName:va&&"0"}}(),ra=wa;Y(!0);U();var W=u.div$.hasClass("ie8"),ca=new d.Cell(null),H=new a(ca,u),ja=new d.Cell(ca,function(){return H.getPanel()});ca.pipeChanges(function(a){ra.focusPanel(H.resolvePanelByName(a))});H.restore();new n(u);d.delayed(250,function(){var a= !1;try{var c="BackCompat"==document.compatMode?document.body:document.documentElement,a=c.scrollHeight>c.clientHeight}catch(d){}a=a?"auto":"hidden";c=b(document.body);c.css("overflow-y")!==a&&(c.css("overflow-y",a),R.fireEvent(p.dr))});(function(){function a(b){e&&(ra.widthCell.setValue(v(e.w-(b.pageX-e.x),ra.minWidth,e.pw)),U())}function c(b){a(b);e=null;S.removeClass("resizeActive");ra.onResize(!1);f.enableSelection();ra.oK.setValue(ra.widthCell.value()/S.width())}var e=null,f=
new d.SelectionDisabler;ga.mousedown(function(g){if(ra.shown&& !e){var h=S.width();if(!(10>=h)){var l=ra.panel$.width();ra.widthCell.setValue(l);e={w:l,pw:h,x:g.pageX};d.dragBind(b,a,c,c,!0);S.addClass("resizeActive");f.disableSelection();ra.onResize(!0);g.preventDefault();g.stopImmediatePropagation();return!1}}})})();"window"===Q?b(document).ready(d.curry(C,!1)):"model"===Q||"model+selectors"===Q?V("model+selectors"===Q):"container"===Q?b(document).ready(G):Q&&B(Q+Ea());(function(){function a(){window.onfocus=d.seq(function(a){a&&a.target&&a.target!==window&&a.target!==document||R.fireEvent(p.cj)},window.onfocus);window.onblur=d.seq(function(a){a&&a.target&&a.target!==window&&a.target!==document||R.fireEvent(p.cX)},window.onblur)}function c(){function a(){b=null;R.fireEvent(p.cX)}var b=null;document.onfocusin=d.seq(function(){b?(window.clearTimeout(b),b=null):R.fireEvent(p.cj)},document.onfocusin);document.onfocusout=d.seq(function(){b=window.setTimeout(a,100)},document.onfocusout)}function e(){var a= !0;window.setInterval(function(){var b=u.div$.is(":visible");b!=a&&(a=b,R.fireEvent(p.bX,a),a&&N())},5E3)}b(window).resize(d.delayed(100,function(){var a=S.width(),b=ra.oK.value()*a;
b&&(b=v(b,ra.minWidth,a),ra.widthCell.setValue(b));R.fireEvent(p.av)}));b("body>div.global-warning, #header>div").on("DOMNodeRemoved",function(){window.setTimeout(function(){R.fireEvent(p.av)},100)});b.browser.msie&&11>b.browser.version?c():a();u.config.hideable&&e()})();this[p.av]=function(){Y().always(function(){U();R.fireEvent(p.dr)})};this[p.dr]=function(){R.fireEvent(p.ar)};R.addListener(new d.Life,this);u.globalActions.register("tabFocusPanel",fa);(new d.Cell(c.visibleCell,c.focusedCell,function(a,b){return a?b:void 0})).pipeChanges(function(a){var b=H.getPanel();b&&x(b,!a);S.toggleClass("st-details-focused",! !a);a||(a=u.master,L(a),t(a))});(new d.Cell(u.bF.visibleCell,u.bF.focusedCell,function(a,b){return a?b:void 0})).pipeChanges(function(a){var b=H.getPanel();b&&x(b,!a);S.toggleClass("st-details-focused",! !a);a||(L(u.master),t(u.master))});var ka=null;d.extend(this,{forceLayout:N,bZ:function(a){sa&&(a=S.height()-a,S.height(a),q(),ra.updateVertical(),R.fireEvent(p.dr))},getFocusedPanel:function(){return H.getPanel()},getFocusedPanelCell:function(){return ja},setFocusedPanel:L,showSlavePanel:d.curry(X,xa),showDetailsPanel:d.curry(X,na),hideSecondaryPanel:d.curry(X,wa),
showHistoryPanel:d.curry(X,$),showExternalPanel:function(a,b){var c=ma[a];c||(c=ma[a]=new s(a,b),b.useMasterSlaveFocus&&(c.focusPanel=t));X(c)},getSplitterPageX:function(){if(!ra.shown|| !ga.is(":visible"))return-1;var a=ga.offset();return a?a.left: -1},getViewportHeightCell:function(){return aa},getHeaderHeight:function(){return Ea()},lb:function(a,b){a.pageManager=g.extend({},a.pageManager);ra&&ra.widthModel&&b(ra.widthModel);b(H)},setDebug:function(a){va=a},tabFocusPanel:fa,switchFullScreenMode:function(a,c,d){if(a!==c){var e={duration:75,easing:"swing"};b("body").toggleClass("s-tb-hover","tbhov"===a||"tbhov"===c);b.when(M(a,c,d,e),ba(a,c,d,e),E(a,c,d,e)).done(I(c)).done(N)}}})}});define("structure/widget/ui/generator/LevelsRangeEditor",["almworks/util/Cell","almworks/util/CellPresenter","structure/widget/jira/SingleSelect2Presenter"],function(f,b,g){return function(d,e,a,n,c){var p=(new f).pipeChanges(function(b){e.toggle("manual"===b);"all"===b?(m.setValue(null),k.setValue(null)):"single"===b?(m.setValue(null),k.setValue(1)):"upTo10"===b?(m.setValue(null),k.setValue(10)):"manual"===b&&a.focus();"function"===typeof c&&c(b)}),m=new f,k=new f;new g(p,d);new b.TextPresenter(m,a,!
0);new b.TextPresenter(k,n,!0);n=m.value();var r=k.value();d= ! !d.find("option[value=upTo10]").length;n||r?n||1!=r? !n&&10==r&&d?p.setValue("upTo10"):p.setValue("manual"):p.setValue("single"):p.setValue("all")}});define("structure/widget/jira/SingleSelect2Presenter",["underscore","almworks/util/Objects","almworks/util/Classes","almworks/util/Log","almworks/util/CellPresenter"],function(f,b,g,d,e){function a(a,b,d){g.addSuper(e.CellPresenter,this)(a,b,d)}b.extend(a.prototype,e.CellPresenter.prototype,{updateView:function(a){(a||"")!==this.view.val()&&(a=this.view.find('option[value="'+a+'"]'),this.view.find("option[selected]").removeAttr("selected"),a.attr("selected","selected"),this.view.trigger("change"))},getViewValue:function(){var a=this.view.val();f.isArray(a)&&(d.assert(1===a.length),a=a[0]);return a?""+a:""},subscribeToViewEvents:function(a){var b=this.view;b&&(b.on("change.presenter",f.bind(this.viewChanged,this)),a.addDetach(function(){b.off(".presenter")}))}});return a});define("structure/widget/ui/attribute/PresetSelectorController",
"underscore jquery jira/lib/class jira/ajs/list/group-descriptor jira/ajs/list/item-descriptor jira/ajs/select/suggestions/default-suggest-handler almworks/util/Objects almworks/util/ObjSet almworks/util/Strings almworks/util/Template almworks/util/I18n almworks/util/Log almworks/util/Cell almworks/util/CellPresenter almworks/util/JSON almworks/util/Functions structure/widget/ui/attribute/AttributeRegistry".split(" "),function(f,b,g,d,e,a,n,c,p,m,k,r,l,h,u,s,q){function x(a,c,d,e){var f=this;this.widget=c;var g=this._presetsMap=t(c,a,d,e);this._customSpec=new l(null);this._customOptgroup$=a.find(".s-ae-og-custom");this._selectedOption=new l("");this._selectedSpec=new l(this._selectedOption,this._customSpec,function(a,b){return a?"*"===a?"*":"+"===a?b&&b.spec:g[a]:null});var h=s.delayed(50,function(){f._customSpec.setValue(null)});this._selectedOption.pipeChanges(function(a){"+"!==a&&f._customSpec.value()&&h()});var k=b(a[0]);a=B.createAjsSingleSelect(k,{suggestionsHandler:O});(new B.SingleSelectPresenter(this._selectedOption)).setView(a);this._customSpec.pipeChanges(function(a){a=a&&a.name?K.option.renderHtml({name:a.name,value:"+"}):"";f._customOptgroup$.html(a);k.trigger("reset")
})}function t(a,b,c,d){var e,f={};e=""+K.placeholder.renderHtml();e+=K.customGroup.renderHtml();e+=v("s.w.attribute-editor.recent",C(a,c),f,d,!0);e+=v("s.w.attribute-editor.columns",z(a,c),f,d);e+=v("s.w.attribute-editor.standard",a.attributeRegistry.getPresets(c),f,d);e+=v("s.w.attribute-editor.customizable",F(a,c),f,d);e+=K.group.renderHtml({label:k.text("s.w.attribute-editor.advanced"),options:K.option.renderHtml({name:k.text("s.w.attribute-editor.manual"),value:"*"})});b.html(e);return f}function w(a,b){var c=b&&b.name||"";return(a&&a.name||"").toLocaleUpperCase().localeCompare(c.toLocaleUpperCase())}function v(a,b,c,d,e){e||(b=b.slice(),b.sort(w));b=f.chain(b);f.isFunction(d)&&(b=b.filter(function(a){return d(a.spec)}));b=b.map(function(a){a.value=n.idString(a.spec);c[a.value]=a.spec;n.deepFreeze(a.spec);return K.option.renderHtml(a)}).value().join("");return K.group.renderHtml({label:k.text(a),options:b})}function C(a,b){return f.chain(A()).map(function(c){c=q.normalizeSpec(c);if(a.attributeRegistry.isFormatSupportedBySpec(c,b)){var d=a.attributeRegistry.suggestLabel(c);if(d)return{name:d,spec:c}}}).compact().first(3).value()}function z(a,b){var d=[],e=new c;a.panels.forEach(
function(c){c.af().getColumns().forEach(function(c){var g=c.getName();f.each(c.getSuggestedAttributeSpecs(),function(c){c=q.normalizeSpec(c);if(e.add(c)&&a.attributeRegistry.isFormatSupportedBySpec(c,b)){var f=a.attributeRegistry.suggestLabel(c);f&&(f!==g&&(f=k.text("s.w.attribute-editor.used-in-columns",g,f)),d.push({name:f,spec:c}))}})})});return d}function F(a,b){var c=a.attributeRegistry.getDescriptors();return f.chain(c).filter(function(a){return a.isConfigurable()&&(!b||a.isFormatSupported(b))}).map(function(a){return{spec:n.extend(q.normalizeSpec(a.getDefaultSpec()),{configure: !0}),name:a.getLabel()}}).value()}function A(){var a=u.safeParse(G.getStored(V));return a&&f.isArray(a)?a:[]}function D(){var a=new c,b=[],d=function(c){a.add(c)&&b.push(c)};U.forEach(d);A().forEach(d);d=b.length-3;0<d&&b.splice(3,d);G.setStored(V,u.stringify(b));U=[];P= !1}var G=namespace("almworks.structure"),B=namespace("almworks.structure.ajsbridge"),K={option:m.build("option",function(a){return a({value:"{value}"})("{name}")}),group:m.build("optgroup",function(a){return a({label:"{label}"})("{options:html}")}),placeholder:new m(
'<option value="" data-placeholder="true">{s.w.attribute-editor.select.placeholder}</option>'),customGroup:new m('<optgroup label="{s.w.attribute-editor.custom}" class="s-ae-og-custom"></optgroup>')};n.extend(x.prototype,{updateSelectedOption:function(a){if(a&&a.id)if(a.format)a="*";else{var b=n.idString(a);this._presetsMap[b]?a=b:(b=this.widget.attributeRegistry.suggestLabel(a))?(this._customSpec.setValue({name:b,spec:a}),a="+"):a="*"}else a="";this._selectedOption.setValue(a)},getSelectedSpecCell:function(){return this._selectedSpec}});var J=g.extend({init:function(a,b){this.model=b;this.model.$element.data("static-suggestions",!0)},execute:function(a){return b.Deferred().resolve(this.model.getAllDescriptors(!0))}}),O=a.extend({init:function(a,b){this.descriptorFetcher=new J(a,b);this.options=a;this.model=b},formatSuggestions:function(a,b){var c=this._super(a,b);return f.filter(c,function(a){return!(a instanceof d&& !a.items().length)})}}),V="ae-recent",U=[],P= !1;x.addRecentSpec=function(a){U.push(a);P||(f.defer(D),P= !0)};return x});define("structure/widget/ui/attribute/AttributeEditor",
"jquery almworks/jquery underscore almworks/util/Util almworks/util/Cell almworks/util/Template structure/widget/ui/attribute/AttributeRegistry structure/widget/ui/UIUtil structure/widget/ui/attribute/PresetSelectorController almworks/util/JSON structure/widget/attributes/Attributes".split(" "),function(f,b,g,d,e,a,n,c,p,m,k){function r(a,b){if(!a.is("textarea"))throw Error("unsupported base field: "+a);var c=a.data("s-attribute-editor");if(c&&c instanceof r)return c;a.data("s-attribute-editor",this);b||(b={});var f=this;this.context=b.context||{};this._widget=this.context.structure&&this.context.structure._widget||require("structure/widget/widget").getWidget();this._registry=this._widget.attributeRegistry;this._elem$=a;this._expectedFormat=b.usePrimaryFormat?null:b.expectedFormat||a.attr("data-expected-format")||k.Formats.HTML;this._presetFilter=b.presetFilter;this._additionalContentClasses=b.additionalContentClasses;this.aK={};this.aK.value=new e;this.aK.valueJSON=this.aK.value.subCell(function(a){a||(a={id:"",format:f._getExpectedFormat()});a.format||(a=d.clone(a),a.format=f._getExpectedFormat(a));return m.stringify(a)},function(a){(a=m.safeParse(a))&&a.format===
f._getExpectedFormat(a)&&delete a.format;return a});this.aK.valueJSON.setValue(a.val());this._initialValue=this.aK.value.value();this.aK.configureButtonPressed=new e(!1);this._level=a.parents(".s-ae-options").length;this._id="s-ae"+ ++q;this._descriptorContext=d.deepExtend({},this.context,{getSpec:function(){return d.deepClone(f.aK.value.value())},updateSpec:function(a,b){var c=f.aK.value.value(),e=d.deepClone(c),h=a.call(b,e);!1!==h&&null!==h&&(void 0!==h&& !0!==h&&g.isObject(h)&&(e=h),c&&e.id!==c.id?d.warn("attribute descriptor is not allowed to change attributeSpec.id"):f.aK.value.setValue(d.deepClone(e)))},getExpectedFormat:function(){return f._expectedFormat}});this._initUI()}var l=namespace("almworks.structure.apputil"),h=a.load("structure.widget.ui.attribute-editor.main"),u=a.load("structure.widget.ui.attribute-editor.options"),s=a.load("structure.widget.ui.attribute-editor.tri"),q=0;d.extend(r.prototype,{_initUI:function(){var a=this;if(this._elem$.is(".s-decorated"))throw Error("cannot initialize AttributeEditor: editor already exists");this._elem$.addClass("s-decorated");var b=h.renderBind({id:this._id});this._elem$.before(b.all$);this._elem$.detach();var e=u.renderBind({
id:this._id,level:3>=this._level?this._level:"max",additionalClasses:this._additionalContentClasses||""});e.all$.insertAfter(b.all$.closest(".field-group,fieldset"));e["text-div"].append(this._elem$);var f=this._elem$.attr("id");f||(f=this._id+"-textarea",this._elem$.attr("id",f));e["text-div"].find("label").attr("for",f);new d.TextPresenter(this.aK.valueJSON,this._elem$);l.initAUIToggleButton(b.configure,this.aK.configureButtonPressed);c.displayPromise(a._registry.getMetaPromise(),b.selector).done(function(){a._initUI2(b,e,b.selector)})},_initUI2:function(a,b,c){var f=this;f._presetsController=new p(c,f._widget,f._expectedFormat,f._presetFilter);f._presetsController.updateSelectedOption(f._initialValue);var g=f._presetsController.getSelectedSpecCell();g.pipe(function(a){if(a&&"*"!==a&&((f.aK.value.value()||{}).id!==a.id|| !a.configure)){var b=d.deepClone(a);delete b.configure;f.aK.value.setValue(b)}a&&("*"===a||a.configure)?f.aK.configureButtonPressed.setValue(!0):f.aK.configureButtonPressed.setValue(!1)});f.aK.selectedPresetConfigurable=new e(g,function(a){if(!a||"*"===a)return!1;if(a.configure)return!0;if(!a.id)return!1;a=f._registry.getDescriptor(a.id);return!(!a|| !
a.isConfigurable())});new d.ElementClassToggler(f.aK.selectedPresetConfigurable,"s-hidden",a["configure-container"],!0);new d.ElementClassToggler(f.aK.selectedPresetConfigurable,"configurable",a["selector-container"]);a=new e(g,function(a){return "*"===a});new d.ElementToggler(a,b["text-div"]);a=new e(f.aK.selectedPresetConfigurable,f.aK.configureButtonPressed,d.and);new d.ElementToggler(a,b["descriptor-options"]);f.aK.configureButtonPressed.pipeChanges(function(a){var b=g.value();"*"!==b&&f.aK.selectedPresetConfigurable.value()&&(a?b&&b.id&& !b.configure&&f._presetsController.updateSelectedOption({id:b.id,configure: !0}):f._presetsController.updateSelectedOption(f.aK.value.value()))});(new e(a,g,function(a,b){return a&&b&&"*"!==b&&b.id})).pipe(function(a){a=f._getDescriptorOptions(a);b["descriptor-options"].empty().append(a);b["descriptor-options"].trigger("notify")});f._isUpdatingRecents()&&f._updateRecentsOnSubmit();f._trackNotify(b)},edit:function(a){this.aK.valueJSON.setValue(a?m.stringify(a):"");this._initialValue=this.aK.value.value();this._presetsController&&this._presetsController.updateSelectedOption(this._initialValue)},_isUpdatingRecents:function(){return!this._level},
_trackNotify:function(a){a["descriptor-options"].on("notify",function(c,d){for(var e=b(c.target).closest(".field-group,fieldset").data("option"),f=a["descriptor-options"].find(".field-group,fieldset"),g=[],h=f.length-1;0<=h;h--){var l=f.slice(h,h+1),k=l.data("option"),m;k&&k!==e&&(m= ! !k.notify(d||"update"),l.toggle(m),k.isInputValid()||g.push(k.title))}})},_isValidSpec:function(a){return this._registry.isSpecValid(a,!0)},_updateRecentsOnSubmit:function(){this._elem$.closest("form").on("submit",g.bind(this.updateRecents,this))},updateRecents:function(){if(this._isUpdatingRecents()){var a=this.aK.value.value();this._isValidSpec(a)&&p.addRecentSpec(a)}},_getDescriptorOptions:function(a){var b=s.render$({level:3>=this._level?this._level:"max"});if(a=a&&this._registry.getDescriptor(a)){var c;g.each(a.createOptions(this._descriptorContext)||[],function(a){c=a.createRow();c.data("option",a);b=b.add(c)})}return b},_getExpectedFormat:function(a){return this._expectedFormat?this._expectedFormat:a&&a.id?this._registry.getPrimaryFormat(a):k.Formats.TEXT}});return r});define("structure/widget/ui/attribute/AttributeRegistry",
"underscore almworks/jquery almworks/util/ObjMap almworks/util/Collections almworks/util/Objects almworks/util/Log almworks/util/MiscUtils structure/widget/attributes/Attributes".split(" "),function(f,b,g,d,e,a,n,c){function p(a){this._widget=a;this._descriptors={};this._presets=[];this._presetsForFormatMap={};this._presetsMap=new g;this._metaPromise=null}function m(a){return{widget:a._widget,addDescriptor:function(b){var c=b.getAttributeID();if(!c)throw Error("invalid descriptor "+b);if(a._descriptors[c])throw Error('descriptor with ID "'+c+'" is already registered');a._descriptors[c]=b},addPreset:function(b,c){var d={name:b,spec:k(c)};a._presetsMap.hasKey(d.spec)||(a._presetsMap.put(d.spec,d),a._presets.push(d))}}}function k(a){if(!a|| !a.id)return null;var b={id:a.id};f.isEmpty(a.params)||(b.params=e.deepClone(a.params));return b}var r=[];e.extend(p.prototype,{getMetaPromise:function(){function c(b,d){a.warn("failed to load promised meta for attributes: "+b)}var d=this;if(!d._metaPromise){var e=b.Deferred();d._metaPromise=e.promise();var g=m(d),k=f.compact(f.map(r,function(b){try{return n.defaultWhenRejected(b(g),c)}catch(d){a.error("error loading attribute metadata from "+b+
": "+d,d)}}));b.when.apply(b,k).always(function(){d._descriptorsList=f.values(d._descriptors);Object.freeze(d._descriptors);Object.freeze(d._descriptorsList);Object.freeze(d._presets);e.resolve()})}return d._metaPromise},assertMetaLoaded:function(){if("resolved"!==this._metaPromise.state())throw Error("metadata not loaded");},_getDescriptor:function(a){return this._descriptors[a&&a.id||a||""]},getDescriptor:function(a){this.assertMetaLoaded();var b=this._getDescriptor(a);if(!b)throw Error('unknown attribute ID "'+a+'"');return b},getDescriptors:function(){this.assertMetaLoaded();return this._descriptorsList},getPresets:function(a){this.assertMetaLoaded();if(a){var b=this._presetsForFormatMap[a];if(!b){var c=this,b=this._presets.filter(function(b){return c.isFormatSupportedBySpec(b.spec,a)});Object.freeze(b);this._presetsForFormatMap[a]=b}return b}return this._presets},suggestLabel:function(a){if(!a)return null;a=k(a);var b=this._presetsMap.get(a);return b?b.name:(b=this._getDescriptor(a))?b.suggestLabel(a):null},isFormatSupportedBySpec:function(a,b){if(!a)return!1;if(!b)return!0;var c=this._getDescriptor(a);return c?c.isFormatSupportedBySpec(a,b): !1},isSpecValid:function(a,b){if(!
a|| !a.id)return!1;var c=this._getDescriptor(a);return null==c? !b:c.isParamsValid(a.params)},getPrimaryFormat:function(a){var b=null;a&&a.id&&(b=(b=this._getDescriptor(a))&&b.getPrimaryFormat(a));return b||c.Formats.TEXT}});p.registerFactory=function(a){r.push(a)};p.normalizeSpec=k;return p});define("structure/widget/ui/column/ColumnNameOption",["almworks/jquery","almworks/util/Classes","almworks/util/Util","structure/api/SpecOption"],function(f,b,g,d){return b.subClass("ColumnNameOption",d,{title:g.text("sw.column.opt.name"),init:function(){this.input$=null;this.lastName=this.configurator.getColumnName()},_setName:g.delayed(250,function(){var b=this.input$.val();b!==this.lastName&&(b?this.spec.name=b:delete this.spec.name,this.lastName=b,this.input$.trigger("notify"))}),createInput:function(b){this.input$=f('<input class="text" type="text">').appendTo(b);var a=this;this.input$.on("keyup",function(){a._setName()});this.input$.on("blur",function(){var b=a.input$.val();b||(b=a.configurator.getColumnName(),a.input$.val(b),a.lastName=b)})},notify:function(){this.input$.val(this.configurator.getColumnName());return!0},isInputValid:function(){return ""!==this.spec.name}})});define(
"structure/widget/ui/column/NumberFormatOption","underscore almworks/jquery almworks/util/Classes almworks/util/Template almworks/util/Util almworks/util/Cell structure/api/SpecOption".split(" "),function(f,b,g,d,e,a,n){function c(a){if(!r){var c=b.Deferred();p.doAjax({url:m.localURL(p.RESOURCES.DATE_STYLES),type:"GET",dataType:"json",timeout:3E4,success:function(a){c.resolve(a.styles)},error:function(a){c.resolve([])}});r=c.promise()}r.always(a)}var p=namespace("almworks.structure.ajax"),m=namespace("almworks.structure.ajsbridge"),k=d.load("structure.widget.ui.column.number-format"),r;return g.subClass("NumberFormatOption",n,{title:e.text("s.w.number-format.title"),init:function(b){this.paramName=b&&b.paramName||"numberFormat";this.cells={type:new a(""),rounding:new a("0"),datetimeStyle:new a(""),workTime:new a(!1)};this.cells.specCell=new a(this.cells.type,this.cells.rounding,this.cells.datetimeStyle,this.cells.workTime,e.withThis(this,this.createSpec));this._$={};this.loadCellsFromSpec();var c=this;this.cells.specCell.pipeChanges(function(a){if(c.spec){var b=c.spec.params||(c.spec.params={});a?b[c.paramName]=a:delete b[c.paramName];c._$.type&&c._$.type.trigger("notify")}})},
createSpec:function(a,b,c,d){var f={type:a};"number"===a||"percentage"===a?f.rounding=Math.min(9,Math.max(0,e.toIntSafe(b))):"datetime"===a?f.style=c:"duration"===a?f.workTime=d:f=null;return f},loadCellsFromSpec:function(){var b=this.spec&&this.spec.params&&this.spec.params[this.paramName],c=this.cells;a.multiUpdate(function(){c.type.setValue(b&&b.type||"");c.rounding.setValue(""+(b&&b.rounding||0));c.datetimeStyle.setValue(b&&b.style||"date-short");c.workTime.setValue(!(!b|| !b.workTime))})},createInput:function(a){k.render$().saveBindings(this._$).appendTo(a);this.fillOptions();new e.SelectPresenter(this.cells.type,this._$.type);new e.SelectPresenter(this.cells.rounding,this._$.rounding);new e.CheckboxPresenter(this.cells.workTime,this._$.workTime);var c=this;this.cells.type.pipe(function(a){c._$.options.find("[data-s-when-type]").each(function(){var c=b(this);c.toggle(f.contains(c.data("s-when-type").split(" "),a))})})},fillOptions:function(){var a=new d('<option value="{value}">{name}</option>'),b=f.range(0,10).map(function(b){return a.renderHtml({value:b,name:b})}).join("");this._$.rounding.html(b);var g=this;c(function(b){b=f.map(b,function(b){var c=b.style;b=b.sample;
return c&&b?a.renderHtml({value:c,name:b}):""}).join();g._$.datetimeStyle.html(b);new e.SelectPresenter(g.cells.datetimeStyle,g._$.datetimeStyle)})},notify:function(){this.loadCellsFromSpec();return!0},isInputValid:function(){return!0}})});define("structure/widget/ui/column/ColumnUtil",["almworks/jquery","almworks/util/Template","almworks/util/Util"],function(f,b,g){function d(a,b,c){var d=a._metadata;d||(a._metadata=d={global:null,preset:null,column:null,config:null});var k=d.global;k||(d.global=k=e(a.getMetadataRequests(c)));c=b?r[b]:null;var m=null;c?(m=d[b])||(d[b]=m=e(a[c]())):m=f.Deferred().resolve({}).promise();var n=f.Deferred(),p={};f.when(k,m).done(function(a,b){g.isEmpty(a)||g.extendOwn(p,a);g.isEmpty(b)||g.extendOwn(p,b)}).always(function(){n.resolve(p)});return n.promise()}function e(a){function b(a){if(a&&a.promise)return a.promise;if(!a|| !a.url)return f.Deferred().reject().promise();a.dataType||(a.dataType="json");if(!0!==a.cacheable)return c.doAjax(a);var d=k[a.url];d||(k[a.url]=d=c.doAjax(a));return d}function d(a,b){return function(c){c="function"===typeof b.extract?b.extract(c):c;n[a]=c}}function e(){p--;0>=p&&m.resolve(n)}var m=f.Deferred();if(g.isEmpty(a))
return m.resolve({}),m.promise();var n={},p=0,r,v;for(r in a)a.hasOwnProperty(r)&&(p++,v=a[r],b(v).done(d(r,v)).always(e));return m.promise()}function a(a,b){if(!g.isEmpty(b)){var c=a.getMetadata||g.noop;a.getMetadata=function(a){return b.hasOwnProperty(a)?b[a]:c(a)}}return a}function n(a,b){var c=a._panel.widget.attributeRegistry,d=c.getMetaPromise(),c=c.suggestLabel(b);c||(c=g.text("s.w.gen.sort.attribute.label"),a.repaintWhen(d));return c}var c=namespace("almworks.structure.ajax"),p=namespace("almworks.structure"),m=namespace("almworks.structure.appevents"),k={},r={preset:"getPresetMetadataRequests",column:"getColumnMetadataRequests",config:"getConfigMetadataRequests"};return{loadTypeMetadata:d,loadMetadata:e,extendMetadata:a,createConfiguratorPromise:function(b,c,k){var m=f.Deferred(),n=null;d(b,"config",c).then(function(d){return(n=b.createConfigurator(a(g.extendOwn({},c),d),k))?e(n.getMetadataRequests()):f.Deferred().reject().promise()}).done(function(b){a(n.context,b)}).always(function(){m.resolve(n)});return m.promise()},copySpec:function(a){return JSON.parse(JSON.stringify(a))},createColumnContext:function(a){var b=p.modes,c=a.widget.jiraConfig;return{structure:{
isPrimaryPanel:function(){return a.isPrimary()},isSecondaryPanel:function(){return!a.isPrimary()},isIssuePage:function(){return! !b.ISSUE_PAGE},isGreenHopperTab:function(){return! !b.GH_TAB},isPCVPage:function(){return! !b.PCV_PAGE},isProjectPage:function(){return b.PCV_PAGE===p.PAGE_IDS.PROJECT},isComponentPage:function(){return!1},isVersionPage:function(){return!1},isGadget:function(){return! !b.GADGET},isLocalGadget:function(){return "local"===b.GADGET},isRemoteGadget:function(){return "remote"===b.GADGET},isStructureBoard:function(){return b.getStructurePageId()===p.PAGE_IDS.BOARD||p.modes.ISSUE_DETAILS&& !p.modes.PCV_PAGE},onExternalParametersChanged:function(){var b=a.af();a.bD().fireEvent(m.ko,b,{columns: !0})},isConfluenceEnabled:function(){return c.isConfluenceAvailable()},_panel:a,_widget:a.widget},jira:{getAllIssueFields:function(){return g.addAll([],c.getJiraFields())},getIssueFieldById:function(a){return c.getJiraFieldMap()[a]}},getMetadata:g.noop}},getGeneratorSummaryHtml:function(a,b){var c=f(b),d=c.find("[data-attribute-spec]");if(!d.length)return b;var e=d.data("attribute-spec");d.find('span.generator-parameter:contains("{attribute}")').html(n(a,e));
return Array.prototype.reduce.call(c,function(a,b){return a+b.outerHTML},"")}}});define("structure/widget/ui/column/EditColumnPanel","almworks/jquery underscore almworks/util/Util almworks/util/Template structure/api/SpecOption structure/widget/ui/column/ColumnUtil structure/widget/ui/column/ColumnNameOption".split(" "),function(f,b,g,d,e,a,n){var c=namespace("almworks.structure.api"),p=namespace("almworks.structure.ajsbridge"),m=namespace("almworks.structure.apputil");return function(k){function r(){U&&V&&(g.safeCall(V.mj,V,U,!1),U=null)}function l(a){a&&(a.key?V&&(U=g.deepClone(a),ma()):g.warn("no spec key: "+a))}function h(){V&&(g.safeCall(V.mj,V,U,!0),U=null);return!1}function u(a){for(var b=v.find(".field-group"),c=b.length-1;0<=c;c--){var d=b.slice(c,c+1),e=d.data("option");e&&a(e,d)}}function s(a,b){if(a!==J)J&&(u(function(a){a.notify("close")}),r());else if(!b)return;if(J=a)q(),v.trigger("notify")}function q(){w.toggleClass("s-wide",! !J.isConfigurationPanelWide());z.empty().append(x([new R({configurator:J}),new n({configurator:J})]));F.empty().append(x(J.getOptions()||[]))}function x(a){var b=f(),c,d,e;for(c=0;d=a[c++];)e=d.createRow(),e.data("option",d),b=b.add(e);
return b}function t(b,c){return a.loadTypeMetadata(b,"preset",c).then(function(d){return(d=b.createSwitchTypePreset(a.extendMetadata(g.extendOwn({},c),d)))?a.createConfiguratorPromise(b,c,d):null})}var w=d.load("structure.widget.ui.column.edit").render$(),v=w.find("form.aui"),C=v.find(".st-col-opt-types"),z=v.find(".st-col-opt-common"),F=v.find(".st-col-opt-custom"),A=w.find(".st-col-buttons"),D=w.find(".st-col-remove"),G=w.find(".st-col-revert");m.initializeButton(w.find(".st-tb"));var B=a.createColumnContext(k),K=null,J=null,O=null,V=null,U=null,P=f.Deferred().reject().promise(),Y= !1,N=new g.Cell(!1),L=new g.Cell(0),fa=new g.Cell(0),X=new g.Cell(0),M=new g.Cell(0),ba=new g.Cell(0),E=new g.Cell(0),I=null;ba.pipe(function(a){E.setValue(Math.max(a,E.value()))});var ma=g.delayed(350,r);w.on("keydown",function(a){if(a&&a.target&&27===g.keyboardCodeFromEvent(a))return h()}).on("keypress",":input:not(.aui-ss-field)",function(a){if(a&&a.target&&13===g.keyboardCodeFromEvent(a))return h()}).on("keydown",":input:visible:last",function(a){if(a&&a.target&&9===g.keyboardCodeFromEvent(a))return w.find(":input:visible:first").focus(),!1}).on("keydown",":input:visible:first",function(a){if(a&&
a.target&&1009===g.keyboardCodeFromEvent(a))return w.find(":input:visible:last").focus(),!1}).on("ajs:submitForm",h);v.on("notify",function(b,c){if(J){var d=f(b.target).closest(".field-group").data("option"),e=[];u(function(a,b){if(a!==d){var f= ! !a.notify(c||"update");b.toggle(f);a.isInputValid()||e.push(a.title)}});var h=J.getColumnSpec(),k= ! !e.length|| ! !K&& !g.deepEquals(h,K);G.toggle(k);A.toggle(!Y||k);ba.setValue(w.outerWidth(!0));I.setValue(w.outerHeight(!0));l(e.length?null:a.copySpec(h))}});D.on("click",function(){V&&g.safeCall(V.onColumnRemoved);return!1});G.on("click",function(){if(V){var b=c.ColumnType.getColumnTypeForKey(K.key);b?a.createConfiguratorPromise(b,B,a.copySpec(K)).then(function(a){O[0]=a;s(a,!0)}).always(function(){g.safeCall(V.mj,V,K,!1)}):g.safeCall(V.mj,V,K,!0)}return!1});var R=c.subClass("KeyOption",e,{notify:g.returnFalse,isInputValid:function(){return! !this.spec.key}}),S=c.subClass("TypeOption",e,{title:g.text("sw.column.opt.type"),init:function(){this.select$=null},createInput:function(a){for(var b='<select class="select">',c=0,d;d=O[c];c++)b+='<option value="'+c+'">'+g.htmlEscape(d.getColumnTypeName())+"</option>";this.select$=a.append(b+
"</select>").find("select");this.select$.on("change",function(){var a=f(this).val();g.isArray(a)&&(a=a[0]);a=g.toIntSafe(a,-1);0<=a&&s(O[a])});p.createAjsSingleSelect(this.select$)},notify:function(){var a=g.indexOf(O,J);0<=a&&this.select$.trigger("ajs:update",""+a).val(a);return!0}});new g.Cell(N,L,fa,X,M,ba,E,function(a,b,c,d,e,f,g){a?(a=b+c,f=Math.max(g,f),d=a+f-d,0<d&&(d+e<=c/2?a-=d:(a=b-f+1,0>a&&(a=0))),w.css("left",a+"px").show()):w.hide()});g.extendOwn(this,{whenReady:function(a){P.done(a)},installTo:function(a){w.hide().appendTo(a)},alignWith:function(a,b){var c=parseInt(a.position().left,10),d=a.outerWidth(!0),e=d-5,f=a.find(".th-ctl-cfg");f.length&&(e=d-parseInt(f.position().left,10));g.Cell.prototype.multiUpdate(!0);try{X.setValue(b),L.setValue(c),fa.setValue(d),M.setValue(e),E.setValue(0)}finally{g.Cell.prototype.multiUpdate(!1)}},show:function(a){J&&(C.empty(),Y||C.append(x([new S])),q(),D.toggle(!Y),V=a,v.trigger("notify","prepare"),N.setValue(!0),v.trigger("notify","show"),this.focus=g.borrowFocus(w.find(":input").first(),w))},hide:function(a){s(null);N.setValue(!1);C.empty();z.empty();F.empty();V=O=K=null;Y= !1;I=new g.Cell(0);this.focus&&(this.focus=
this.focus.returnFocus(a))},containsElement:function(a){return! !a&&0<f(a).closest(".st-col-choose,.s-aui-dd").length},mQ:function(d,e){var h=f.Deferred();P=h.promise();Y=e;if(!d|| !d.key)return h.reject(),P;var k=c.ColumnType.getColumnTypeForKey(d.key);if(!k)return h.reject(),P;var m=[a.createConfiguratorPromise(k,B,a.copySpec(d))];if(!Y)for(var l=c.ColumnType.getAllColumnTypes(),n=0,p;p=l[n++];)p!==k&&m.push(t(p,B));f.when.apply(f,m).done(function(){O=g.arrayFilter(g.toArray(arguments),function(a){return! !a});J=O[0];O=b.sortBy(O,function(a){return a&&a.getColumnTypeName()||""});J?(K=d,h.resolve()):(J=O=null,h.reject())}).fail(function(){h.reject()});return P},pipeHeightTo:function(a){I=a}})}});define("structure/widget/ui/attribute/desc/CustomFieldDescriptor","underscore almworks/util/Strings almworks/util/Objects almworks/util/Collections almworks/util/Types almworks/util/I18n structure/api/AttributeDescriptor structure/api/SpecOption structure/widget/attributes/Attributes".split(" "),function(f,b,g,d,e,a,n,c,p){return namespace("almworks.structure.api").subClass("CustomFieldDescriptor",n,{init:function(a){this.fields=f.compact(f.map(a.fields,function(a){var c=e.toIntSafe(
b.tail(a.id,"customfield_"),0);return c?g.deepExtend({},a,{value:c}):null}));this.fieldMap=d.mapArray(this.fields,function(a){return a.value})},isConfigurable:function(){return!0},getJiraFieldIdFromSpec:function(a){return a&&"customfield"===a.id?(a=a.params&&a.params.fieldId)?"customfield_"+a:null:null},_getField:function(a){return a&&"customfield"===a.id?this._getFieldFromParams(a.params):null},_getFieldFromParams:function(a){return(a=a&&a.fieldId)?this.fieldMap[a]:null},suggestLabel:function(a){return(a=this._getField(a))&&a.name||this.getLabel()},isFormatSupportedBySpec:function(a,b){if(!b)return!0;var c=this._getField(a);return c?this._isFormatSupportedByField(c,b): !1},_isFormatSupportedByField:function(a,b){return b&&b!==p.Formats.HTML&&b!==p.Formats.ORDER&&b!==p.Formats.TEXT?b===p.Formats.NUMBER?"number"===a.type:b===p.Formats.TIME?"date"===a.type||"datetime"===a.type: !1: !0},getPrimaryFormat:function(a){return(a=this._getField(a))?"number"===a.type?p.Formats.NUMBER:"date"===a.type||"datetime"===a.type?p.Formats.TIME:"string"===a.type?p.Formats.TEXT:null:null},isParamsValid:function(a){return! !this._getFieldFromParams(a)},createOptions:function(b){var d=
b.getExpectedFormat(),f=this,g=d?this.fields.filter(function(a){return f._isFormatSupportedByField(a,d)}):this.fields;return[new c.Select({title:a.text("s.w.attribute.customfield.field"),configurator:this,options:g,getValue:function(){var a=b.getSpec().params;return a&&a.fieldId||""},setValue:function(a){(a=e.toIntSafe(a,0))&&b.updateSpec(function(b){b=b.params||(b.params={});a?b.fieldId=a:delete b.fieldId})}})]}})});define("structure/widget/ui/attribute/desc/SumDescriptor","underscore almworks/util/Strings almworks/util/Objects almworks/util/Collections almworks/util/I18n structure/api/AttributeDescriptor structure/api/SpecOption structure/widget/attributes/Attributes".split(" "),function(f,b,g,d,e,a,n,c){f=namespace("almworks.structure.api");var p=c.Formats.NUMBER,m=c.Formats.DURATION;return f.subClass("SumDescriptor",a,{init:function(a){this.id="sum";this.label=e.text("s.w.attribute.sum.label");this.prefix=e.text("s.w.attribute.sum.prefix")+" ";this.distinctPrefix=e.text("s.w.attribute.sum.prefix")+"! ";this.widget=a.widget;this.formats=[p,m,c.Formats.TEXT,c.Formats.HTML,c.Formats.ORDER]},isConfigurable:function(){return!0},_getSummedAttribute:function(a){return a&&a.id===
this.id&&a.params&&a.params.attribute},suggestLabel:function(a){var b=this._getSummedAttribute(a);return b?(b=this.widget.attributeRegistry.suggestLabel(b))?(a&&a.params&&a.params.distinct?this.distinctPrefix:this.prefix)+b:this.label:null},isParamsValid:function(a){return this._isSpecSupported(a&&a.attribute)},_isSpecSupported:function(a){if(!a)return!1;a=a.format;return a===p||a===m},getPrimaryFormat:function(a){a=(a=this._getSummedAttribute(a))&&a.format;return!a||a!==p&&a!==m?p:a},createOptions:function(a){var b=this;return[new n.Attribute({title:e.text("s.w.attribute.sum.attr"),configurator:this,context:a,getValue:function(){return b._getSummedAttribute(a.getSpec())},setValue:function(b){a.updateSpec(function(a){b&&((a.params||(a.params={})).attribute=b)})},usePrimaryFormat: !0,presetFilter:function(a){if(!a||a.id===b.id)return!1;if(a.configure)return!0;a=b.widget.attributeRegistry.getPrimaryFormat(a);return a===p||a===m}}),new n.Checkbox({title:e.text("s.w.attribute.sum.distinct"),configurator:this,getValue:function(){var b=a.getSpec();return! !(b&&b.params&&b.params.distinct)},setValue:function(b){a.updateSpec(function(a){b?(a.params||(a.params={})).distinct= !0:a.params&&
delete a.params.distinct})}})]}})});define("structure/widget/ui/attribute/desc/CountDescriptor",["almworks/util/I18n","structure/api/AttributeDescriptor","structure/api/SpecOption","structure/widget/attributes/Attributes"],function(f,b,g,d){return namespace("almworks.structure.api").subClass("CountDescriptor",b,{init:function(b){this.id="count";this.label=f.text("s.w.attribute.count.label");this.leavesOnlyLabel=f.text("s.w.attribute.count.leaves-only.label");this.widget=b.widget;this.formats=[d.Formats.NUMBER,d.Formats.TEXT,d.Formats.HTML,d.Formats.ORDER]},isConfigurable:function(){return!0},_isLeavesOnly:function(b){return b&&b.id===this.id&&b.params&&b.params.leaves},suggestLabel:function(b){return this._isLeavesOnly(b)?this.leavesOnlyLabel:this.label},isParamsValid:function(b){return!0},createOptions:function(b){var a=this;return[new g.Checkbox({title:f.text("s.w.attribute.count.leaves-only"),configurator:this,getValue:function(){return! !a._isLeavesOnly(b.getSpec())},setValue:function(a){b.updateSpec(function(b){a?(b.params||(b.params={})).leaves= !0:b.params&&delete b.params.leaves})}})]}})});define("structure/widget/ui/attribute/desc/LinksCountDescriptor",
["almworks/util/Classes","almworks/util/I18n","structure/api/AttributeDescriptor"],function(f,b,g){return f.subClass("LinksCountDescriptor",g,{init:function(){this.id="links-count";this.label=b.text("s.w.attribute.links-count.label");this.formats=g.Formats.NUMERIC}})});define("structure/widget/ui/attribute/desc/UserPropertyDescriptor",["almworks/util/Util","almworks/util/I18n","structure/api/AttributeDescriptor","structure/api/SpecOption","structure/widget/attributes/Attributes"],function(f,b,g,d,e){return namespace("almworks.structure.api").subClass("UserPropertyDescriptor",g,{init:function(a){this.id="user-property";this.label=b.text("s.w.attribute.user-property.label");this.widget=a.widget;this.formats=[e.Formats.TEXT,e.Formats.HTML,e.Formats.ORDER]},isConfigurable:f.returnTrue,_getUserAttribute:function(a){return a&&a.id===this.id&&a.params&&a.params.userKey},_getPropertyName:function(a){return a&&a.id===this.id&&a.params&&a.params.propertyName},suggestLabel:function(a){var d=this._getUserAttribute(a);if(!d)return null;d=this.widget.attributeRegistry.suggestLabel(d);a=this._getPropertyName(a);return d&&a?b.text("s.w.attribute.user-property.label-configured",d,a):b.text(
"s.w.attribute.user-property.label-unconfigured")},isParamsValid:function(a){return a&&a.userKey&&a.propertyName},createOptions:function(a){var f=this;return[new d.Attribute({title:b.text("s.w.attribute.user-property.attr"),configurator:this,context:a,getValue:function(){return f._getUserAttribute(a.getSpec())},setValue:function(b){a.updateSpec(function(a){b&&((a.params||(a.params={})).userKey=b)})},expectedFormat:e.Formats.TEXT,presetFilter:function(a){if(!a)return!1;if(a.configure)return!0;var b=f.widget.attributeRegistry.getDescriptor(a);a=b&&b.getJiraFieldIdFromSpec&&b.getJiraFieldIdFromSpec(a);return a?(a=f.widget.jiraConfig.getJiraFieldMap()[a])?"user"===a.type||"array"===a.type&&"user"===a.items: !1: !1}}),new d.Text({title:b.text("s.w.attribute.user-property.propertyName"),configurator:this,getValue:function(){return f._getPropertyName(a.getSpec())},setValue:function(b){a.updateSpec(function(a){(a.params||(a.params={})).propertyName=b||""})}})]}})});(function(){var f=namespace("almworks.structure.api"),b=require("structure/api/ColumnGroup");f.ColumnGroup=b;f.registerColumnGroup=b.register;b=require("structure/api/ColumnType");f.ColumnType=b;f.registerColumnType=b.register;
b=require("structure/api/ColumnConfigurator");f.ColumnConfigurator=b;b=require("structure/api/Column");f.Column=b;f.ColumnOption=f.SpecOption=require("structure/api/SpecOption");b=require("structure/api/StructureCoreExtensionRegistry");f.registerCoreExtension=b.registerCoreExtension})();(function(){var f=namespace("almworks.structure"),b=namespace("almworks.util"),g=require("structure/widget/model/Rows"),d=require("structure/widget/clipboard/Clipboard"),e=require("structure/widget/model/Items");f.ez=function(a){function n(){return g.nextTemporaryRowId()}function c(b,c,d){if(a.isReadOnly())return!1;if(c){var f=F.aL(c);if(!f||e.isGenerator(f.itemId))return!1}return 0>b&&0<c&&B.isCutMode()&&B.contains(c)||(f=a.getTitleRow())&&(b===f||0===c)? !1:a.aW()?b&&(b=F.indexOf(b),0<b&&(d?d=d.getUnder(b):(d=F.aI(b),d=0<=d?F.rowId(d):0),0<d&& !a.hh(d,!0)))? !1: !c||a.hh(c,!0): !0}function p(a,c,d){var e= !1,g;a.rowId&&a.rowId===c&&(d&&(a.rowId=d),e= !0);a.rowIds&&(g=b.indexOf(a.rowIds,c),0<=g&&(d&&(a.rowIds[g]=d),e= !0));a.forest&&(g=a.forest.indexOf(c),0<=g&&(d&&(e=a.forest.as(),e[g]=e[g].clone(d),a.forest=new f.DataForest(e)),e= !0));a.under&&a.under===c&&(d&&(a.under=d),e= !0);a.after&&
a.after===c&&(d&&(a.after=d),e= !0);a.before&&a.before===c&&(d&&(a.before=d),e= !0);a.cutFrom&&a.cutFrom.rowIds&&(g=b.indexOf(a.cutFrom.rowIds,c),0<=g&&(d&&(a.cutFrom.rowIds[g]=d),e= !0));a.originalRowIds&&(a.originalRowIds.hasOwnProperty(c)&&(a.originalRowIds[d]=a.originalRowIds[c],delete a.originalRowIds[c],e= !0),g=b.findKey(a.originalRowIds,function(a){return a===c}),null!==g&&(a.originalRowIds[g]=d,e= !0));return e}function m(a,b){function c(a){return!(!a|| !(0>a||b&&b[a]))}return c(a.rowId)||a.rowIds&&a.rowIds.some(c)||c(a.under)||c(a.after)||c(a.before)? !1: !0}function k(a,c){return b.extendOwn({action:c},r(a))}function r(a){var c={};a.rowId?c.rowId=a.rowId:a.rowIds?1===a.rowIds.length?c.rowId=a.rowIds[0]:c.rowIds=a.rowIds:a.forest&&(c.forest=f.Forest.encode(a.forest));"undefined"!==typeof a.under&&(c.under=a.under);"undefined"!==typeof a.before&&(c.before=a.before);"undefined"!==typeof a.after&&(c.after=a.after);a.cutFrom&&(c.cutFrom=b.extend({},a.cutFrom));if(a.originalRowIds){c.originalRowIds=[];for(var d=0,e=a.forest.size();d<e;d++)c.originalRowIds.push(a.originalRowIds[a.forest.rowId(d)]||0)}return c}function l(a,c){var d=b.extendOwn({},a);"undefined"!==
typeof d.rowId&&(d.rowIds=[d.rowId],delete d.rowId);return function(a){c(d,a)}}function h(a){return a.rowId?[a.rowId]:a.rowIds?a.rowIds:a.forest?a.forest.aD():[]}function u(a){a=h(a);var b=[],c,d,e;for(c=0;c<a.length;c++)if(d=F.indexOf(a[c]),0<=d)for(e=F.bH(d);d<e;)b.push(F.rowId(d++));return b}function s(b,c){f.bG.call(this,a,c);var d=a.getVersionedSpec();this.forestSpec=d.spec;this.signature=d.version.signature;this.data=b;this.init(b)}function q(b){var c=[a.getVersionedSpec().spec];b.cutFrom&&c.push(d.CLIPBOARD_SPEC);s.call(this,b,c)}function x(c){var e=[a.getVersionedSpec().spec];c.cutFrom&&(b.assert(!b.deepEquals(e[0],c.cutFrom.spec)),e.push(d.CLIPBOARD_SPEC),e.push(c.cutFrom.spec));s.call(this,c,e)}function t(a){s.call(this,a)}function w(a){s.call(this,a)}function v(a,d,e){if(!D)return b.assert(!1,"readonly?"),!1;var f,g,h;f=0;for(g=a.length;f<g;f++){h=a[f];if(0>F.indexOf(h))return b.warn("cannot move or delete missing row "+h),!1;if(!c(h,d,e))return!1}return!0}function C(c,d,e){if(!D)return b.assert(!1,"readonly?"),!1;if(!c|| !c.size()|| !d&&a.getTitleRow())return!1;var g,h,l,k;if(0<d){g=F.getPath(d);if(!g)return b.warn("cannot merge under "+d),!1;g=b.flipSet(g);for(h=
c.size()-1;0<=h;h--)if(g[c.rowId(h)])return!1}if(!a.isReadOnly()&&a.aW())for(e=new f.ForestIndexer(c,d,e),g=new f.ForestIndexer(F),h=0,d=c.size();h<d;h++)if(l=c.rowId(h),k=F.indexOf(l),l=e.getUnder(h),0<=k){if(k=g.getUnder(k),k!==l&&(0<k&& !a.hh(k,!0)||0<l&&0<=F.indexOf(l)&& !a.hh(l,!0)))return!1}else if(0<l&&0<=F.indexOf(l)&& !a.hh(l,!0))return!1;return!0}function z(a,c,d){var e=c?F.indexOf(c):null,f=d?F.indexOf(d):null;if(c&&0>e)return b.assert(!1,"bad under: "+c),!0;if(d&&0>f)return b.assert(!1,"bad after: "+d),!0;var g=c?F.rowDepth(e)+1:0;c=d?f:c?e+1:0;for(var e=0,h=a.size(),l=F.size(),k= !0;e<h;e++,c++){if(c>=l)return!1;if(a.rowId(e)!==F.rowId(c)){k= !1;break}if(a.rowDepth(e)!==F.rowDepth(c)-g){k= !1;break}}if(k)return!0;if(!d)return!1;e=0;for(c=F.bH(f);e<h;e++,c++)if(c>=l||a.rowId(e)!==F.rowId(c)||a.rowDepth(e)!==F.rowDepth(c)-g)return!1;return!0}var F=a.bd(),A=a.dH(),D=a.widget.ad,G=a.widget.forestCache,B=a.widget.clipboard,K=a.bh();b.extend(s.prototype,f.bG.prototype,{forestAction: !0,init:function(a){b.pvc()},aj:function(){return this.spec},bN:function(a){return b.safeCall(this.ff,this,a)},aB:function(a,b){return p(this.data,a,b)?(this.init(this.data),!0): !1},an:function(
a){return! !this.spec&&m(this.data,a)},getInverseAction:function(){return this.inverse||null},getAffectedRows:function(){return h(this.data)}});b.extend(q.prototype,s.prototype,{init:function(a){var c=this.forestSpec,d=l(a,function(a,b){b.moveSubtreesById(a.rowIds,a.under,a.after)}),e=function(a){a.oW(a.hf())};this.spec=k(a,"move");this.ff=function(a){return b.deepEquals(a,c)?d:e}},isOverridingAction:function(a){if(a instanceof q&&this.spec.action===a.spec.action&&b.deepEquals(this.forestSpec,a.forestSpec)&&this.signature===a.signature){if(this.data.rowId)return this.data.rowId===a.data.rowId;if(this.data.rowIds&&this.data.rowIds.length)return b.arrayEquals(this.data.rowIds,a.data.rowIds)}return!1},getAffectedRows:function(){return u(this.data)}});b.extend(x.prototype,s.prototype,{init:function(a){var c=this.forestSpec,e=l(a,function(a,b){b.bo(a.forest.as(),a.under,a.after)}),f=function(b){b.oW(a.cutFrom.rowIds)},g=function(a){a.oW(a.hf())};this.spec=k(a,a.originalRowIds?"copy":"add");this.ff=function(h){if(b.deepEquals(h,c))return e;if(b.deepEquals(h,d.CLIPBOARD_SPEC))return g;if(a.cutFrom&&b.deepEquals(a.cutFrom.spec,h))return f}}});b.extend(t.prototype,s.prototype,{init:
function(a){var b=l(a,function(b,c){var d=a.forest,e=b.under,f,g,h,l=[];f="undefined"!==typeof b.before?c.ds(e,b.before):b.after;g=0;for(h=d.size();g<h;g++)l.push(d.row(g));c.cP(l,e,f)});this.spec=k(a,"add");this.ff=function(){return b}}});b.extend(w.prototype,s.prototype,{init:function(a){var b=l(a,function(a,b){b.oW(a.rowIds)});this.spec=k(a,"remove");this.ff=function(){return b}},getAffectedRows:function(){return u(this.data)}});D.aF(new function(){this.dw=function(a,c){var d,e,g,h,l,k;c=b.extendOwn({},c||{});d=0;for(e=a.length;d<e;d++){g=a[d];if(!g.forestAction)break;if(!g.an(c)){b.debug("action not ready for upload: "+f.apputil.ct(g.aj()));break}if(0===d)h=g.forestSpec,l=g.signature,k=g.jobId,g.jobId=null;else if(!b.deepEquals(h,g.forestSpec)||g.signature!==l)break;else if(g.jobId&&g.jobId!=k)break;b.flipSet(g.getAffectedRows(),null,c)}if(!d)return null;if(k)h={jobId:k};else{g=a.slice(0,d);k=[];for(e=0;e<d;e++){var m=g[e].aj();if(m.cutFrom&&m.cutFrom.spec&&m.cutFrom.version){var n=G.getCurrentVersion(h);n&&n.signature===m.cutFrom.version.signature&&(m.cutFrom.version=n)}k.push(m)}h={spec:h,version:G.getCurrentVersion(h),actions:k};h.version.signature!==l&&(h.version={
signature:l,version:0})}return{count:d,url:f.ajax.RESOURCES2g.FOREST.UPDATE,data:f.apputil.ct(h),cB: !0}}});b.extend(this,{nP:function(c,d,e,g,h){if(!c|| !c.length)return!1;var l=null,k=null,m,n,p;if(g|| !a.isReadOnly()&&a.aW())l=new f.ForestIndexer(F);if(!v(c,d,l))return!1;if(0<d){k=F.getPath(d);if(!k)return b.warn("cannot move under "+d),!1;k=b.flipSet(k);l=0;for(m=c.length;l<m;l++)if(k[c[l]])return!1}n=e;p= !1;l=0;for(m=c.length;l<m;l++)k=c[l],K.moveNew(k,d,n)||a.widget.automationMenu.moveNew(k,d,n)||(p= !0),n=k;if(!p)return!0;c=new q({rowIds:c,under:d,after:e,before:A.getBeforeForAfter(d,e),cutFrom:h?{viaClipboard: !0}:null});D.enqueue(c,g);return!0},addIssue:function(a,b,d,g){if(!c(0,b))return!1;var h=new f.bP(n(),0,!0);h.itemId=e.issue(a);a=new f.DataForest([h]);D.enqueue(new t(g?{forest:a,under:b,before:d}:{forest:a,under:b,after:d}));return!0},eH:function(b,c){if(!b|| !b.length)return!1;var d=null;if(c|| !a.isReadOnly()&&a.aW())d=new f.ForestIndexer(F);if(!v(b,null,d))return!1;d=new w({rowIds:b});D.enqueue(d,c);return!0},bo:function(c,d,e,g,h,l,k){if(!c|| !c.size())return!1;var m=c===B.getForest(),p=c.cloneRows();c=new f.DataForest(p);!h&&m&&(h={});for(var q=0;q<p.length;
q++){var s=n();h&&(h[p[q].id]=s);p[q].id=s}if(!C(c,d,e))return!1;m&&B.fillAttributeValues(a.getAttributeSubscription(),h);l=l&&b.extend({viaClipboard:m},l);h=k?b.flipSet(h,b.toInt):null;z(c,d,e)||(d=new x({forest:new f.DataForest(c.as()),under:d,after:e,before:A.getBeforeForAfter(d,e),cutFrom:l,originalRowIds:h}),D.enqueue(d,g));return!0},canMergeForest:C,eP:c,nextTemporaryRowId:n})}})();(function(f,b){var g=namespace("almworks.structure"),d=namespace("almworks.structure.apputil"),e=namespace("almworks.structure.ajsbridge"),a=namespace("almworks.util"),n=namespace("almworks.structure.appevents"),c=g.$,p=require("underscore");require("structure/widget/attributes/Attributes");var m=require("almworks/util/Cell");g.JiraConfig=function(k){function r(a,b){return a.name.localeCompare(b.name)}function l(){if(!T&& !Aa){Aa= !0;var c=new J.Task(g.ajax.RESOURCES.CONFIG_WIDGET,g.ajax.DOWNLOAD,function(b){if(b){L=b.structureVersion||"";fa=b.jiraVersion||"";X=b.licenseInvalid|| !1;var c=b.jiraFields;if(c)if(c.length){for(var d=[],e=0;e<c.length;e++){var f=c[e];f.id&&f.name?y[f.id]||d.push(f):a.warn("bad column "+f)}U=d}else U=[];else a.warn("invalid columns "+c),U=[];U.sort(r);P=null;Y=h(
b.jiraAgileRankFields);N= ! !b.canCreate;M= ! !b.canBulkChange;ba= ! !b.canCreateViews;E= ! !b.canShareViews;I= ! !b.canCreatePerspective;ma= ! !b.admin;R.setValue(b.extensions);S=b.features||{};ia=b.jiraClusterNodeId||"";x(b.exportLinks)}else va.push("Cannot load widget configuration")},Fa);c.chainComplete(function(){Aa= !1;T= !0;for(var c=0;c<Z.length;c++)a.safeCall(Z[c],b,V);Z=[]});J.addTask(c)}}function h(a){return p.filter(U,function(b){return(b=b.customId)&&p.contains(a,b)})}function u(a){var b=a.creationContext;if(b){if(b.pid&&b.issuetype)return ta;if(b.sampleIssueId)return sa}else if(a.itemId)return Q;return null}function s(a,b){if(a===Q)return b.itemId;if(a===sa)return b.creationContext.sampleIssueId;if(a===ta){var c=b.creationContext;return ""+c.pid+":"+c.issuetype}return null};function q(a){var b=u(a);a=s(b,a);return b&&a?b.getValue(a):null}function x(a){var b=[];a&&(b=p.filter(a,function(a){return a.label&&a.url&&a.moduleKey}));da.setValue(b)}function t(b){if(b){var c=b.field,d=u(b),e=s(d,b);if(d&&e){var f=d===ta?g.ajax.RESOURCES.CREATE_FIELDS+"?project="+b.creationContext.pid+"&issuetype="+b.creationContext.issuetype:d===sa?g.ajax.RESOURCES.CREATE_FIELDS+"?sample="+
b.creationContext.sampleIssueId:g.ajax.RESOURCES.UPDATE_FIELDS+"?issue="+b.itemId;c&&(f+="&field="+encodeURIComponent(c));f=new J.Task(f,g.ajax.DOWNLOAD,function(f){f?(a.safeCall(b.jw,b,f),c?v(b):d.putValue(e,f)):a.safeCall(b.ii,b,a.text("s.w.config.fields.load-got-nothing"))},function(c,d,e){c=a.httpErrorReport(c,d);a.safeCall(b.ii,b,a.text("s.w.config.fields.load-error",c.title))});f.chainComplete(function(){a.safeCall(b.hQ)});J.addTask(f)}else a.safeCall(b.ii),a.safeCall(b.hQ)}}function w(){ya= !1}function v(b){ya||q(b)||(ya= !0,t({itemId:b.itemId,itemType:b.itemType,creationContext:b.creationContext&&a.extend({},b.creationContext),hQ:w}))}function C(a){Q.removeValue(a);sa.removeValue(a)}function z(b,d){try{if(b&&d){var e=b.project&&b.project.createHtml;if(e){var f=a.flipSet(d,a.returnTrue),g=c("<div></div>").html(e),h=g.find('select[name="pid"]');h.length?h.find("option").filter(function(){var b=a.toIntSafe(c(this).attr("value"),0);return 0<b&& !f[b]}).remove():F(g,f);b.project.createHtml=g.html()}}}catch(l){a.warn("cannot filter project selections: "+l)}}function F(a,b){var e=a.find("#project-options"),g=f.JSON.parse(e.attr("data-suggestions")),h= !1;c.isArray(g)&&(g=g.filter(
function(a){if(!a|| !c.isArray(a.items))return!0;var d= !1;a.items=a.items.filter(function(a){var c=a&&b[a.value];c||(h= !0,a&&a.selected&&(d= !0));return c});if(!a.items.length)return!1;d&&(a.items[0].selected= !0);return!0}));h&&e.attr("data-suggestions",d.ct(g));return h}function A(b,c,d,e){ga[b]?d(ga[b]):(c=new J.Task(c,g.ajax.DOWNLOAD,function(a){ga[b]="function"===typeof e?e(a):a&&a[e]||null},function(b,c,d){a.httpErrorReport(b,c)}),c.chainComplete(function(){d(ga[b])}),J.addTask(c))}function D(){if(!oa){if(!qa)return null;var a=qa&&qa.issuetype&&qa.issuetype.createHtml;if(!a)return null;var b=c("<div></div>");b.html(a);(oa=G(b))||(oa=B(b))}return oa}function G(b){function c(b){if(b)for(var d=0;d<(b?b.length:0);d++){var e=a.toIntSafe(b[d].value,0);0<e&&(g[e]= !0)}}b=b.find("#issuetype-options").attr("data-suggestions");if(!b)return null;var d;try{d=f.JSON.parse(b)}catch(e){a.warn("cannot parse data-suggestions from #issuetype-options",e)}if(!d)return null;var g={};if(0<d.length)if(d[0]&&d[0].items)for(b=0;b<d.length;b++)c(d[b].items);else c(d);return g}function B(b){var d={};b.find('select[name="issuetype"] option[value]').each(function(){var b=a.toIntSafe(c(this).attr(
"value"),0);0<b&&(d[b]= !0)});return d}function K(a){return R.fieldSubCell(a,{onlyName: !0})}var J=a.nn(k.ajax),O=a.nn(k.errorCentral),V=this,U=[],P=null,Y=[],N= !1,L="",fa="",X= !1,M= !1,ba= !1,E= !1,I= !1,ma= !1,R=new a.Cell({}),S={},ga={},da=new m([]),ia="",T= !1,Aa= !1,Z=[],va=[],Q=new a.LRUCache(20),sa=new a.LRUCache(10),ta=new a.LRUCache(20),ya= !1,qa=null,aa=null,la=null,oa=null,pa={};this.getJiraFields=function(){return U};this.getJiraFieldsPromise=function(){var a=c.Deferred();this.load(function(){a.resolve(U)});return a.promise()};this.getJiraFieldMap=function(){P||(P=a.mapArray(U,function(a){return a.id}));return P};this.getJiraAgileRankFields=function(){return Y};this.getFeature=function(a){return S[a]};this.load=function(c){"function"===typeof c&&(T?a.safeCall(c,b,V):Z.push(c));l()};this.getJiraRestAPIPromise=function(a){var b=pa[a];b||(b=c.ajax(e.localURL(a)),pa[a]=b);return b};this.getErrors=function(){return va};this.isReady=function(){return T};var Fa=function(b,c){var d=a.httpErrorReport(b,c);O.reportError(new g.error.AppError(a.text("sw.error.load-config",d.title),d.details))},y={aggregatetimeoriginalestimate: !0,aggregateprogress: !0,aggregatetimeestimate: !0,
aggregatetimespent: !0,progress: !0},ua=/^(\d+)\.(\d+)(\.(\d+))?/,Ea=a.flipSet("project issuetype assignee environment priority security versions fixVersions components".split(" ")),na=a.flipSet(["space"]);k.eventBus.addListener(new a.Life,this);this[n.aX]=function(a){if(!a)Q.clear(),sa.clear();else if(Q.size()||sa.size())for(var b=0,c=a.length;b<c;b++)C(a[b])};this[n.aN]=function(a,b,c){c&&C(b)};a.extend(this,{gB:t,hy:q,gZ:function(){return Ea},getCopiedAttributeIdsForNewConfluence:function(){return na},iG:v,hK:C,ke:function(){return T?N&& !X:null},kx:function(b){if(qa)b(qa);else{var c=null,d=new J.Task(g.ajax.RESOURCES.CREATE_FIELDS+"?field=project&field=issuetype",g.ajax.DOWNLOAD,function(a){"object"===typeof a&&a.fields&&(qa=a.fields,(aa=a.structuredProjects)&&z(qa,aa))},function(b,d,e){c=a.httpErrorReport(b,d)});d.chainComplete(function(){b(qa,c)});J.addTask(d)}},loadConfluenceSpaces:function(b){if(la&&0<p.size(la))b(la);else{var c=null,d=[],e=new J.Task(g.ajax.RESOURCES2g.CONFLUENCE.MODIFIABLE_SPACE,J.DOWNLOAD,function(a){"object"===typeof a&&a.confluences&&(d=a.confluences)},function(b,d,e){c=a.httpErrorReport(b,d)});e.chainComplete(function(){la=d;b(d,c)});J.addTask(e)}},
lk:function(a){var b=D();return b&& !b[a]},lf:function(){return L},le:function(){return X},lP:function(){return T&&M},isCreateViewAllowed:function(){return T&&ba&& !X},isShareViewAllowed:function(){return T&&E&& !X},isCreatePerspectiveAllowed:function(){return T&&I},isAdmin:function(){return T&&ma},getVersionSignature:function(){if(fa){var c=ua.exec(fa);if(c){var d=a.toIntSafe(c[1],0),e=a.toIntSafe(c[2],0),c=a.toIntSafe(c[4],0);return 1E4*d+100*e+c}}return b},filterProjectsSelectionJira64:F,mJ:function(a){A("assignableGroups",g.ajax.RESOURCES.CONFIG_GROUPS+"?assignable=true",a,"groups")},mB:function(a){A("availableRoles",g.ajax.RESOURCES.CONFIG_ROLES,a,"roles")},mn:function(b){A("projectsWithRoles",g.ajax.RESOURCES.CONFIG_PROJECTS+"?withRoles=true",b,function(b){var c=b&&b.projects;if(!c)return null;b=a.mapArray(b.roles,function(a){return a.id});for(var d=0,e=c.length;d<e;d++){var f=c[d],g=f.userRoles;if(g)for(var f=0,h=g.length;f<h;f++)g[f]=b[g[f]],g[f]||(g.splice(f,1),f--,h--);else f.userRoles=[]}return c})},validateStructuredProjectId:function(a){if(!aa|| !aa.length)return a;for(var b=0;b<aa.length;b++)if(aa[b]==a)return a;return aa[0]},getExtensionCell:a.returnConst(R),
getConfluenceConfigCell:a.returnConst(K("com.almworks.structure.pages:pages-extension")),isConfluenceAvailable:function(){return!0===K("com.almworks.structure.pages:pages-extension").fieldSubCell("licensed").value()},getExtensionAvailableCell:function(a){return K(a).fieldSubCell("licensed")},getExportLinksCell:function(){return da},getJiraClusterNodeId:function(){return ia}})}})(window);(function(f){var b=namespace("almworks.structure"),g=namespace("almworks.structure.apputil"),d=namespace("almworks.util"),e=namespace("almworks.structure.appevents"),a=b.$,n=d.requireGlobal("AJS");require("jira/dialog/form-dialog");var c=require("structure/widget/model/Items"),p=require("structure/ui/details/ItemDetails"),m=require("structure/widget/clipboard/Clipboard"),k=require("structure/widget/util/NavigationHint"),r=require("structure/widget/ui/column/EditableColumn"),l=require("structure/widget/columns/FieldColumn"),h=require("structure/widget/ui/layout/LayoutManager"),u=require("structure/widget/ui/QuickActions");b.eT=function(s){function q(a){return function(){return za.value()? !1:a.apply(this,arguments)}}function x(a){for(var b=0,c=a.length;b<c;b++)a[b]()}function t(a){Ha?Ha.push(
a.update):(Ha=[a.update],ra.addListener(new d.Life,e.nl,d.delayed(200,function(a){a===s&&x(Ha)})))}function w(a){function b(){s.widget.pageManager.getFocusedPanel()===s&&x(La)}if(La)La.push(a.update);else{La=[a.update];var c={},f=d.delayed(200,b);c[e.eu]=f;ra.addListener(new d.Life,c);s.getAttributeSubscription().addDataUpdateHandler(f)}t(a)}function v(a){if(Ma)Ma.push(a.update);else{Ma=[a.update];var b={},c=d.delayed(200,C);b[e.am]=c;ra.addListener(new d.Life,b);s.getAttributeSubscription().addDataUpdateHandler(c)}t(a)}function C(){ea=z();try{x(Ma)}finally{ea=null}}function z(){return{expanded:F(ca),displayed:F(H),forMove:d.lazy(function(){if(s.isReadOnly())return[];var a=this.expanded.original();if(a.length){if(N(a[0]))return[];var b;if(b=1<a.length){a:{d.assert(a.length);var c,e,f,g;b=ca.indexOf(a[0]);d.assert(0<=b);c=ca.rowDepth(b);e=1;for(f=a.length;e<f;e++){g=ca.indexOf(a[e]);d.assert(g>b&&(b=g));if(ca.rowDepth(g)!==c){b= !1;break a}g=ca.lG(g);if(0>g||ca.rowId(g)!=a[e-1]){b= !1;break a}}b= !0}b= !b}if(b)return[]}return a})}}function F(a){return{count:d.lazy(function(){return $.mp(a)}),original:d.lazy(function(){return $.getSelected(a)}),normalized:d.lazy(function(){
return $.kT(a)})}}function A(a){this.subscribe=v;this.update=function(b,c,d){d.panel=s;return a.update(d,b,c)};this.perform=function(b,c,d){return a.perform(d,b,c)}}function D(a){return A.call(this,{update:function(b){var c;c=wa.fQ()&&wa.fQ().isNewItemDetailsEditor()?[wa.fQ().getRowId()]:(ea||z()).forMove();return c.length&&a.update(c,b)?(b.selection=c,!0): !1},perform:function(b){return a.perform(b.selection,b)}})}function G(a){if(Oa)Oa.push(a.update);else{Oa=[a.update];var b={},c=d.delayed(200,d.curry(x,Oa));b[e.be]=c;b[e.eu]=c;b[e.cq]=c;ra.addListener(new d.Life,b)}t(a)}function B(a,b,c){$.focusRow(a,b,c);na.aJ();return!0}function K(a,b){return B(H.rowId(a),!1,b)}function J(a){if(za.value())return!1;var b=H.size();if(0===b)return!1;var c=$.bc();if(c)if(c=H.indexOf(c),c<b-1)c++;else return!1;else c=0;return K(c,a)}function O(a){if(za.value())return!1;var b=$.bc();if(!b)return!1;b=H.indexOf(b);if(0>=b)return!1;b--;return K(b,a)}function V(a){if(za.value())return!1;var b=H.size();if(0===b)return!1;var c=$.bc();if(!c)return!1;c=H.indexOf(c);if(0>c||c>=b-1)return!1;var d=na.cE(),c=c===d.to||d.animation?Math.min(b-1,d.to+(d.to-d.from+1)):d.to;return K(c,a)}function U(a){if(za.value()
||0===H.size())return!1;var b=$.bc();if(!b)return!1;b=H.indexOf(b);if(0>=b)return!1;var c=na.cE(),b=b===c.from||c.animation?Math.max(0,c.from-(c.to-c.from+1)):c.from;return K(b,a)}function P(a){if(za.value()||H.isEmpty())return!1;var b=$.bc();return!b||0>=H.indexOf(b)? !1:K(0,a)}function Y(a){if(za.value())return!1;var b=H.size();if(0===b)return!1;var c=$.bc();if(!c)return!1;c=H.indexOf(c);return 0>c||c>=b-1? !1:K(b-1,a)}function N(a,b){var c=s.normalizedRootPaths.value();if(!c)return!1;if(0===a)return!0;for(var e=0;e<c.length;e++){var f=c[e],g=d.indexOf(f,a);if(0<=g&&(!b||g<f.length-1))return!0}return!1}function L(){var a=$.bc();return a?ca.indexOf(a): -1}function fa(a){return s.isReadOnly()||0>a?null:(a=ca.row(a))?a:null}function X(a){var b=null;wa&&(a&&(b=wa.hH(a)),b||(b=wa.fQ()));return b}function M(a,b,c,d){for(var e= !1,f=b.length;0<=c&&c<f&& !e;){var g=b[c];ba(g,a)&&(e= ! !wa.editRow(a,g));c+=d}return e}function ba(a,b){return a&&a.isInstanceOf(r)&&a.isEditableColumn()&& !a.gb(b,s.widget)}function E(a,b){if(!a)return-1;for(var c=a.length-1;0<=c&&a[c].getCsid()!==b;c--);return c}function I(a,b){if(za.value())return!1;var c=X(b);if(!c){if(!a&& !wa.fQ()){var d={};
return Ta.update(b,null,d)&&Ta.perform(b,null,d)}return!1}var d=c.getRowId(),e=H.indexOf(d),f=H.size();if(0>e)return!1;var g=s.af().getColumns(),h=E(g,c.getColumnId());if(0>h)return!1;c=a? -1:1;h=M(d,g,h+c,c);if(!h){if(!wa.kX(d))return R(d);e+=c;(d=0<=e&&e<f?H.rowId(e):0)&&s.hh(d)&&(h=M(d,g,a?g.length-1:0,c))}h||wa.finishAllEdits();return!0}function ma(a,b){if(za.value())return!1;var c=X(b);if(!c)return!1;var d=s.af().getColumns(),e=E(d,c.getColumnId());if(0>e)return!1;var f=a? -1:1;M(c.getRowId(),d,e+f,f);return!0}function R(a){var b=s.af().gj();if(!b)return!1;wa.editRow(a,b);return!0}function S(a,b){if(za.value())return!1;var c=X(b);if(!c||0>E(s.af().getColumns(),c.getColumnId()))return!1;var d=c.getRowId(),c=c.getColumn();if(!wa.kX(d))return R(d);var e=H.indexOf(d),f=H.size();if(0>e)return!1;for(var g=a? -1:1,h= !1,l=0;!h&&100>l&&0<=e&&e<f;)e+=g,l++,(d=0<=e&&e<f?H.rowId(e):0)&&s.hh(d)&&(h= ! !wa.editRow(d,c));return!0}function ga(a,b,d){return{subscribe:w,update:function(b,e,f){if(d&& !wa.canCreateDialog()||Ba.value()|| !s.widget.jiraConfig.ke()|| !s.isStructure())return!1;var g=L();b=ca.rowId(g);var h=null;if(0<=g&&(h=fa(g),!h&& !d))return!1;f.child=1===a;f.createBefore=2===a;
h&&h.semantics===c.Semantics.TITLE&&(f.child= !0);f.child|| !N(b,!1)||N(b,!0)||(f.child= !0);if(0<=g&&N(b,f.child))return!1;e=b=0;if(h)for(var l=g,k=h;k;){if(e=c.getIssueIdFromItemId(k.getItemId())){b=k.getId();break}k=ca.lG(l);if(0>k&&(k=ca.aI(l),0>k))break;l=k;k=fa(l)}k=h?h.getId():0;l={};if(h)f.child?(l.under=k,l.after=0,l.before=ca.getBeforeForAfter(k,0)):(g=ca.aI(g),l.under=0>g?0:ca.rowId(g),f.createBefore?(l.after=ca.ds(l.under,k),l.before=k):(l.after=k,l.before=ca.getBeforeForAfter(l.under,k)));else{if((g=s.rootPaths.value())&& !g.length)return!1;g=g?g[g.length-1]:null;l.under=g?g[g.length-1]:0;f.createBefore?(l.after=0,l.before=ca.cG(l.under)):(l.after=ca.dU(l.under),l.before=0)}if(!xa.eP(-100,l.under))return!1;f.placement=l;f.sample=b;f.sampleIssueId=e;return!0},perform:function(a,c,e){if((a=wa.fQ())&& !a.gg())return b&&a.switchTab(b),a.takeFocus(),!0;c=e.placement;var f=e.sample;ha=$.ml();a=xa.nextTemporaryRowId();0!==c.under&&$.by(c.under,!0);e=wa.fN(a,b,c,f,e.sampleIssueId,d);$.kK(a,ca);na.aJ();return! !e}}}function da(a){$.adjustExpansionLevel(a);na.aJ();return!0}function ia(a,b){var c=d.toIntSafe(b&&b.level,-1);0<=c&&($.setExpansionLevel(c),na.aJ())}function T(a){
return function(b){ia(b,{level:a});return!0}}function Aa(){return s.isPrimary()&&p.shouldBlockActions()};function Z(){if(za.value()||Aa())return!0;var a=$.bc();if(a&&0<a)try{var b;try{b=require("jira/dialog/dialog-register").issueActions}catch(c){}b||(b=namespace("jira.app.issueActionsPopup",!1));if(b&&"function"===typeof b.show)return b.show(),!0}catch(e){d.warn("cannot show actions dialog",e)}return!1}function va(a,d){if(za.value()||Aa())return!0;var e=$.bc();if(!e||0>e)return!0;e=ca.aL(e).getItemId();return c.isIssue(e)&&(e=b.ajsbridge.jiraDialogs()[a])&&"function"===typeof e.show?(e.$activeTrigger=n.$("a."+d),e.show(),!0): !1}function Q(){if(za.value()||Aa())return!0;var a=ya();if(a){var b=a.getItemId();if(c.isIssue(b)){if(a=c.getIssueIdFromItemId(b))return Ia?(n.$("a.issueaction-edit-issue").click(),!0):aa("a.issueaction-edit-issue",a)}else return s.bh().editRow(a.getId(),s.af().gj()),!0}return!1}function sa(){if(za.value()||Aa())return!0;var a,c=qa();if(b.modes.ISSUE_PAGE||b.modes.GH_TAB){if((a=s.widget.anchorIssue)&&c&&a!==c)return!1}else a=c;return a?aa("a.issueaction-assign-to-me",a): !1}function ta(){var a=d.curry(va,"comment","issueaction-comment-issue");return!0===
s.widget.config.showIssueDetails?function(){var b=n.$("#footer-comment-button");return p.visibleCell.value()&&b.length?(b.click(),!0):a.apply(this,arguments)}:a}function ya(){var a=L();if(0>a)return null;var a=ca.row(a),b=a.getId();return 0>b|| !s.hh(b)?null:a}function qa(){var a=ya();return a?c.getIssueIdFromItemId(a.getItemId()):null};function aa(b,c){var e,f;a(b).each(function(){var b=a(this).attr("href");(b=Xa.exec(b))&&("{0}"===b[1]?f=this:d.toIntSafe(b[1],0)===c&&(e=this))});var g=f||e;if(!g)return!1;n.$(g).click();return!0}function la(b){return function(){if(za.value())return!0;var c=qa(),e;return c&&(e=a("#s-issueaction-links").find(b),e.length&&(e=e.attr("href"))&&0<=e.indexOf("id={0}"))?(e=e.replace("id={0}","id="+c),e=d.setUrlParameter(e,"returnUrl",f.top.location.href),f.top.location=e,!0): !1}}function oa(a){return new A({update:function(b,c){if(s.isClipboard()||za.value()||a&&Ba.value())return!1;var e=(ea||z()).expanded.original();if(-1!==d.find(e,function(a){return 0>a}))return!1;if(a)b.rows=m.getRowsForCut(e,s.bs());else{var f=c&&c.type;if(("keydown"===f||"keyup"===f||"keypress"===f)&&d.getSelectedText())return!1;b.rows=m.getRowsForCopy(e,s.bs())}if(!b.rows|| !
b.rows.length)return!1;b.selection=e;return!0},perform:function(b){ka.putRows(b.selection,b.rows,s,a);return!0}})}function pa(a){if(Ba.value())return!1;var b=L();if(0>b&&a.pasteUnder|| !a.forest||a.forest.isEmpty()||s.isReadOnly())return!1;var c=ca.fH(b,a.pasteUnder);!c.under&&a.panel.getTitleRow()&&(a.pasteUnder= !0,c=ca.fH(b,a.pasteUnder));if(N(c.under,!0)){if(0<=b)return!1;b=s.rootPaths.value();if(!b|| !b.length)return!1;b=b[b.length-1];b=ca.indexOf(b[b.length-1]);if(0>b)return!1;a.pasteUnder= !0;c=ca.fH(b,!0)}if(!xa.canMergeForest(a.forest,c.under,c.after))return!1;a.row=b;a.position=c;return!0}function Fa(a,b){var c=ca.aG(a.row);a.pasteUnder&&c&&$.by(c);var c=a.forest,d=a.position;if(ka.isCutMode()&&d.after===c.rowId(0))return ka.clear(),!1;var e=d.after||d.under,f=ka.getCutFrom();if(f&&s.isSpec(f.spec))e=c.rowId(0),c=xa.nP(c.hf(),d.under,d.after,b||"paste",!0);else{var g={};(c=xa.bo(c,d.under,d.after,b||"paste",g,f,!f&&s.isUntransformedSpec(ka.getSpecFrom())))&&Object.keys(g).some(function(a){a=g[a];return H.contains(a)?(e=a,!0): !1})}if(!c)return!1;B(e);return!0}function y(a){return{subscribe:G,update:function(b,c,d){d.panel=s;d.pasteUnder=a;d.forest=ka.getForest();
return pa(d)},perform:function(a,b,c){return Fa(c)}}}function ua(a){if(wa.cu())return!1;var b=na.eK();if(!b)return!0;for(var c=L()+a,d=ca.size();0<=c&&c<d;){var e=ca.rowId(c);if(b(e)){B(e,!0);break}c+=a}return!0}function Ea(){if(za.value())return!0;if(!n)return!1;var a=$.bc();if(!a||0>a||"number"!==typeof a)return!1;a=(a=ca.aL(a))&&c.getIssueIdFromItemId(a.getItemId());return 0<a&&(a=n.$("a#actions_"+a),a.length)?(a.click(),!0): !1}var na=s.bn(),$=s.ao(),xa=s.aZ(),wa=s.bh(),ra=s.bD(),W=s.ah(),ca=s.bs(),H=s.ae(),ja=s.widget.mouseController,ka=s.widget.clipboard,Ga=s.widget.ni,ha=null,Ia=n.$&&"function"===typeof namespace("JIRA.Forms.createEditIssueForm",!1),za=s.eN(),Da=s.getReadOnlyCell(),Ba=(new d.Cell(za,Da,d.or)).pipeChanges(function(){Ha&&x(Ha)}),Ja;s.widget.ad.og().pipeChanges(function(a){Ja&&a&&a.redo&&(Ja.hide(),Ja=null)});var Ha=null,Ka={subscribe:t,update:function(a,b,c){c.panel=s;return!1},perform:d.returnFalse},La=null,Ma=null,ea=null,Oa=null,Da=new D({update:function(a){if(za.value())return!1;var b=ca.indexOf(a[0]);if(1>b)return!1;var c=ca.aI(b);if(c===b-1)return!1;b=0>c?0:ca.rowId(c);return xa.eP(a[0],b)? !0: !1},perform:function(a){var b=ca.indexOf(a[0]),c=
ca.rowDepth(b),e=ca.aI(b),e=0>e?0:ca.rowId(e),f=ca.ak(b-1,c);d.assert(0<=f,f+" "+b);if(0>f)return!1;f=ca.ak(f-1,c);f=0>f?0:ca.rowId(f);xa.nP(a,e,f,"move-up");na.aJ();return!0}}),Pa=new D({update:function(a,b){if(za.value())return!1;var c=ca.indexOf(a[a.length-1]),d=ca.bH(c);if(d>=ca.size()||ca.rowDepth(d)!==ca.rowDepth(c))return!1;c=ca.aI(c);c=0>c?0:ca.rowId(c);if(!xa.eP(a[0],c))return!1;b.under=c;b.after=ca.rowId(d);return!0},perform:function(a,b){xa.nP(a,b.under,b.after,"move-down");na.aJ();return!0}}),Qa=new D({update:function(a,b){if(za.value())return!1;var c=ca.indexOf(a[0]);if(0>=c)return!1;var e=ca.row(c),f=ca.row(c-1);if(e.getDepth()>f.getDepth())return!1;f=ca.ak(c-1,e.getDepth());d.assert(0<=f,c);var g=ca.rowId(f);if(!xa.eP(a[0],g))return!1;var h=0;f!==c-1&&(h=ca.ak(c-1,e.getDepth()+1),h=ca.rowId(h));b.under=g;b.after=h;return!0},perform:function(a,b){$.by(b.under,!0);xa.nP(a,b.under,b.after,"level-down");na.aJ();return!0}}),Na=new D({update:function(a,b){if(za.value())return!1;var c=ca.indexOf(a[0]);if(0>=c||1>ca.rowDepth(c))return!1;var e=ca.aI(c);d.assert(0<=e,e+" "+c);if(N(ca.rowId(e)))return!1;c=ca.aI(e);c=0>c?0:ca.rowId(c);if(!xa.eP(a[0],c))return!1;b.under=c;
b.after=ca.rowId(e);return!0},perform:function(a,b){xa.nP(a,b.under,b.after,"level-up");na.aJ();return!0}}),Ta={subscribe:function(a){w(a);wa.hE().pipe(a.update)},update:function(a,b,c){if(za.value())return!1;if(wa.fQ())return c.toggled= !0;a=fa(L());if(!a)return!1;b=a.getId();if(!a|| !s.hh(b))return!1;c.issue=b;return!0},perform:function(a,b,c){if(wa.fQ())return wa.finishAllEdits(),!0;a=c.issue;b=wa.gq();wa.isRowEditedAndHasUploadErrors(a)&& !wa.isRowEditedAndHasUploadErrors(a,b)&&(b=(b=wa.getFirstCellEditorWithError(a))&&b.column);ba(b,a)||(b=null);c=s.af();b&&0>d.indexOf(c.getColumns(),b)&&(b=null);b||(b=c.gj());if(!b)return!1;wa.editRow(a,b);return!0}},Xa=/[\?&]id=([^\?&]+)/,Ua=new A({update:function(a){if(Ba.value())return!1;var b=(ea||z()).expanded.normalized();if(!b.length)return!1;var c=b.length;a.beforePerform||(c=Math.min(c,100));for(var d=0;d<c;d++)if(N(b[d],!0)|| !xa.eP(b[d],null))return!1;a.selection=b;return!0},perform:function(a){var b=a.selection,c=s.bd();a= !0;var e,f,g,h,l=0,k=s.bd(),m;e=[];f=0;for(g=b.length;f<g;f++)for(m=k.indexOf(b[f]),h=0>m?m:k.bH(m);m<h;m++)e.push(k.rowId(m));k=0<=d.indexOf(e,$.bc())?s.ae().findNextFocusAfterDeletion(b):null;a:{if(wa)for(f=0,
g=e.length;f<g;f++)if(h=e[f],wa.isEditingRow(h)&& !wa.cancelSpecifiedRowEdit(h)){e= !1;break a}e= !0}if(!e)return!1;e=[];f=0;for(g=b.length;f<g;f++)h=b[f],(h=c.dg(h))&&h.length?(e.push(h),l+=h.length):(b.splice(f,1),f--,g--);b.length&&(a=xa.eH(b,"remove"));if(a){f=0;for(g=e.length;f<g;f++)s.widget.fK.addDeleted(e[f]);k&&0<=H.indexOf(k)&&B(k);(b=namespace("JIRA.Messages",!1))&&b.showWarningMsg&&(l=1<l?d.text("s.w.info.deleteSubtree.n.html",l):d.text("s.w.info.deleteSubtree.1.html"),s.widget.ad.og().value()&&(l+='<br><a href="#" data-s-action="undo">'+d.text("s.w.+undo+.action.+remove+")+"</a>"),Ja=b.showWarningMsg(l,{closeable: !0,timeout:5}))}return a}}),Ra=new A({update:function(a){if(za.value()|| !s.widget.jiraConfig.lP())return!1;for(var b=(ea||z()).expanded.original(),d=s.bs(),e=[],f=0;f<b.length;f++){var g=d.aL(b[f]);(g=c.getIssueIdFromItemId(g&&g.getItemId()))&&e.push(g)}if(2>e.length)return!1;a.selection=e;return!0},perform:function(a){a={issues:a.selection.join(" "),homeUrl:f.location.toString()};g.openWindow("/secure/StructureBulkChange.jspa",a,"_self","POST");return!0}});W.register("down",d.curry(J,!1));W.register("up",d.curry(O,!1));W.register("pageDown",d.curry(V,!1));
W.register("pageUp",d.curry(U,!1));W.register("pageHome",d.curry(P,!1));W.register("pageEnd",d.curry(Y,!1));W.register("selectDown",d.curry(J,!0));W.register("selectUp",d.curry(O,!0));W.register("selectPageDown",d.curry(V,!0));W.register("selectPageUp",d.curry(U,!0));W.register("selectPageHome",d.curry(P,!0));W.register("selectPageEnd",d.curry(Y,!0));W.register("selectSubtrees",q(function(){$.selectSubtrees(ca)}));W.register("selectRoots",q(function(){$.selectRoots(ca)}));W.register("cancelMode",function(b){if(ja&&ja.cU())return!0;var c=b&&b.target,d= !1;c&&(d=a.Event("structure:cancelMode"),d.causingEvent=b,a(c).trigger(d),d=d.isDefaultPrevented());return d||Ga&&Ga.hideCurrentPopup()? !0:wa&&wa.cu()?(wa.cancelCurrentCellEdit(),!0):0<$.kz(ca)?($.jo(),!0): !1});W.register("collapseOrMoveToParent",function(){if(za.value())return!1;var a=$.bc();return a?$.isExpanded(a)&&ca.hasChildren(a)?($.by(a,!1),na.aJ(),!0):(a=ca.bL(a))?B(a): !1: !1});W.register("expandOrMoveToNext",function(){if(za.value())return!1;var a=$.bc();return a?ca.cG(a)&& !$.isExpanded(a)?($.by(a,!0),na.aJ(),!0):J():H.isEmpty()? !1:K(0)});W.register("expandAll",function(){$.cC(!0);na.aJ();return!0});W.register(
"collapseAll",function(){$.cC(!1);na.aJ();return!0});W.register("expandNextLevel",d.curry(da,1));W.register("collapseNextLevel",d.curry(da,-1));W.register("expandLevel",ia);for(var Ca=1;8>=Ca;Ca++)W.register("expandLevel."+Ca,T(Ca-1));W.register("closestHighlighted",function(){if(wa.cu())return!1;var a=na.eK();if(!a)return!1;var b=$.bc();return b?a(b)||ua(1)? !0:ua(-1):ua(1)});W.register("nextHighlighted",d.curry(ua,1));W.register("prevHighlighted",d.curry(ua,-1));W.register("toggleSelected",function(a){if(za.value())return!1;a=$.bc();if(!a)return!1;$.toggleSelected(a);J();return!0});W.register("toggleSelectAll",function(){if(za.value()|| !$.bc())return!1;$.toggleSelectAll();return!0});W.register("copy",oa(!1));W.register("cut",oa(!0));W.register("viewThumbnails",function(){if(za.value())return!1;var a=$.bc();if(!a)return!1;var c=s.af().getColumns();if(0>d.find(c,function(a){return l.isFieldColumn(a)&&"thumbnail"===a.fieldId}))return!1;na.aJ();a=s.aS().TRByRowId(a).find(".s-f-thumbnail .value a").eq(0);a.length&&(b.ajsbridge.hW(a.closest(".value"),a[0],s.widget),n.$(a[0]).click());return!0});W.register("bulkChange",Ra);W.register("moveUp",Da);W.register("moveDown",Pa);W.register(
"levelUp",Na);W.register("levelDown",Qa);W.register("deleteSubtree",Ua);W.register("paste",y(!1));W.register("pasteUnder",y(!0));W.register("toggleEditMode",Ta);W.register("createChild",ga(1,null,!1));W.register("createSiblingBelowWithDialog",ga(0,c.ISSUE,!0));W.register("createSiblingBelow",ga(0,c.ISSUE,!1));W.register("createFolderBelow",ga(0,c.FOLDER,!1));W.register("addItem",ga(0,null,!1));W.register("addChildItem",ga(1,null,!1));W.register("addItemAbove",ga(2,null,!1));W.register("addIssue",ga(0,c.ISSUE,!1));W.register("addFolder",ga(0,c.FOLDER,!1));W.register("searchAndAdd",function(){var a=s.getSpecController().getSearchAndAddSlaveSpec();return{perform:function(b,c,d){s.widget.layoutManager.switchLayout(h.TWO_PANEL_LAYOUT);s.widget.slave.setSpec(a);s.widget.pageManager.setFocusedPanel(s.widget.slave);s.widget.slave.getPanelHeader().focusQuery();return!0}}}());W.register("addConfluencePage",ga(0,c.CONFLUENCE_PAGE,!1));W.register("nextEditableField",d.curry(I,!1));W.register("prevEditableField",d.curry(I,!0));W.register("togglePin",function(){if(za.value()||s.widget.automationOn.value()||s.widget.bF.visibleCell.value())return!1;if(s.pinnedItem.value())s.pinnedItem.setValue(
null);else{var a=s.widget.getAnchorIssue();if(a)a=""+a;else{a=$.bc();if(!a)return!1;a=ca.aL(a);if(!a)return!1;a=a.itemId}s.pinnedItem.setValue(a)}return!0});W.register("placePinned",function(){var a=s.widget.getAnchorIssue();if(!a)return!1;var b=L(),b=0<=b?ca.fH(b):{under:0,after:0};return xa.addIssue(a,b.under,b.after,!1)});W.register("rightEditableField",d.curry(ma,!1));W.register("leftEditableField",d.curry(ma,!0));W.register("downEditableField",d.curry(S,!1));W.register("upEditableField",d.curry(S,!0));W.register("finishAllEdits",function(){wa.finishAllEdits()});W.register("cancelCurrentIssueEdit",function(){wa.cancelCurrentRowEdit()});W.register("cancelCurrentCellEdit",function(){wa.cancelCurrentCellEdit()});W.register("revertCurrentCellEdit",function(){wa.revertCurrentCellEdit()});W.register("switchToDialog",function(){wa.switchToDialog()});W.register("openIssue",function(){function a(){var c=$.bc();if(c&&0<c){c=s.getRowKey(c);if(!c)return!1;k.saveNavigationHint(s,c);if(c=b.ajsbridge.issueURL(c))return b.modes.GADGET?f.open(c,"_parent"):f.location.href=c,!0}return!1}var c= !0===s.widget.config.showIssueDetails&&s.isPrimary();return!c&&s.config.areJiraActionsDisabled()?Ka:{
subscribe:function(a){c&&(w(a),p.enabledCell.pipe(a.update))},update:function(a,b,d){return c?(d.toggled=p.enabledCell.value(),d.panel=s,a=p.isValidFocusedRowId(s,s.ao().bc()),d.toggled||a): !0},perform:function(){return za.value()? !0:c?p.toggleEnabledAndFocus():a()}}}());W.register("quickActions",function(){(new u(s)).show();return!0});s.config.areJiraActionsDisabled()||((W.register("jira.showActions",Z),W.register("jira.actions.dropdown",Ea),b.modes.GADGET)?"local"===b.modes.GADGET&&(W.register("jira.assign",la("a.issueaction-assign-issue")),W.register("jira.edit",la("a.issueaction-edit-issue")),W.register("jira.assignToMe",la("a.issueaction-assign-to-me")),W.register("jira.comment",la("a.issueaction-comment-issue")),W.register("jira.labels",la("a.issueaction-edit-labels"))):(W.register("jira.assign",d.curry(va,"assignIssue","issueaction-assign-issue")),W.register("jira.edit",Q),W.register("jira.assignToMe",sa),W.register("jira.comment",ta()),W.register("jira.labels",d.curry(va,"editLabels","issueaction-edit-labels"))));s.panel$.delegate("a.s-ms-mark","click",function(a){if(a.shiftKey&& !a.ctrlKey&& !a.altKey&& !a.metaKey)return a.preventDefault(),!1;var b=g.getRowIdFromEvent(a)
;a.preventDefault();$.toggleSelected(b);s.widget.pageManager.setFocusedPanel(s);return!1});s.panel$.delegate("a.s-ms-toggle-all","click",function(a){a.preventDefault();$.toggleSelectAll()});ra.addListener(new d.Life,this);this[e.bu]=function(){var a=$.bc();if(a){var b=s.ae(),c=s.bs(),d=b.indexOf(a);if(0>d){for(a=c.bL(a);a;){d=b.indexOf(a);if(0<=d)break;a=c.bL(a)}0<=d&&(B(a),na.io(a))}}};this[e.aN]=function(a,b,c){!c&&0>b&&$.getForcedFocusedRow()===b&&($.eJ(ha),na.aJ());a.fQ()||(ha=null)};this[e.REPLACE_ROW_IDS]=function(a,b){if(ha)for(var c=0,d=a.length;c<d;c++){var e=ha.indexOf(a[c]);null!==e&&(ha[e]=b[c])}};this.focusRow=B;this.oQ=function(a,b){for(var c=s.af().getColumns(),d=0,e=c.length;d<e;++d)ba(c[d],a)&&b(c[d])}}})(window);(function(f){var b=namespace("almworks.structure"),g=namespace("almworks.structure.apputil"),d=namespace("almworks.util"),e=namespace("almworks.structure.appevents"),a=b.$,n=d.requireGlobal("AJS"),c=require("structure/widget/ui/grid/TRCache"),p=require("structure/widget/util/NavigationHint"),m=require("structure/widget/ui/column/EditableColumn");b.fj=function(k){function r(c){L=c;if(!c)ba=0,T=ia=null,Aa= -1,k.div$.removeClass("dragactive"),
E.enableSelection(),v(),ga=0;else if(2===c)k.div$.addClass("dragactive");else if(1===c){c=d.dragBind(a,V,t,U,!0);if(b.modes.GADGET&&(a(f).focus(),a.browser.webkit)){var e=d.withThis(c,c.detach),e=d.seq(U,e);c.bind(a("body"),"mouseleave",e)}E.disableSelection();z()}}function l(b,c){var e=a(b.target).closest(".td");if(!e.length)return null;for(var f=d.getClasses(e),g=c.panelId+"col",h=0,l=f.length;h<l;h++)if(e=d.toIntSafe(d.tail(f[h],g),-1),0<=e){f=c.af().getColumns();if(e<f.length)return f[e];break}return null}function h(b){if(!b|| !b.target)return!1;b=a(b.target);return b.is("a")&& !b.closest(".s-editorpanel").length}function u(e){if(e){if(!e.which&&("click"===e.type||"dblclick"===e.type))try{e.which=1}catch(f){}if(1===e.which&&0===L){var g=a(e.target);if(!g.closest(".s-editorpanel, .aui-dd-parent, .s-ms-mark").length&& !g.hasClass("s-expander")){var k=b.apputil.getDominator(e.target,"panel");if(k&&(a.browser.msie|| !e.isDefaultPrevented())&&(g=c.getRowIdFromParentTR(e.target))){var m=d.mouseCodeFromEvent(e),n= !1,p=k.bh();if("dblclick"===e.type&&1===m){Q=null;k=l(e,k);if(!k)return;p&&p.editRow(g,k);n= !0}else 1===m&&p&&p.hE().value()&&h(e)&&(n= !0);n||1!==m||(
E.isSelectionDisabled()||(E.disableSelection(),qa()),e.target&&e.target!==sa&&a(e.target).closest("a[href]").length&&(Q=e.target,ya(),e.preventDefault()));sa=null;n&&(e.preventDefault(),e.stopImmediatePropagation())}}}}}function s(a){if(a&&"click"===a.type&&0===L&& !(a.which&&1!==a.which||d.modifiersFromEvent(a))){var e=b.apputil.getDominator(a.target,"panel");if(e&&c.getRowIdFromParentTR(a.target)){if((e=e.bh())&&e.hE().value()&&h(a))a.preventDefault(),a.stopImmediatePropagation();else if(a.target&&a.target!==ta){var e=n.$(a.target),f=e.closest("a[href]");f.length&& !e.closest(".aui-dd-parent").length&&(a.preventDefault(),f.hasClass("issue-link")&&a.stopImmediatePropagation())}ta=null}}}function q(a){if(1===L)r(0);else if(2===L){var b=N.dV(),c=N.dA(),d= !1,e={};a?a=(d=N.fo(J(),e))?c:b:(N.dM(),a=b);ba&&a&&(e=e[ba]||ba,d&&(d=a.bs().bL(e))&&a.ao().by(d),a.ao().eJ(e,a.ae()),a.bn().aJ(),k.pageManager.setFocusedPanel(a));r(0);oa&&(clearTimeout(oa),oa=0)}}function x(){var a=2===L;q(!1);return a}function t(a){L&&1===a.which&&(1===L&&a.shiftKey&& !a.ctrlKey&& !a.metaKey&&ia.ao().focusRow(ba,!1,!0),q(!0))}function w(a,b){ma=a;R=Math.min(100,Math.max(9,b));I||(I=f.setInterval(C,100))}
function v(){ma=0;I&&(f.clearInterval(I),I=null)}function C(){if(ma&&T){var a=T.bn(),b=a.scrollpane.scrollTop(),c=null;if(0>ma)0<b&&(c=Math.max(0,b-R));else{var d=a.scrollpaneHeight(),d=a.issueAreaHeight.value()-d;b<d&&(c=Math.min(d,b+R))}null===c?(v(),K(null)):(a.scrollpane.scrollTop(c),S.rowsY&&(S.rowsY-=c-b))}else v()}function z(){var a=(new Date).getTime();3E3<a-ga&&T&&(ga=a,a=k.glass$.offset(),S.glassX=a.left,S.glassY=a.top,a=T.fr().offset(),S.rowsX=a.left,S.rowsY=a.top);return S}function F(a,b){for(var c=9;a>b&&100>c;)c=Math.round(2*c),a-=b;return c}function A(){la= !1}function D(a,b){if(0===a)return[];var c=b.aG(a-1);return c&&c.length?c:[]}function G(a,b,c){if(0===b|| !T)return 0;var e=T.ae(),f=N.dW(),g=D(b,e),h=0;if(ia===T){if(h=N.fE()+Math.floor((c-da)/50),h===f&&a===b)return f}else a=0,T===k.slave?h=a=Math.floor((c-Aa)/50):(a=Math.floor((Aa-c)/50),f=g.length,h=f-a);c=B(e,b,T,g);h=d.minmax(c,g.length,h);oa&&(clearTimeout(oa),oa=0);0<h&&(oa=setTimeout(function(){oa=0;T&&(T.ao().by(g.slice(0,h)),N.dp(T,b,h,J(),!0))},500));return h}function B(a,b,c,d){var e=b<a.size()?a.rowDepth(b):0;c.getTitleRow()&&(e=Math.max(1,e));(a=c.rootPaths.value())&&a.forEach(function(a){for(var b=
a.length-1;0<=b;b--)if(0<=d.indexOf(a[b])){e=Math.max(b+1,e);break}});return e}function K(a){if(N.isDragging()){var b,c;if(a){b=a.pageX;c=a.pageY;if(b===M.x&&c===M.y)return;M.x=b;M.y=c;var d=null;(d=0<=Aa?b>=Aa?k.slave:k.master:k.master)&&d!==T&&(T=d,ga=0)}else b=M.x,c=M.y;T||x();var e=c;if(c=N.ce()){var d=z(),e=e-X.top,f=d.rowsY;null===f&&(f=d.rowsY-T.bn().containerScrollTop());f=Math.round(e-f);c.css("top",e-d.glassY);c=f}else c=0;if((d=N.ce())&& !la){f=T;e=aa[f.panelId];if(!e){e={};aa[f.panelId]=e;var f=f.panel$.offset(),g=k.glass$.offset();e.xgo=f.left-g.left}e=e.xgo;d.data("new")?d.css("left",e).data("new",!1):d.css("left")!==e+"px"&&(la= !0,d.animate({left:e},250,A))}var d=T.bn().fm(c),e=c,f=N.dQ(),g=N.dA(),h=d.rowY,l=d.rowHeight,m=d.forestIndex,n=Math.min(T.ae().size(),m+1),p=l/4,e=e<h+p?m:e>h+l-p?n:f<=m&&g===T?m:n;b=G(N.dQ(),e,b);a&&(a=c,c=d.rowHeight,f= !1,h=c/2,0<d.pxfrom&&(g=d.pxfrom-a,g>h&&(w(-1,F(g,c)),f= !0)),!f&&a>d.pxto-h&&(g=T.bn().issueAreaHeight.value(),d.pxto<g&&(g=a+c-d.pxto,w(1,F(g,c)),f= !0)),f||v());N.dp(T,e,b,J())}}function J(){var a= !0;if(ia!==T)var a=ia.ao(),a=O(a),b=T.bs(),a=a.every(function(a){return-1!==b.indexOf(a)});var c=Z.value(),d=ia.isReadOnly()
,e=T.isSpec(ia.getVersionedSpec().spec),c=d|| !c;return ia===T||e||a?c: !c}function O(a){var b=null;a.isSelected(ba)&&(b=a.kT(ia.ae()));b&&b.length||(b=[ba]);return b}function V(a){if(L)if(1===L){if(3<=Math.abs(a.pageX-fa.left)+Math.abs(a.pageY-fa.top)){var b=ia.ao(),c=O(b);if(c=ia&&N.ef(ia,c,J()))b.eJ(null),Aa=k.pageManager.getSplitterPageX();r(c?2:0);K(a)}}else 2===L&&K(a)}function U(a){L&&q(!1)}function P(){if(n)n.$(k.div$[0]).off("click.structure").on("click.structure",s)}var Y=d.nn(k.eventBus),N=d.nn(k.dJ),L=0,fa={top:0,left:0},X={top:0,left:0},M={x:0,y:0},ba=0,E=new d.SelectionDisabler,I=null,ma=0,R=0,S={rowsX:0,rowsY:0,glassX:0,glassY:0},ga=0,da=0,ia=null,T=null,Aa= -1,Z=(new d.Cell(!1)).pipeChanges(function(){K(null)}),va=d.isMac()?18:17;a(document).bind({keydown:function(a){a.keyCode===va&&Z.setValue(!0)},keyup:function(a){a.keyCode===va&&Z.setValue(!1)}});var Q=null,sa=null,ta=null,ya=d.delayed(550,function(){if(Q){var c=Q;Q=null;var g=a(c);if(d.onPage(g)){var h={link$:g,prevent: !1};Y.fireEvent(e.BEFORE_CLICK,h);if(!0!==h.prevent){h=b.apputil.getDominator(g,"panel");h||(h=k.master);p.saveNavigationHintFromLink(h,g);ta=sa=c;h= !1;try{if(f.document.createEvent&&
c.dispatchEvent){var l=document.createEvent("MouseEvents");k.div$.is(".ie9")?l.initMouseEvent("click",!0,!0,f,1,1,1,1,1,!1,!1,!1,!1,1,c):l.initEvent("click",!0,!0);h= !1!==c.dispatchEvent(l)}else c.click&&(c.click(),h= !0)}catch(m){}if(!h&& !g.hasClass("issue-link")&&(c=g.attr("href"))){g=g.attr("target")||"_self";try{f.open(c,g)}catch(n){}}}}}}),qa=d.delayed(500,function(){E.enableSelection()}),aa={},la= !1,oa;k.div$.mousedown(function(c){if(1===c.which){var d=b.apputil.getDominator(c.target,"panel");if(d){var f=g.getRowIdFromEvent(c),n=a(c.target),p;if(p=f&&0===L)p=c.shiftKey&& !c.ctrlKey&& !c.metaKey||a(c.target).hasClass("st-dh");if(p&&(p=n.closest(".tr"),p.length))return fa.left=c.pageX,fa.top=c.pageY,T=ia=d,d=p.offset(),X.top=Math.round(c.pageY-d.top),X.left=Math.round(c.pageX-d.left),da=c.pageX,ba=f,r(1),c.preventDefault(),c.stopImmediatePropagation(),!1;var q=d.ao();d.bs();p=q.bc();if(f&&c.target&&n.hasClass("s-expander"))d= !q.isExpanded(f),Y.postEvent(e.gS,d?"expandClick":"collapseClick"),q.by(f,d),c.preventDefault(),c.stopImmediatePropagation();else{if(f&&(!c.target|| !n.closest(".s-ms-mark").length)){var n= !1,s=d.bh();if(s){var u=s.fQ();if(u){q=l(c,d);!q||
q.isInstanceOf(m)&&q.isEditableColumn()||(q=null);if(f!==u.rowId||q!==u.column)n= ! !s.editRow(f,q||u.column);n||(n=h(c))}else s.isRowEditedAndHasUploadErrors(f)&&((q=l(c,d))&& !s.isRowEditedAndHasUploadErrors(f,q)&&(q=(u=s.getFirstCellEditorWithError(f))&&u.column),q&&(n= ! !s.editRow(f,q)))}n?(c.stopPropagation(),c.preventDefault()):f!==p&&d.cc().focusRow(f)}k.pageManager.setFocusedPanel(d);if(E.isSelectionDisabled())return!1}}}}).click(u).dblclick(u);P();Y.addListener(new d.Life,this);this[e.ar]=function(){aa={}};a.extend(this,{cU:x,installAJSMouseHandler:P})}})(window);(function(){function f(a,b){if(a===b)return 0;var d=a.getOrder(),e=b.getOrder();if(d!==e)return d<e? -1:1;d=c.renderTemplate(a.getTitle())||"";e=c.renderTemplate(b.getTitle())||"";return d.localeCompare(e)}function b(a,b){if(a===b)return 0;var d=c.renderTemplate(a.getPresetName())||"",e=c.renderTemplate(b.getPresetName())||"";return d.localeCompare(e)}function g(a){var e=n.ColumnGroup.getGroups();e.sort(f);var g=c.mapArray(e,function(a){return a.getGroupKey()}),k=n.ColumnType.getAllColumnTypes(),p=[],q,x;q=0;for(x=k.length;q<x;q++)p.push(d(a,k[q]));var t=m.Deferred(),w=[];m.when.apply(m,p).done(function(){var a=
[],d,f,k,m,n;d=0;for(f=arguments.length;d<f;d++)if(n=arguments[d],c.isArray(n))for(k=0,m=n.length;k<m;k++)n[k]&&a.push(n[k]);a.sort(b);d=0;for(f=e.length;d<f;d++){n=e[d];var p=n.getGroupKey(),q= !1;k=0;for(m=a.length;k<m;k++){var s=a[k],u=s.getGroupKey();if(u===p|| !u&& !p||u&& !g[u]&& !p)q||(w.push(n),q= !0),w.push(s)}}c.assert(w.length>=a.length&&w.length<=a.length+e.length,w.length+" "+a.length+" "+e.length)}).always(function(){t.resolve(w)});return t.promise()}function d(a,b){var d=m.Deferred(),e=[];k.loadTypeMetadata(b,"preset",a).then(function(d){d=b.createAddColumnPresets(k.extendMetadata(c.extendOwn({},a),d));for(var e=[],f=0,g=d.length;f<g;f++)e.push(k.createConfiguratorPromise(b,a,d[f]));return m.when.apply(m,e)}).done(function(){c.addAll(e,c.toArray(arguments))}).always(function(){d.resolve(e)});return d.promise()}function e(a){return p.buildHtml("div","input","ul","li","a",function(b,d,e,f,g,k){return[b(".st-col-add")(b(".st-col-nf")(d(".ajs-ditry-warning-exempt.s-col-filter",{type:"text",maxlength:20,placeholder:"{s.w.ccnf.search}"})),b(".st-col-list")(e()(k.forEach(a,function(a){if(n.isInstance(n.ColumnGroup,a))return[f(".col-gr-mark.st-dis")(g()(a.getTitle()))];
c.assert(n.isInstance(n.ColumnConfigurator,a));var b=a.getDescription&&a.getDescription();return[f(b?{title:b}:{})(g()(a.getPresetName()))]}),f(".s-not-found.st-dis")(g()("{sw.generic.not-found}")))))]})};var a=namespace("almworks.structure"),n=namespace("almworks.structure.api"),c=namespace("almworks.util"),p=require("almworks/util/Template"),m=a.$,k=require("structure/widget/ui/column/ColumnUtil");a.AddColumnPanel=function(b){function d(a,b){var c=[],e={},f=0;b.each(function(b){var d=a[b];if(n.isInstance(n.ColumnConfigurator,d)){var d=JSON.stringify(d.getColumnSpec())+d.getPresetName(),g=e[d];g||(g= ++f,e[d]=g);c[b]=g}});return c}function f(){c.safeCall(A&&A.mN,q)}function p(){var a=m.trim(w.val()).toLowerCase();if(a){a=s(a,v);C.css("display",a?"none":"list-item");var b=F.getSelectedItem();!a||b&&b.is(":visible")?b&& !b.is(":visible")&&F.jo():F.selectFirst()}else v.css("display","list-item"),C.hide();F.lc()}function s(a,b){var c= !1,d={};b.each(function(b){var e=m(this),f= !1;e.is(".st-dis")||(b=D[b],!d[b]&&0<=e.text().toLowerCase().indexOf(a)&&(f= !0,d[b]= !0));e.css("display",f?"list-item":"none");c|=f});return c}var q=this,x=m.Deferred(),t,w,v,C,z,F,A,D;g(
k.createColumnContext(b)).done(function(b){t=m(e(b));w=t.find("input.s-col-filter");v=t.find("li");D=d(b,v);C=v.filter(".s-not-found");z=t.find(".st-col-list");F=new a.apputil.MenuList({container$:t,selector:"li:not(.st-dis)",viewPort$:z,handler:{onMenuItemChosen:function(a){a=v.index(a);0<=a&&a<b.length?(a=b[a],n.isInstance(n.ColumnConfigurator,a)&&a.isConfigured()&&c.safeCall(A&&A.mj,q,a.getColumnSpec())):f();return!0},onMenuCancelled:f}})}).always(function(){x.resolve()});c.extendOwn(this,{whenReady:function(a){x.always(a)},installTo:function(a){t.appendTo(a);a=t.width();m.browser.msie&&8<m.browser.version&&11>m.browser.version&&(a+=20);t.css("min-width",a+"px");w.change(p).keyup(p)},alignWith:function(a,b){var c=parseInt(a.position().left,10)+5,d=c+t.outerWidth(!0)-b;0<d&&(c-=d);t.css("left",c)},show:function(a){A=a;F.jo();t.find("input.s-col-filter").val("");p();t.show();z.css("overflow-y","auto");this.focus=c.borrowFocus(w,t);z.scrollTop(0)},hide:function(a){t.hide();this.focus&&(this.focus=this.focus.returnFocus(a))},containsElement:function(a){return a?0<m(a).closest(".st-col-add").length: !1},pipeHeightTo:function(a){a.setValue(t.outerHeight(!0))}})}})();(function(){var f=
namespace("almworks.structure"),b=namespace("almworks.util"),g=namespace("almworks.structure.appevents"),d=namespace("almworks.structure.apputil"),e=require("structure/widget/generator/GeneratorRegistry"),a=require("structure/widget/transform/Transform"),n=require("structure/widget/columns/MainColumn"),c=require("structure/widget/ui/column/EditColumnPanel"),p=require("underscore"),m=f.$,k=b.flipSet(["handle","actions"]),r=b.flipSet(["main"]);f.ee=function(l){function h(a){if(a===xa)return!0;xa=a;return!1}function u(a,b){if(b.columns){for(var c=a.getColumns(),d=Z.children(".th"),e=d.length,f=[],g="",k=0;k<c.length;k++){var n=c[k];f.push(n.getCsid());var p;p=k<e?m(d[k]):m('<div class="th '+l.columnClass(k)+'"></div>');p.removeClass("s-last-col-but-not-actions");k!=c.length-1||n.isColumnOfType("actions")||p.addClass("s-last-col-but-not-actions");n.renderHeader(p);0<k&&m(".value",p).prepend(m('<span class="col-sort"><i class="alm"></i></span>'));k>=e&&p.appendTo(Z);0<k&&(g+='<div class="'+l.columnClass(k)+'"><a href="#">{add column}</a></div>')}e>c.length&&d.slice(c.length).remove();Z.find("> .th-ccnf").remove();m(
'<div class="th-ccnf th-ccnf-add"><a class="th-ccnf-add-icon" title="{s.w.ccnf.title}"><i class="s-fa s-fa-plus-square"></i></a></div>').appendTo(Z);Fa.setValue(f);N(c);L()}if(b.columns||b.columnWidths)q(0,function(a){h(a);return b.manualResize}),s(b.kC)}function s(a){if(a){var b=E.getColumns(),c=E.eV();if(b&& !(0>c)){var d=m();ta.children(".s-resizer").each(function(e){(e=b[e<c?e:e+1])&&e.isResizable()&&a(e)&&(d=d.add(m(this).find("a.handle")))});if(d.length){var e=d.css("background-color");d.stop().css("background-color",e).animate({"background-color":"#58Aee0"},{duration:200,easing:"swing"}).animate({"background-color":e},{duration:800,easing:"swing",complete:function(){m(this).css("background-color","")}})}}}}function q(a,c){var d=E.getColumns(),e=E.eV();if(d){var f=Z.data("ColWidths");f||(f={widths:{},kP:{}},Z.data("ColWidths",f));var h=b.getClientWidth(va);if(0!==h||va.is(":visible"))if(a&&(h===va.width()&& !wa()||20>h))setTimeout(b.curry(q,a-1,c),100);else if(!(20>h)){var k=x(d,h,c(h));Z.data("ColWidths",k);h=f.widths;f=k.widths;k= !1;if(h.length!==f.length)k= !0;else for(var n=0;n<d.length;n++)if(f[n]!==h[n]){k= !0;break}if(k){for(var h=d.length,k="",p=n=0;p<h;p++)var s=
f[p],k=k+("  #structure ."+l.columnClass(p)+" { left: "+n+"px; width: "+s+"px }\n"),n=n+s;k+="  #structure ."+S+"fullwidth { width: "+n+"px }";m("#"+ia).remove();m("head").append('<style type="text/css" id="'+ia+'">'+k+"\n</style>");z(d,f,e);d=f[0];49<=d?ya.show().css("left",d-24+"px"):ya.hide();ba.fireEvent(g.au,f);y.setValue(f)}}}}function x(a,c,d,e,g,h,k){function l(a){return e&&e.hasOwnProperty(a.csid)?e[a.csid]:a.getWidth()}function m(){return{widths:r,kP:x}}function n(b,c){var d,e,f;d=0;for(e=a.length;d<e&& !(f=a[d],f.isResizable()&&g(d,f)&&b(d,f)&& !1===c(d,f));d++);}function p(a,b){n(a,function(a,d){var e=Math.min(r[a]-b(a,d),-c);0<e&&(r[a]-=e,c+=e,h(a,d,r[a]));return 0>c})}function q(a,b){var d=0,e={},f;n(a,function(a,c){e[a]=Math.max(0,r[a]-Math.max(s,b(a,c)));d+=e[a]});0<d&&(f= -c<d? -c/d:1,p(function(a){return 0<e[a]},function(a){return r[a]-Math.ceil(e[a]*f)}))}g=g||b.returnTrue;h=h||b.noop;var s=f.MIN_COLUMN_WIDTH,u= -1,t=[],r=[],x={},na=Math.round(c/(a.length||1)),C,y;for(C=0;C<a.length;C++)if(y=a[C],y.isColumnOfType("main"))u=C;else{var v=l(y);!v&&d&&(v=y._stretchedWidth);if(!v)if(v=y._preferredWidth,0<v){if(y._stretchedWidth&&(y._stretchedWidth=null),v>na){t.push(
C);continue}}else v=y.getDefaultWidth()||2*s;r[C]=v;c-=v}0<=u&&t.push(u);for(C=0;C<t.length;C++)y=a[t[C]],v=Math.round(c/(t.length-C)),v=Math.max(v,b.toIntSafe(w(y),0),s,na),0<y._preferredWidth&&(v=Math.min(v,y._preferredWidth),y._stretchedWidth=v),r[t[C]]=v,c-=v;x.stretch= -c;if(0<=c)return m();q(function(a,b){if(a!==u){var c=b._stretchedWidth||b._preferredWidth||b.getDefaultWidth();return 0<c&&c<r[a]}return!1},function(a,b){return b._stretchedWidth||b._preferredWidth||b.getDefaultWidth()});x.shrinkPreferred= -c;if(0<=c)return b.assert(0===c),m();q(function(a){return a!==u},function(a,b){return w(b)||0});x.shrinkMinimum= -c;if(0<=c)return b.assert(0===c),m();if(k)return m();p(function(a,b){return b.canShrinkWhenNoSpace()},function(){return s});x.shrinkShrinkable= -c;if(0<=c)return b.assert(0===c),m();p(b.returnTrue,function(){return s});x.shrinkAll= -c;0>c&&b.warn("cannot fit all columns ("+c+")");return m()}function t(a){a.addClass("s-resizer");a.append('<a class="handle" onclick="return false;">Resize column</a>');a.draggable({axis:"x",containment:"parent",scroll: !1,start:function(a,c){if(!c.helper.length||c.helper.hasClass("s-rs-nomove"))return!1;c.helper.addClass(
"s-rs-moving");Ga=b.indexOf(ta.children(".s-resizer"),c.helper[0]);H.setValue(!0);aa.css("left",c.position.left+Aa+"px").show()},drag:function(a,b){if(!b.helper.length)return!1;var c=v(b.helper,b.position.left,a);if(c){c.backoff&&(b.position.left=c.x);if(c.lQ){var d=E.getColumns(),e=E.eV();C(d.length,c.lQ);z(d,c.lQ,e)}aa.css("left",c.x+Aa+"px");b.helper.toggleClass("s-rs-snapped",! !c.snapped);aa.toggleClass("s-rs-snapped",! !c.snapped)}return! !c},stop:function(b,c){aa.hide();Ga= -1;H.setValue(!1);if(c.helper.length){c.helper.removeClass("s-rs-moving s-rs-snapped");aa.removeClass("s-rs-snapped");var d=v(c.helper,c.position.left,b);d&&(I.df({manual:d.widths},null),C(0,null),a.css("left",d.x+Aa+"px"))}}})}function w(a){var b=E.getColumns();if(0===b.length)return a.getMinWidth();b=b[b.length-1];return b!==a||b.isColumnOfType("actions")?a.getMinWidth():a.getMinWidth()+26}function v(a,c,d){c=Math.round(c);var e=ta.children(".s-resizer"),f=b.indexOf(e,a[0]);if(0>f)return!1;var e=Z.data("ColWidths"),g,h=0,k;if(b.isEmptyOrFalsy(e)||0<e.kP.shrinkMinimum)return!1;a=e.widths;e=0<e.kP.stretch;for(g=0;g<f;g++)h+=a[g];k=h+a[f]+a[f+1];g=d.altKey;var l= !g&& !d.metaKey&& !d.ctrlKey,m=
E.getColumns();g=g? -1:E.eV();d=0>g||f<g?m[f]:null;g=0>g||f>=g?m[f+1]:null;var n=c-T,p= !1,q= !1,s={},u;d&&(s[d.csid]=n-h);g&&(s[g.csid]=k-n);d&&(u=h+w(d),n<u?(c=u+T,p= !0,s[d.csid]=w(d),g&&(s[g.csid]-=u-n)):l&&(u=d._stretchedWidth||d._preferredWidth||d.getDefaultWidth(),0<u&&(h+=u,15>=Math.abs(n-h)&&(c=h+T,q=p= !0,s[d.csid]=e?u:null))));g&&(h=k-w(g),n>h?(c=h+T,p= !0,s[g.csid]=w(g),d&&(s[d.csid]-=n-h)):l&&(u=g._stretchedWidth||g._preferredWidth||g.getDefaultWidth(),0<u&&(h=k-u,15>=Math.abs(n-h)&&(c=h+T,q=p= !0,s[g.csid]=e?u:null))));k=b.getClientWidth(va);var r=u=n=h=l=null;m&&a&&(0!==k||va.is(":visible"))&&20<=k&&(! !d!== ! !g&&(n=d?function(a){return a>f}:function(a){return a<=f},u=function(a,b,c){r=r||{};r[b.csid]=c}),e&&b.eachOwn(a,function(a){var b=m[a].csid;s.hasOwnProperty(b)||(s[b]=this[a])}),l=x(m,k,!0,s,n,u,!0));l&&(h=l.widths,r&&b.extendOwn(s,r),a=l.kP.shrinkMinimum||0,0<a&&(p= !0,q&&15<a&&(q= !1),d?(c-=a,h[f]-=a,s[d.csid]=h[f]):(c+=a,h[f+1]-=a,s[g.csid]=h[f+1])));return{widths:s,backoff:p,x:c,snapped:q,lQ:h}}function C(a,b){var c=l.panel$.find("div.tableHeader div.th"),d,e,f;if(0===a)c.css({left:"",width:""});else for(f=d=0;d<a;d++)e=b[d],0<d&&m(c[d]).css({left:f+"px",
width:e+"px"}),f+=e}function z(a,b,c){var d=ta.children(".s-resizer"),e=a.length-1,f,g,h;if(d.length<e){for(f=d.length;f<e;f++)t(m("<div>").appendTo(ta));d=ta.children(".s-resizer")}else e<d.length&&d.slice(e).remove();f=0;for(g=T;f<e;f++)g+=b[f],h=0>c?a[f].isResizable()&&a[f+1].isResizable():f<c?a[f].isResizable():a[f+1].isResizable(),m(d[f]).css("left",g+"px").toggleClass("s-rs-nomove",!h)}function F(a){"string"!==typeof a&&(a=m(a).closest(".th-ctl").attr("id"));return b.toIntSafe(b.tail(a,ga),-1)}function A(a){if(0>ha)return-1;for(var b=y.value(),c=E.getColumns(),d=0,e=b.length;d<e;){var f=b[d];if(a<f/2)break;a-=f;d++}if(d===ha||d===ha+1)return-1;d>ha&&d--;b=d<ha? -1:1;for(e=ha+b;0<=(d-e)*b;e+=b)if(!c[e]||k[c[e].getColumnKey()]){d=e-b;break}return d===ha? -1:d}function D(a){return a.csid}function G(a){Ba&&Ba.whenReady(function(){Ba.hide(a)});Ja&&Ja.whenReady(function(){Ja.hide(a)});ka.setValue(-1);Ea.setValue(0);m("body").unbind("click",B);l.widget.ni.popupHidden(X)}function B(a){a&&(Ba&&Ba.containsElement(a.target)||Ja&&Ja.containsElement(a.target))||G(!0)}function K(a){if(!a)return null;a=m.extend(!0,{params:{}},a);return p.find(na.value(),function(c){if(c.module!==a.module)
return!1;c=m.extend(!0,{params:{}},c);delete c.id;delete c.key;da.forEach(function(a){delete c.params[a]});return b.deepEquals(a,c)})}function J(a){if(!l.isReadOnly()&& !l.widget.automationOn.value()){var c;c=m(this).closest(".th-ctl");c=F(c.attr("id"));if(!(0>c)){var d=E.getColumns();c>=d.length||(c=d[c],n.isMainColumn(c)?O():(a=a.shiftKey,(d=c.getSortTransform())&&m.when(d).always(b.curry(V,c,a))))}}}function O(){var c=b.addAll([],R.copySpec().transforms),c=p.reject(c,function(b){return b.key===a.Type.SORTER});R.setTransforms(c)}function V(c,d,e){function f(a,b){return a.id===b.id}var g=K(e);e=g?m.extend(!0,{},g):m.extend(!0,{params:{desc: !c.isSortDescendingByDefault()}},e);e.key=a.Type.SORTER;e.params.desc= !e.params.desc;c=b.addAll([],R.copySpec().transforms);d|| !c.length?R.saveTransform(e):(e.id?(d=b.find(c,b.curry(f,e)),0<=d?c[d]=e:(delete e.id,c.push(e))):c.push(e),c=p.reject(c,function(a){return a.id!==e.id&&0<=b.find(na.value(),b.curry(f,a))}),R.setTransforms(c))}function U(a){return b.startsWith(a,"#")}function P(){var a=m(this),d,e;Ja||(Ja=new c(l),Ja.installTo(sa));e=a.closest(".th-ctl");d=F(e.attr("id"));if(0>d)return!1;var f=E.getColumns();if(d>=f.length|| !Y(d))
return!1;var h=e.find("a.th-ctl-cfg");window.setTimeout(function(){h&&h.addClass("th-ccnf-loading")},300);a=f[d];Ja.mQ(a.getColumnSpec(),! !r[a.getColumnKey()]).done(function(){Ja.alignWith(e,Q.width());Ja.pipeHeightTo(Ea);Ja.show({mj:function(a,c){c&&G();if(a){var e=E.getColumns()[d];!e||k[e.getColumnKey()]||b.deepEquals(a,e.getColumnSpec())||(ba.postEvent(g.gS,"view.changeColumn"),I.changeColumn(e.csid,a),Ka.forceUpdate())}},onColumnRemoved:function(){var a=f[d];!a||k[a.getColumnKey()]||r[a.getColumnKey()]||(G(),ba.postEvent(g.gS,"view.removeColumn"),I.removeColumn(a.csid),Ka.forceUpdate())}});l.widget.ni.lV(X,G);m("body").click(B)}).fail(G).always(function(){h.removeClass("th-ccnf-loading");h=null});return!1}function Y(a){var b=ka.value();-1!==b&&G();return b!==a?(ka.setValue(a),!0): !1}function N(a){var c="",d,e,f;d=0;for(e=a.length;d<e;d++)if(f=a[d],!k[f.getColumnKey()])var g=d==a.length-1&& !f.isColumnOfType("actions"),c=c+b.renderTemplate(
'<div class="th-ctl {ctlClass}{noActionsColumnClass}" id="{ctlId}"><div><div class="th-ctl-hi"><a class="th-ctl-cfg" title="{sw.widget.column.configure}"><i class="s-fa s-fa-caret-down"></i></a><div class="th-ctl-mv automation-on-warning"><div class="celldiv"><span class="value">{sort:html}{colName}</span></div></div></div></div></div>',{ctlClass:l.columnClass(d),ctlId:ga+d,colName:f.getName(),sort:0<d?'<span class="col-sort"><i class="alm"></i></span>':"",noActionsColumnClass:g?" s-last-col-but-not-actions":""});ta.children(".th-ctl").remove();m(c).appendTo(ta);m(".th-ctl-mv",ta).draggable(Da);m(".th-ctl-cfg",ta).click(P)}function L(){var a=E.getColumns();if(a.length){var c,d,e;for(c=0;c<a.length;c++)d=a[c],(e=d.getSortTransform())&&m.when(e).always(b.curry(fa,d))}}function fa(a,c){if(c){var d=E.getColumns();if(d.length){var e,f,g=K(c),h=function(a){a.toggleClass("alm-sort-desc",! !(g&&g.params&&g.params.desc));a.toggleClass("alm-sort-asc",!(!g|| !g.params||g.params.desc))},k=function(a,d){if(b.deepEquals(c,d)){var e=m("div."+l.columnClass(a)+" > .celldiv .col-sort > i",Z);e.length&&(h(e),e=m("div.th-ctl."+l.columnClass(a)+" .celldiv .col-sort > i",Z),e.length&&h(e))}};for(e=0;e<
d.length;e++)if(f=d[e],f.getCsid()===a.getCsid()){if(d=a.getSortTransform())d=m.when(d),"resolved"===d.state()&&d.done(b.curry(k,e));break}}}}var X=this,M=l.panel$,ba=l.bD(),E=l.af(),I=l.bW(),ma=l.ah(),R=l.getSpecController(),S=l.panelId,ga=S+"-st-tc-",da=e.getPlatformParams("sorter"),ia="structure_style_"+S,T= -Math.floor(.5),Aa=Math.floor(0),Z=m(".tableHeader",M);if(1!==Z.size())throw Error("THP cannot find .tableHeader");var va=m(".main",M);if(1!==va.length)throw Error("THP cannot find .main");var Q=m('<div class="st-hc"></div>').appendTo(Z),sa=m('<div class="st-hc-d"></div>').appendTo(Q),ta=m('<div class="th-ctls"></div>').appendTo(sa);m(b.renderTemplate('<div class="s-th-handle"><a href="#" class="s-ms-toggle-all s-ms-t-a-hc s-ms-{panelId}-all"></a></div>',{panelId:l.panelId})).appendTo(sa);var ya=m(b.renderTemplate('<div class="th-ccnf th-ccnf-asz"><a class="th-ccnf-asz-icon" title="{s.w.ccnf.autosize}"></a></div>')).appendTo(sa),qa=m(b.renderTemplate('<div class="th-ccnf th-ccnf-add"><a class="th-ccnf-add-icon" title="{s.w.ccnf.title}"><i class="s-fa s-fa-plus-square"></i></a></div>')).appendTo(sa),M=m(".secbody",M),aa=m('<div class="resizeIndicator"></div>').appendTo(M),la=
m('<div class="s-issue-cover s-ic-left"></div>').appendTo(M),oa=m('<div class="s-issue-cover s-ic-middle"><div class="s-ic-middle-fill"></div></div>').appendTo(M),pa=m('<div class="s-issue-cover s-ic-right"></div>').appendTo(M),Fa=(new b.Cell).setValue([]),y=(new b.Cell).setValue([]),ua=new b.Cell(y,function(a){var b=[],c=a.length;b.length=c+1;for(var d=0,e=0;e<c;e++)b[e]=d,d+=a[e];b[e]=d;return b}),Ea=(new b.Cell).setValue(0),na=(new b.Cell(R.bw(),l.widget.automationOn,function(b,c){return p.where(!c&&b&&b.transforms||[],{key:a.Type.SORTER})})).pipeChanges(function(){L()}),$;ta.on("click",".th-ctl-mv",function(a){$?(clearTimeout($),$=0):$=setTimeout(function(){$=0;b.safeCall(J,a.target,a)},500)});ta.on("dblclick",".th-ctl-mv, .s-resizer",function(a){clearTimeout($);$=0;if(!a|| !a.target)return!1;var c=F(a.target),d=null;if(0>c){d=m(a.target).closest(".s-resizer");if(!d.length||d.hasClass("s-rs-nomove"))return!1;c=b.indexOf(ta.children(".s-resizer"),d[0]);if(0>c)return!1}var e=E.getColumns(),f=E.eV(),h=[],k=null,l=null;d?(k=(a.altKey||0>f||c<f)&&e[c],l=(a.altKey||0>f||c>=f)&&e[c+1]):c!==f&&(k=e[c]);k&&k.isResizable()&&h.push(k.csid);l&&l.isResizable()&&h.push(l.csid);ba.fireEvent(
g.mh,h);a.preventDefault()});var xa=null,wa=b.lazy(function(){return b.isMac()&&m.browser.webkit&&0===d.getScrollBarSize().width}),ra=b.timeCache(1E4,function(){return Z.offset().left}),W=(new b.Cell).setValue(-1);Z.mousemove(function(a){W.setValue(a.pageX-ra())});var ca=(new b.Cell).setValue(!1),H=(new b.Cell).setValue(!1),ja=(new b.Cell).setValue(!1),ka=(new b.Cell).setValue(-1),M=new b.Cell(ca,H,ja,ka,W,y,function(a,b,c,d,e,f){return b||c|| -1!==d?2:a?1:0});M.pipeChanges(function(a,c){2===a?sa.stop(!0,!0).show():1===a?0===c&&sa.stop().hide().fadeIn(100):(b.assert(0===a,a),2===c?sa.stop(!0,!0).hide():sa.stop().fadeOut(200))});(new b.Cell(H,ja,b.or)).pipeChanges(function(a){Z.toggleClass("drag",! !a)});Z.hoverIntent({over:function(){ca.setValue(!0)},out:function(){ca.setValue(!1)},timeout:500,interval:50});var Ga= -1,ha= -1,Ia=(new b.Cell).setValue(-1);Ia.pipeChanges(function(a){0>a?aa.hide():(a>ha&&a++,a=ua.value()[a],aa.css("left",a-.5+"px").show())});var za=0,Da={axis:"x",containment:ta,appendTo:ta,scroll: !1,helper:function(){var a=F(this);ha=a;if(0>a)return m("<div></div>");var c=E.getColumns();if(a>=c.length)return m("<div></div>");a=c[a];return k[a.getColumnKey()]?m(
"<div></div>"):m('<div class="th-ctl-mv-helper"><div class="celldiv">'+b.htmlEscape(a.getName())+"</div></div>")[0]},start:function(a,b){if(!b.helper.length)return!1;ja.setValue(!0);za=b.helper.outerWidth(!1)},drag:function(a,b){if(!b.helper.length)return!1;var c=a.pageX-ra(),d=b.position.left;c<d?d=b.position.left=c:c>d+za&&(d=b.position.left=c-za);Ia.setValue(A(d+za/2));return!0},stop:function(a,c){var d=ha,e=A(c.position.left+za/2);ja.setValue(!1);ha= -1;Ia.setValue(-1);if(c.helper.length&&0<=e&&e!==d){var f=E.getColumns();if(e<f.length&&d<f.length){var h;e<d?(h=b.convertArray(f.slice(0,e),D),e=b.convertArray(f.slice(e,d),D),b.addAll(e,b.convertArray(f.slice(d+1),D))):(h=b.convertArray(f.slice(0,d),D),b.addAll(h,b.convertArray(f.slice(d+1,e+1),D)),e=b.convertArray(f.slice(e+1),D));ba.postEvent(g.gS,"view.moveColumn");I.moveColumn(f[d].csid,h,e);Ka.forceUpdate()}}}},Ba=null,Ja=null;f.apputil.initializeButton(qa);qa.click(function(){Ba||(Ba=new f.AddColumnPanel(l),Ba.whenReady(function(){Ba.installTo(sa)}));if(!Y(Ha))return!1;var a=qa.find("a.th-ccnf-add-icon");window.setTimeout(function(){a&&a.addClass("th-ccnf-loading")},300);var c=m(this);Ba.whenReady(function(){a.removeClass(
"th-ccnf-loading");a=null;Ba.alignWith(c,Q.width());Ba.show({mj:function(a){G();if(a){var c=E.getColumns(),d=b.convertArray(c,D),e;a.shouldOpenConfigurator&&(a=m.extend({},a),delete a.shouldOpenConfigurator,window.setTimeout(function(){var a=b.indexOf(b.convertArray(E.getColumns(),D),e);P.apply(m("#"+ga+a))},100));c=p.chain(c).collect(D).filter(U).value();ba.postEvent(g.gS,"view.addColumn");e=I.addColumn(a,d,[],c);Ka.forceUpdate()}},mN:G});Ba.pipeHeightTo(Ea);l.widget.ni.lV(X,G);m("body").click(B)});return!1});ma.register("addColumn",function(){qa.click();return!0});f.apputil.initializeButton(ya);ya.click(function(){ba.fireEvent(g.mh)});new b.Cell(ka,y,function(a,b){if(-1===a)la.hide(),oa.hide(),pa.hide();else if(a===Ha)pa.hide(),oa.hide(),la.css("width","100%").show();else{for(var c=0,d=b[0]||0,e=1;e<=a;e++)c+=b[e-1]||0,d+=b[e]||0;d+=1;la.css("width",c+"px").show();oa.css({left:c+"px",width:d-c+"px"}).show();pa.css("left",d+"px").show()}});var Ha="add",Ka=new b.Cell(M,y,W,H,ja,ka,function(a,b,c,d,e,f){if(0===a||d)return-1;if(e)return ha;if(f===Ha)return-1;if(0<=f)return f;a=0;for(d=b.length;a<d;a++){if(2.5>c)return-1;e=b[a];if(c<e-2.5)break;c-=e}return a===d? -1:a});
Ka.pipeChanges(function(a,b){0<=b&&m(".th-ctl."+l.columnClass(b)).removeClass("active");0<=a&&m(".th-ctl."+l.columnClass(a)).addClass("active")});ma=new b.Cell(M,y,W,H,ja,ka,function(a,b,c,d,e,f){if(0===a||e||f===Ha||0<=f)return-1;if(d)return Ga;a=0;for(d=b.length-1;a<d;a++){if(2.5>=Math.abs(b[a]-c))return a;c-=b[a]}return-1});ma.pipeChanges(b.curry(function(a,b){var c=ta.children(".s-resizer");c.removeClass(a);0<=b&&b<c.length&&(c=m(c[b]),c.hasClass("s-rs-nomove")||c.addClass(a))},"s-rs-active"));(new b.Cell(ma,function(a){if(0>a)return-1;var b=E.getColumns(),c=E.eV();return a<c?a:a+1<b.length?a+1: -1})).pipeChanges(function(a,b){if(0<=a){var c=E.getColumns();a<c.length&&c[a].isResizable()&&m(".th."+l.columnClass(a),Z).addClass("s-cl-rs-helper")}0<=b&&m(".th."+l.columnClass(b)).removeClass("s-cl-rs-helper")});(ma=l.bh())&&(new b.Cell(Fa,ma.hE(),function(a,c){return c?b.indexOf(a,c.column.csid): -1})).pipeChanges(function(a){var b=Z.children(".th");0>a?b.removeClass("s-col-edited"):(b.filter(":not(:eq("+a+"))").removeClass("s-col-edited"),b.filter(":eq("+a+")").addClass("s-col-edited"))});ka.pipeChanges(function(a){ba.fireEvent(0>a?g.bM:g.cv)});this[g.ko]=u;this[g.ar]=
b.bottlenecked(100,b.curry(q,10,h));ba.addListener(new b.Life,this);u(E,{columns: !0,columnWidths: !0});this.fO=function(){return Ea};this.ng=function(){return H};this.fL=function(){return ka}}})();define("structure/widget/dnd/DragModel",["underscore","almworks/jquery","almworks/util/Util","structure/widget/attributes/AttributeManager"],function(f,b,g,d){var e=namespace("almworks.structure.appevents");return function(a){function n(){B||(B=a.attributeManager.subscribe(),B.addDataUpdateHandler(function(){u&&c(!0)}));B.setDisplayedForestSpec(s.getSpecForAttributes());var b=new d.AttributeSet;a.attributeManager.collectAllUsedAttributes(b);B.setUsedAttributes(b);var e={};f.each(G,function(a){e[a.id]= !0});B.setUsedRows(e)}function c(a){D.empty();for(var b=G.length,c=0;c<b;c++){var d=G[c],e=q.aL(d.id),f=B.getValueAccessor(d.id),e=v.aS().tableRowTR(d.id,e,f,a).clone();g.updateClasses(e,V,U);d.row$=e;D.append(e)}}function p(){var a=A;if(a){var b=q.aD();D=A=null;u= !1;w=0;x=q=null;z=0;C= -1;F= !1;G=null;s.mH().remove(K);v=s=null;B.setDisplayedForestSpec(null);B.setUsedAttributes(new d.AttributeSet);B.setUsedRows({});a.remove();l.fireEvent(e.aq,b)}};function m(){u&&p();return!1}function k(){
if(!v||v.eN().value())return!1;var a=v.ae(),b=a.size();return 0>C||C>b? !1:(a=a.cf(C,z))?v===s&&a.under===x.under&&a.after===x.after? !0:v.isDropPossible(a,q,s): !1}function r(a){for(var b=0,c=G.length;b<c;b++){var d=G[b],e=a+q.rowDepth(q.indexOf(d.id));v&&v.getTitleRow()&&e--;e=h.getDepthOffset(Math.max(0,e));d.row$.find(".offset").stop().animate({"padding-left":e},300,"swing")}}var l=a.eventBus,h=a.config,u= !1,s=null,q=null,x=null,t= -1,w=0,v=null,C= -1,z=0,F= !1,A=null,D=null,G=null,B=null,K=function(a){u&&q&&a.oW(q.hf())},J=(new g.Cell).pipeChanges(function(a){s&&(a?s.mH().add(K):s.mH().remove(K))}),O= !1,V=["dragged"],U=["dragged","s-focused","hrow","hrowf","dimmed"];g.extend(this,{ef:function(d,f,g){if(u|| !d|| !f.length)return!1;var h=d.getTitleRow();if(h&&0<=f.indexOf(h))return!1;O= !1;if(!d.isMoveDragPossible(f))if(d.widget.panels.some(function(a){return d!==a&&a.isVisible()&& !a.isReadOnly()}))O= !0,g= !1;else return!1;s=d;h=s.ae();t= -1;for(var k=0,m=f.length;0>t&&k<m;k++)t=h.indexOf(f[k]);if(0>t)return!1;x=h.dI(t);if(!x)return!1;v=d;C=t;z=w=h.rowDepth(t);F= !0;q=s.dH().cD(f);l.fireEvent(e.mg,q,s);G=[];f=s.ao();h=0;for(k=q.size();h<k;){m=q.rowId(h);G.push({id:m});if(5<=
G.length)break;h=f.isExpanded(m)?h+1:q.bH(h)}b("#st-drag").remove();A=b('<div id="st-drag"></div>').data("new",!0);D=b('<div class="st-dnd-content"></div>').appendTo(A);A.append('<div id="st-dragcover"></div>');A.append('<span class="aui-lozenge s-dnd-n"></span>');n();c(!1);r(w);A.data("fixedHeight",G.length*a.config.getFixedRowHeight());u= !0;J.setValueForced(g);a.glass$.append(A);l.fireEvent(e.cr,q.aD());return!0},dp:function(a,d,f,h,m){if(!u)return!1;O&&(h= !1);var n=m||h!==J.value();J.setValue(h);if(m||a!==v||d!==C||f!==z){n= -1!==C;m=f!==z;var p=a!==v;v=a;C=d;z=f;p&&c(!0);(F=k())?A.removeClass("s-nodrop"):A.addClass("s-nodrop");m&&r(f)}n&&l.fireEvent(e.dP);a=F?h?"aui-lozenge-moved":"aui-lozenge-current":"aui-lozenge-error";d=q.size();f="sw.dnd.impossible.hint";F&&(f="sw.dnd.+"+(1<d?"n":"1")+"+.+"+(h?"move":"copy")+"+.hint");b(".s-dnd-n",A).text(g.text(f,d)).toggleClass("aui-lozenge-moved aui-lozenge-current aui-lozenge-error",!1).toggleClass(a,!0);return F},dM:m,fo:function(a,b){if(!u|| !x)return!1;if(!F|| !v)return m();var c=v.ae().cf(C,z);if(!c||v===s&&c.under===x.under&&c.after===x.after)return m();var d=q,e=s,f=v,h=v===s,k=h?null:e.getVersionedSpec().spec,l=h||
f.isUntransformedSpec(k),k=v.bg();k.jy();try{if(p(),l&&a)f.aZ().nP(d.hf(),c.under,c.after,"dnd");else{b||(b={});var n=a&&g.extend({rowIds:d.hf()},e.getVersionedSpec()),l=b,r= !a;f.aZ().bo(d,c.under,c.after,"dnd",l,n,r);for(var n=b,t=e.getAttributeSubscription(),w=f.getAttributeSubscription(),l=0,A=d.size();l<A;l++){var B=d.rowId(l),D=n[B];D&&w.fillTempRowData(t,B,D)}}}finally{k.ap()}e.cL(d,e,f,c);h||f.cL(d,e,f,c);return!0},dQ:function(){return u?C: -1},dW:function(){return u?z:0},dA:function(){return u?v:null},dV:function(){return u?s:null},ce:function(){return u?A:null},getStartIndex:function(){return t},fE:function(){return w},getDraggedForest:function(){return q},isDragging:function(){return u},isMoving:function(){return J.value()}})}});define("almworks/util/LCS",["almworks/util/Log"],function(f){function b(b,c){return 0>b||0>c?0:a[b*d+c]}var g=0,d=0,e=0,a=null;return{calculateMap:function(n,c){var p={};if(!n|| !c)return p;g=n.length;d=c.length;e=0;if(!g|| !d)return p;for(var m;0<g&&0<d;){m=n[g-1];if(m!==c[d-1])break;g--;d--;p[m]= !0}for(var k=Math.min(g,d);e<k;){m=n[e];if(m!==c[e])break;e++;g--;d--;p[m]= !0}if(!g|| !d)return p;a=Array(g*d);var r,l;for(m=0;m<g;m++)for(k=0;k<d;
k++)n[e+m]===c[e+k]?a[m*d+k]=b(m-1,k-1)+1:a[m*d+k]=Math.max(b(m-1,k),b(m,k-1));m=b(g-1,d-1);if(0!=m){r=m-1;m=g-1;for(k=d-1;0<=m&&0<=k&&0<=r;)l=n[e+m],l===c[e+k]?(p[l]= !0,m--,k--,r--):b(m,k-1)>b(m-1,k)?k-- :m--;-1!==r&&f.assert(-1==r,r+" "+m+" "+k+" "+n.slice(e,e+g)+" "+c.slice(e,e+d))}a=null;g=d=e=0;return p}}});define("structure/widget/ui/grid/Displacement",["almworks/util/Objects"],function(f){var b=namespace("almworks.structure.appevents");return function(g){function d(a,b){return a===b||a&&b&&a[0]===b[0]}function e(a,b){a.d!==b&&(a.d=b,a.row$&&a.row$.css("margin-top",0<b?b:""))}function a(){l&&(window.clearInterval(l),l=null)}function n(){for(var a=0,b=r[0];b;b=r[++a])e(b,0);r=[]}function c(a,b){var c=Math.min(a.d,b);0<c&&(e(a,a.d-c),b-=c);return b}function p(){if(0>=m|| !k)return a();var d=Math.max(0,Math.min(1,((new Date).getTime()-h)/300)),f=Math.max(0,Math.min(m,Math.round(Math.max(0,Math.min(1,-Math.cos(d*Math.PI)/2+.5))*m))),l;if(f===m)a(),n(),e(k,m),g.fireEvent(b.DISPLACEMENT_UPDATED);else if(d=f-k.d,!(0>=d)&&(e(k,f),0<d))for(f=0,l=r[0];0<d&&l;l=r[++f])d=c(l,d)}var m=0,k=null,r=[],l=null,h=0;f.extend(this,{fM:function(a){m=a},eU:function(b,f){if(!(0>=m)){if(k){if(d(
k.row$,b))return;r.push(k);k=null}for(var g=0,n=0,t=r[0];t;t=r[++n])g+=t.d,d(t.row$,b)&&(k=r.splice(n,1)[0],n--);k||(n=0,b&&(t=b.attr("style"))&&(t=/margin\-top\s*:\s*(\d+)px/.exec(t))&&t[1]&&(n=parseInt(t[1],10)||0),k={row$:b,d:n},g+=k.d);g=m-g;0<g&&e(k,k.d+g);if(!f&&0>g)for(n=r.length,t=k;0>g&&0<=n;t=r[--n])g= -c(t,-g);a();k.d<m&&(g=(new Date).getTime(),h=Math.round(g-k.d/m*300),l=window.setInterval(p,30))}},eZ:function(){a();m=0;k&&e(k,0);k=null;n()}})}});define("structure/widget/ui/grid/TablePresenter","almworks/jquery underscore almworks/util/Util almworks/util/LCS structure/widget/ui/grid/TRCache structure/widget/ui/grid/Displacement structure/widget/model/ForestUpdateEvent structure/widget/ui/UIUtil".split(" "),function(f,b,g,d,e,a,n,c){var p=namespace("almworks.structure"),m=namespace("almworks.structure.appevents");return function(k){function r(a){var b=a*M.getFixedRowHeight();$&&xa<a&&(b+=$);return b}function l(){if(y>Fa&& !ua.is(":animated")){var a=Math.max(y-ca.value(),Fa);y>a?(ua.height(y),ua.animate({height:a},{duration:800,easing:"swing",step:function(a,b){y=Math.ceil(a);u()},complete:function(){y=Fa;u()}})):(y=Fa,u())}Ea=null}function h(){var a=0,b=pa.value();if(b){
var c=b[1],b=E.indexOf(b[0]);0<=b&&(a=M.getFixedRowHeight()*b+c)}if(Fa===a)return!1;Fa=a;Ea&&(window.clearTimeout(Ea),Ea=null);ua.stop(!0,!1);a>y||0>=ca.value()?y=a:Ea=window.setTimeout(l,5E3);return!0}function u(){var a=E.size();if(qa!==a||aa!==$||la!==y||oa!==W.value()){qa=a;aa=$;la=y;oa=W.value();var b=qa*M.getFixedRowHeight()+aa,a=Math.max(b,la)+oa,b=Math.max(a-b,0);Q.height(a);g.Cell.prototype.multiUpdate(!0);try{ra.setValue(a),ca.setValue(b)}finally{g.Cell.prototype.multiUpdate(!1)}}}function s(a,b){b||(b=e.getRowIdFromTR(a));if(!b)return b;var c=[];ba.hasChildren(b)?I.isExpanded(b)?c.push("expanded"):c.push("collapsed"):c.push("leaf");I.bc()==b?c.push("s-focused"):ka&& !ka(b)&&c.push("dimmed");!k.isClipboard()&&ga.contains(b)&&c.push(ga.isCutMode()?"cut":"copy");S.isDragging()&&S.getDraggedForest().contains(b)&&c.push("dragging");var d=k.normalizedRootPaths.value();if(d){var f=k.roots.value();if(0<=g.indexOf(f,b))c.push("root");else for(f=0;f<d.length;f++)if(0<=g.indexOf(d[f],b)){c.push("rootpath");break}}k.widget.bF.visibleCell.value()&&(d=k.widget.bF.getRowStatus(b))&&c.push("s-h-"+d);da&&(d=da.fQ())&&d.getRowId()===b&&c.push("s-edited");g.updateClasses(a,c,Ga);return b}
function q(){return{cache:{},parent$:X.find(".issueArea"),get:function(a){if(this.cache.hasOwnProperty(a))return this.cache[a];var b=f('<div class="s-h-position '+a+'"></div>');this.parent$.prepend(b);return this.cache[a]=b}}}function x(a,b){if(!(a&&a.length||b&&b.length))return 0;var c=t(b,!0);0>c&&(c=t(a,!1));return Math.max(c,0)}function t(a,b){var c,d;if(a&&a.length)for(c=a.length-1;0<=c;c--)if(d=E.indexOf(a[c]),0<=d)return b?d=E.bH(d):d++,d;return-1}function w(a){var b,c,d;if(a&&a.length)for(b=0,c=a.length;b<c;b++)if(d=E.indexOf(a[b]),0<=d)return d;return-1}function v(a){var b,c;if(a&&a.length)for(b=a.length-1;0<=b;b--)if(c=E.indexOf(a[b]),0<=c)return c;return-1}function C(){var a=na.from,b=na.to;if(!(a>=b)){for(;a<b;a++){var c=E.rowId(a);z(c)}b=f("a.s-ms-"+k.panelId+"-all");b.length&&(a=I.kz(ba),b.toggleClass("s-ms-t-a-all",a===ba.size()),b.toggleClass("s-ms-t-a-some",0<a))}}function z(a){if(a&& !(na.from>=na.to)){var b=I.isSelected(a),c= !1,d=ba.indexOf(a),e,g,h;e=I.isExpanded(a);var l=ba.hasChildren(a)&& !e;if(0<=d&& !e)for(g=ba.bH(d),e=d+1;e<g;e++)if(h=ba.rowId(e),e===d+1)c= ! !I.isSelected(h);else if(! !I.isSelected(h)!==c){c=null;break}a=f("#s-ms-"+k.panelId+"-"+a);
a.length&&(b?(a.addClass("s-ms-on"),a.toggleClass("s-ms-auto","auto"===b),a.toggleClass("s-ms-none",l&& !1===c)):a.removeClass("s-ms-on s-ms-auto s-ms-none"),!0===c?a.removeClass("s-ms-some").addClass("s-ms-all"): !1===c?a.removeClass("s-ms-some s-ms-all"):a.removeClass("s-ms-all").addClass("s-ms-some"))}}function F(a,b,c){A(a,!0);var d=a.css("background-color")||"#ffffff";a.addClass("s-bganimation").animate({"background-color":"#ffffbb"},200,"swing");b?(a.addClass("s-bganimation-remove"),a.fadeOut(800,"swing",function(){var a=f(this);a.hasClass("s-bganimation-remove")&&a.remove();A(a);R.fireEvent(m.TR_ANIMATION_FINISHED,c,!0)})):a.animate({"background-color":d},800,"swing",function(){A(f(this));R.fireEvent(m.TR_ANIMATION_FINISHED,c,!1)})}function A(a,b){b&&a.stop(!0,!1);return a.removeClass("s-bganimation s-bganimation-remove").removeAttr("style")};function D(a){if(a&&a.length)for(var b=0,c=a.length;b<c;b++){var d=a[b],e=ma.TRByRowId(d);e.length&&s(e,d)}}function G(a){if(a&&a.length&&a.is(":visible")){var b=Y(),c=a.position().top;a=c+a.height();var d=M.getFixedRowHeight(),c=Math.max(c-d,0);a+=d;c<b.pxfrom?ja.setValue(c):a>b.pxto&&ja.setValue(a-(b.pxto-b.pxfrom))}}function B(a,b){
if(a){var d=E.indexOf(a);if(!(0>d)){var e=Y(),f=M.getFixedRowHeight(),g=d*f,h=e.pxto-e.pxfrom,k= -1;$&&xa<=d&&(g+=$);"number"===typeof b?(e=c.getViewportPixelPosition(h,f,b),k=J(g-e,h)):g<e.pxfrom?k=g:(d=g+f,da&&(f=da.fQ())&&f.rowId===a&&(d=Math.max(d,g+da.fS().value())),d>e.pxto&&(k=d-h));0<=k&&ja.setValue(k)}}}function K(){B(I.bc())}function J(a,b){a=Math.max(0,a);var c=E.size()*M.getFixedRowHeight(),d=a+b;d>c&&(a-=Math.min(a,d-c));return a}function O(){za= -1}function V(){var a= !1;try{a=document.activeElement}catch(b){}return a}function U(a){ta=sa.scrollTop();h();var b;u();var c=N();b=c.pxto-c.pxfrom;var l=M.getFixedRowHeight(),n=Math.ceil(b/l);b=E.size();var l=c.from,p=c.to,c=Math.ceil(Math.max(M.preloadRowsFactor,.5)*n/2),l=Math.max(0,l-c),p=Math.min(b,p+c);na.from<=l&&na.to>=p&&0<=na.from&&na.to<=b?b= !1:(l=Math.max(0,Math.floor(l-2*c)),c=Math.min(b,Math.ceil(p+2*c)),p=M.minCachedRows-(c-l),0<p&&(l=Math.max(0,l-Math.floor(p/2)),p=M.minCachedRows-(c-l),c=Math.min(b,c+p)),na.from=l,na.to=c,b= !0);if(b||a){a=V();b=[];c={};for(l=na.from;l<na.to;l++)(p=E.row(l))||g.error("null row in table presenter ["+l+"]["+na.from+"]["+na.to+"]"),p=p?p.getId(): -1,c[p]= !0,b.push(p);l=
f.extend({},c);p=na.from;if(!(0>p||p>=E.size()))for(p=E.aI(p);0<=p;p=E.aI(p))l[E.rowId(p)]= !0;ma.setUsedRows(l);var t=[],l={},y=ya[0],z,T,$,ua,Z=0,n=p=0,B=Aa.mw();for(T=y.firstChild;T;)$=T.nextSibling,1===T.nodeType&&(z=T.className,z="string"===typeof z&&Ia.exec(z),z||(z=e.getRowIdFromTRElement(T),c[z]?(t.push(z),l[z]=T,s(f(T),z)):(B[z]?F(f(T),!0,z):y.removeChild(T),Z++))),T=$;if(g.arrayEquals(b,t)){if(!g.isEmptyOrFalsy(B))for(c=0,y=b.length;c<y;c++)z=b[c],B[z]&&(T=l[z])&&F(f(T),!1,z)}else{y=t.length;if(0===y)$={};else if(1===y)$={},$[t[0]]= !0;else{T=null;c=0;for(y=b.length;c<y;c++)z=b[c],l[z]?T&&T.push(z):T||(T=b.slice(0,c));$=d.calculateMap(T||b,t)}t=null;c=0;for(y=b.length;c<y;c++)z=b[c],T=l[z],$[z]?g.assert(! !T):(T?(ua=f(T),n++):(ua=ma.tableRowTR(z),s(ua,z),T=ua[0],p++),t?ua.insertAfter(t):ua.prependTo(ya),ua.hasClass("s-bganimation")&&A(ua,!0)),B[z]&&($[z]&&(ua=f(T)),F(ua,!1,z)),g.assert(! !T),t=T;H.setValue(!0)}X.find(".s-h-position").remove();if(ua=ia.value())for(b=0;b<ua.changes.length;b++){var c=ua.changes[b],l=q(),n=c.forest.aD(),p=M.getFixedRowHeight(),B=w(n),L,Y;if(0<=B)n=v(n)+1,g.assert(n>B),B*=p,n*=p,"add"===c.operation||"copy"===c.operation||"move"===c.operation&&
 !k.widget.bF.isBeforeChange()?(T=l.get("s-h-bracket s-h-pos-to-start"),t=l.get("s-h-bracket s-h-pos-to-end")):(T=l.get("s-h-bracket s-h-pos-from-start"),t=l.get("s-h-bracket s-h-pos-from-end")),"move"===c.operation&&(k.widget.bF.isBeforeChange()?(L=x(c.parentPathTo,c.precedingSiblingsTo)*p,Y=l.get("s-h-marker s-h-pos-to")):(L=x(c.parentPathFrom,c.precedingSiblingsFrom)*p,Y=l.get("s-h-marker s-h-pos-from"))),c=T,l=B,p=t,B=Y,t=L,T=ra.value(),B&&(g.assert(t<=l||t>=n),t===l?0===t?(t=1,l=3):(t-=1,l+=1):t===n&&(t===T?(n=T-2-6+5,t=T-2+1):(n-=1,t+=1)),t-=1,t=Math.max(0,t),t=Math.min(T-2,t)),l=Math.max(0,l-1),n=Math.min(T-6,n-5),c.css("top",l).show(),p.css("top",n).show(),B&&B.css("top",t).show();else{var aa,D;if("add"===c.operation||"copy"==c.operation)B=l.get("s-h-marker s-h-pos-to"),n=x(c.parentPathTo,c.precedingSiblingsTo)*p;else if("move"===c.operation)B=l.get("s-h-marker s-h-pos-to"),n=x(c.parentPathTo,c.precedingSiblingsTo)*p,aa=l.get("s-h-marker s-h-pos-from"),D=x(c.parentPathFrom,c.precedingSiblingsFrom)*p;else if("remove"===c.operation)B=l.get("s-h-marker s-h-pos-from"),n=x(c.parentPathFrom,c.precedingSiblingsFrom)*p;else{g.assert(!1,c.operation);continue}c=B;l=n;p=aa;n=D;B=
ra.value();p&&(n==l&&(0===l?(l=1,n=3):l===B?(l=B-2-2+1,n=B-2+1):(l-=1,n+=1)),n-=1,n=Math.max(0,n),n=Math.min(B-2,n));l-=1;l=Math.max(0,l);l=Math.min(B-2,l);c.css("top",l).show();p&&p.css("top",n).show()}}C();ha();ya.css("top",r(na.from));I.restoreFocus();L=V();if(a&&L!==a&&a!==window&&a!==window.document){L=f(a);try{L.focus()}catch(qa){}L.closest(".s-editorpanel").length&&K()}R.fireEvent(m.kE)}}function P(a,b,c){return a<b?a:a<b+c?b:a-c}function Y(){u();var a=0<=za,b=a?za:ta,c=wa();return{animation:a,pxfrom:b,pxto:b+c}}function N(){var a=Y(),b=M.getFixedRowHeight(),c=E.size()-1,d=0;$&&(d=xa*b);var e=Math.min(c,Math.floor(P(a.pxfrom,d,$)/b)),b=Math.min(c,Math.ceil(P(a.pxto,d,$)/b)-1);return f.extend(a,{from:e,to:b,gappx:d})}function L(a){a&&D(a);var b=S.isMoving(),c=S.dA();a=1===Math.abs(S.getStartIndex()-S.dQ());b=b||c!==S.dV()|| !b&&(S.dQ()!==S.getStartIndex()||S.dW()!==S.fE());if(c===k){if(!Ka){Ka=b;var c=S.ce(),d=c.data("fixedHeight");$=b?"number"===typeof d?d:c.height():0;u()}b&&0<$?(Ba.fM($),b=S.isDragging(),c=S.dQ(),b&&(xa=c),b=null,S.isDragging()&&xa>=na.from&&xa<na.to&&(c=ya.children()[xa-na.from])&&(b=f(c)),Ba.eU(b,a)):fa()}else Ka&&fa()}function fa(){Ka= !1;$=0;xa= -1;
Ba.eZ();u()}var X=k.panel$,M=k.widget.config,ba=k.bs(),E=k.ae(),I=k.ao(),ma=k.aS(),R=k.bD(),S=k.widget.dJ,ga=k.widget.clipboard,da=k.bh(),ia=k.widget.bF.lg,T=k.eg().ng(),Aa=k.nX(),Z=k.getUnavailableCell(),va=new g.Life,Q=f(".issueArea",X);if(1!==Q.length)throw Error("TP cannot find .issueArea");var sa=Q.parent(),ta=0,ya=f(".cacheTable",Q);if(1!==ya.length)throw Error("TP cannot find .cacheTable");var qa=0,aa=0,la=0,oa=0,pa=(new g.Cell).setValue(null),Fa=0,y=0,ua=f("<div></div>"),Ea=null,na={from:0,to:0},$=0,xa= -1,wa=g.timeCache(1E3,function(){return sa.height()}),ra=(new g.Cell).setValue(0),W=(new g.Cell).setValue(0).pipeChanges(u),ca=(new g.Cell).setValue(0),H=new g.Cell(!1),ja=new g.Cell(0);(new g.Cell(H,ja,function(a,b){return a?b:null})).pipeChanges(function(a){if(null!==a)if(Da){var b={duration:100,easing:"swing",queue: !1,callback:O};za=a;sa.animate({scrollTop:a},b)}else sa.scrollTop(a),za= -1});var ka;(function(){function a(){!d||(new Date).getTime()<p.mouseTracker.timeStamp+5E3||b(null,2500,"linear")}function b(g,h,l){g&&d&&d.length&&g===d[0]||(d&&(!h||d.hasClass("s-focused")||d.hasClass("s-bganimation")?d.removeClass("hrow hrowf s-hrow-0"):c(h,l),d=null),e&&(
window.clearInterval(e),e=null),g&&(new Date).getTime()<p.mouseTracker.timeStamp+5E3&&(d=f(g),d.hasClass("s-focused")?d.addClass("s-hrow-0"):(d.hasClass("hrow")&&d.hasClass("s-bganimation")&&d.stop(!0,!0),d.addClass("hrow hrowf"),e=window.setInterval(a,500))))}function c(a,b){d.css("backgroundColor","#f0f0f0").removeClass("hrowf").addClass("s-bganimation");var e="#ffffff";d.is(".s-h-added, .s-h-copied, .s-h-movedTo")?e="#f3fff3":d.is(".s-h-removed, .s-h-movedFrom")&&(e="#fff3f3");d.animate({backgroundColor:e},{duration:a||200,easing:b||"swing",complete:function(){var a=f(this);a.removeClass("hrow s-hrow-0").css("backgroundColor","");window.setTimeout(function(){a.removeClass("s-bganimation")},1)}})}var d=null,e=null,g= -1,h= -1;ya.delegate("div.tr","mousemove",function(a){if(a){var c=a.pageX;a=a.pageY;if(c!==g||a!==h)g=c,h=a,T.value()||b(this)}}).delegate("div.tr","mouseleave",function(){this&&d&&d.length&&this===d[0]&&b(null)});f("body").keyup(function(){b(null)})})();(function(){ya.on("click",".s-upload-error",function(){k.widget.popupQuestion()})})();var Ga=
"leaf expanded collapsed dimmed s-focused nodata cut copy copied dragging rootpath root rootpathlast s-h-added s-h-movedTo s-h-movedFrom s-h-removed s-h-copied s-edited".split(" "),ha=da?g.delayed(50,da.je,da):g.returnTrue,Ia=/\bs-bganimation-remove\b/,za= -1,Da= !1,Ba=new a(R);this[m.eu]=function(a,b,c,d){b=ya.children(".s-focused");c=b.length?e.getRowIdFromTR(b):0;a!==c&&(c&&s(b,c),a&&(b=ma.TRByRowId(a),b.length&&s(b,a)));d&&a&&La()};this[m.bY]=function(a){a=s(a);z(a)};this.dispose=va.detach;var Ja=g.curry(U,!0);E.events.addListener(new g.Life,n.E,function(a,b){R.fireAfterDispatch("TP.UP",function(){U(!0);R.fireEvent(m.FOREST_UPDATE_DISPLAYED,a,b)})});k.rootPaths.pipeChanges(function(a,c){D(b.union(b.flatten(a||[]),b.flatten(c||[])))});var Ha=g.delayed(1E3,I.setRowScroll);this[m.ar]=function(){wa.reset();U(!1);Ha()};sa.scroll(g.seq(g.delayed(50,g.curry(U,!1)),Ha));this[m.be]=function(a,b){D(a);D(b)};var Ka= !1;this[m.dP]=L;this[m.cr]=L;this[m.aq]=L;this[m.am]=C;U(!0);R.addListener(va,this);var La=g.bottlenecked(250,K);da&&(pa=new g.Cell(da.hE(),da.fS(),function(a,b){return a&&b?[a.getRowId(),b]:null}),pa.pipeChanges(function(){h()&&u()}));g.extend(this,{aJ:La,io:B,
setViewPortScroll:function(a){var b=Y(),b=b.pxto-b.pxfrom,d=E.size()*M.getFixedRowHeight();a=c.getViewportPixelPosition(d,b,a);a=J(a,b);ja.setValue(a)},gC:function(){var a=ia.value();if(a){for(var b=0;b<a.changes.length;b++){var c=a.changes[b].forest;if(c&& !c.isEmpty()){var d=[],e=void 0,f=void 0,g=void 0,h=void 0;if(e=ba.getPath(c.rowId(0)))for(f=0,g=e.length;f<g;f++)h=e[f],I.isExpanded(h)||d.push(h);f=0;for(g=c.size()-1;f<g;f++)h=c.rowId(f),c.il(f)&& !I.isExpanded(h)&&d.push(h);d.length&&I.by(d,!0)}}a=a.changes[0];b=a.operation;c=a.forest.aD();a=w(c);0>a?"add"===b||"copy"==b||"move"===b&& !k.widget.bF.isBeforeChange()?G(X.find(".s-h-pos-to")):("remove"===b||"move"===b&&k.widget.bF.isBeforeChange())&&G(X.find(".s-h-pos-from")):(b=v(c)+1,c=Y(),d=M.getFixedRowHeight(),a*=d,b*=d,a>=c.pxfrom&&b<=c.pxto||(c=c.pxto-c.pxfrom,b-=a,b<=c&&(a=Math.max(0,a-Math.round((c-b)/2))),ja.setValue(a)))}},containerScrollTop:function(){return 0<=za?za:ta},cE:N,fm:function(a){var b=Y(),c=M.getFixedRowHeight();a=Math.min(b.pxto,Math.max(b.pxfrom,a));a=Math.floor(a/c);var d=E.size();a=Math.max(0,Math.min(d,a));return f.extend(b,{rowHeight:c,rowY:a*c,forestIndex:a})},issueAreaHeight:ra,
issueAreaExtraHeight:W,hM:ca,isRowVisible:function(a){var b=E.indexOf(a);if(0>b)return!1;a=Y();var c=M.getFixedRowHeight(),b=b*c;return b>=a.pxfrom&&b<=a.pxto-c},eQ:function(a){ka=a;a=ya.children();for(var b=0,c=a.length;b<c;b++)s(f(a[b]))},eK:function(){return ka},scrollpaneHeight:wa,scrollpane:sa,fs:Ja,gL:function(){0!=sa.scrollLeft()&&sa.scrollLeft(0)},animateRowById:function(a){var b=k.aS().TRByRowId(a);b&&F(b,!1,a)},getRowY:function(a){return Z.value()? -1:(a=ma.getCachedRowTR(a))&&a.parent().length?a.offset().top-ya.offset().top+ya.position().top: -1}})}});(function(){function f(a,b){this.actionId=h++;this.state=1;this.panel=a;this.adjustSpecs=b&&b.length?[].concat(b):a?[a.getVersionedSpec().spec]:[]}function b(a){f.call(this);this.data=a;this.panel=a.action.getPanel();this.adjustSpecs=a.action.adjustSpecs}function g(a){a=a[0];if(!(a instanceof b))return null;var c=a.data.applied?e.ajax.RESOURCES2g.EFFECT.UNDO:e.ajax.RESOURCES2g.EFFECT.REDO,d=a.getPanel().widget;a.jobId?(d={jobId:a.jobId},a.jobId=null):d={effectIds:a.data.effects,forest:{spec:a.adjustSpecs[0],version:d.forestCache.getCurrentVersion(a.adjustSpecs[0])},items:{version:d.attributeManager.getItemsVersion()}};
return{count:1,url:c,data:e.apputil.ct(d),cB: !0}}function d(d){function f(b){if(b.priority)L.length&&L[0]===b||(L=l.filter(L,function(a){return b.isOverridingAction(a)?(d.clearQuestion(a),!1): !0}),L=a.addAll([b],L));else{var c=L.length-1,g=L[c];if(g&&(1===g.state||4===g.state)&&b.isOverridingAction(g)){d.clearQuestion(g);L[c]=b;c=b.getForestUploadAdjusts(N);a.addAll(c,g.getForestUploadAdjusts(N));c.forEach(function(a){a.al(!0)});try{g.removeUploadAdjustments(N),b.addUploadAdjustments(N)}finally{c.forEach(function(a){a.al(!1)})}}else L.push(b),b.addUploadAdjustments(N)}fa=0<L.length;for(g=0;g<L.length;g++)if(b=L[g],4===b.state){d.popupQuestion();return}e.modes.DEVMODE||ma();Y.fireEvent(n.aE,O)}function h(){if(!M&&L.length&& !ga&&4!==L[0].state){if(E){var b=(new Date).getTime();if(b<E){I||(I=window.setTimeout(h,E-b+50));return}}I=null;for(b=E=0;b<L.length&&1===L[b].state;)b++;for(var c=null,d=0,e={};!c&&d<b;){for(var f=L.slice(d,b),g=0;g<X.length&& !(c=X[g].dw(f,e));g++);c||(a.flipSet(f[0].getAffectedRows(),null,e),d++)}c?(c.skipped=d,v(c)||window.setTimeout(h,100)):fa= !1;Y.fireEvent(n.aE,O)}}function p(e,f,g,h){ba=0;g=g||{};var q,s,t,x,w=e[0].getPanel(),C=e[0],v,T,F=
C.getForestLocalLatests(N);F.forEach(function(a){a.jy()});try{var y=C.getForestUploadAdjusts(N);y.forEach(function(a){a.al(!0)});try{var ua=g.successfulActions||0;for(q=0;q<ua;q++)x=e[q],a.assert(w===x.getPanel()),a.assert(2===x.state,q+" "+x),s=a.indexOf(L,x),a.assert(0<=s,q+" "+s+" "+x),0<=s&&L.splice(s,1),x.removeUploadAdjustments(N);var B=g.effects;if(B&&B.length){k.showEffects(l.flatten(l.pluck(B,"effects")));var na=g.undoEffects;if(na&&na.length){x=e[ua-1];var $=da.value();if($&&$.action===x&& !$.effects)if(B=l.indexBy(B,"batchId"),na=l.filter(na,function(a){return(a=B[a])&&a.effects&&l.some(l.pluck(a.effects,"reversible"))}),na.length)da.setValue(a.extendOwn({},$,{effects:na}));else for(q=0;q<ua;q++)J(e[q])}}var D=g.problems;D&&D.length&&k.showProblems(D);var G=g.updateError,E= ! !g.fieldErrors;T=g.jobId;t=e.length;if(ua<t){var K=e[ua];for(q=ua+1;q<t;++q)x=e[q],a.assert(2===x.state,q+" "+x),x.state=1;if(G||E)K.state=4;if(G){K.result=a.extendOwn({itemId:g.itemId},G);var M=K.getErrorRows(),H=K.getPanel()&&K.getPanel().aS();if(H)for(x=0;x<M.length;x++)H.aM(M[x]);d.popupQuestion(K)}else T&&(K.state=3,K.jobId=T,l.defer(function(){O.retryWithDecision(K)}))}if(!T){var ia=h?f.es:
f.eI;ia&&a.safeCall(ia,g,g)}}finally{y.forEach(function(a){a.al(!1)})}var I=g.forestUpdates,fa=g.itemsUpdate;if(I||fa){v={};I&&(v.forests=c.parseForestUpdates(I,g.itemTypes));fa&&(v.items=c.parseItemsUpdate(fa,g.itemTypes));var X=l.some(e,function(a,c){return a instanceof b&&c<ua});m.setAddingAnimatedRowsEnabled(X);try{Y.fireEvent(n.POLL_RESULT,v)}finally{m.setAddingAnimatedRowsEnabled(!0)}}var P=g.oldRowIds,R=g.newRowIds;if(I&&P&&R&&P.length&&P.length===R.length){var S=C.adjustSpecs[0];S||a.warn("row replacement without base forest spec");q=0;for(t=P.length;q<t;q++){var U=P[q],V=R[q];for(s=0;s<ua;s++)e[s].aB(U,V);S&&z(function(a){r.areUntransformedSpecsEqual(S,a.adjustSpecs[0])&&a.aB(U,V);return!0})}S&&Y.fireEvent(n.REPLACE_ROW_IDS,P,R,S)}}finally{F.forEach(function(a){a.ap()})}if(g.errors)for(e=g.errors,q=0,t=e.length;q<t;q++)A(w,e[q]);d.confluenceErrorHanlder.checkErrors(g);if(!v&& !T&&f.cB|| !h)h&& !1!==g.success&&a.isDebugging()&&a.debug("UQ:no update"),Y.fireEvent(n.REQUEST_POLL)}function t(a,b,c){S===b.life&&p(a,b,c,!0)}function w(b,c,d,f){if(S===c.life){var g;a:if("timeout"===f||"connection"===f)g= !1;else{try{g=d.status}catch(h){g= !1;break a}g=g? !T[g]: !1}if(g){f=
a.httpErrorReport(d,f);g=1===c.count?"When uploading change:":"When uploading "+c.count+" structure changes:";var l=a.text("sw.error.upload-forest",f.title),k=l;try{if(0<d.status){var m="s.w.error.upload.http."+d.status,k=a.text(m,f.title);k===m&&(k=l)}}catch(n){}P.reportError(new e.error.AppError(k,l+"\n"+g+"\n"+f.details));p(b,c,{successfulActions:b.length,report:f},!1)}else{c=0;for(d=b.length;c<d;c++)m=b[c],a.assert(2===m.state,c+" "+m),f=a.indexOf(L,m),a.assert(f===c,c+" "+f+" "+m),m.state=1;ba=Math.floor(Math.min(Math.max(3E3,1.5*ba),3E4));E=(new Date).getTime()+ba}}}function v(b){a.assert(!M,this);var c=b.count;if(!c)return!1;M= !0;var d=b.skipped||0,c=L.slice(d,c+d),d=new V.Task(b.url,e.ajax.UPLOAD,a.curry(t,c,b),a.curry(w,c,b));d.type="POST";d.data=b.data;for(var f=0,g=c.length;f<g;f++)a.assert(1===c[f].state),c[f].state=2;var l=d.complete;d.complete=function(){if(S===b.life){M= !1;l.call(this);fa=0<L.length;if(0===L.length||4===L[0].state){var c=R;R=[];for(var d=0,e=c.length;d<e;d++)a.safeCall(c[d])}else h();Y.fireEvent(n.aE,O)}};b.ax&&R.push(b.ax);b.life=S;V.addTask(d);return!0}function C(a){return 2!==a.state}function z(a){return F(a,C)}function F(b,c){c=c||a.returnTrue;
var d=0,e=[],f=[],g,h,l,k,m,p;try{for(;d<L.length;)g=L[d],c(g)?(g.getForestUploadAdjusts(N).forEach(function(a){f.push(a);a.al(!0)}),l=g.getForestAdjustments(),h=b(g),l.isEmpty()||(m=h?g.getForestAdjustments():null,g.adjustSpecs.forEach(function(a){k=l.get(a);p=m&&m.get(a);k!==p&&N.dC(a).replace(k,p)})),h?d++ :a.addAll(e,L.splice(d,1))):d++}finally{f.forEach(function(a){a.al(!1)})}(d=da.value())&& !b(d.action)&&(G(),da.setValue(null));0<e.length&&Y.fireEvent(n.aE,O);return e}function A(b,c){var d=c.itemId||"",d=c.itemDescription||d,f=c.code||0,g=c.message||"",h="s.w.error."+f,l=a.text(h,d);l===h&&(l=d?a.text("s.w.error.upload-generic.item",d):a.text("s.w.error.upload-generic"));P.reportError(new e.error.AppError(l,l+"\n\nError "+f+"\n"+g))}function D(c){var g=da.value();if(!g|| !g.action||"undo"===c&& !g.applied||"redo"===c&&g.applied)return!1;G();ia=window.setTimeout(B,e.pf);if(g.effects)f(new b(g));else if(g.applied){c=L.length-1;var h=L[c];h!==g.action||1!==h.state&&4!==h.state?c= !1:(d.clearQuestion(h),L.splice(c,1),h.removeUploadAdjustments(N),fa=0<L.length,e.modes.DEVMODE||ma(),Y.fireEvent(n.aE,O),c= !0);if(!c)return!1}else g.action.getPanel().nX().aO(
g.action.getAffectedRows()),f(g.action.reset());da.setValue(a.extendOwn({},g,{applied: !g.applied}));return!0}function G(){ia&&(window.clearTimeout(ia),ia=null)}function B(){var b=da.value();b?(da.setValue(a.extendOwn({fading: !0},b)),ia=window.setTimeout(K,e.nY+500)):ia=null}function K(){da.setValue(null);ia=null}function J(a){var b=da.value();b&&b.action===a&&(G(),da.setValue(null))}var O=this,V=d.ajax,U=d.config.uploadDelay||0,P=d.errorCentral,Y=d.eventBus,N=d.forestCache,L=[],fa= !1,X=[],M= !1,ba=0,E=0,I=null,ma=0>=U?a.noop:a.delayed(U,h),R=[],S=1,ga=null,da=new a.Cell(null),ia=null,T=a.flipSet([204,304]);a.extend(this,{enqueue:function(b,c){b&&(a.assert(1===b.state),c?(G(),ia=window.setTimeout(B,e.pf),da.setValue({i18nKey:c,action:b,applied: !0})):b.forestAction&&(G(),da.setValue(null)),f(b))},aF:function(a){X.push(a)},updateActions:F,dv:z,clear:function(a){S++;l.filter(L,function(b){return a?a===b.getPanel(): !0}).forEach(function(b){b.removeUploadAdjustments(a.widget.forestCache);J(b);d.clearQuestion(b)});L=a?l.filter(L,function(b){return a!==b.getPanel()}):[];0===L.length&&(M= !1,ba=E=0,I&&(window.clearTimeout(I),I=null),R=[],fa= !1,G());da.setValue(null);Y.fireEvent(n.aE,
O)},isEmpty:function(a){return a? !l.filter(L,function(b){return a===b.getPanel()}).length: !L.length},isIdle:function(){return!fa&& !M|| ! !ga},iv:function(){return ga},iP:function(b){a.assert(b,b);a.assert(!ga,ga+" "+b);ga=b;fa= !1;Y.fireEvent(n.aE,O)},hx:function(b){a.assert(b,b);a.assert(ga===b,ga+" "+b);ga===b&&(ga=null,fa=0<L.length,e.modes.DEVMODE||ma(),Y.fireEvent(n.aE,O))},jk:function(a){return! !ga&& !this.isEmpty(a)},og:function(){return da},acknowledgeFailed:function(a){d.clearQuestion(a);L.splice(L.indexOf(a),1);fa=0<L.length;a.tempRowId&&a.tempRowId===ga&&(ga=null);var b=a.getErrorRows(),c=a.getPanel().aS();a.result=null;a.removeUploadAdjustments(N);J(a);e.modes.DEVMODE||ma();for(a=0;a<b.length;a++)c.aM(b[a]);Y.fireEvent(n.aE,O)},retryWithDecision:function(a){d.clearQuestion(a);a.state=1;fa=0<L.length;a.tempRowId&&a.tempRowId===ga&&(ga=null);e.modes.DEVMODE||ma();Y.fireEvent(n.aE,O)},hasUploadErrors:function(a){for(var b,c=0;c<L.length;c++)if(b=L[c],-1<b.getErrorRows().indexOf(a))return!0;return!1}});this.aF({dw:g});d.globalActions.register("_uploadTree",h);d.globalActions.register("undoOrRedo",a.curry(D,"auto"));d.globalActions.register("undo",a.curry(D,"undo"));
d.globalActions.register("redo",a.curry(D,"redo"))}var e=namespace("almworks.structure");namespace("almworks.structure.ajsbridge");var a=namespace("almworks.util"),n=namespace("almworks.structure.appevents"),c=require("structure/widget/poll/Deserializer"),p=require("almworks/util/ObjMap"),m=require("structure/widget/ui/panel/AnimatedRowsBuffer"),k=require("structure/widget/EffectNotifications"),r=require("structure/widget/spec/SpecController"),l=require("underscore"),h=1;a.extend(f.prototype,{aj:function(){a.pvc()},bN:function(b){a.pvc()},isOverridingAction:function(a){return!1},getInverseAction:function(){return null},aB:function(a,b){return!1},getForestAdjustments:function(){var a=this,b=new p;this.adjustSpecs.forEach(function(c){b.put(c,a.bN(c))});return b},getForestUploadAdjusts:function(a){return this.adjustSpecs.map(function(b){return a.dC(b)||new e.DataForest})},getForestLocalLatests:function(a){return this.adjustSpecs.map(function(b){return a.gP(b)||new e.DataForest})},addUploadAdjustments:function(a,b){b=b||this;this.adjustSpecs.forEach(function(c){var d=a.dC(c);d&&d.add(b.bN(c))})},removeUploadAdjustments:function(a,b){b=b||this;this.adjustSpecs.forEach(function(c){var d=
a.dC(c);d&&d.remove(b.bN(c))})},toString:function(){try{return "upload: "+e.apputil.ct(this.aj())}catch(a){return "?"+a+"?"}},reset:function(){this.state=1;return this},getAffectedRows:function(){return[]},getPanel:function(){return this.panel},getErrorRows:function(){var a=[];if(this.result){var b=this.result.error,c=this.result.interactions;if(b)a.push(b.row);else if(c)for(b=0;b<c.length;b++)a.push(c[b].row)}return a},appendParameter:function(a,b){this.spec&&(this.spec.parameters||(this.spec.parameters={}),this.spec.parameters[a]=b);if(this.result&&this.result.interactions){var c=this.result.interactions;if(c.length)for(var d=0;d<c.length;d++)if(c[d].parameter===a){c.splice(d,1);break}}},hasMoreInteractions:function(){return! !(this.result&&this.result.interactions&&this.result.interactions.length)}});a.extendOwn(b.prototype,f.prototype,{bN:a.noop});d.STATE_PENDING=1;d.STATE_UPLOADING=2;d.STATE_PROCESSING=3;d.STATE_BLOCKING=4;e.cA=d;e.bG=f})();(function(){var f=namespace("almworks.structure"),b=namespace("almworks.util"),g={up:"up",down:"down",o:"openIssue","shift+o":"toggleIssueDetailsNoFocus",left:"collapseOrMoveToParent",right:"expandOrMoveToNext",pageup:"pageUp",pagedown:
"pageDown",home:"pageHome",end:"pageEnd",escape:"cancelMode","shift+escape":"cancelMode",f2:"toggleEditMode",tab:"nextEditableField","shift+tab":"prevEditableField","alt+plus":"expandNextLevel","alt+=":"expandNextLevel","alt+=plus":"expandNextLevel","alt+shift+=":"expandNextLevel","plus,plus":"expandAll","=,=":"expandAll","=plus,=plus":"expandAll","shift+=,shift+=":"expandAll","shift+=,=":"expandAll","alt+minus":"collapseNextLevel","alt+-":"collapseNextLevel","minus,minus":"collapseAll","-,-":"collapseAll","i,d,d,q,d":"debugActions","t,=":"addColumn","t,plus":"addColumn","t,t":"addColumn","delete":"deleteSubtree","\\":"tabFocusPanel","ctrl+]":"historyOlderVersion","ctrl+[":"historyNewerVersion",".":"jira.showActions",a:"jira.assign",e:"jira.edit","alt+down":"jira.actions.dropdown",m:"jira.comment",space:"toggleSelected","shift+down":"selectDown","shift+up":"selectUp","shift+pageup":"selectPageUp","shift+pagedown":"selectPageDown","shift+home":"selectPageHome","shift+end":"selectPageEnd","shift+right":"selectSubtrees","shift+left":"selectRoots","ctrl+.":"togglePin","ctrl+alt+up":"upEditableField","ctrl+alt+down":"downEditableField","ctrl+alt+left":"leftEditableField",
"ctrl+alt+right":"rightEditableField","i,i":"viewThumbnails","v,v":"view.select","v,s":"view.save","v,r":"view.revert","v,s,s":"view.save-as",g:"-- pass --","ctrl+alt+1":"layout.single","ctrl+alt+2":"layout.double","ctrl+alt+3":"layout.details","ctrl+alt+4":"layout.history","ctrl+alt+num_1":"layout.single","ctrl+alt+num_2":"layout.double","ctrl+alt+num_3":"layout.details","ctrl+alt+num_4":"layout.history","alt+\\":"swapPanels","`":"toggleAutomation","shift+`":"toggleAutomation","q,q":"toggleQuickTransform","r,r":"toggleUnresolved","ctrl+alt+/":"focusSearch","ctrl+alt+;":"toggleSearchFilter","ctrl+alt+shift+/":"toggleSearchFilter","ctrl+alt+[":"prevHighlighted","ctrl+alt+]":"nextHighlighted","s,s":"selectStructure","ctrl+alt+apos":"toggleQuery","s,q":"quickActions",z:"fullScreen.toggle",formattedShortcuts:{toggleEditMode:"F2"}};["=,","plus,","=plus,"].forEach(function(a){for(var b=1;8>=b;b++){var c="expandLevel."+b;g[a+b]=c;g[a+"num_"+b]=c}});for(var d=1;9>=d;d++){var e="quick-transform.toggle."+d;g["q,"+d]=e;g["q,num_"+d]=e}b.isMac()?b.extend(g,{"ctrl+meta+up":"moveUp","ctrl+meta+down":"moveDown","ctrl+meta+left":"levelUp","ctrl+meta+right":"levelDown","ctrl+up":"moveUp",
"ctrl+down":"moveDown","ctrl+left":"levelUp","ctrl+right":"levelDown","meta+c":"copy","meta+x":"cut","meta+v":"paste","meta+shift+v":"pasteUnder","meta+a":"toggleSelectAll","meta+z":"undo","meta+shift+z":"redo","ctrl+shift+\\":"addColumn","meta+\\":"addColumn"}):(b.extend(g,{"ctrl+up":"moveUp","ctrl+down":"moveDown","ctrl+left":"levelUp","ctrl+right":"levelDown",insert:"createChild","ctrl+c":"copy","ctrl+x":"cut","ctrl+v":"paste","ctrl+shift+v":"pasteUnder","shift+delete":"cut","shift+insert":"paste","shift+alt+insert":"pasteUnder","ctrl+a":"toggleSelectAll","ctrl+z":"undo","ctrl+shift+z":"redo","ctrl+shift+\\":"addColumn"}),b.extend(g.formattedShortcuts,{createChild:b.formatShortcut("insert")}));f.keymap=b.lazy(function(){if(f.modes.GH_TAB)return b.extendOwn(g,{t:"gh.closeDetails",minus:"gh.toggleSwimlanes","-":"gh.toggleSwimlanes","s,t":"gh.sendToTop","s,b":"gh.sendToBottom"}),g;b.extendOwn(g,{enter:"addItem","shift+enter":"addChildItem","alt+enter":"addItemAbove"});f.modes.ISSUE_PAGE||b.extendOwn(g,{k:"up",j:"down"});f.modes.GADGET||b.extendOwn(g,{"ctrl+/":"showShortcuts","ctrl+shift+/":"showShortcuts"});f.modes.GADGET&&"local"!==f.modes.GADGET||b.extendOwn(g,{l:"jira.labels"});
return g})})();(function(){var f=namespace("almworks.structure"),b=namespace("almworks.util"),g=namespace("almworks.structure.appevents"),d=f.$;f.AjaxNotifier=function(e,a){function f(){var a= !m.isIdle()||c.isLoading()||k.isLoading()? !0: !1;a!==l&&(l=a,r.css({visibility:a?"visible":"hidden"}))}var c=e.fk,p=e.eventBus,m=e.ad,k=e.bF,r=d('<span class="st-progress-icon"></span>').appendTo(a),l=null,h=b.delayed(200,f);this[g.aE]=h;this[g.ROW_DATA_LOADING_STATE_CHANGED]=h;this[g.cQ]=h;p.addListener(new b.Life,this);f()}})();(function(f){function b(b,e){function g(a){var b=a.keyCode,d=c.ui.keyCode,e=c(a.target);e.is("textarea, :text, select, :radio")||e.is(".form-body")&&e.closest("#structure-shortcuts-dialog").length||b!==d.DOWN&&b!==d.UP&&b!==d.LEFT&&b!==d.RIGHT||a.preventDefault()}var r=b.globalActions;if(n){var l=d.ajsbridge.localURL("/secure/ViewStructureShortcuts.jspa");a.isMac()&&(l+="?mac=true");var h=n.$(a.renderTemplate('<a id="structure-help" class="item-link" title="{s.w.kbdhelp.title}" href="{url}">{s.w.kbdhelp.label}</a>',{url:l})).appendTo(e),u=new(n.FormPopup||f.JIRA&&f.JIRA.FormDialog)({id:"structure-shortcuts-dialog",trigger:"#structure-help",widthClass:"large",
onContentRefresh:function(){this.dialogEverShown= !0},ajaxOptions:{url:l}}),s=n.consumesKeyboardEvents;"function"===typeof s?n.consumesKeyboardEvents=function(a){return s(a)||a.is(".form-body")&&a.closest("#structure-shortcuts-dialog").length? !0: !1}:(l=n.enableKeyboardScrolling,"function"===typeof n.disableKeyboardScrolling&&"function"==typeof l&&(n.disableKeyboardScrolling=function(){c(document).bind("keypress keydown",g)},n.enableKeyboardScrolling=function(){c(document).unbind("keypress keydown",g)}));u._focusFirstField=function(){this.get$popupContent().find(".form-body").css("outline-style","none").attr("tabIndex","-1").attr("contenteditable","false").focus()};r.register("showShortcuts",function(){return b.div$.is(":visible")?(u.show(),!0): !1});this.place$=e;this.link$=h}}function g(d){var e,f=d.div$.find(".s-info-link"),g=c(".s-info-link-a",f);g.length||(g=c(a.renderTemplate('<a class="s-info-link-a" href="#" title="{s.w.info.tooltip}"><i class="s-fa fw s-fa-info-circle"></i>{s.w.info.label}</a>')).appendTo(f));d.hints||(d.hints=new b(d,n.$("<div></div>")));e=n.InlineDialog(n.$(g[0]),"structure-info",function(b,c,f){if(!b.data("s-initialized")){b.data("s-initialized",!0);c=
d.jiraConfig.lf()||"?";var g=d.jiraConfig.getJiraClusterNodeId();b.html(a.renderTemplate(
'<div id="s-info-dialog-contents"><div class="s-info-header">{s.w.info.version,version}<div class="s-info-node-id">{nodeId}</div></div><ul class="s-info-links"><li><span class="st-kbdhelp"></span> ({shortcut:html})</li><li><a href="http://almworks.com/structure/help/widget-overview" target="strhelp" title="{s.w.help.tooltip}">{s.w.help.label}</a></li><li class="s-section"><span>{s.w.info.support.label}</span><ul><li><a href="http://almworks.com/structure/support-request" target="strhelp" title="{s.w.info.support.ticket.title}">{s.w.info.support.ticket.label}</a></li><li><a href="mailto:support@almworks.com?subject=Structure%20Support%20Request%20(version%20{encodedVersion})" title="{s.w.info.support.mail.title}">{s.w.info.support.mail.label}</a></li></ul></li><li class="s-section"><span>{s.w.info.feedback.label}</span><div>{s.w.info.feedback.text}</div><ul><li><a id="s-uservoice-link" href="http://almworks.com/structure/suggest-idea" target="_blank" title="{st.widget.uservoice.title}">{st.widget.uservoice.label}</a></li><li><a href="mailto:structure@almworks.com?subject=Structure%20Feedback%20(version%20{encodedVersion})" title="{s.w.info.feedback.mail.title}">{s.w.info.feedback.mail.label}</a></li></ul></li></ul><div class="s-info-footer">{s.w.info.footer}</div></div>',
{version:c,encodedVersion:encodeURIComponent(c),shortcut:a.formatShortcut("ctrl+?"),nodeId:g}));d.hints.link$.detach().appendTo(n.$(b.find(".st-kbdhelp")[0]))}f();d.ni.lV(e,e.hide)},{hideDelay:8E3,width:250,offsetX: -180,hideCallback:function(){d.ni.popupHidden(e)}})}var d=namespace("almworks.structure"),e=namespace("almworks.structure.appevents"),a=namespace("almworks.util"),n=f.AJS,c=n&&n.$;d.setupEmptyMasterHint=function(b){function c(){!1!==l&&(l= !1,g&&(g.remove(),g=null),f.detach())}if(!b.__emptyMasterHintSetUp){b.__emptyMasterHintSetUp= !0;var f=new a.Life,g=null,l= !1;c();var h={};h[e.STRUCTURE_CHANGED]=c;h[e.kl]=c;h[e.cr]=c;h[d.ForestUpdateEvent.E]=a.delayed(50,c);h.valueChanged=c;b.eventBus.addListener(f,h);b.master.bd().events.addListener(f,h)}};d.ep=function(a){};d.kN=g;d.reviveHelpPanels=function(a){g(a)}})(window);(function(){var f=namespace("almworks.structure");namespace("almworks.structure.appevents");var b=namespace("almworks.util");f.fp=function(g){var d=new f.DataForest,e=g.master.bd(),a=(new f.ExclusionForest).setSource(d).setExcludeFrom(e);g.ad.og().pipeChanges(function(b){d.isEmpty()||b||d.aH(a.as())});b.extend(this,{addDeleted:function(a){var b=0,e=d.size();
0<e&&(b=d.ak(e-1,0));d.bo(a,0,b)},getDisplayedForest:function(){return a}})}})();define("structure/widget/ui/panel/ForestFilter","underscore structure/widget/spec/SpecController structure/widget/model/ForestIndex structure/widget/model/ForestUpdateEvent structure/widget/model/Items almworks/util/Util".split(" "),function(f,b,g,d,e,a){return function(f){function c(a,b){return a?b&&b.getSource()===a?b:new g(a):null}function p(){f.bn().eQ(q.value())}var m=null,k=new a.Lifecycle,r=null,l=new a.Lifecycle,h=new a.Cell,u=new a.Cell(null),s=(new a.Cell(null)).pipeChanges(function(a){f.dR().gy("search",a)}),q=(new a.Cell(u,s,function(b,c){return c?a.fand(b,c):b})).pipeChanges(p);(new a.Cell(h,f.getSpecController().bw(),f.widget.automationOn,function(a,c,d){return a||(d?null:b.getSpecForFilter(c,f.widget.transformRegistry))})).pipeChanges(function(c){var e=null;k.cycle();m&&(m.unsubscribe(),m=null);c&&(c=b.getRestSpec(c,f.widget.transformRegistry),m=f.widget.forestCache.subscribe(c),c=m.getForest())&&(e=a.curryThis(c,c.contains),c.events.addListener(k,d.E,a.delayed(100,p)));u.setValue(e)});return a.extendOwn(this,{filterRowsBySpec:function(a){h.setValue(a)},filterItems:function(a,b){
function g(a,c){if(f.isClipboard())return!0;c||(c=f.bs().aL(a));return!c||e.isGenerator(c.itemId)? !0:k.containsItem(c.itemId)===b}var h=null,k=c(a,r);l.cycle();k&&(h=g,k.getSource().events.addListener(l,d.E,function(){k.update();f.dR().cn();p()}));s.setValue(h);r=k},onSearchResultsReady:function(a){if(!m)return!1;m.getForestPromise().always(a);return!0},isRowMatching:function(a){return m?m.getForest().contains(a):void 0},findMatchingIndex:function(a,b,c){if(!m)return-1;var d=b.size(),e=m.getForest();for(c+=a;0<=c&&c<d;c+=a)if(e.contains(b.rowId(c)))return c;return-1}})}});define("structure/widget/ui/panel/ForestPanel",
"almworks/jquery underscore structure/widget/perspective/StorageUtil structure/widget/spec/SpecController structure/widget/ui/panel/ForestFilter structure/widget/ui/panel/PanelBanners structure/widget/ui/panel/header/PanelHeader structure/widget/ui/grid/TablePresenter structure/widget/ui/grid/TRCache structure/widget/attributes/Attributes structure/widget/ui/state/UIStateModel structure/widget/model/Items structure/widget/model/ForestUpdateEvent structure/widget/model/ColumnsModel structure/widget/ui/panel/AnimatedRowsBuffer almworks/util/Template almworks/util/Util structure/widget/ui/editor/ItemEditor".split(" "),function(f,b,g,d,e,a,n,c,p,m,k,r,l,h,u,s,q,x){function t(a){a=a||namespace("almworks.structure.global");var b=(a.seq||0)+1;return a.seq=b}var w=namespace("almworks.structure"),v=namespace("almworks.structure.appevents"),C={},z=s.load("structure.widget.ui.panel.panel-no-pin-message");return function(s,A,D,G){function B(){return I&&I.value()||void 0}function K(a,b){return!r.isPermanent(r.getGeneratorId(b.itemId))}function J(a){M.dR().gy("transientGenerators",a?null:O)}function O(a,b){return!r.isTransient(r.getGeneratorId(b.itemId))}function V(){B()?d.isStructure(B())?P():
U({readOnly:d.isClipboard(B()),name:B().hasOwnProperty("type")?q.text("sw.structure.+"+B().type+"+.name"):q.text(B().hasOwnProperty("sQuery")?"sw.structure.query.name":"sw.structure.unknown.name")}):U(void 0)}function U(a){M.getInfoCell().setValue(a)}function P(){var a=B().structureId,b=C[a];if(b)U(b);else{var b=w.ajsbridge.localURL(w.ajax.RESOURCES2g.structure(a)),c= !1;w.ajax.doAjax({url:b,dataType:"json",success:function(b){c= !0;b&&b.id===a&&(C[a]=b,M.isStructure(a)&&U(b))},complete:function(){!c&&M.isStructure(a)&&U(null)}})}}function Y(a,b){if(q.deepEquals(a,B())){var c=da.value(),d=Date.now();0<c&&1500<d-c&&M.nX().aO(b)}}function N(a){function b(){s.clipboard.fillAttributeValues(M.getAttributeSubscription())}null!=ba&&(ba.unsubscribe(),M.ao().unsyncState());S.cycle();M.nX().clear();a?(ga.setValue(!1),sa= !1,V(),M.getAttributeSubscription().setDisplayedForestSpec(M.getSpecForAttributes()),ba=s.forestCache.subscribe(a,!0),ba.getForestPromise().done(function(a){q.deepEquals(B(),a)&&ga.setValue(!0)})):(V(),M.getAttributeSubscription().setDisplayedForestSpec(M.getSpecForAttributes()),ba=null,M.aT().setSource(null));R.cycle();M.isClipboard()&&(b(),s.eventBus.addListener(R,v.be,b))
}function L(){function a(){oa.recalculate()}var b=ba.getForest();M.aT().setSource(b);M.gP().setSource(ba.gP());M.ao().syncState(B(),ba.getVersionCell());var c=q.delayed(150,function(a){M.dR().gy("hide-unselected",a?function(a){return M.ao().isSelected(a)}:null)}),d=M.ao().hideUnselectedOn;d.pipe(c);M.bD().addListener(new q.Life,v.am,function(a){"forest"!=a&&d.value()&&c(!0)});la.value()&&(a(),b.events.addListener(S,l.E,q.delayed(20,a)))}function fa(){return new q.Cell(Q.bw(),s.automationOn,s.bF.visibleCell,s.bF.forestVersionCell,function(a,b,c,e){if(!a)return a;M.dR().gy("automation",c||b||d.isClipboard(a)?null:K);b||c?(a=f.extend(!0,{},a),a.hasOwnProperty("pinnedItem")&&delete a.pinnedItem,a.transforms&&a.transforms.length&&delete a.transforms):la.setValue(a.pinnedItem);!c&&b&&a.structureId?a.title= !0:delete a.title;c&&a.structureId&&e&&e.structureId===a.structureId?a.version=e.version:delete a.version;return d.isValidSpec(a)?a:null})}var X=t(s),M=this,ba=null,E=void 0,I=void 0,ma=new q.Cell(!1),R=new q.Lifecycle,S=new q.Lifecycle,ga=(new q.Cell).pipeChanges(function(a){a&&L()}),da=new q.Cell(ga,function(a){return a?Date.now():0}),ia,T,Aa=m.KEY_TEXT,Z=m.SUMMARY_TEXT,va=
m.EDITABLE,Q=new d(s,G,w.modes.getStructurePageId()),sa= !1,ta=new q.Cell(Q.bw(),function(a){return g.getStorageKey(a)}),ya=f('<div id="s-loading"></div>'),qa=z.render$(),aa=new q.Cell,la=(new q.Cell).pipeChanges(q.seq(Q.pinItem,function(a){var b=M.ao();a?(ia=a,T=null):(a=b.bc())&&(T=a)})),oa=new q.Cell(la,ga,s.automationOn,function(a,b,c){return a&& !c&&b&&Q.isTransformable()?M.aT().getPathsByItemId(a):null}),pa=new q.Cell(oa,function(a){if(!a)return null;var c,d;a=b.sortBy(a,function(a){return a.length});for(c=0;c<a.length-1;c++){var e=a[c];for(d=c+1;d<a.length;d++){var f=a[d];e.length<f.length&&q.arrayEquals(e,b.first(f,e.length))&&(a.splice(d,1),d--)}}return a}),Fa=(new q.Cell(!1)).pipe(function(a){f(".st-unavailable",A).toggle(a);f(".issueArea",A).toggle(!a);f(".tableHeader",A).css({visibility:a?"hidden":"visible"})}),y=(new q.Cell(la,oa,ga,aa,s.automationOn,function(a,c,d,e,g){return d?b.isObject(e)?g|| !c||c.length?null:qa:f(q.renderTemplate("<span>{s.g.no-such-structure,structureId}</span>",B())):ya})).shallowEquality().pipeChanges(function(a){var b= ! !a;Fa.setValue(b);b&&f(".st-unavailable",A).empty().append(a)});q.extend(this,{sequence:X,panelId:"p"+X,panelName:G,widget:
s,panel$:A,config:D,columnClass:function(a){return this.panelId+"col"+a},co:q.returnTrue,fr:q.lazy(function(){return this.panel$.find(".issueArea")}),isPrimary:function(){return this===s.master},bD:q.lazy(function(){var a=new q.Observable(q.nn(s.eventBus));w.apputil.installEventBus(this.panel$,a);return a}),getPanelBanners:q.lazy(function(){return new a(this)}),getPanelHeader:q.lazy(function(){return new n(this)}),getFilter:q.lazy(function(){return new e(this)}),af:q.lazy(function(){return new h(this)}),ao:q.lazy(function(){return new k(this)}),ae:q.lazy(function(){return(new w.CollapsibleForest(this.ao(),this.bD())).setSource(this.bs())}),aS:q.lazy(function(){var a=[Aa,Z,va];!1!==s.jiraConfig.ke()&&(a=a.concat(m.REQUIRED_FOR_CREATE));return new p(this,a)}),eg:q.lazy(function(){return new w.ee(this)}),bn:q.lazy(function(){return new c(this)}),cc:q.lazy(function(){return new w.eT(this)}),ah:q.lazy(function(){return(new q.ActionRegistry).listen(new q.Life,this.bD(),v.ACTION,v.mt,v.ly)}),bW:q.lazy(function(){return new w.mE(this)}),aT:q.lazy(function(){return new w.ForestDelegator}),gP:q.lazy(function(){return new w.ForestDelegator}),bd:q.lazy(function(){return new w.ForestDelegator(
this.gP())}),dR:q.lazy(function(){return new w.fq(this)}),dH:q.lazy(function(){return new w.DecoratorSwitchForest(this.bd(),this.dR())}),mH:q.lazy(function(){return new w.ApplicatorForest}),bg:q.lazy(function(){return new w.DecoratorSwitchForest(this.dH(),this.mH())}),bs:function(){return this.bg()},bh:q.lazy(function(){return new x(this)}),aZ:q.lazy(function(){return new w.ez(this)}),nX:q.lazy(function(){return new u}),roots:new q.Cell(oa,function(a){return a?b.map(a,b.last):null}),rootPaths:oa,normalizedRootPaths:pa,pinnedItem:la,settingsKey:ta,jY:q.lazy(function(){return new w.lZ(this)}),eN:q.lazy(function(){return new q.Cell(M.eg().fL(),Q.bw(),function(a,b){return-1!==a})}),getReadOnlyCell:q.lazy(function(){return(new q.Cell(M.getInfoCell(),M.widget.readOnlyCell,function(a,b){return!a||a.readOnly||b})).pipe(q.curryThis(A,A.toggleClass,"ro"))}),isReadOnly:function(){return M.getReadOnlyCell().value()},isVisible:function(){return s.layoutManager.isVisible(M)},getUnavailableCell:q.returnConst(Fa),getSpecController:function(){return Q},getInfoCell:function(){return aa},getAttributeSubscription:q.lazy(function(){return s.attributeManager.subscribe()}),getAttributeValue:function(a,b)
{return s.attributeManager.getAttributeValue(this.getSpecForAttributes(),a,b)},getAttributeValuePromise:function(a,b,c){var d=f.Deferred(),e=this.getAttributeValue(b,c);if(void 0!==e)d.resolve(e);else{var g=this,h=a.sub();this.getAttributeSubscription().addDataUpdateHandler(function(a){a&&a[b]&&(e=g.getAttributeValue(b,c),void 0!==e&&(d.resolve(e),h.detach()))},h);a.addDetach(function(){"pending"===d.state()&&d.reject()})}return d.promise()},getRowKey:function(a){return this.getAttributeValue(a,Aa)},getRowSummary:function(a){return this.getAttributeValue(a,Z)},hasSummary:function(a){return! !this.getRowSummary(a)},hh:function(a,b,c){if(0>a)return!0;var d=this.bd(),e=d.indexOf(a);return(d=0<=e&&d.row(e))&&r.isLoopMarker(d.getItemId())? !1:b&&(a==this.getTitleRow()||d&& !r.getIssueIdFromItemId(d.getItemId()))? !0:c? !this.getAttributeSubscription().getValueAccessor(a).isNotAccessible(): !0===this.getAttributeValue(a,va)},gY:function(a){return 0<=a&& !1===this.getAttributeValue(a,va)},isAdminable:function(){return aa.value()&& ! !aa.value().adminable},isPerspectiveReady:function(){return s.layoutManager.isPerspectiveReady(M)},aW:function(){return aa.value()&&aa.value()
.editRequiresParentIssuePermission},isStructure:function(a){return d.isStructure(B())&&(b.isUndefined(a)||B().structureId===a)},getStructureId:function(){return B()&&d.isStructure(B())&&B().structureId||0},isClipboard:function(){return d.isClipboard(B())},isSpec:function(a){return q.deepEquals(a,B())},isUntransformedSpec:function(a){return d.areUntransformedSpecsEqual(a,B())},hasSpec:function(){return sa|| ! !B()},setSpec:function(a){if(!M.canChangePanelState())return!1;sa=Q.setSpec(a)&& !B();return!0},canChangeSpecSilently:function(){var a=this.bh().getUncommittedItems();return 0===a.changed.length&&0===a.new&& !s.ad.jk(this)},canChangePanelState:function(){var a=this.bh().getUncommittedItems();if(0!==a.changed.length||0!==a.new|| !s.ad.isEmpty(this)){var b=[],b=b.concat(a.changed);0<a.new&&b.push(q.text(1===a.new?"s.w.warn.edited.sub.new.1":"s.w.warn.edited.sub.new.n",a.new));if(b.length){if(a=q.text("s.w.warn.edited.sub",b.join(", ")),a=q.text("s.w.warn.edited.alt")+" \n\n"+a,s.ad.jk(this)&&(a+=" \n\n"+q.text("s.w.warn.edit.blocked")),!window.confirm(a))return!1}else if(!window.confirm(q.text("sw.warn.pending.upload")))return!1;M.bh().gf();M.ao().clear();s.ad.clear(this)}return!
0},getRestSpecCell:function(){return I},copySpec:function(){return f.extend(!0,{},B())},getVersionedSpec:function(){return{spec:B(),version:ba&&ba.getVersion()}},getSpecForAttributes:function(){return d.getSpecForAttributes(B())},getPanelSettingsKey:function(){return ta.value()},setInitiallyFocusedItem:function(a){ia=a},setInitiallyFocusedRow:function(a){T=a},getPanelContentHeight:q.lazy(function(){return new q.Cell(M.bn().issueAreaHeight,y,function(a,b){return b?b.parent().outerHeight(!0):a})}),start:function(){if(!this.isStarted){this.isStarted= !0;this.eg();this.bn();this.cc();this.getPanelHeader();this.jY();this.getFilter();s.showTransientGenerators.pipe(J);E=fa();I=new q.Cell(E,function(a){return d.getRestSpec(a,s.transformRegistry)});I.pipe(N);var a={};a[v.AFFECTED_ROWS_IN_UPCOMING_CHANGE]=Y;this.bD().addListener(new q.Life,a);this.ah().register("unpin",q.curryThis(la,la.setValue,null));a=s.layoutManager.kY(M);(new q.Cell(s.initialized,a,q.and)).pipe(function(a){!a||B()||sa||M.setSpec({sQuery:{query:"",type:"jql"}})});ma.setValue(!0)}},cL:function(a,b,c,d){},isMoveDragPossible:function(a){if(M.isReadOnly()||M.eN().value())return!1;var b,c,d,e,f,g=M.rootPaths.value();if(g)for(
b=0,e=a.length;b<e;b++)for(f=a[b],c=0;c<g.length;c++)if(d=g[c],0<=q.indexOf(d,f))return!1;if(M.aW())for(c=M.bd(),b=0,e=a.length;b<e;b++)if(f=a[b],(f=c.bL(f))&& !M.hh(f,!0))return!1;return!0},isDropPossible:function(a,b,c){if(!a||M.isReadOnly())return!1;if((b=pa.value())&&a){if(0===a.under|| !b.length)return!1;for(c=0;c<b.length;c++){var d=b[c],e=q.indexOf(d,a.under);if(0<=e&&e<d.length-1)return!1}}return 0<a.under&&(b=M.bd().aL(a.under),!b||r.isGenerator(b.itemId)||M.aW()&& !M.hh(a.under,!0))? !1:0===a.under&&M.getTitleRow()? !1: !0},getTitleRow:function(){var a=M.bd();return a.isEmpty()?0:(a=a.row(0))&&a.semantics===r.Semantics.TITLE?a.getId():0},restoreScroll:function(){M.ao().restoreScroll(function(a){var b=M.bs(),c;T&&(c=b.getPath(T));if(!c&&ia){var d=b.getPathsByItemId(ia);d&&d.length&&(c=d[0])}d=M.ao();c?(d.by(c,!0),d.kK(c),M.bn().aJ()):(c=d.bc(),w.modes.GH_TAB?c&&d.kK(null):c||0<b.size()&&d.kK([b.rowId(0)]));a||M.bn().aJ()})},initialized:ma});w.apputil.setDominator(A,"panel",this)}});define("structure/widget/ui/behavior/ClickLabel",["almworks/util/Util"],function(f){var b=namespace("almworks.structure.appevents"),g=namespace("almworks.structure.apputil");return function(d){
d.eventBus.addListener(new f.Life,b.BEFORE_CLICK,function(b){var a=b.link$.closest("li"),n=a.closest("ul.labels");if(n.length&&n.closest("#structure").length&&(b.prevent= !0,!d.automationOn.value()&&(b=a.text().trim()))&&(a=g.getDominator(a,"panel"))){var c={key:"filter",module:"com.almworks.jira.structure:filter-jql",params:{jql:'labels = "'+b+'"'}},a=a.getSpecController();a.findTransforms("filter").some(function(a){return a&&a.module===c.module&&f.deepEquals(a.params,c.params)})||a.addTransform(c)}})}});define("structure/widget/history/HistoryManager","almworks/jquery jquery underscore almworks/util/Util structure/widget/perspective/CellBasedValueWrapper structure/widget/perspective/StorageUtil".split(" "),function(f,b,g,d,e,a){function n(b){d.addSuper(e,this)(r.perspective,b);b=new d.Cell(b.master.getSpecController().bw(),function(b){return "history."+a.getStorageKey(b)});d.extend(this,e.prototype,{key:b,perspectivePath:"history",defaultValue:{}})}function c(a){if(!a)return[];for(var b=0,c=0,d=[];0<=b;){var c=a.indexOf(",",b+1),e=0>c?a.substring(b):a.substring(b,c),b=0>c? -1:c+1,c=parseInt(e,10);isNaN(c)||0>=c||d.push(c)}return d}var p=namespace("almworks.structure"),m=
p.appevents,k=namespace("JIRA.userhover",!1),r={focused:new d.Cell(!1),visible:new d.Cell(!1),version:new d.Cell,effectiveVersion:null,forcedVersion:new d.Cell(null),before:new d.Cell(!1),forestVersion:null,perspective:null};r.effectiveVersion=new d.Cell(r.visible,r.version,d.and);r.forestVersion=new d.Cell(r.effectiveVersion,r.before,function(a,b){if(!a)return null;if(b){var c=f("#s-h-entry-"+a.version);d.assert(1===c.length);c=c.next(".s-h-entry");if(1===c.length){if(c=c.data("version"))return{version:c,structureId:a.structureId}}else return{version:0,structureId:a.structureId}}return{version:a.version,structureId:a.structureId}});r.perspective=new d.Cell(r.visible,r.version,r.before,r.forcedVersion,function(a,b,c,d){b=d||b&&b.version;return a&&b?{version:b,before:c}:{}});return function(a){function b(a){var c={maxCount:Math.max(20,oa)};aa&&(c.maxVersion=aa);B([c],[w(),a])}function e(a){return a&&a.length&&(a=a.slice(0,1).data("version"))?(v(a),y(a),!0): !1}function s(){if(!Aa.isLoading("history")){var a;pa?(a=pa.next(".s-h-entry"))&&a.length?(pa=a,e(pa)):R.is(":visible")&&b(s):(a=r.effectiveVersion.value())&&a.version?(pa=I.find("#s-h-entry-"+a.version),s()):r.visible.value()&&(
a=I.find(".s-h-entry"))&&a.length&&(pa=a.slice(0,1),e(pa))}}function q(){sa&&sa.hasOwnProperty("version")&&I.find(".s-h-entry").length&& !I.find(".s-h-selected").length&&(ta= !0,L(sa.version,null,function(){v(sa.version,function(){x(sa.before,function(){ta= !1;sa=null})})}))}function x(a,c,d){if(a&& !d&&(d=f("#s-h-entry-"+r.effectiveVersion.value().version),1===d.length&&0===d.next(".s-h-entry").length)){b(function(){x(a,c,!0)});return}r.before.setValue(a);"function"===typeof c&&c()}function t(){var a;pa?(a=pa.prev(".s-h-entry"))&&a.length&&(pa=a,e(pa)):(a=r.effectiveVersion.value())&&a.version&&(pa=I.find("#s-h-entry-"+a.version),t())}function w(){var a=aa;return function(){1===aa||aa===a?(R.hide(),0<oa?S.text(d.text("s.w.history.no-more-versions")):S.text(d.text("s.w.history.history-is-empty")),S.show()):(S.hide(),R.show())}}function v(a,c){var d=r.effectiveVersion.value();if(!d||d.version===a)if(d=E.find(".s-h-entry.s-h-selected"),1!==d.length||d.data("version")!==a)if(d.removeClass("s-h-selected"),d=E.find("#s-h-entry-"+a),d.length)d.addClass("s-h-selected"),C(d);else if(R.is(":visible")){b(function(){v(a,c)});return}"function"===typeof c&&c()}function C(a){var b=I.scrollTop(),
c=I.height(),d=b+c,e=b+a.position().top;a=a.outerHeight(!0);var f=e+a;e>=b&&f<=d||((e>=d||f<=b)&&c>=3*a&&(e=Math.max(0,e-a),f+=a),e<b?I.scrollTop(e):f>d&&I.scrollTop(f-(d-b)))}function z(){var a=ga.value();return a&&a.structureId}function F(a){r.visible.value()&&(a?A()||d.focus(I):d.blur())}function A(){return r.visible.value()&&r.focused.value()}function D(a){var b=z();if(b){var c=r.version.value();c&&c.structureId==b||G();b=[];c=[];b.push({maxCount:20});c.push(w());for(var e=0;e<arguments.length;e++)"function"===typeof arguments[e]&&c.push(arguments[e]);B(b,c)}else G(),S.text(d.text("s.w.history.history-not-available")),S.show()}function G(){ya= !0;I.find(".s-h-entry").remove();r.version.setValue(void 0);Z.clear();va.clear();aa=qa=oa=0;la=pa=null;Fa= !1;R.hide();g.defer(function(){ya= !1})}function B(a,b){var c=z();d.assert(c,"Should be called with a structure");S.hide();d.isArray(b)&&(b=d.seq.apply(d,b));if(a&&a.length)for(var e=0,f=a.length;e<f;e++)Aa.addTask("history",p.ajax.RESOURCES2g.versions(c,a[e]),0==e&&b?d.seq(K,b):K);else b&&b()}function K(b){if(b&&b.versions){b=b.versions;var c,d,e,g;c=0;for(d=b.length;c<d;c++)if(e=b[c],g=e.version)oa++,e=f(
'<div class="s-h-entry"></div>').prop("id","s-h-entry-"+e.version).data("version",e.version).append(J(e),O(e)),qa&&aa?g>qa?(qa=g,e.prependTo(I)):g<aa?(aa=g,e.insertBefore(ma)):I.find("#s-h-entry-"+g).length||e.insertBefore(Y(g)):(qa=aa=g,e.insertBefore(ma));k&&"function"===typeof k&&k(I);a.eventBus.fireEvent(m.av)}}function J(a){a=a.user;var b=a.avatarUrl,b=f('<img class="s-h-e-avatar">').attr("src",b+"&size=small");a.profileUrl&&b.addClass("user-hover").attr("rel",a.name);return b}function O(a){var b=f('<div class="s-h-e-body"></div>').append(V(a),P(a)),c;if(1===a.changes.length)c=a.changes;else{for(var d={},e=0;e<a.changes.length;e++){var g=a.changes[e],h=d[g.operation];h||(h={forestSize:0},d[g.operation]=h);for(c in g)g.hasOwnProperty(c)&& !h.hasOwnProperty(c)&&"forestSize"!==c&&(h[c]=g[c]);h.forestSize+=g.forestSize}e=[];for(c in d)d.hasOwnProperty(c)&&e.push(d[c]);c=e}d=f('<div class="s-h-e-ops"></div>');for(e=0;e<c.length;e++)d.append(U(c[e]));b.append(d);a:{for(c=0;c<a.changes.length;c++)if("move"===a.changes[c].operation){a= !0;break a}a= !1}a&&d.append(f(
'<div class="s-h-e-toggle"><div class="s-h-e-toggle-knob"></div><span class="s-h-e-t-from alm alm-checked" ></span><span class="s-h-e-t-to alm alm-history"></span></div>'));return b}function V(a){var b=a.synchronizer;a=a.user;var c=f('<div class="s-h-e-subject"></div>');b?c.text(b.description).attr("title",b.description):c.text(a.displayName);return c}function U(a){var b=d.toIntSafe(a.itemId,0),c=f('<div class="s-h-e-operation"></div>');1===a.forestSize&&b&&a.issueKey&&a.issueSummary?(c.html(d.text("s.w.history.entry."+d.htmlEscape(a.operation)+".1",d.htmlEscape(a.issueKey),d.htmlEscape(a.issueSummary))),c.find("a").data("itemId",a.itemId).attr("href","#").click(N)):1===a.forestSize?c.text(d.text("s.w.history.entry."+d.htmlEscape(a.operation)+".1.plain")):c.text(d.text("s.w.history.entry."+d.htmlEscape(a.operation)+".n",a.forestSize));c.addClass("s-h-operation-"+d.htmlEscape(a.operation));return c}function P(a){return f('<div class="s-h-e-timestamp"></div>').text(a.dateTimeFormatted)}function Y(a){var b;I.find(".s-h-entry").each(function(){var c=f(this);if(c.data("version")<a)return b=c,!1});d.assert(! !b,a);return b}function N(b){function c(){var b=r.effectiveVersion.value();
return b&&b.version==g?((b=a.master.ae().getPathsByItemId(e))&&b.length&&a.master.ao().eJ(b[0]),!0): !1}var d=f(b.target),e=d.data("itemId"),g=d.closest(".s-h-entry").data("version");e&&g&&(c()||(v(g),L(g,c)),b.preventDefault(),b.stopPropagation())}function L(a,b,c,e){la=a;var f=Z.getValue(a);f?Ea(f,b,c):(f=z(),Aa.addTask("version",p.ajax.RESOURCES2g.version(f,a),d.curry(fa,f,b,c),e))}function fa(a,b,e,f){if(f&&f.version){a={version:f.version,structureId:a,changes:[]};for(var g=0;g<f.changes.length;g++){var h=f.changes[g],k=h.operation,l=h.moveDirection,m=p.DataForest,n;var q=h.forest;n=[];if(q)for(var q=q.split(","),s=void 0,t=void 0,r=void 0,t=void 0,s=0;s<q.length;s++)if(t=q[s])t=t.match(/^([\d]+):([\d]+)/),r=d.toInt(t[1]),t=d.toInt(t[2]),n.push(new p.bP(r,t));h={operation:k,moveDirection:l,forest:new m(n),parentPathFrom:c(h.parentPathFrom),precedingSiblingsFrom:c(h.precedingSiblingsFrom),parentPathTo:c(h.parentPathTo),precedingSiblingsTo:c(h.precedingSiblingsTo)};a.changes.push(h)}Z.putValue(a.version,a);Ea(a,b,e)}}function X(){var a=r.version.value();if(!a)return null;var b=a.version+"."+(r.before.value()?"before":"after"),c=va.getValue(b);c||(c=M(a,r.before.value()),
va.putValue(b,c));return c}function M(a,b){var c={};g.each(a.changes,function(a){var e={copy:"copied",add:"added",remove:"removed"}[a.operation];g.each(a.forest.aD(),function(f){var g=e;"move"===a.operation&&(g=b?"movedFrom":"movedTo");d.assert(!c.hasOwnProperty(f),"Another status?!");c[f]={status:g}});g.each(a.forest.hf(),function(d){var f=e,h=e;"move"===a.operation&&(f=a.moveDirection,0>f?f="Up":0<f?f="Down":(f=ba(a.parentPathFrom),h=ba(a.parentPathTo),f=h<f?"Left":h>f?"Right":""),h="moved"+f+(b?"From":"To"),f=b?"movedFrom":"movedTo");c[d]=g.extend(c[d]||{},{icon:{icon:h,status:f}})})});return c}function ba(a){return a&&a.length||0}var E=function(){return d.generateDom("div","input","a",function(a,b,c){return a(".s-history")(a(".st-focus-decoration"),a(".s-h-header")(a(".s-h-toolbar")(a(".s-h-title.alm.alm-history")("{s.w.history.title}"),a(".s-h-close")(c("#close-history-btn.close-panel-btn",{href:"#"})))),a(".s-h-entries.main")(a(".s-h-after-entries")(b(".s-h-show-more",{type:"button"}),a(".s-h-nothing-more"))))})}(),I=E.find(".s-h-entries"),ma=E.find(".s-h-after-entries"),R=E.find(".s-h-show-more"),S=E.find(".s-h-nothing-more"),ga=a.master.getSpecController().bw(),da=
a.master.bD(),ia=a.master.widget.ajax,T=a.globalActions,Aa=new function(){function a(d){b--;if(d){var e=c[d];c[d]=e?e-1:0}da.fireEvent(m.cQ)}var b=0,c={};return{isLoading:function(a){return a&& ! !c[a]|| ! !b},addTask:function(e,f,g,h){b++;e&&(c[e]=(c[e]||0)+1);da.fireEvent(m.cQ);e=d.curry(a,e);ia.addTask(new ia.Task(f,p.ajax.DOWNLOAD,d.seq(e,g),d.seq(e,h)))}}},Z=new d.LRUCache(10),va=new d.LRUCache(50),Q=new n(a),sa=null,ta= !1,ya= !1;a.div$.after(E);a.eventBus.addListener(new d.Life,m.WIDGET_STARTED,function(){Q.restore(function(a){var b=r.forcedVersion.value();sa=b?{version:b,before: !1}:a;q()})});r.forcedVersion.pipeChanges(function(a){a&&(r.visible.setValue(!0),Q.forced= !0)});r.version.fieldSubCell("version").pipeChanges(function(){ya||(Q.forced?g.defer(function(){Q.forced= !1}):r.forcedVersion.setValue(0))});r.focused.pipe(d.curryThis(E,E.toggleClass,"st-focused"));r.visible.pipeChanges(function(b){p.modes.HISTORY= ! !b;a.div$.toggleClass("s-history-mode",b);b?D(q):ya||(Q.forced= !1,r.forcedVersion.setValue(0));da.fireEvent(m.STRUCTURE_PAGE_CHANGED)});r.before.pipeChanges(function(a){var b=I.find(".s-h-entry.s-h-selected .s-h-e-toggle");1===b.length&&(b.toggleClass(
"s-h-e-t-before",a),b.attr("title",d.htmlEscape(d.text(a?"s.w.history.toggle.before.tooltip":"s.w.history.toggle.after.tooltip"))))});da.addListener(new d.Life,m.FOREST_UPDATE_DISPLAYED,function(){r.visible.value()&&a.master.bn().gC()});da.addListener(new d.Life,m.STRUCTURE_CHANGED,function(){r.visible.value()&&D()});r.effectiveVersion.pipeChanges(function(a){!a||sa&&sa.version===a||v(a.version)});r.forestVersion.pipeChanges(function(b){a.eventBus.fireEvent(m.kl)});E.on("focusin focusout",function(a){(a="focusin"===a.type)&& !r.visible.value()&&F(!1);r.focused.setValue(a)});(function(){f("#close-history-btn",E).on("mousedown mouseup",function(a){a.stopPropagation();a.preventDefault();"mouseup"===a.type&&r.visible.setValue(g.isBoolean(!1)? !1: !r.visible.value());return!1})})();(function(){a.keyboardManager.addCustomController({accept:function(a,b){if(b===I[0]||f.contains(I[0],b))return!1}})})();T.register("historyOlderVersion",function(){Fa= !0;ua()});T.register("historyNewerVersion",function(){Fa= !1;ua()});var qa=0,aa=0,la=null,oa=0,pa=null,Fa= !1,y=d.delayed(200,L),ua=d.bottlenecked(100,function(){Fa?s():t()});R.attr("value",d.text("s.w.history.show-more")).click(d.curry(b,null)
);I.delegate(".s-h-entry","click",function(a){a=f(a.target).closest(".s-h-entry");var b=a.data("version");!a.hasClass("s-h-selected")&&b&&L(b)});I.delegate(".s-h-e-toggle","click",function(a){x(!r.before.value());a.preventDefault();a.stopPropagation()});var Ea=d.delayed(0,function(a,b,c){if(a.version===la&&(la=null,a.params=b,r.version.setValue(a),!ta)){b=x;a:{for(var d=0;d<a.changes.length;d++)if("remove"!==a.changes[d].operation){a= !1;break a}a= !0}b(a)}"function"===typeof c&&window.setTimeout(c,0)});d.extend(this,{panel$:E,visibleCell:r.visible,forestVersionCell:r.forestVersion,lg:r.effectiveVersion,forcedVersionCell:r.forcedVersion,focusedCell:r.focused,isBeforeChange:function(){return r.before.value()},isLoading:Aa.isLoading,setFocused:F,isFocused:A,getRowStatus:function(a){var b=X();return b&&b.hasOwnProperty(a)&&b[a].status},getRowIconData:function(a){var b=X();return b&&b.hasOwnProperty(a)&&b[a].icon},lb:function(a,b){b(Q)}})}});define("structure/api/StructureCoreExtension",["almworks/util/Classes"],function(f){return f.baseClass("StructureCoreExtension",{getExtensionRequest:function(){return null},isBlockingPoll:function(){return!1}})});(function(f){var b=namespace(
"almworks.structure"),g=namespace("almworks.util"),d=namespace("almworks.structure.appevents"),e=b.$;b.ij=function(a){function b(c){m&&(p=(new Date).getTime(),k||(k= !0,a.eventBus.fireEvent(d.jx,k)))}function c(){if(k){var b=(new Date).getTime();0<p&&b-p>r&&(k= !1,a.eventBus.fireEvent(d.jx,k))}}var p=(new Date).getTime(),m= !0,k= !0,r=a.config.userInactivityThreshold;e(function(){e("body").bind({mousedown:b,keydown:b});e(f).bind({resize:b,scroll:b});a.div$.find(".main").bind({scroll:b})});this[d.bX]=function(a){m=a};this[d.cj]=b;this[d.IFRAME_FOCUS]=b;a.eventBus.addListener(new g.Life,this);0<r&&f.setInterval(c,2E3)}})(window);define("structure/widget/widget",
"almworks/jquery jquery underscore almworks/util/Util almworks/util/JSON almworks/util/Template almworks/util/Keyboard almworks/util/Collections structure/widget/URLController structure/widget/model/Items structure/widget/ui/page/PageManager structure/widget/history/HistoryManager structure/widget/ui/layout/LayoutManager structure/widget/perspective/StorageManager structure/widget/perspective/StorageUtil structure/widget/WidgetConfig structure/widget/ui/panel/ForestPanel structure/widget/ui/panel/DecisionPanel structure/widget/forests/ForestCache structure/widget/poll/Poller structure/widget/attributes/AttributeManager structure/widget/attributes/DataLoader structure/widget/generator/GeneratorRegistry structure/widget/transform/TransformRegistry structure/widget/ui/toolbar/Toolbar structure/widget/clipboard/Clipboard structure/widget/dnd/DragModel structure/widget/confluence/ConfluenceErrorHandler structure/widget/ui/toolbar/AutomationMenu structure/widget/ui/attribute/AttributeRegistry structure/ui/details/ItemDetails structure/widget/ui/Tooltip structure/widget/ui/layout/FullScreenController".split(" "),function(f,b,g,d,e,a,n,c,p,m,k,r,l,h,u,s,q,x,t,w,v,C,z,F,A,D,G,B,K,J,O,V,U){
function P(b,c){var e=f(b);e.append(a.build$("div","input","a","span",function(a,b,c,d){function e(b){return a()(a(".st-focus-decoration"),a(".head"))}function f(b){return a(".sechead")(a(".tableHeader").apply(void 0,arguments))}function g(b){return a(".secbody")(a(".main")(a(".issueArea").apply(void 0,arguments),a(".st-unavailable").apply(void 0,arguments)))}return[a("#issuetable.fake")(a(".mousePanel")(a("#st-tgp")(a(".st-ssel"))),a("#st-glass"),a(".st-page.single-panel")(a(".st-master.s-forest-panel.vcol")(e(),f(),a(".s-pb-container"),g(a(".cacheTable"))),a(".st-splitter.vcol"),a(".st-slave.s-forest-panel.vcol")(e(),f(),a(".s-pb-container"),g(a(".cacheTable")))),a(".foot")(a(".s-info-link.s-frlink"),a(".s-board-link.s-frlink"),a(".s-sec-panel-status"),a(".st-stat")(d(".long"),d(".short")),a(".st-progress"),a(".s-footer-warning"),a(".s-undo-redo")(c({href:"#","data-s-action":"undoOrRedo",class:"long"}),c({href:"#","data-s-action":"undoOrRedo",class:"short"})),a(".s-footer-confluence-warning"),a(".br")))]}));if(c.fixFooterBottom){var g=f("footer#footer"),h=g.css("paddingBottom");h&&20<parseInt(h,10)&&g.css("paddingBottom","8px")}if(f.browser.msie){e.addClass("ie");g=8;try{g=
parseInt(f.browser.version,10)}catch(k){}7===g||7==document.documentMode?e.addClass("ie7"):8==document.documentMode||8===g?e.addClass("ie8"):9==document.documentMode||9===g?e.addClass("ie9"):10==document.documentMode||10===g?e.addClass("ie10"):11!=document.documentMode&&11!==g||e.addClass("ie11")}f.browser.webkit&&e.addClass("webkit");f.browser.chrome&&e.addClass("chrome");f.browser.safari&&e.addClass("safari");f.browser.mozilla&&e.addClass("mozilla");d.isMac()&&e.addClass("mac")}function Y(b){function c(a){var b=a.getItemId();return m.isGenerator(b)||m.isLoopMarker(b)||a.semantics===m.Semantics.TITLE?null:b}function e(){var a=g.size(b.master.dH().selectDistinct(c));0>=a?l.setValue({long:d.text("sw.widget.status.nothing"),short:d.text("sw.widget.status.short.nothing")}):l.setValue({long:N("sw.widget.status.showing",a),short:N("sw.widget.status.short.showing",a)})}var h=f(".foot .st-stat > .long",b.div$),k=f(".foot .st-stat > .short",b.div$);if(h.length){var l=(new d.Cell(null)).pipeChanges(function(a){a&&(h.html(a.long),k.html(a.short))}),n=d.delayed(50,e),p=new d.Life,q={};q[Z.ForestUpdateEvent.E]=n;q[Q.am]=n;n=b.master;n.bD().addListener(p,q);n.bd().events.addListener(p,q);n.dH()
.events.addListener(p,q);a.build("span","a",function(a,b,c){return[a()("{msg}"),c.html("&nbsp;-&nbsp;"),b(".s-foot-restore",{href:"#","data-s-action":"uistate.selection.restore",title:"{s.w.status.restore-selection.tooltip}"})("{s.w.status.restore-selection}")]});return l}}function N(a,b){return 1===b?d.text(a+".+1+"):d.text(a+".+n+",b)}function L(a){var b=window.onbeforeunload;window.onbeforeunload=function(){try{a.eventBus.fireEvent(Q.cK)}catch(c){}if("function"===typeof b){var e=b.apply(this,arguments);if(void 0!==e)return e}if(e=fa(a))return e;if(!a.ad.isEmpty())return a.popupQuestion(),d.text("sw.warn.pending.upload");a.errorPanel.setEnabled(!1)}}function fa(a){var b=[],c=0;g.each(a.panels,function(a){a=a.bh().getUncommittedItems();b=b.concat(a.changed);c+=a["new"]});if(!b.length&& !c)return null;0<c&&b.push(d.text(1===c?"s.w.warn.edited.sub.new.1":"s.w.warn.edited.sub.new.n",c));var e=d.text("s.w.warn.edited.sub",b.join(", ")),e=d.text("s.w.warn.edited")+" \n\n"+e;a.ad.jk()&&(e+=" \n\n"+d.text("s.w.warn.edit.blocked"));return e}function X(a,b){function c(b,d){var e=null,f=a.pageManager.getFocusedPanel();f&&(e=f.bD());!e&&d&&d.target&&(e=Z.apputil.getDominator(d.target,
"eventBus"));e||(e=a.eventBus);e.fireEvent(Q.ACTION,b,d);return d&&d.consumed? !1: !0}var e=d.nn(a.keyboardManager);d.eachOwn(b,function(a){if("string"===typeof a&&a){var f=b[a];"-- pass --"===f?e.addShortcutPass(a):"string"===typeof f&&f&&e.addShortcut(a,d.curry(c,f))}})}function M(a,b,c){function e(b,c){var d=null,f=a.pageManager.getFocusedPanel();f&&(d=f.bD());!d&&c&&c.target&&(d=Z.apputil.getDominator(c.target,"eventBus"));d||(d=a.eventBus);d.fireEvent(Q.ACTION,b,c);return c&&c.consumed? !1: !0}d.assert(! !b,"Empty shortcut",b);d.assert("string"===typeof b);var f=d.nn(a.keyboardManager);"string"===typeof b&&b&&("-- pass --"===c?f.addShortcutPass(b):"string"===typeof c&&c&&f.addShortcut(b,d.curry(e,c)))}function ba(a){var b=a.keyboardManager;a=window.JIRA;b&&a&&"function"===typeof a.bind&&(a.bind("Dialog.show",function(){b.setEnabled(!1)}),a.bind("Dialog.hide",function(){b.setEnabled(!0)}))}function E(a){a.div$.delegate(".automation-on-warning","click",function(){a.automationOn.value()&&a.eventBus.fireEvent(Q.AUTOMATION_OFF_REQUIRED)})}function I(a){var d=n.codeMapFromKeyMap(c.flipSet("enter up down right left space esc tab pageup pagedown home end".split(" "))),e=null;b("body")
.on("aui-dropdown2-show aui-dropdown2-hide",function(){e=null});a.keyboardManager.addCustomController({accept:function(a){null===e&&(e=0<f('.aui-dropdown2[aria-hidden="false"]').length);return!1===e?void 0: !(a.isDefaultPrevented()||d[a.keyCode])}})}function ma(a){var b=a.pageManager.getFocusedPanel();if(!b)return null;var c=b.getSpecController(),d=c.copySpecForRest();if(c.isStructure())if(a.bF.visibleCell.value()){if(c=a.bF.forestVersionCell.value())d.version=c.version,delete d.transforms}else a.automationOn.value()&&(d.title= !0,delete d.transforms);var c={forestSpec:va.ct(d)},e=b.bW(),f=e.fi();if(0>f||e.ku().value()){if(e=g.clone(e.um())){var h=b.af().getColumns();e.columns=e.columns.map(function(a){if(!a.name){var b=g.findWhere(h,{csid:a.csid});if(b&&b.getName())return g.extend({name:b.getName()},a)}return a});c.viewSpec=va.ct(e)}}else f&&(c.viewId=f);c.expand=b.ao().aP();a=a.forestCache.getCurrentVersion(d);c.signature=a&&a.signature||0;return c}function R(a){function b(c){if(c){var d=f(this),e=d.attr("data-s-action");if(e){var g=Z.apputil.getDominator(this,"eventBus");g||(g=a.eventBus);var h=null,k=d.attr("data-s-action-options");!k&&d.is("form")&&(k=d);k&&(d=d.closest(k),
d.length&&(h=Z.apputil.ht(d)));g.fireEvent(Q.ACTION,e,c,h);c.preventDefault();return!1}}}f("body").off(".structure-actions").on("click.structure-actions","a[data-s-action],:button[data-s-action],:submit[data-s-action]",b).on("submit.structure-actions","form[data-s-action]",b)}function S(a,b){function c(){var e=b.value(),k;e&&(k=g+e,(e=a.master.ao().bc())&&(k+="#"+e));k?(h?h.show():(e=d.renderTemplate('<a href="#" target="_top" title="{s.w.open-board.title}"><i class="s-fa fw s-fa-external-link"></i><span>{s.w.open-board}</span></a>'),f(".s-board-link").html(e),h=f(".s-board-link a")),h.attr("href",k)):h&&h.hide()}if(Z.modes.GADGET||Z.modes.GH_TAB||Z.modes.ISSUE_PAGE||Z.modes.PCV_PAGE){var e={};e[Q.eu]=c;a.master.bD().addListener(null,e);b.pipeChanges(c);var g=Z.ajsbridge.localURL("secure/StructureBoard.jspa?s="),h}}function ga(a){var b=a.globalActions;b.register("openPrintable",function(){var b=ma(a);if(!b)return!1;va.openWindow("/secure/StructurePrintable.jspa",b,"strprint"+a.pageManager.getFocusedPanel().getPanelSettingsKey())});b.register("openExcel",function(){var b=ma(a);if(!b)return!1;va.openWindow("/plugins/servlet/structure/excel",b,"_self")});b.register(
"toggleExtraActions",function(){var b=a.div$.find(".s-extra-action");b.filter(":visible").length?b.hide():b.show()});b.register("toggleAutomation",function(){a.automationOn.setValue(!a.automationOn.value());return!0})}function da(){this.lastPopup=null;this.lV=function(a,b){this.lastPopup&&this.lastPopup.obj!==a&&this.hideCurrentPopup();a&&(this.lastPopup={obj:a,hideF:b})};this.popupHidden=function(a){this.lastPopup&&this.lastPopup.obj===a&&(this.lastPopup=null)};this.hideCurrentPopup=function(){if(null===this.lastPopup)return!1;d.safeCall(this.lastPopup.hideF,this.lastPopup.obj);this.lastPopup=null;return!0}}function ia(a,b){b||(b=ta["default"]);this._icon$=f(d.renderTemplate('<i class="{iconClasses}"></i>',{iconClasses:b}));a.hide().html(this._icon$);this._warnings=[];this.show=function(a,b,c,d){this._warnings=g.filter(this._warnings,function(b){return b.key!==a});b={key:a,message:b,title:c,callback:d};this._warnings.push(b);this._show(b)};this._show=function(b){function c(a){a.preventDefault();b.callback&&b.callback.apply(this);return!1}this._icon$.on("click.footer-warning",c);this._icon$.attr("title",b.title);this._link$&&(this._link$.remove(),this._link$=null);this._link$=f(
d.renderTemplate('<a href="#" class="s-footer-warning-jump" title="{title}">{message}</a>',b));this._link$.click(c);a.append(this._link$);a.show()};this.hide=function(a){this._warnings=g.filter(this._warnings,function(b){return b.key!==a});this._warnings.length?this._show(this._warnings[this._warnings.length-1]):this._hide()};this._hide=function(){a.hide();this._icon$.off(".footer-warning");this._link$&&(this._link$.remove(),this._link$=null)}}function T(a,b){function c(){return d.arrayFilter("ie ie7 ie8 ie9 ie10 ie11 mozilla webkit chrome safari mac".split(" "),function(a){return y.div$.hasClass(a)})}function e(a){a=(!a|| !a.readOnly)&&Z.modes.LICENSE_INVALID;var b=y.footerWarning$.parent().find("#s-license-warning");a?b.length?b.show():f(d.renderTemplate('<div id="s-license-warning" title="{s.w.err.license.title}"><span></span>{s.w.err.license.label}</div>')).insertAfter(y.footerWarning$):b.hide()};function m(a){a()}function n(a,b){m(function(){var c;c=g.isNumber(b)?{structureId:b}:b;a.setSpec(c)});return this}var T=Z.modes.getStructurePageId();!Z.modes.STRUCTURE_BETAMODE||"structure"!==T&&"project"!==T||d.setLogWindowErrors(function(a,b,c){return "string"===typeof b&&(0<=
b.indexOf("structure:")||0<=b.indexOf(".jspa"))?d.ERR:d.WARN});var y=this,N=new d.Cell(!1);g.defer(function(){N.setConstant(!0)});y.initialized=(new d.Cell).pipeOnce(d.truthy,function(){y.eventBus.fireEvent(Q.WIDGET_STARTED)});y.div$=a;y.config=new s(b);y.storage=new h(y);y.az=y.storage.getPerspectiveManager();P(a,y.config);y.glass$=a.find("#st-glass");y.gk=f('<a id="s-focus-placeholder" name="focus" rel="0" tabindex="9999"></a>').appendTo(y.glass$);y.footerWarning$=a.find(".s-footer-warning");y.footerWarning=new ia(y.footerWarning$);y.footerConfluenceWarning$=a.find(".s-footer-confluence-warning");y.footerConfluenceWarning=new ia(y.footerConfluenceWarning$,ta.confluence);y.eventBus=new d.Observable;Z.apputil.installEventBus(a,y.eventBus);y.hO=new Z.ij(y);y.errorCentral=new Z.error.eC(y);y.errorPanel=new Z.error.fg(y);y.globalActions=(new d.ActionRegistry).listen(new d.Life,y.eventBus,Q.ACTION,Q.mt,Q.ly);y.keyboardManager=(new d.KeyboardManager(a)).setDominate(!0);y.ajax=new Z.ajax.AJAX;y.forestCache=new t(y.eventBus);y.ad=new Z.cA(y);y.jiraConfig=new Z.JiraConfig(y);y.dJ=new G(y);y.mouseController=new Z.fj(y);y.jT=new Z.lH(y);y.ni=new da;y.ajsBridge=new Z.ajsbridge.AJSBridge(y);
y.generatorRegistry=new z(y);y.transformRegistry=new F(y.generatorRegistry);y.attributeManager=new v(y.eventBus,y.forestCache,y.transformRegistry,1E4,12E4);y.fk=new C(y);y.poller=new w(y);y.decisionPanel=new x(y);y.confluenceErrorHanlder=new B(y);y.footerWarningHeightCell=new d.Cell(y.decisionPanel.getHeightCell(),y.confluenceErrorHanlder.getHeightCell(),Math.max);y.automationOn=new d.Cell(!1);if(Z.modes.ISSUE_PAGE||Z.modes.GH_TAB||Z.modes.GADGET)y.automationOn.setValue=d.noop;y.showTransientGenerators=new d.Cell(!1);y.master=new q(y,a.find(".st-master"),y.config.masterConfig,u.PRIMARY_PANEL_NAME);y.panels=[y.master];y.slave=new q(y,a.find(".st-slave"),y.config.slaveConfig,u.SECONDARY_PANEL_NAME);y.panels.push(y.slave);y.config.singlePanel&&(y.slave._defunct= !0);var fa=new d.Cell(y.master.getSpecController().bw(),function(a){return a&&a.structureId||null});y.bF=new r(y);y.clipboard=new D(y);y.pageManager=new k(y);y.layoutManager=new l(y);y.fullScreenController=new U(y);y.attributeRegistry=new J(y);y.licenseInvalidCell=new d.Cell(!1);y.forcedReadOnlyCell=new d.Cell(! !y.config.forceReadOnly);y.readOnlyCell=new d.Cell(y.forcedReadOnlyCell,y.bF.visibleCell,y.licenseInvalidCell,d.or);
y.urlController=new p(y);(new d.Cell(N,this.urlController.initializedCell,d.and)).pipeOnce(d.truthy,function(){y.initialized.setValue(!0)});y.master.start();y.automationMenu=new K(y);y.toolbar=new A(y);y.ajaxNotifier=new Z.AjaxNotifier(y,a.find(".foot .st-progress"));Z.kN(y);y.fK=new Z.fp(y);y.undoTextCell=function(a,b){var c=b.find(".s-undo-redo"),e=c.find("a"),f=c.find("a.short"),g=(new d.Cell(a.bF.visibleCell,a.ad.og(),function(a,b){return a?null:b})).pipeChanges(function(a){a&&a.fading?c.stop(!0,!0).fadeOut(Z.nY):c.stop(!0,!0).show()});return(new d.Cell(g,function(a){return a?{short:d.text("s.w.+"+(a.applied?"undo":"redo")+"+.short"),long:d.text("s.w.+"+(a.applied?"undo":"redo")+"+.action.+"+a.i18nKey+"+")}:null})).pipeChanges(function(a){a?(e.text(a.long),f.text(a.short)):c.stop(!0,!0).hide()})}(y,a);y.footerStatTextCell=Y(y);y.smallFooterCell=new d.Cell(!1);!0===y.config.showIssueDetails&&O.initialize(y);L(y);X(y,Z.keymap());ba(y);I(y);E(y);Z.setupEmptyMasterHint(y);Z.ep(y);ga(y);R(y);d.trackFocus();S(y,fa);y.az.installSharingButton();Z.oD(y.eventBus);(function(){var a=Z.modes.ISSUE_PAGE?["issue"]:Z.modes.GADGET?["gadget","gadget."+Z.modes.GADGET]:Z.modes.PCV_PAGE?["pcv",
"pcv."+Z.modes.PCV_PAGE]:Z.modes.GH_TAB?["agile"]:Z.modes.ISSUE_DETAILS?["structure-with-details","structure-with-details."+(Z.modes.PCV_PAGE||"board")]:["board"],b=c(),d=["widget.created"],e,f,g,h;e=0;for(f=a.length;e<f;e++)d.push("widget.created."+a[e]);e=0;for(f=b.length;e<f;e++)d.push("widget.created."+b[e]);e=0;for(f=a.length;e<f;e++)for(g=0,h=b.length;g<h;g++)d.push("widget.created."+a[e]+"."+b[g]);y.eventBus.fireEvent(Q.gS,d)})();y.jiraConfig.load(function(){y.jiraConfig.ke()||y.div$.addClass("s-nocreate");y.jiraConfig.lP()||y.div$.addClass("s-nobulk");if(y.jiraConfig.le()){Z.modes.LICENSE_INVALID= !0;y.licenseInvalidCell.setValue(!0);var a=y.master.getInfoCell().value();a&&e(a)}});y.master.getInfoCell().pipeOnce(e);y.storage.whenReady(function(){y.az.getPerspectiveId()&&y.eventBus.addListener(null,Q.STRUCTURE_PAGE_CHANGED,function(){y.az.setPerspectiveStructurePageId(Z.modes.getStructurePageId())})});d.extend(this,{setPrimaryStructure:d.curry(n,y.master),setSecondaryStructure:d.curry(n,y.slave),getPrimaryStructureIdCell:function(){return fa},setInitiallySelectedIssueFromLocation:function(a){var b=window.location.hash;b&&1<b.length&&(b=d.toIntSafe(b.substring(1)),0<b&&(
window.location.hash="",y.master.setInitiallyFocusedRow(b)));a&&y.master.setInitiallyFocusedItem(""+a)},forceLayout:function(){y.pageManager.forceLayout()},getViewportHeightCell:function(){return y.pageManager.getViewportHeightCell()},getHasErrorsCell:function(){return y.decisionPanel.getHasErrorsCell()},getHasConfluenceErrorsCell:function(){return y.confluenceErrorHanlder.getHasErrorsCell()},getSmallFooterCell:d.returnConst(y.smallFooterCell),getPrimaryPanelRootPathsCell:function(){return y.master.rootPaths},setKeyboardEnabled:function(a){y.keyboardManager.setEnabled(a)},getMasterViewModel:function(){return y.master.bW()},getMasterViewAdjustedCell:function(){return y.master.bW().ku()},loadJiraConfig:function(a){y.jiraConfig.load(a)},setView:function(a,b){y.master.bW().mz(a,b)},setInitialView:function(a){y.master.bW().setInitialViewId(a)},showHistory:function(a){y.bF.forcedVersionCell.setValue(a)},registerAction:function(a,b){y.globalActions.register(a,b)},getMasterEventBus:function(){return y.master.bD()},setAnchorIssue:function(a,b,c){y._anchorIssue=a||null;var d=y.master;a?(a=""+a,b&&d.pinnedItem.setValue(a),c&&d.setInitiallyFocusedItem(a)):d.pinnedItem.setValue(null)},
getAnchorIssue:function(){return y._anchorIssue},reinstallAJSMouseHandler:function(){y.mouseController.installAJSMouseHandler()},reviveIssueActionDropDowns:function(){y.ajsBridge.ob()},popupQuestion:function(a){y.decisionPanel.show(a)},clearQuestion:function(a){y.decisionPanel.close(a)},setErrorsEnabled:function(a){y.errorPanel.setEnabled(a)},setSingleStructureMode:function(a){if(Z.modes.ISSUE_PAGE||Z.modes.GH_TAB)f("body").toggleClass("s-single-structure",a),y.master.getPanelHeader().setSingleStructureMode(a)},makeFooterResponsive:function(a){a||(a=f("#structure").find(".foot"));y.smallFooterCell.pipeChanges(function(b){a.toggleClass("s-small",b)});var b=function(){var b=a.width();y.smallFooterCell.setValue(!1);var c=g.reduce(a.children(":visible:not(.br)"),function(a,b){return a+f(b).outerWidth(!0)},0);y.smallFooterCell.setValue(c>b)},c=g.throttle(b,100);y.eventBus.addListener(new d.Life,Q.av,b);y.getMasterViewAdjustedCell().pipeDebounced({wait:100,waitInit:100},c);y.getHasErrorsCell().pipeChanges(c);y.getHasConfluenceErrorsCell().pipeChanges(c);y.undoTextCell.pipeChanges(c);y.footerStatTextCell.pipeChanges(c);c()},installKeyAction:M});(Z.instances||(Z.instances=[])).push(this);
["structure/widget/ui/behavior/ClickLabel"].forEach(function(a){require(a)(y)});y.initialized.pipeOnce(d.truthy,function(){sa.setValue(!0)})}function Aa(){var a=Z.instances;if(!a|| !a.length)throw Error("no Structure widget");1<a.length&&d.warn(a.length+" Structure widgets on this page!");return a[a.length-1]}var Z=namespace("almworks.structure"),va=namespace("almworks.structure.apputil"),Q=namespace("almworks.structure.appevents");Z.getUrlHashParam("traceRoot");var sa=new d.Cell(!1),ta={"default":"s-fa s-fa-fw s-fa-circle",confluence:"alm alm-fw alm-pages"};V.initialize();T.getWidget=Aa;T.onWidgetReady=function(a){sa.pipeOnce(d.truthy,function(){var b=Aa();d.assert(null!=b,"widget should not be null");a(b)})};return T});(function(f){function b(c,d){c="object"===typeof c&&c||{};var e=null;a.eachOwn(d,function(d){var f=this[d],g;null===f?c.hasOwnProperty(d)&&(e=e||a.extendOwn({},c),delete e[d]):(g=c[d],"object"===typeof f&&(f=b(g,f)),f!==g&&(e=e||a.extendOwn({},c),e[d]=f))});return e||c}function g(a,b,c,d,e){this.prefix=a+".";this.kp={};this.kU={};this.storage=e.widget.storage;this.panel=e;this.viewIdWrapper=new k(e,a,b,c,d)}var d=namespace("almworks.structure"),e=namespace(
"almworks.structure.api"),a=namespace("almworks.util"),n=namespace("almworks.structure.appevents"),c=require("almworks/jquery"),p=require("underscore"),m=require("structure/widget/perspective/StoredValueWrapper"),k=require("structure/widget/ui/view/ViewIdWrapper"),r=require("structure/widget/ui/view/ViewModificationsWrapper"),l=require("structure/widget/ui/view/ViewWidthsWrapper"),h=require("structure/widget/ui/view/RecentViewsModel"),u={actions:1,handle: -1};f=e.baseClass("ViewConfigModification",{init:function(a){this.csid=this.validateOption("csid",s)},validateOption:function(a,b,c){var d=this.options;if(!d)throw "no options";if(!d.hasOwnProperty(a))throw "missing option "+a;d=d[a];if(b&&typeof d!==b)throw "bad option "+a+" :"+typeof d;if(c&&d!==c)throw "bad option "+a+" :"+d+" vs. expected "+c;return d},apply:a.pvc,findColumn:function(a,b){var c=a.columns,d=this.columnIndex(c,b);return 0<=d?c[d]:null},columnIndex:function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c].csid===b)return c;return-1},merge:function(a,b,c){return null},mF:function(a){return a.options.type===this.options.type&&a.options.csid===this.options.csid},mf:function(a,b,c){for(var d=b&&b.length||0,e=c&&c.length||
0,f=d>e?d:e,g= -1,h=0;h<f&&0>g;h++)h<d&&(g=this.columnIndex(a,b[d-h-1]),0<=g&&g++),0>g&&h<e&&(g=this.columnIndex(a,c[h]));return g}});var s="string",q=e.subClass("AddColumn",f,{init:function(a){this.validateOption("type",s,"colAdd");this.validateOption("prev");this.validateOption("next");this.validateOption("spec","object")},apply:function(b){var c=this.options.spec,d=this.csid;if(this.findColumn(b,d))throw Error("column "+d+" already present");var e=b.columns,f=e.length,g=this.mf(e,this.options.prev,this.options.next);0>g&&(g=f);if(0<f){for(;0<g&&1===u[e[g-1].key];)g--;for(;g<f&& -1===u[e[g].key];)g++}var h=[];a.addAll(h,e,0,g);h.push(a.extend({},c,{csid:d}));a.addAll(h,e,g,f);b.columns=h}}),x=e.subClass("RemoveColumn",f,{init:function(a){this.validateOption("type",s,"colRemove")},apply:function(a){a=a.columns;var b=this.columnIndex(a,this.options.csid);0<=b&&a.splice(b,1)},merge:function(a,b,c){if(a.options.csid!==this.options.csid)return null;a=a.options.type;return "colChange"===a?[null,this]:b?"colAdd"===a?[null,null]:[null,this]:null}}),t=e.subClass("MoveColumn",f,{init:function(a){this.validateOption("type",s,"colMove");this.validateOption("prev");this.validateOption("next")
},apply:function(b){var c=a.addAll([],b.columns),d=this.columnIndex(c,this.options.csid);if(!(0>d)){var e=c.splice(d,1)[0],f=this.mf(c,this.options.prev,this.options.next);0>f||f===d||(c.splice(f,0,e),b.columns=c)}},merge:function(a,b,c){return b&&this.mF(a)?[null,this]:null}}),w=e.subClass("ChangeColumn",f,{init:function(a){this.validateOption("type",s,"colChange");a=this.validateOption("spec","object");if(a.csid&&this.csid!==a.csid)throw Error("can change column only to another column with the same csid");},apply:function(a){a=a.columns;var b=this.columnIndex(a,this.csid);0>b||(a[b]=this._newSpec())},merge:function(b,c,d){if(this.mF(b)){a:{b=this.csid;if(d&&b&&(d=d.columns,a.isArray(d)))for(c=0;c<d.length;c++){var e=d[c];if(e&&e.csid===b){b=e;break a}}b=null}return b&&a.deepEquals(b,this._newSpec())?[null,null]:[null,this]}return null},_newSpec:function(){return a.extendOwn({},this.options.spec,{csid:this.csid})}}),v={colAdd:q,colRemove:x,colMove:t,colChange:w};a.extend(g.prototype,{lY:function(a){this.viewIdWrapper.setValue(a)},detach:function(){this.viewIdWrapper.detach()},forceView:function(a){this.bA=a||0;if(a){var b=this.viewIdWrapper.bf();b&&b!==a&&(this.ki(a),this.lM(a));
this.viewIdWrapper.forceValue(a)}},lJ:function(a){return this.bA&&a!==this.bA?[]:this.storage.read(new r(this.panel,a,this.prefix,this.bA))},cO:function(a,b){var c=this.kp[a];if(!c||b){for(var d=this.lJ(a),c=[],e=0,f=d.length;e<f;e++){var g;if((g=d[e])&&g.type){var h=v[g.type];if(h){var k=void 0;try{k=new h(g)}catch(l){k=null}g=k}else g=null}else g=null;if(!g)return[];c.push(g)}this.kp[a]=c}return c},mL:function(b,c,d){var e=this.cO(b);a.addAll(e,c);c=e;for(var f,g=c.length,h= !1,k,l,e=g-1;0<e;e--)if(c[e])for(l= !0,f=e-1;0<=f&&(!c[f]||(k=c[e].merge(c[f],l,d),l= !1,!k||2!==k.length||(h=k[0],k=k[1],a.assert(!h|| !k),c[f]=h,c[e]=k,h= !0,k)));f--);if(h){d=[];for(e=0;e<g;e++)(h=c[e])&&d.push(h);e=d}else e=c;this.kp[b]=e;this.storage.save(new r(this.panel,b,this.prefix,this.bA),e)},ki:function(a){var b=this.cO(a);return b&&b.length?(this.kp[a]=[],this.storage.save(new r(this.panel,a,this.prefix,this.bA),null),!0): !1},kG:function(a,b){if(this.bA&&a!==this.bA)return{};var c=this.kU[a];if(!c||b)c=this.storage.read(new l(this.panel,a,this.prefix,this.bA)),this.kU[a]=c;return c},kh:function(a,c){var d=this.kG(a),e=b(d,c);e!==d&&(this.storage.save(new l(this.panel,a,this.prefix,this.bA),e),
this.kU[a]=e);return e},lM:function(b){var c=this.kG(b);return a.isEmptyOrFalsy(c)? !1:(this.kU[b]={},this.storage.save(new l(this.panel,b,this.prefix,this.bA),null),!0)},lT:function(b,c){var d=this.kG(b),e= !1;a.eachOwn(d,function(b){var d=null;a.eachOwn(this[b],function(b){c.hasOwnProperty(b)&&(d=d||a.extendOwn({},this),d[c[b]]=d[b],delete d[b])});d&&(this[b]=d,e= !0)});e&&(this.storage.save(new l(this.panel,b,this.prefix,this.bA),d),this.kU[b]=d);return d}});d.mE=function(b){function f(a){if(a){var b= !1;X.mi(a,function(c){a===E.ay.value()&&(E.ag.setValue(c),b= !0,c||a===d.FALLBACK_VIEW_ID||E.ay.setValue(d.FALLBACK_VIEW_ID))});b||E.ag.setValue(null)}else E.ag.setValue(null)}function k(b,c){if(!b|| !c)return!1;for(var d= !1,e=0,f=c.length;e<f;e++)try{c[e].apply(b),d= !0}catch(g){a.warn("cannot modify view spec",g)}0<f&&(b.columns=s(b.columns));return d}function l(a){var d=E.ag.value();if(d){var e=c.extend(!0,{},d.spec),f={};e.columns=s(e.columns);var g= !1;I&&(f=I.cO(d.id,a),g=k(e,f),f=I.kG(d.id,a));E.ck.setValue({spec:e,widths:f,ey:{preferred:1,manual:1}});E.jM.setValue(g);b.bD().fireEvent(n.mx,e)}else E.ck.setValue({spec:null,widths:null,ey:null})}function s(b){b=b||[];var c=
a.find(b,function(a){return "main"===a.key}),d=a.find(b,function(a){return "handle"===a.key}),f=[];f.push(0<=d?b[d]:{csid:"handle",key:"handle"});0>c&&f.push({csid:"main",key:"main"});for(var d=0,g=b.length;d<g;d++){var h=b[d];if(h){var k=h.key;k&&e.ColumnType.getColumnTypeForKey(k)?h.csid?u[k]||"main"===k&&d!==c||f.push(h):a.warn("view spec contains column without csid ("+k+")"):a.warn("view spec contains column of unknown key "+k)}}fa.areJiraActionsDisabled()||(c=a.find(b,function(a){return "actions"===a.key}),f.push(0<=c?b[c]:{csid:"actions",key:"actions"}));return f}function r(a,c){var e=b.panelName+".";"structure"===a?e+=c:"structure-with-details"===a?e+=c+":structure-with-details":"issue"===a?e+=c+":issue":"project"===a||"version"===a||"component"===a?e+=c+":pcv":"gadget"===a?e+="gadget:"+(d.modes.GADGET_ID||"0"):"greenhopper"===a&&(e+="gh:"+(d.modes.GH_AGILEBOARD_ID||"0"));return e}function v(a){var c=d.modes.getStructurePageId();a=X.jf(a);c=b.widget.az.oh()===c;M&&(a=a&&c&&b.widget.az.getPerspectiveId());return a}function K(c){b.widget.storage.whenReady(function(){var e=b.getPanelSettingsKey();if(e){var f=M?ga||b.widget.config.forceViewId:0,h=d.modes.getStructurePageId(),e=
r(h,e),k=v(c),l=k?c:b.widget.config.initialViewId;I&&I.detach();I=new g(e,k,l,E.ay,b);f?(I.forceView(f),a.assert(d.modes.GADGET||d.modes.GH_TAB||ga,f),ma.recordRecent=a.noop,J(),E.structurePageId.setValue(d.modes.getStructurePageId())):(S.cycle(),E.ay.pipe(S,!1,function(a){R[h]=a}),R[h]?a.Cell.multiUpdate(function(){E.structurePageId.setValue(d.modes.getStructurePageId());E.ay.setValue(R[h])}):(J(),E.structurePageId.setValue(d.modes.getStructurePageId())))}else E.ay.setValue(0)})}function J(){I&&I.viewIdWrapper.restore(function(a){ma.recordRecent(a)})};function O(a,c){if(I){var d=E.ag.value();if(d&&d.id){I.mL(d.id,a,d.spec);c&&I.kh(d.id,c);d=E.jM.value();l();var e=E.jM.value();d!==e&&b.bD().fireEvent(n.md,L,e,d);ba.fireEvent(n.VIEW_ADJUSTED,L)}}}function V(a){var b=I.cO(a),c,d,e,f=null;if(!b|| !b.length)return!1;I.ki(a);c=0;for(d=b.length;c<d;c++)if(e=b[c],e instanceof q||e instanceof w)f=f||{},f[e.csid]=null;f&&I.kh(a,{manual:f,preferred:f});return!0}function U(b){b=b.columns;var c=0,d= !1,e,f=b.length,g,h={};for(e=0;e<f;e++)(g=(g=b[e])&&g.csid)?a.tail(g,"#")?d= !0:(g=a.toIntSafe(g,0),g>c&&(c=g)):(b.splice(e,1),e--,f--);if(d)for(e=0;e<f;e++)g=b[e],a.tail(g.csid,"#")&&(g.csid=
h[g.csid]=""+ ++c);return h}function P(a,b){b&&I&&(I.lY(a),ma.recordRecent(a));E.ay.setValue(a)}function Y(a){return!u[a]}function N(a){if(!I)return!1;a=I.cO(a);return!(!a|| !a.length)}a.addSuper(m,this)(b.widget,b.panelName);var L=this,fa=a.nn(b.config),X=b.widget.jT,M=b===b.widget.master,ba=b.widget.eventBus,E={},I,ma=new h(b),R={},S=new a.Lifecycle;E.ay=new a.Cell(0);E.ag=new a.Cell(null);E.structurePageId=new a.Cell;E.ck=new a.Cell({spec:null,widths:null,ey:null});E.colWidths=new a.Cell(null);E.ay.pipe(f);E.lK=new a.Cell(E.ag,function(a){return{name:a&&a.name||"?",description:a&&a.description||"",id:a&&a.id}});E.jM=new a.Cell(!1);var ga=0;new a.Cell(E.ag,E.structurePageId,l);this[n.STRUCTURE_CHANGED]=M?this[n.STRUCTURE_PAGE_CHANGED]=p.bind(K,this,d.iq):p.bind(K,this,d.jG);this[n.jH]=function(a){a===E.ay.value()&&f(a)};var da=new a.Life;b.bD().addListener(da,this);var ia=b.ah();ia.register("view.revert",function(){var a;a=I?(a=E.ag.value())&&a.id?V(a.id): !1: !1;return a?(l(),ba.fireEvent(n.VIEW_ADJUSTED,L),!0): !1});ia.register("view.save",function(){if(!I)return!1;var b=E.ag.value(),d=b&&b.id;if(!d||0>d|| !N(d))return!1;b=E.ck.value().spec;if(a.isEmptyOrFalsy(b))return!1;
var b=c.extend(!0,{},b),e=U(b);X.mY(d,b,function(a){a&&(I.ki(d),I.lT(d,e),E.ay.value()===d&&E.ag.setValue(a))});return!0});ia.register("view.switch",function(b){b=a.toIntSafe(c(b.target).attr("rel"),0);if(!b)return!1;P(b,!0);return!0});ia.register("view.share-all",function(b){(b=b&&a.toIntSafe(c(b.target).attr("rel")))||(b=E.ay.value());if(!X.lN(b))return!1;X.makePublic(b);return!0});ia.register("view.share-none",function(b){(b=b&&a.toIntSafe(c(b.target).attr("rel")))||(b=E.ay.value());if(!X.lN(b))return!1;b=X.np(b);if(!b)return!1;b.permissions=[];X.saveView(b);return!0});ba.addListener(da,n.VIEW_ADJUSTED,function(a){a!==L&&a.fi()===L.fi()&&l(!0)});ba.addListener(da,n.VIEW_SAVED_AS,function(a,b){L.fi()===a&&(E.ay.setValue(b),I&&I.ki(a))});a.extend(this,m.prototype,{um:function(){return E.ck.value().spec},mR:function(){return E.ck},fi:function(){return E.ay.value()},mA:function(){return E.ay},getBaseViewName:function(){var a=E.ag.value();return a?a.name||"":""},getBaseViewCell:function(){return E.ag},mG:function(){return E.ag.value()},lX:function(){return E.lK},ku:function(){return E.jM},df:function(b,c){var d=E.ag.value(),e,f;d&&I&&(e=I.kh(d.id,b),d=E.ck.value(),f=a.extendOwn({},
d.ey),b.manual&&(f.manual=(f.manual||0)+1),b.preferred&&(f.preferred=(f.preferred||0)+1),E.ck.setValue({spec:d.spec,widths:e,ey:f,kC:c}))},moveColumn:function(b,c,d){O([new t({type:"colMove",csid:b,prev:a.arrayFilter(c,Y),next:a.arrayFilter(d,Y)})])},removeColumn:function(b){var c=a.collectMap(b,null);O([new x({type:"colRemove",csid:b})],{manual:c,preferred:c})},addColumn:function(b,c,d,f){var g;if(!(g=b.csid))a:if(g=E.ag.value(),I&&g&&g.id){g=I.cO(g.id);for(var h=0,k=0,l=g.length;k<l;k++){var m=g[k];e.isInstance(q,m)&&(m=a.toIntSafe(a.tail(m.options.csid,"#"),0),0>=m?h++ :m>h&&(h=m))}for(g=h+1;;g++)if(h="#"+g,!p.contains(f,h)){g=h;break a}}else g="#"+(new Date).getTime();f=g;O([new q({type:"colAdd",csid:f,spec:b,prev:a.arrayFilter(c,Y),next:a.arrayFilter(d,Y)})]);return f},changeColumn:function(b,c){var d=a.collectMap(b,null);O([new w({type:"colChange",csid:b,spec:c})],{manual:d,preferred:d})},mr:function(){var a;a=E.ag.value();a=I&&a&&a.id?(a=I.cO(a.id))&&a.length?a:null:null;return!(!a|| !a.length)},nt:N,lC:function(){var a=E.ag.value();return a&&a.writable},mz:P,setInitialViewId:function(a){P(a,!1);ga=a},isCreateViewAllowed:function(){
return b.widget.jiraConfig.isCreateViewAllowed()},saveViewAs:function(b,d){b=c.trim(b||"");var e=E.ck.value().spec;if(!b|| !I||a.isEmptyOrFalsy(e))return d&&d(null),!1;var f=E.ay.value(),e=c.extend(!0,{},e),g=U(e);X.createView(b,e,function(b){b&&(I.lM(b.id),I.kh(b.id,I.kG(f)),I.lT(b.id,g),V(f),f===E.ay.value()&&P(b.id,!0),ba.fireEvent(n.VIEW_SAVED_AS,f,b.id));a.safeCall(d,b,b)});return!0},mo:function(a){var b=ma.bf();b&&b.length?X.mW(b,a):a([])},mZ:function(a,b){if(!a|| !b)return null;var d=I.cO(b);if(!d|| !d.length)return null;var e=c.extend(!0,{},a);if(!k(e,d))return null;U(e);return e},kb:function(a){if(a)for(var b=0,c=a.length;b<c;b++){var d=a[b],e=d&&d.id;e&&N(e)&&(d._adjusted= !0)}return a},mC:function(a){!a||0<a||P(a,!1)},mV:function(){var a=E.ay.value();0>a&&(I&&I.ki(a),J())},perspectivePath:b.panelName+".viewSpec",bf:function(){return this.um()},importModel:function(a){X.importPerspectiveView(b.panelName,a)},lb:function(a,b){b(this)}});this.restore()}})(window);(function(f){function b(a){return a&&a.length?c(a[0]):a}var g=namespace("almworks.structure"),d=namespace("almworks.util"),e=namespace("almworks.structure.appevents"),a=g.$,n=g.api,c=require("jquery"),p=n.baseClass(
{getHtml:function(a,b){}}),m=n.subClass(p,{getHtml:function(a){if(!a.mr())return null;var b='<span class="s-adjusted-mark">*</span> <span>{s.w.view.stripe.modified}</span><span class="s-view-dd-stripe-actions">';a.lC()&&(b+='<a href="#" data-s-action="view.save" title="{s.w.view.action.save.title}">{s.w.view.action.save.label}</a>');a.isCreateViewAllowed()&&(b+='<a href="#" data-s-action="view.save-as" title="{s.w.view.action.save-as.title}" class="interactive">{s.w.view.action.save-as.label}</a>');return b+'<a href="#" data-s-action="view.revert" title="{s.w.view.action.revert.title}">{s.w.view.action.revert.label}</a></span>'},cssClass:function(){return "s-stripe-modified"}}),k=n.subClass(p,{getHtml:function(a){return this.active?a.isCreateViewAllowed()&&a.mr()?'<form class="s-save-as-form" data-s-action="view.save-as.apply"><div><div><input name="name" type="text" size="20" maxlength="255" class="ajs-dirty-warning-exempt s-view-dd-saveas-name s-menulist-keyboard-ignore"></div><span></span><div><input type="submit" class="aui-button aui-button-compact" value="{s.w.view.stripe.saveas.save}"></div></div></form>':(this.deactivate(),null):null},deactivate:function(){this.active&&(
this.active= !1,this.focus&&(this.focus=this.focus.returnFocus()))},cssClass:function(){return "s-stripe-saveas"}}),r=n.subClass(p,{getHtml:function(a,b){var c=a.mG();if(!c|| !c.adminable)return null;var d= ! !c.shared,c= ! !c.sharedWithAll;return d||b.widget.jiraConfig.isShareViewAllowed()?d?"<span>"+(c?"{s.w.view.stripe.shared.public}":"{s.w.view.stripe.shared.true}")+'</span><span class="s-view-dd-stripe-actions"><a href="#" data-s-action="view.details.sharing" title="{s.w.view.action.sharing-details.title}">{s.w.view.action.sharing-details.label}</a></span>':'<span>{s.w.view.stripe.shared.false}</span><span class="s-view-dd-stripe-actions"><a href="#" data-s-action="view.share-all" title="{s.w.view.action.share-all.title}" class="interactive">{s.w.view.action.share-all.label}</a><a href="#" data-s-action="view.details.sharing" title="{s.w.view.action.share.title}" class="interactive">{s.w.view.action.share.label}</a></span>':null}});g.lZ=function(l){function h(a,b){return new d.Cell(a,b,function(a,b){return b?null:a})}function n(){if(0===R.jR.value()&&R.visible.value()&& !N.find("li.s-hover:visible").length){var a=null;if(!R.showingFound.value()){var b=V.fi();b&&(a=N.find(
'li > a[rel="'+b+'"]:visible'));a=a&&a.length?a.parent():null}a?ba.selectItem(a):N.find("li > a[rel]:first").length&&ba.selectFirst()}}function p(a){R.jR.setValue(R.jR.value()+a)}function q(){if(S){var a=S;p(1);U.nh(a,function(b){p(-1);a===S&&R.foundViews.setValue(V.kb(b))})}}function x(){if(V.fi()){var b=V.lX().value(),c=b&&b.name||"";(b=b&&b.description||"")&&(b=" - "+b);X.name.text(c).attr("title",d.text("s.w.view.current.title")+" "+c+b)}var c=d.onPage(N),b=null,e,f=Y.length;for(e=0;e<f;e++){var g=Y[e],h=d.renderTemplate(g.getHtml(V,l));h?(g.div$?g.div$.html()!=h&&g.div$.html(h):(g.div$=a('<div class="s-view-dd-stripe '+("function"===typeof g.cssClass?g.cssClass():"")+'"></div>').html(h),c&&g.div$.css("display","none"),b?b.after(g.div$):g.div$.prependTo(X.stripes),c&&z(g.div$,!0)),b=g.div$):g.div$&&(c?z(g.div$,!1):g.div$.remove(),g.div$=null)}}function t(a,b,c){a.pipe(function(a){var e="";if(a)for(var f=0,g=a.length;f<g;f++){var h=a[f],k=h.id;if(h.name&&k)var l="aui-dropdown2-radio",l=l+(V.fi()===k?" checked":""),l=l+(h._adjusted?" s-view-adjusted":""),e=e+d.renderTemplate(
'<li class="{classes:html}"><a href="#" data-s-action="view.switch" rel="{id}" title="{description}">{name}</a></li>',h,{classes:l})}e?(c.html(e),b.show()):(b.hide(),c.html(e))})};function w(){p(2);U.mK(l.getPanelSettingsKey(),function(a){p(-1);R.associatedViews.setValue(V.kb(a))});V.mo(function(a){p(-1);R.nu.setValue(V.kb(a))})}function v(){if(!ma){var b,c;if(E.length)b=E[0],"show"===b.data("animate")?(ma= !0,b.slideDown("fast",C)):(ma= !0,b.slideUp("fast",function(){a(this).remove();C()}));else{var e=I;if(e.length)for(I=[],b=0,c=e.length;b<c;b++)d.safeCall(e[b])}}}function C(){ma= !1;E.length&&E.splice(0,1);E.length?f.setTimeout(v,100):v()}function z(a,b){a.data("animate",b?"show":"hide");E.push(a);v()}function F(a){E.length?I.push(a):a()}function A(){return N.is(":visible")}function D(){A()||l.widget.config.forceViewId||b(L).trigger("aui-button-invoke")}function G(){A()&&b(L).trigger("aui-button-invoke")}function B(a,b,c){a!==R.visible.value()&&(a?(R.lF.setValue(V.fi()),x(),w(),ba.jo(),R.searchTerm.setValue(""),c?N.is(":visible")||N.css({left:0,top:0}):D(),M=d.borrowFocusDeferred(X.input,N)):(P.deactivate(),c||G(),M&&M.done(function(a){a.returnFocus(b)})),R.visible.setValue(a))}
function K(a){if(!0===a|| !1===a? !a:P.active)P.deactivate(),A()&&x();else{if(!V.isCreateViewAllowed()|| !V.mr())return!1;D();P.active= !0;x();F(function(){var a=P.div$&&P.div$.find("input:text:visible");a&&a.length&&(P.focus=d.borrowFocus(a,P.div$))})}return!0}function J(a,b){B(!1);fa||(fa=new(require("structure/widget/ui/view/ViewDialog"))(l));fa.reset(a?V.fi():0,b);fa.show()}function O(){A()&&(x(),w())}var V=l.bW(),U=l.widget.jT,P=new k,Y=[new m,P,new r],N=l.getPanelHeader().getViewsContainer$(),L=l.getPanelHeader().getViewSelector$(),fa,X={name:N.find(".s-view-dd-current-name"),stripes:N.find(".s-view-dd-stripes"),input:N.find(".s-view-dd-search"),recent:N.find(".s-view-dd-recent"),recentList:N.find(".s-view-dd-recent ul"),associated:N.find(".s-view-dd-associated"),associatedList:N.find(".s-view-dd-associated ul"),found:N.find(".s-view-dd-found"),foundList:N.find(".s-view-dd-found ul"),notFound:N.find(".s-view-dd-notfound"),progress:N.find(".s-view-dd-progress")},M=null,ba=new g.apputil.MenuList({container$:N,handler:{onMenuCancelled:G,onMenuItemChosen:function(a){var b=a&&d.toIntSafe(a.find("a").attr("rel"))||0,c= !1;b?(l.widget.eventBus.postEvent(e.gS,"view.switch"),V.mz(b,!
0),c= !0):"view.manage"===a.find("a[data-s-action]").attr("data-s-action")&&(J(!1,null),c= !0);a.parents().find(".checked").removeClass("checked");a.addClass("checked");B(!1);return c}}}),E=[],I=[],ma= !1,R={associatedViews:new d.Cell(null),nu:new d.Cell(null),foundViews:new d.Cell(null),lF:new d.Cell(0),visible:new d.Cell(!1),jR:new d.Cell(0),searchTerm:new d.Cell("")};R.me=function(){return new d.Cell(R.associatedViews,R.nu,R.lF,function(a,b,c){if(!a|| !b)return null;c=[];a=d.mapArray(a,function(a){return a&&a.id});for(var e=0;e<b.length;e++){var f=b[e];if(f&&f.id&& !a[f.id]&&(c.push(f),4<=c.length))break}return c})}();R.showingFound=new d.Cell(R.foundViews,function(a){return! !a});c(f.document).on("aui-dropdown2-show aui-dropdown2-hide",".s-view-dd",function(a){a&&a.target===N[0]&&B("aui-dropdown2-show"===a.type,!1,!0)});(function(){N.find(".s-view-dd-top").keydown(function(b){if(b&&b.target&&a(b.target).is(".s-view-dd-saveas-name:visible")&&(b.stopPropagation(),27===d.keyboardCodeFromEvent(b)))return K(!1),b.preventDefault(),!1})})();(function(){new d.TextPresenter(R.searchTerm,X.input);R.searchTerm.pipe(function(b){(S=a.trim(b||""))?U.nm(S)?q():ga():R.foundViews.setValue(null)
});(new d.Cell(R.foundViews,function(a){return!(!a||a.length)})).pipe(function(a){X.notFound.toggle(a)})})();(function(){(new d.Cell(R.jR,function(a){return 0<a})).setDelay(500).pipe(function(a){X.progress.toggle(a)});R.jR.pipeChanges(function(a){a||f.setTimeout(n,0)})})();t(h(R.associatedViews,R.showingFound),X.associated,X.associatedList);t(h(R.me,R.showingFound),X.recent,X.recentList);t(R.foundViews,X.found,X.foundList);var S="",ga=d.delayed(400,q),da=l.ah();this[e.mx]=O;this[e.jH]=O;this[e.dz]=this[e.aN]=G;l.bD().addListener(new d.Life,this);d.extend(this,{kY:function(){return R.visible}});da.register("view.select",D);da.register("view.save-as.cancel",d.curry(K,!1));da.register("view.save-as.apply",function(b,c){var e=a.trim(c&&c.name||"");if(!e)return K(!1),!0;var f=a(b.target).closest("form.s-save-as-form");f.find('input[type="submit"]').attr({disabled:"disabled",value:d.text("s.w.view.stripe.saveas.saving")});f.find('input[type="text"]').attr("readonly","readonly").css("color","#666");f.find("a").hide();V.saveViewAs(e,function(a){a&&a.id&&R.lF.setValue(a.id)})});da.register("view.save-as",K);da.register("view.manage",d.curry(J,!1,null));da.register("view.details.sharing",
d.curry(J,!0,"#s-view-permissions"))}})(window);(function(f,b){function g(b,c,d,e){a.assert(0>b,b);return{id:b,name:c?a.text(c):"?",description:d?a.text(d):"",writable: !1,adminable: !1,shared: !1,sharedWithAll: !1,permissions:[],owner:null,spec:e}}function d(a){var b=[{key:"handle",csid:"handle"},{key:"field",csid:"1",params:{field:"issuekey"}},{key:"main",csid:"main"}];a&&b.push({key:"actions",csid:"actions"});return{columns:b}}var e=namespace("almworks.structure"),a=namespace("almworks.util"),n=require("almworks/util/JSON"),c=namespace("almworks.structure.appevents"),p=require("underscore"),m=require("structure/widget/perspective/StorageUtil"),k=require("almworks/jquery"),r=g(-1,"s.w.view.fallback-config.name","s.w.view.fallback-config.description",d(!0)),l=g(-2,"s.w.view.fallback-config.name","s.w.view.fallback-config.description",d(!1)),h=g(-3,"s.w.view.gh.name","s.w.view.gh.description",d(!1)),u=[r,l,h];e.lH=function(d){function f(a){var b=[];if(!a)return b;for(var c=0,d=a.length;c<d;c++){var e=h(a[c]);e&&b.push(e)}return b}function h(a){return a?(a=B[a])?k.extend(!0,{},a):null:null}function l(a,b){if(!a)return null;for(var c=[],d=0,e=a.length;d<e;d++){var f=r(a[d],b);f&&
c.push(f)}return c}function r(b,e,f){if(!b|| !b|| !b.spec)return!1;var g=b.id;if(!g||0>g&& !f|| !b.name)return!1;b.hasOwnProperty("description")||(b.description="");d.jiraConfig.le()&&(b.writable=b.adminable= !1);f=B[g];B[g]=b;if(e||K.hasOwnProperty(g))K[g]= ! !e;f&& !a.isDeeplySame(f,b)&&d.eventBus.postEvent(c.jH,g);return g}function v(a,b,c){a=a+"?forPage="+b;p.isNumber(c)&&(a+="&forStructure="+c);return a}function C(a){var b=null,c;for(c in P)if(P.hasOwnProperty(c)&&"string"===typeof c&&0<=a.indexOf(c)){var d=P[c];d&&d.length&&(!b||b.length>d.length)&&(b=d)}return b}function z(a,b){for(var c=[],d=0,e=a.length;d<e;d++){var f=B[a[d]];f&&(f=f.name)&&0<=(f?f.toUpperCase().toLocaleLowerCase():"").indexOf(b)&&c.push(h(a[d]))}return c}function F(){P={};U=V=null;O={};J={}}function A(a,b,c){D(a,b,!1,c)}function D(c,d,f,g){var k=null;c=new G.Task(e.ajax.RESOURCES.VIEW+c,d?e.ajax.UPLOAD:e.ajax.DOWNLOAD,function(a){k=r(a,f)});c.chainComplete(function(){a.safeCall(g,b,h(k));d&&F()});d&&(c.type="POST",c.data=d);G.addTask(c)}var G=d.ajax,B={},K={},J={},O={},V=null,U=null,P={};(function(){for(var a=0,b=u.length;a<b;a++){var c=u[a];B[c.id]=c}})();a.extend(this,{jf:function(a){return! !B[a]},
isViewConfigurationShared:function(a){return(a=B[a])? ! !a.shared: !1},isViewConfigurationDefaultForCurrentStructure:function(a){var b=d.master.getPanelSettingsKey();if(!b)return!1;var c=e.modes.getStructurePageId();return J[b+"."+c]===a},lN:function(a){return(a=B[a])? ! !a.adminable: !1},mK:function(c,g){if(!c||0>c)g(null);else{var h=e.modes.getStructurePageId(),k=c+"."+h,m=O[k];if(m)g(f(m));else{var n=v(e.ajax.RESOURCES.VIEW+"/menu",h,c);G.addTask(new G.Task(n,e.ajax.DOWNLOAD,function(c){c=l(c.views,!1);O[k]=c;a.safeCall(g,b,f(c))},function(c,f){var h=a.httpErrorReport(c,f);d.errorCentral.reportError(new e.error.AppError(a.text("s.w.error.load-views",h.title),"When loading GET "+n+"\n:"+h.details));O[k]=[];a.safeCall(g,b,[])}))}}},nf:function(a){if(V)a(f(V));else{var b=new G.Task(e.ajax.RESOURCES.VIEW+"?withPermissions=true&withOwner=true&permission=admin",e.ajax.DOWNLOAD,function(a){V=l(a.views,!0)});b.chainComplete(function(){a(f(V))});G.addTask(b)}},nx:function(c,d){if(!c||0>c)d(null);else{var f=null,g=new G.Task(e.ajax.RESOURCES.VIEW+"/"+c+"/associations",e.ajax.DOWNLOAD,function(a){f=a||null});g.chainComplete(function(){a.safeCall(d,b,f)});G.addTask(g)}},mi:function(a,b){
var c=a&&B[a];!a|| !1===c||c?b(h(a)):A("/"+a,!1,b)},np:h,lD:function(a,b){var c=a&&B[a];!a|| !1===c||c&&K[a]?b(h(a)):D("/"+a+"?withPermissions=true&withOwner=true",!1,!0,b)},mD:function(a,b){var c=e.modes.getStructurePageId(),d=a+"."+c,f=J[d]||0;f|| !a?b(f):(c=v("/default",c,a),A(c,!1,function(a){(a=a&&a.id)&&(J[d]=a);b(a)}))},mW:function(c,d){if(c&&c.length){c=k.merge([],c);var g="",h,m=c.length;for(h=0;h<m;h++){var n=c[h],p=B[n];"number"===typeof n&&0<n&& !p&& !1!==p&&(g&&(g+=","),g+=n)}h=function(){a.safeCall(d,b,f(c))};g?(g=e.ajax.RESOURCES.VIEW+"?ids="+encodeURIComponent(g),g=new G.Task(g,e.ajax.DOWNLOAD,function(a){l(a.views,!1)}),g.chainComplete(h),G.addTask(g)):h()}else d(null)},nh:function(a,b){if(a&&"string"===typeof a){var c=a?a.toUpperCase().toLocaleLowerCase():"",d=P[c];if(d)b(f(d));else if(d=C(c))b(z(d,c));else{var d=e.ajax.RESOURCES.VIEW+"?name="+encodeURIComponent(a),g=null,d=new G.Task(d,e.ajax.DOWNLOAD,function(a){g=l(a.views,!1)});d.chainComplete(function(){g&&(P[c]=g);b(f(g))});G.addTask(d)}}else b(null)},lU:function(a){if(U)a(f(U));else{var b=new G.Task(e.ajax.RESOURCES.VIEW+"?withPermissions=true&withOwner=true",e.ajax.DOWNLOAD,function(a){U=l(a.views,!0)});
b.chainComplete(function(){a(f(U))});G.addTask(b)}},nm:function(a){a=a?a.toUpperCase().toLocaleLowerCase():"";return P[a]? !0: ! !C(a)},saveView:function(c,d){var f=c&&c.id;if(f){var g=null,f=new G.Task(e.ajax.RESOURCES.VIEW+"/"+f+"/update",e.ajax.UPLOAD,function(a){g=r(a,!1)});f.chainComplete(function(){a.safeCall(d,b,h(g));F()});f.type="POST";f.data=n.stringify(c);G.addTask(f)}else d(null)},mY:function(a,b,c){a&&b?A("/"+a+"/updateSpec",n.stringify(b),c):c(null)},createView:function(a,b,c){a=n.stringify({name:a,spec:b});A("",a,c)},makePublic:function(a,b){!a||0>a?b(null):A("/"+a+"/makePublic","{}",b)},deleteView:function(f,g){if(!f||0>f)g(!1);else{var h= !1,k=new G.Task(e.ajax.RESOURCES.VIEW+"/"+f,e.ajax.UPLOAD,function(a){h= !0;B[f]=null;K[f]= !1;J={};d.eventBus.postEvent(c.jH,f)});k.chainComplete(function(){a.safeCall(g,b,h);F()});k.type="DELETE";G.addTask(k)}},mb:function(a){return a&&0>a.id?r(a,!0,!0): !1},importPerspectiveView:function(a,b){if(b){var c=a===m.PRIMARY_PANEL_NAME?e.iq:e.jG;B[c]=g(c,"s.w.view.perspective.+"+a+"+.name","s.w.view.perspective.+"+a+"+.description",b);K[c]= !0}}})};e.FALLBACK_VIEW_ID=r.id;e.SECONDARY_VIEW_ID=l.id;e.GREENHOPPER_VIEW_ID=h.id;e.iq= -20;
e.jG= -21;e.iJ=function(a){return a===e.iq||a==e.jG}})(window);(function(){function f(a){a=e.getStored(a);var b;try{b=e.JSON.parse(a)}catch(c){}return b&&"number"===typeof b.timestamp&&"object"===typeof b.stats?b:null}function b(){var a=new Date;a.setMilliseconds(0);a.setSeconds(0);a.setMinutes(0);a.setHours(0);return a.getTime()}function g(a){a&&"string"===typeof a&&(m.stats[a]=(m.stats[a]||0)+1,l())}function d(a,b){e.setStored(a,e.apputil.ct(b))}var e=namespace("almworks.structure"),a=namespace("almworks.structure.appevents"),n=namespace("almworks.util"),c=new e.ajax.AJAX,p=0,m=f("statistics.currentData")||{timestamp:b(),stats:{}},k=f("statistics.prevData"),r={};r[a.ACTION]=g;r[a.gS]=function(a){if(a)if(n.isArray(a))for(var b=0,c=a.length;b<c;b++)g(a[b]);else g(a)};var l=n.delayed(1E3,function(){var a=b();a!==m.timestamp&&(k=m,m={timestamp:a,stats:{}},d("statistics.prevData",k),h());d("statistics.currentData",m)}),h=n.delayed(12E4,function(){var a=new c.Task(e.ajax.RESOURCES.STATISTICS+"/record",e.ajax.UPLOAD,function(){k=null;d("statistics.prevData",k);p=0},function(){p++;3>p?h():(n.warn("failed to send usage statistics to server"),k=null,d("statistics.prevData",k),p=0)});
a.type="POST";a.data=e.apputil.ct(k);c.addTask(a)});k&&h();e.oD=function(a){a.addListener(new n.Life,r)}})();(function(){function f(a,b,c){var d=a[b];a[b]=function(){var e=c.call(this,d,Array.prototype.slice.call(arguments));a[b]=d;return e}}function b(b,c){for(var d=b.getForm().serializeArray(),e=d.length,f=b.getActiveFieldIds(),g={},m=0;m<e;++m){var p=d[m];if(g.hasOwnProperty(p.name))a.isArray(g[p.name])?g[p.name].push(p.value):g[p.name]=[g[p.name],p.value];else if(c||a.contains(f,p.name))g[p.name]=p.value;if("filetoconvert"===p.name){var p=p.value,v=n("#filetoconvert-"+p);v.is('input[type="checkbox"]')&&(v=v.closest("div.field-group"),0!==v.length&&(v=v.find("label").nextAll(),v.length&&(r[p]=v)))}}c&&(g.fieldsToRetain=f);for(m=0;m<f.length;++m)"undefined"===typeof g[f[m]]&&k[f[m]]&& !b.getForm().find('[name="'+f[m]+'"]').length&&(g[f[m]]="");return g}function g(d,e,g,k,q,x,t,w){var v=a.text("s.w.editor.dialog.title"),C=(new p.Forms.Container(function(){function z(){C._unassignEvents("container",document);C._unassignEvents("trigger",C.options.trigger)}function F(){n(document).off("keydown.stcreatedialog").on("keydown.stcreatedialog",function(b){return a.keyboardCodeFromEvent(b)
===m?(n("#st-switch-to-inline").click(),b.stopImmediatePropagation(),b.preventDefault(),!1): !0})}function A(){n(document).off(".stcreatedialog")}function D(a,b,c){var d=a[b];a[b]=function(){d.apply(this,arguments);c.apply(this,arguments)};V.push([a,b,d]);return function(){d.apply(a,arguments)}}var G=["QuickCreateIssue"],B=new p.Forms.CreateIssueModel({projectId:d,issueType:e}),K=[];!a.isEmpty(g)&&g.filetoconvert&&(f(B,"getFieldsResource",function(a){return a()+"&toggle=true"}),K=a.isArray(g.filetoconvert)?g.filetoconvert:[g.filetoconvert]);f(B,"refresh",function(b){var d;if(a.isEmpty(g))d=[];else{var e=a.keysOf(g),f=g.fieldsToRetain;d=[n.param(n.extend({retainValues: !0,fieldsToRetain:f?a.unionShortArrays(e,f):e},g),!0)]}var h=this;if(x){var k=c.$.Deferred();x.jiraConfig.mn(function(c){h._structureProjects=a.mapArray(c,function(a){return a.id});b.apply(h,d).then(function(){k.resolveWith(this,arguments)},function(){k.rejectWith(this,arguments)},function(){k.notifyWith(this,arguments)})});return k.promise()}return b.apply(h,d)});var J=new p.Forms.ConfigurableCreateIssueForm({model:B,title:v,globalEventNamespaces:G}),O=new p.Forms.UnconfigurableCreateIssueForm({model:B,title:v,
globalEventNamespaces:G}),V=[],U=D(C,"hide",function(a,b){null===p.Dialog.current&&(b&&b.reason&&(b.reason===p.Dialog.HIDE_REASON.cancel||b.reason===p.Dialog.HIDE_REASON.escape)&&(A(),t.cancel()),z())});w.hide=a.curry(U,!0,{reason:p.Dialog.HIDE_REASON.cancel});var P=null;n.each([J,O],function(f,g){c.$(g).on("rendered.stcreatedialog",function(b,d){c.$(g).off("rendered.stcreatedialog");var e=K,f=d.find("#qf-field-attachment .file-input-list #attachment_div");if(0!==f.length){a.isArray(e)||(e=[e]);for(var h=0;h<e.length;++h){var k=f.find("label[for=filetoconvert-"+e[h]+"]"),l=r[e[h]];l&&k.after(l)}r={}}F()});D(g.helper,"decorate",function(){if(g.model._structureProjects){var f= !1;try{var m=this.getProjectField().find("option").filter(function(){return!g.model._structureProjects[n(this).attr("value")]});m.length?(m.remove(),f= !0):f=x.jiraConfig.filterProjectsSelectionJira64(g.getForm(),g.model._structureProjects)}catch(r){a.warn("error changing available projects: "+r)}if(f)c.$(g).off("rendered.stinjectprojtip").on("rendered.stinjectprojtip",function(b,c){c.find(".qf-field-project > .field-group").append(a.renderTemplate(
'<div class="description">{s.w.editor.dialog.filtered.projects.desc}</div>'))})}f=n('<div id="st-create-buttons"></div>');g.$element.find("#qf-create-another").parents(".buttons").parent().prepend(f);var m=n(a.renderTemplate('<input class="button" id="st-switch-to-inline" name="StInline" type="button" value="{s.w.editor.dialog.inline}" title="{s.w.editor.dialog.inline.tooltip}" />')),w=n(a.renderTemplate('<a href="#" id="st-create-nostruct" title="{s.w.editor.dialog.nostruct.tooltip}">{s.w.editor.dialog.nostruct}</a>'));m.click(function(){var c=b(g,!0);a.extendOwn(c,{projectId:d,issueType:e});U(!0,{reason:"structure-switch-to-panel"});z();A();t.inline(c,P,b(g));return!1});w.click(function(b){try{J.title=O.title=p.Forms.createCreateIssueForm({}).options().configurableForm.title}catch(d){J.title=O.title=a.text("s.w.editor.new.title")}c.$(g).off("rendered.stinjectprojtip");for(b=0;b<V.length;++b){var e=V[b];e[0][e[1]]=e[2]}A();t.cancel();g.render(g.serialize(!0));return!1});f.prepend(w).prepend(m);k&&(p.applyErrorsToForm(g.getForm(),k),g.triggerEvent("validationError",[g,k],!0));q&&p.applyMessageToForm("warning",g.getForm(),a.text("s.w.editor.dialog.clone.disabled"),!0);
t.onJiraDialogInit(b(g))});D(g.helper,"handleSubmitSuccess",function(b){A();t.submit(a.toInt(b.createdIssueDetails.id),B.isInMultipleMode(),b)});D(g.helper,"setProjectId",function(b){d=a.toInt(b);t.onProjectId(d)});D(g.helper,"setIssueType",function(b){e=a.toInt(b);t.onIssueType(e)});g.bind("validationError",function(a,b,c){P=c})});return{globalEventNamespaces:G,model:B,errorHandler:new p.Forms.CreateIssueError,configurableForm:J,unconfigurableForm:O}})).asDialog({trigger:document.createElement("a"),id:"create-issue-dialog",windowTitle:v});C.show()}var d=namespace("almworks.structure");namespace("almworks.structure.api");var e=namespace("almworks.structure.appevents"),a=namespace("almworks.util"),n=d.$,c=a.requireGlobal("AJS"),p=window.JIRA,m=a.keyboardCodeFromString("alt+enter"),k=a.flipSet(["project","timetracking","issuelinks","attachment","worklogged"]);if(p){var r={};d.openCreateIssueDialog=function(b,c,e,f,k,m,n,r){try{if("object"!==typeof p.Forms||"function"!==typeof p.Forms.Container||"function"!==typeof p.Forms.CreateIssueModel||"function"!==typeof p.Forms.UnconfigurableCreateIssueForm||"function"!==typeof p.Forms.ConfigurableCreateIssueForm)
throw "Unsupported JIRA API found";g(b,c,e,f,k,m,n,r)}catch(v){a.warn("Failed to open JIRA Create Issue Dialog: "+v),d.openCreateIssueDialog=null,n&&(n.inline&&n.inline(e,f),n.openFailed&&n.openFailed())}};d.installCreateIssueHandler=function(a){c.$("a.create-issue").prepend("+&nbsp;").on("simpleClick",function(b){if(!a)return!0;var d=a.pageManager.getFocusedPanel();if(!d)return!0;d=d.bD();if(!d)return!0;d.fireEvent(e.ACTION,"createSiblingBelowWithDialog",b);if(b.consumed){b.stopImmediatePropagation();try{c.$(document).trigger(c.$.Event("click",{target:document.createElement("a")}))}catch(f){}return!1}return!0})}}else d.openCreateIssueDialog=null,d.installCreateIssueHandler=null})();define("structure/widget/ui/view/ViewDialog",["almworks/jquery","almworks/util/Template","almworks/util/Binding"],function(f,b,g){function d(a,b){a.data("loaded")||(a.data("loaded",!0),b(function(){a.find(".st-progress-icon").hide();a.children(":not(.st-progress-icon)").show()}))}function e(a,b){var c="<select";b&&(c+=' class="'+b+'"');c+=">";if(a&&a.length)for(var d=0,e=a.length;d<e;d++){var f=a[d];if(f){var g=f.name;g&&(c+=k.renderTemplate('<option value="{id}">{name}</option>',{id:f.id||g,name:g}))}}
return c+"</select>"}function a(a,b){d(a,function(c){b.jiraConfig.mJ(function(b){a.find(".s-subject-group").parent().html(e(b,"s-subject-group"));a.find(".s-subject-group option:first").attr("selected","selected");c()})})}function n(a,b){d(a,function(c){b.jiraConfig.mn(function(b){a.find(".s-subject-project").parent().html(e(b,"s-subject-project"));var d=a.find(".s-subject-project");a.find("option:first",d).attr("selected","selected");var f=new k.Cell;(new k.SelectPresenter(f)).setView(d,!0);var g=k.mapArray(b,function(a){return a.id});f.pipe(function(b){if(b){var c=g[b];if(c){var d=a.find(".s-subject-role");b=d.val();d.parent().html(e(c.userRoles,"s-subject-role"));b&&(c=a.find('.s-subject-role option[value="'+b+'"]'),c.length?c.attr("selected","selected"):b=0);b||a.find(".s-subject-role option:first").attr("selected","selected")}}});c()})})}function c(a){var b={view:[],edit:[],admin:[],isPublic: !1,isPrivate: !a||0===a.length};if(a)for(var c=0,d=0,e=a.length;d<e;d++){var f=a[d];if(!f||"set"!==f.rule)return null;var g=f.level;if(!g)return null;var h=q[g];if(!h||h<c)return null;c=h;h=f.subject;if("anyone"!==h&&"group"!==h&&"projectRole"!==h)return null;"anyone"===h&&(b.isPublic= !
0);h=b[g];if(!h)return k.assert(!1,g),null;h.push(f)}return b}function p(b,c,d){var e={};b.empty().append(s.render$().saveBindings(e));var f=new k.Cell("anyone");new k.SelectPresenter(f,e.type);var g=e["group-params"],h=e["role-params"];f.pipe(function(b){var d="group"===b;b="projectRole"===b;d&&a(g,c);b&&n(h,c);g.toggle(d);h.toggle(b)});e.add.click(function(a){var c=f.value(),e={subject:c};"group"===c?e.groupId=b.find(".s-subject-group").val():"projectRole"===c&&(e.projectId=k.toIntSafe(b.find(".s-subject-project").val()),e.roleId=k.toIntSafe(b.find(".s-subject-role").val()));d(e);a.preventDefault();return!1})}var m=namespace("almworks.structure");namespace("almworks.structure.api");var k=namespace("almworks.util"),r=namespace("almworks.structure.appevents"),l=k.requireGlobal("AJS"),h=namespace("JIRA.userhover",!1),u=require("underscore"),s=b.load("structure.widget.ui.view.subject-selector"),q={view:10,edit:20,admin:30};return function(a,d){var e,n,s;function z(){I||(I=V(),ma=I.page[0],R=I.page[1],I.page[0].ontabchange=function(a){fa()},window.JIRA.bind("Dialog.beforeHide",function(a,b,c,d){"s-manage-views"!==d||1!==I.curpage||J()||a.preventDefault();f("body").removeClass(
"s-viewdialog-shown")}));return I}function F(b){b.element.addClass("s-view-selection-page");b.addHeader(k.text("s.w.view.d.sel.header"));b.addPanel(k.text("s.w.view.d.sel.current"),k.renderTemplate('<div class="s-view-abovelist"><h3>{s.w.view.d.sel.current.title}</h3><div class="s-manageview-description">{s.w.view.d.sel.current.description}</div></div><div class="s-manageview-list"></div>'));b.addPanel(k.text("s.w.view.d.sel.my"),k.renderTemplate('<div class="s-view-abovelist"><h3>{s.w.view.d.sel.my.title}</h3><div class="s-manageview-description">{s.w.view.d.sel.my.description}</div></div><div class="s-manageview-list"></div>'));b.addPanel(k.text("s.w.view.d.sel.associated"),k.renderTemplate('<div class="s-view-abovelist"><h3>{s.w.view.d.sel.associated.title}</h3><div class="s-manageview-description">{s.w.view.d.sel.associated.description}</div></div><div class="s-manageview-list"></div>'));b.addPanel(k.text("s.w.view.d.sel.search"),k.renderTemplate(
'<div class="s-view-abovelist"><div class="s-manageview-search"><form class="aui ajs-dirty-warning-exempt" action="#"><div class="field-group"><label for="s-search-name">{s.w.view.d.sel.search.name}</label><input type="text" class="text" id="s-search-name" name="s-search-name"><div class="description">{s.w.view.d.sel.search.name.description}</div></div><div class="field-group"><input type="submit" value="{s.w.view.d.sel.search}" class="s-button"><input type="button" value="{s.w.view.d.sel.search.all}" class="s-button s-search-all"></div></form></div></div><div class="s-manageview-list"></div>'));b.addButton(k.text("s.w.view.d.close"),M);D(b.panel[0],function(a){var b=ba.mG();b&& -1===b.id&&(b=null);a(b&&[b]||null)});D(b.panel[1],function(a){E.nf(a)});D(b.panel[2],function(b){E.mK(a.getPanelSettingsKey(),b)});S=b.panel[3];A()}function A(){var a=S.body.find("div.s-view-abovelist form"),b=a.find("#s-search-name"),c=a.find("input.s-search-all"),d= !1;D(S,function(a){if(d)E.lU(a);else{var c=f.trim(b.val()||"");c?E.nh(c,a):a(!1)}});a.submit(function(a){d= !1;S.ky();a.preventDefault();return!1});c.click(function(a){d= !0;b.val("");S.ky();a.preventDefault()})}function D(a,b){a.kI=
new k.Cell(null);a.kw=new k.Cell(!1);a.ky=function(){a.kw.value()||(a.kw.setValue(!0),b(function(b){a.kw.setValue(!1);a.kI.setValue(b)}))};a.kI.pipeChanges(function(b){a.body.find(".s-manageview-list").html(L(ba.kb(b)))})}function G(d){function r(b,c,d){function e(a,b){if(b){var c=k.mapArray(b,function(a){return a.id});s.find(a+".s-unresolved-entity").each(function(){var a=f(this),b=c[a.attr("data-s-id")];b&&(a.text(b.name),a.removeClass("s-unresolved-entity"))})}}var g,h= !1,l= !1;g="<ol>";for(var m=0,n=c.length;m<n;m++){var p=c[m],q=p.subject;"anyone"===q?(g+=k.renderTemplate('<li><span class="s-perm-marker">{s.w.view.d.perm.list.anyone}</span><a href="#" class="s-perm-remove">{s.w.view.d.perm.list.remove}</a></li>'),l= !0):"group"===q?g+=k.renderTemplate('<li><span class="s-perm-marker">{s.w.view.d.perm.list.group}</span> <span class="s-perm-list-group">{groupId}</span><a href="#" class="s-perm-remove">{s.w.view.d.perm.list.remove}</a></li>',p):"projectRole"===q?(g+=k.renderTemplate(
'<li><span class="s-perm-marker">{s.w.view.d.perm.list.project}</span> <span class="s-perm-list-project s-unresolved-entity" data-s-id="{projectId}">{projectId}</span> <span class="s-perm-marker">{s.w.view.d.perm.list.role}</span> <span class="s-perm-list-role s-unresolved-entity" data-s-id="{roleId}">{roleId}</span><a href="#" class="s-perm-remove">{s.w.view.d.perm.list.remove}</a></li>',p),h= !0):g+=k.renderTemplate('<li>?<a href="#" class="s-perm-remove">{s.w.view.d.perm.list.remove}</a></li>')}l||(g+=k.renderTemplate('<li class="s-perm-list-default">{'+d+"}</li>"));var s=f(g+"</ol>");h&&(a.widget.jiraConfig.mn(k.curry(e,"span.s-perm-list-project")),a.widget.jiraConfig.mB(k.curry(e,"span.s-perm-list-role")));b.empty().append(s)}function t(a,b){for(var c=D.value()||[],d=[],e=q[a],g= !1,h=f.extend(b,{rule:"set",level:a}),k="anyone"===b.subject,l=0,m=c.length;l<m;l++){var n=c[l],p=q[n.level];if(p){if(k&&p<=e)continue;if(!k&&"anyone"===n.subject&&p===e)continue;!g&&e<p&&(g= !0,d.push(h))}d.push(n)}g||d.push(h);D.setValue(d)}d.addHeader(k.text("s.w.view.d.det.header"));var u=b.load("structure.widget.ui.view.dialog-details-page"),z=a.panelId+"-";va={defaultAdminUrl:
m.ajsbridge.localURL("/secure/admin/StructureDefaults.jspa"),viewPropertiesId:z+"s-view-properties",viewPermissionsId:z+"s-view-permissions",viewAssociationsId:z+"s-view-associations",viewAdvancedId:z+"s-view-advanced",viewDeleteId:z+"s-view-delete",viewNameInputId:z+"s-view-det-name-input",viewDescriptionInputId:z+"s-view-det-description-input"};u=g.saveBindings(u.render$(l.$,va),Q);d.addPanel("",u);d.addButton(k.text("s.w.view.d.det.back"),function(){J()&&(U(0),fa(!1))},"s-view-det-back-btn");d.addButton(k.text("s.w.view.d.det.apply"),function(){O()},"s-view-det-apply-btn");d.addLink(k.text("sw.generic.cancel-action"),function(){(1!==I.curpage||J())&&M()},"s-view-det-cancel-link");e=u=d.element;n=u.find(".s-view-det-apply-btn");s=u.find(".s-view-det-cancel-link");da.pipe(function(b){var c=b&&b.description||"";Q.topName.text(b&&b.name||"?");Q.topDescription.text(c);Q.topAccess.html(b?b.writable?b.adminable?k.text("s.w.view.access.admin"):k.text("s.w.view.access.edit"):k.text("s.w.view.access.view"):"?");Q.adjusted.toggle(! !(b&&b.id&&ba.nt(b.id)));var d=(c=b&&b.owner)&&(c.displayName||c.name);if(d){var e="";c.avatarUrl&&(e=c.profileUrl?e+k.renderTemplate(
'<img class="user-hover s-avatar" rel="{name}" src="{avatarUrl}&size=small">',c):e+k.renderTemplate('<img class="s-avatar" src="{avatarUrl}&size=small">',c));c=e+=k.renderTemplate('<span class="s-view-det-user">{name}</span>',{name:d})}else c="";Q.ownerGroup.toggle(! !c);Q.owner.html(c);c&&"function"===typeof h&&h(Q.ownerGroup);Q.permissionsTab.toggle(! !(b&&b.adminable&&a.widget.jiraConfig.isShareViewAllowed()));Aa.setValue(null)});u=new k.Cell(da,function(a){return!(!a|| !a.adminable)});(new k.InputEnabler(u)).setView(Q["#"+va.viewNameInputId].add(d["#"+va.viewDescriptionInputId]));new k.ElementToggler(u,Q.deleteTab);B();d=new k.Cell(da,function(a){return!(!a|| !a.writable)});(new k.InputEnabler(d)).setView(Q.spec);d.pipe(function(a){Q.specWarn.toggle(a)});d=new k.Cell(da,function(a){return! !(a&&0<a.id)});new k.ElementToggler(d,Q.assocTab);Z=new k.Cell(da,ia,function(a,b){var c;if(c=a&&b&&(b.adminable||b.writable)&& !k.isDeeplySame(a,b))b?(c=b.id,c="number"!==typeof c||0>=c? !1:(c=b.name)&&"string"===typeof c&&f.trim(c)?b.spec? !0:null: !1):c= !1;return c});Z.pipe(function(a){n.toggle(! !a);s.text(k.text(a?"sw.generic.cancel-action":"s.w.view.d.close"))});new k.TextPresenter(
ia.fieldSubCell("name"),Q["#"+va.viewNameInputId]);new k.TextPresenter(ia.fieldSubCell("description"),Q["#"+va.viewDescriptionInputId]);var A=ia.fieldSubCell("spec");d=new k.TextPresenter(A);d.getCellValue=function(){var a=this.cell&&this.cell.value();return a&&m.apputil.ct(a)||null};d.updateCell=function(a){if(this.cell){var b=null;if(a)try{b=m.JSON.parse(a)}catch(c){}this.cell.setValue(b)}};d.setView(Q.spec);(new k.Cell(A,function(a){return!a})).pipe(function(a){Q.specError.toggle(a)});if(Q.specError.length)f(Q.specError[0]).on("click","a.s-view-spec-restore",function(a){a=da.value();A.setValue(a&&a.spec)});ia.pipe(function(a){var b=a&&a.id;a=a&&a.spec;b&&a&&(b=ba.mZ(a,b),Q.adjustedSpecBlock.toggle(! !b),Q.adjustedSpec.text(m.apputil.ct(b)||""))});var D=ia.fieldSubCell("permissions");D.pipe(function(a){var b=c(a);b?(r(e.find(".s-view-perm-view .s-perm-list"),b.view,"s.w.view.d.perm.list.default.view"),r(e.find(".s-view-perm-edit .s-perm-list"),b.edit,"s.w.view.d.perm.list.default.edit"),r(e.find(".s-view-perm-admin .s-perm-list"),b.admin,"s.w.view.d.perm.list.default.admin"),Q.permsPrivate.toggle(b.isPrivate),Q.permsPublic.toggle(b.isPublic),Q.permsShared.toggle(!b.isPublic&& !
b.isPrivate)):Q.uneditableRules.val(m.apputil.ct(a));Q.permsEditable.toggle(! !b);Q.permsUneditable.toggle(!b)});new p(e.find(".s-view-perm-view .s-perm-add"),a.widget,k.curry(t,"view"));new p(e.find(".s-view-perm-edit .s-perm-add"),a.widget,k.curry(t,"edit"));new p(e.find(".s-view-perm-admin .s-perm-add"),a.widget,k.curry(t,"admin"));e.length&&(d=f(e[0]),d.on("click","a.s-perm-remove",function(a){var b=f(a.target).closest("li"),c=b.closest("div.s-view-perm-control").attr("data-s-level");if(b.length&&c){for(var b=b.index(),d=D.value()||[],e=[],g=0,h=d.length;g<h;g++){var k=d[g];if(0<=b&&k.level===c&&(b--,0>b))continue;e.push(k)}D.setValue(e)}a.preventDefault();return!1}),d.on("click","a.s-perm-share-all",function(a){t("view",{subject:"anyone"});a.preventDefault();return!1}),d.on("click","a.s-perm-share-none",function(a){D.setValue([]);a.preventDefault();return!1}));Q.form.submit(function(a){a.preventDefault();a.stopPropagation();O(function(){M()})});K()}function B(){Q["#"+va.viewDeleteId].find("input").click(function(a){var b=da.value();b&&b.adminable&&window.confirm(k.text(b.shared?"s.w.view.d.delete.confirm.shared":"s.w.view.d.delete.confirm"))&&E.deleteView(b.id,function(a){a&&(
U(0),fa(!1))});a.preventDefault()})}function K(){var b=new k.Cell(e.find("div.active-pane").attr("id"));l.$(e[0]).bind("tabSelect",function(){b.setValue(e.find("div.active-pane").attr("id"))});var c= !1;(new k.Cell(b,Aa,da,function(a,b,c){return null===b&&a===va.viewAssociationsId&&c?c.id: !1})).pipe(function(a){a&& !c&&(c= !0,E.nx(a,function(a){c= !1;Aa.setValue(a|| !1)}))});Aa.pipe(function(b){var c=null!==b;Q.assocLoading.toggle(!c);Q.assocLoaded.toggle(c);if(c){Q.assocLoadFailed.toggle(!b);var c=b&&b.associatedStructures,d=b&&b.associatedDefault;Q.assocNone.toggle(!(!b||c&&c.length));Q.assocGlobal.toggle(! !d);var e="";b= !1;var d=a.getPanelSettingsKey(),f=da.value()&&da.value().id;if(c&&c.length)for(var g=0,h=c.length;g<h;g++){var l=c[g];l.id===d&&(b= !0);e+=k.renderTemplate('<tr><th title="{description}"><a class="s-newwindow" href="{openurl}" target="_blank">{name}<span></span></a></th><td>',k.extend({},l,{openurl:m.ajsbridge.localURL("/secure/StructureBoard.jspa?s="+l.id+"&view="+f)}));l.adminable&&(e+=k.renderTemplate('<a class="s-newwindow" href="{link}" target="_blank">{s.w.view.d.det.assoc.str.open}<span></span></a>',{link:m.ajsbridge.localURL(
"/secure/StructureViews.jspa?id="+l.id)}));e+="</td></tr>"}Q.assocTable.html(e);c=Q.assocManage;c.toggle(a.isAdminable()&& !b);c.find("a").toggle(u.isNumber(d)).attr("href",m.ajsbridge.localURL("/secure/StructureViews.jspa?id="+d+"&addedView="+f))}});a.widget.jiraConfig.isAdmin()||Q.assocAdmin.hide();Q.assocRefresh.click(function(a){Aa.setValue(null);a.preventDefault();return!1})}function J(){if(!Z|| !Z.value())return!0;var a=window.confirm(k.text("s.w.view.d.det.confirm-navigation"));if(a){var b=da.value();ia.setValue(b&&f.extend(!0,{},b))}return a}function O(a){var b=ia.value();if(Z&&Z.value()){T.setValue(!0);var c=function(b){b&&(N(b.id,b),k.safeCall(a))};b.adminable?E.saveView(b,c):b.writable&&E.mY(b.id,b.spec,c)}}function V(){var a=new l.Dialog({width:840,height:520,id:"s-manage-views"});a.addPage();F(a.page[0]);G(a.page[1]);return a}function U(a){if(I.curpage!==a){var b=a?1:0,c=I.page[b],d=I.page[1-b],e=c.element.parent().width();c.element.css({left:b?e: -e,borderRight:"1px solid #ddd",borderLeft:"1px solid #ddd"});c.element.show();c.element.animate({left:0},{step:function(a){d.element.css({left:a+(b? -e-1:e+1)})},duration:400,easing:"swing",complete:function(){
d.element.hide();c.element.css({left:"","border-right":"","border-left":"","border-right-width":"","border-right-style":"","border-right-color":"","border-left-width":"","border-left-style":"","border-left-color":""});d.element.css("left","")}});I.curpage=a}}function P(a){try{l.tabs.change(R.element.find(".tabs-menu .menu-item:first a"))}catch(b){k.warn(b)}Y(a);U(1)}function Y(a){if(a!==ga|| !T.value()){ga=a;k.Cell.prototype.multiUpdate(!0);try{T.setValue(!0),da.setValue(null),ia.setValue(null)}finally{k.Cell.prototype.multiUpdate(!1)}E.lD(a,k.curry(N,a))}}function N(a,b){if(a===ga){k.Cell.prototype.multiUpdate(!0);try{da.setValue(b),ia.setValue(b&&f.extend(!0,{},b)),T.setValue(!1)}finally{k.Cell.prototype.multiUpdate(!1)}}}function L(a){if(!1===a)return "";if(!a|| !a.length)return ta;for(var b="",c=0,d=a.length;c<d;c++){var e;if(e=a[c])if(e.id){var f=k.renderTemplate('<div class="s-manage-view" data-viewid="{id}">',e),g=e.id===ba.fi(),g=k.renderTemplate('<span class="s-current-icon'+(g?"":" s-notcurrent")+'" title="'+(g?"{s.w.view.d.sel.current.state}":"")+'"></span>'),h=void 0,l=void 0;e.shared?e.sharedWithAll?(h="{s.w.view.stripe.shared.public}",l="s-public"):(h=
"{s.w.view.stripe.shared.true}",l="s-shared"):(h="",l="s-private");h=k.renderTemplate('<span class="s-sharing '+l+'" title="'+h+'"></span>');f+=k.renderTemplate('<div class="s-view-details"><button data-s-action="view.manage.show" rel="{id}">{s.w.view.d.sel.details}</button></div>',e);f+='<div class="s-name">'+g+h+k.renderTemplate('<a href="#" data-s-action="view.switch" rel="{id}">{name}</a>',e);e._adjusted&&(f+=k.renderTemplate('<span class="s-adjusted-mark" title="{s.w.view.adjusted-mark}">*</span>'));f+="</div>";f=e.description?f+k.renderTemplate('<div class="s-description">{description}</div>',e):f+'<div class="s-description">&nbsp;</div>';e=f+="</div></div>"}else e="";else e="";b+=e}return b}function fa(a){var b=I.getCurrentPanel();b&&b.ky&&(a&&(a=b.kI.value())&&(a.forceUpdate=(new Date).getTime()),b.ky())}function X(){l.tabs.setup();var a=f(ma.element[0]);a.on("mouseover","div.s-manage-view",function(){var a=f(this),b=a.parent().find("div.s-manage-view.s-active");b.length&&b[0]===this||(b.removeClass("s-active"),a.addClass("s-active"))});a.on("click","div.s-manage-view",function(a){if(a&& !a.isDefaultPrevented()&&a.target&& !f(a.target).is("a,:button")){var b=k.toIntSafe(f(
a.currentTarget||a.target).attr("data-viewid"),0);b&&P(b);a.preventDefault();return!1}})}function M(){I.hide()}var ba=a.bW(),E=a.widget.jT,I,ma,R,S;a.widget.jiraConfig.isCreateViewAllowed();var ga=0,da=new k.Cell(null),ia=new k.Cell(null),T=new k.Cell(!1),Aa=new k.Cell(null),Z,va,Q={},sa= !0,ta=k.renderTemplate('<div class="s-manage-viewlist-empty">{s.w.view.list.empty}</div>');f.extend(this,{reset:function(a,b){var c=z();c.gotoPanel(0,0);a&&c.gotoPanel(1,0);Y(a);if(b&&(c=R.element.find('.tabs-menu a[href="'+b+'"]'),c.length))try{l.tabs.change(c)}catch(d){k.warn(d)}},show:function(){var a=z();try{a.show()}catch(b){if(k.warn("Exception while showing view dialog",b),-2146826178!==b.number)throw b;}sa&&(sa= !1,X());fa(!0);f("body").addClass("s-viewdialog-shown")}});a.bD().addListener(new k.Life,this);this[r.mx]=function(){ma.element.is(":visible")&&fa(!0)};a.ah().register("view.manage.show",function(a){a=k.toIntSafe(a&&f(a.target).attr("rel"),0);0!==a&&P(a)})}});(function(){var f=window.JIRA,b=require("structure/widget/ui/attribute/AttributeEditor"),g=require("almworks/jquery");f.bind(f.Events.NEW_CONTENT_ADDED,function(d,e){e.find(".s-attribute-editor:not(.s-decorated)").each(
function(){new b(g(this))})})})();(function(){function f(a,c){a.forEach(function(a){if(!a.custom){var d=n.systemFieldsMap[a.id];d&&d.attributeId?(c.addDescriptor(new s({id:d.attributeId,label:a.name,formats:b(d)})),c.addPreset(a.name,{id:d.attributeId})):u[a.id]||r.warn("unmappable field "+a.id)}})}function b(a){a=a.type;var b=[];"number"===a?b.push(m.Formats.NUMBER):"date"===a||"datetime"===a?b.push(m.Formats.TIME):"duration"===a&&b.push(m.Formats.DURATION);b.push(m.Formats.TEXT);b.push(m.Formats.HTML,m.Formats.ORDER);return b}function g(a,b){var c=l.filter(a,function(a){return! !a.custom});b.addDescriptor(new k({id:"customfield",label:r.text("s.w.attribute.customfield.label"),fields:c,widget:b.widget}));c.forEach(function(a){var c=r.toIntSafe(r.tail(a.id,"customfield_"),0);0<c&&b.addPreset(a.name,{id:"customfield",params:{fieldId:c}})})}function d(b){e(b,"progress","s.w.attribute.progress.label",m.Formats.NUMBER);e(b,"worklogged","sw.column.worklogged.name",m.Formats.DURATION);e(b,"expr","s.w.formula.column-type.name",m.Formats.NUMBER);e(b,"itemProperty","s.w.notes.column-type.name",m.Formats.TEXT);a(b,"depth","s.w.attribute.depth",m.Formats.NUMBER);a(b,"itemtype",
"s.w.attribute.itemtype",m.Formats.TEXT);a(b,"seq","sw.column.seq",m.Formats.TEXT)}function e(a,b,c,d){var e=[d];[m.Formats.TEXT,m.Formats.HTML,m.Formats.ORDER].forEach(function(a){a!==d&&e.push(a)});c=r.text(c);a.addDescriptor(new p({id:b,label:c,formats:e}))}function a(a,b,c,d){e(a,b,c,d);a.addPreset(r.text(c),{id:b})}var n=require("structure/widget/jira/Fields"),c=require("structure/widget/ui/attribute/AttributeRegistry"),p=require("structure/api/AttributeDescriptor"),m=require("structure/widget/attributes/Attributes");require("structure/api/SpecOption");var k=require("structure/widget/ui/attribute/desc/CustomFieldDescriptor"),r=require("almworks/util/Util"),l=require("underscore"),h=namespace("almworks.structure.api"),u=r.flipSet(["thumbnail","lastViewed","issuelinks","subtasks"]);c.registerFactory(function(a){return a.widget.jiraConfig.getJiraFieldsPromise().always(function(b){f(b,a);g(b,a);d(a);var c={widget:a.widget};["structure/widget/ui/attribute/desc/SumDescriptor","structure/widget/ui/attribute/desc/CountDescriptor","structure/widget/ui/attribute/desc/LinksCountDescriptor","structure/widget/ui/attribute/desc/UserPropertyDescriptor"].forEach(function(b){a.addDescriptor(
new(require(b))(c))})})});var s=h.subClass("SystemAttributeDescriptor",p,{getJiraFieldIdFromSpec:function(a){return a&&a.id===this.id?this.id:null}})})();define("structure/widget/columns/AttributeColumn","structure/widget/ui/attribute/AttributeRegistry structure/widget/attributes/Attributes almworks/util/Util almworks/util/Template structure/api/SpecOption structure/api/Column structure/api/ColumnConfigurator structure/api/ColumnType".split(" "),function(f,b,g,d,e,a,n,c){function p(a,b){var c=b&&b.params&&b.params.attribute,d;c&&(d=a.structure._widget.attributeRegistry.suggestLabel(c));return d||g.text("s.w.column.attribute")}var m=g.subClass("AttributeColumn",a,{init:function(){var a=this.spec.params||{};this.format=a.format||a.attribute&&a.attribute.format||b.Formats.HTML;this.attribute=a.attribute;this.widget=this.options.context.structure._widget;this.widget.attributeRegistry.isSpecValid(this.attribute)||(this.attribute=null)},getDefaultName:function(){return p(this.context,this.spec)},collectRequiredAttributes:function(a){if(this.attribute){var b=g.extend(this.attribute,{format:this.format});a.requireAttribute(b,this.spec.params.forestSpec)}},getSortAttribute:function(){
return this.attribute?this.format===b.Formats.NUMBER?this.attribute:this.widget.attributeRegistry.isFormatSupportedBySpec(this.attribute,b.Formats.ORDER)?g.deepExtend({},this.attribute,{format:b.Formats.ORDER}):null:null},isSortDescendingByDefault:function(){return this.attribute&&this.widget.attributeRegistry.isFormatSupportedBySpec(this.attribute,b.Formats.NUMBER)},getCellValueHtml:function(a){if(!this.attribute)return "";a=a.getAttributeValue(this.attribute,this.spec.params.forestSpec)||"";this.format!==b.Formats.HTML&&(a=g.htmlEscape(""+a));return a},isAutoSizeAllowed:g.returnTrue,canShrinkWhenNoSpace:g.returnTrue,shouldFlash:function(a){return this.attribute&&a.isAttributeFlashed(this.attribute,this.spec.params.forestSpec)},getSuggestedAttributeSpecs:function(){return this.attribute?[g.deepClone(this.attribute)]:[]}}),k=g.subClass("AttributeColumnConfigurator",n,{getDefaultColumnName:function(){return p(this.context,this.spec)},getColumnTypeName:g.returnConst(g.text("s.w.column.attribute")),getOptions:function(){var a=this;return[new e.Attribute({configurator:this,title:g.text("s.w.column.attribute"),getValue:function(){return a.spec.params&&a.spec.params.attribute||{}},
setValue:function(b){a.spec.params||(a.spec.params={});a.spec.params.attribute=b}})]},isConfigurationPanelWide:g.returnTrue});return{key:"attribute",columnType:new(g.subClass("AttributeColumnType",c,{createSwitchTypePreset:function(a){return{key:"attribute",params:{attribute:{}}}},createAddColumnPresets:function(a){var b=g.deepExtend({},this.createSwitchTypePreset(a),{presetName:g.text("s.w.column.attribute.preset"),shouldOpenConfigurator: !0,groupKey:"advanced"});a=g.deepExtend({},this.createSwitchTypePreset(a),{presetName:g.text("s.w.attribute.count.label"),groupKey:"structure",params:{attribute:{id:"count",format:"html"}}});var c=g.deepExtend({},a,{presetName:g.text("s.w.attribute.count.leaves-only.label"),params:{attribute:{params:{leaves: !0}}}});return[b,a,c]},createConfigurator:function(a,b){return new k({context:a,spec:b})},createColumn:function(a,b){return new m({context:a,spec:b})},getMetadataRequests:function(a){return{attributeRegistry:{promise:a.structure._widget.attributeRegistry.getMetaPromise()}}}}))}});define("structure/widget/columns/confluence/ConfluenceColumn",
"underscore almworks/util/Classes almworks/util/Functions almworks/util/I18n almworks/util/Log almworks/util/Strings almworks/util/Template structure/widget/attributes/Attributes structure/api/Column structure/api/ColumnType structure/api/ColumnConfigurator structure/api/SpecOption".split(" "),function(f,b,g,d,e,a,n,c,p,m,k,r){function l(a){return a&&d.text("sw.column.pages.+"+a)||""}function h(a){return a&&a.params&&a.params.field}namespace("almworks.structure.ajsbridge");var u=f.sortBy(["space"].concat(["updated","updater","updateMessage","parentPages"]),l);m=b.subClass("ConfluenceColumnType",m,{createSwitchTypePreset:function(a){return a.structure.isConfluenceEnabled()?{key:"pages",params:{}}:null},createAddColumnPresets:function(a){return a.structure.isConfluenceEnabled()?f.map(u,function(a){return{key:"pages",params:{field:a}}}):[]},createConfigurator:function(a,b){return a.structure.isConfluenceEnabled()?new s({context:a,spec:b}):null},createColumn:function(a,b){if(!a.structure.isConfluenceEnabled()|| !b||"pages"!==b.key|| !f.contains(u,h(b)))return null;var c=h(b),d={context:a,spec:b};return "space"===c?new x(d):new q(d)}});var s=b.subClass("ConfluenceColumnConfigurator",k,{
getDefaultColumnName:function(){return l(h(this.spec))},getColumnTypeName:g.returnConst(d.text("sw.column.type.pages")),getGroupKey:g.returnConst("pages"),getOptions:function(){return[new r.Select({title:d.text("sw.column.opt.field"),configurator:this,options:f.map(u,function(a){return{value:a,name:l(a)}}),getValue:function(){return h(this.spec)},setValue:function(a){this.spec.params.field=a}})]}});k={getSuggestedAttributeSpecs:function(){return[this.attribute]},canShrinkWhenNoSpace:g.returnTrue,getDefaultName:function(){return l(h(this.spec))}};var q=b.subClass("ConfluenceColumn",p,f.extend({init:function(){this.attribute={id:h(this.spec),format:"html"}},getCellValueHtml:function(a){return a.getAttributeValue(this.attribute)||""},collectRequiredAttributes:function(a){a.requireAttribute(this.attribute)},getDefaultWidth:g.returnConst(200)},k)),x=b.subClass("SpaceColumn",p,f.extend({init:function(){this.attribute={id:"space.key",format:"text"};this.URL_REGEX=/^(.*)\/pages\/viewpage.action\?pageId=\d+$/;this.LINK_TEMPLATE=new n('<a href="{baseUrl:html}/display/{spaceKeyEncoded:html}">{spaceKey}</a>')},getCellValueHtml:function(b){var d=b.getAttributeValue(this.attribute),f;f=
b.getAttributeValue(c.URL_TEXT);if(d){if(b=(b=this.URL_REGEX.exec(f))&&b[1])return f=encodeURIComponent(d).replace(/%40/g,"@").replace(/%7[eE]/g,"~"),this.LINK_TEMPLATE.renderHtml({baseUrl:b,spaceKeyEncoded:f,spaceKey:d});f&&e.warn("Unrecognized page URL:",f);return a.htmlEscape(d)}return ""},collectRequiredAttributes:function(a){a.requireAttribute(this.attribute);a.requireAttribute(c.URL_TEXT)}},k));return{key:"pages",columnType:new m}});define("structure/widget/generator/SorterAgileRankDescriptor",["almworks/jquery","underscore","structure/api/GeneratorDescriptor"],function(f,b,g){return namespace("almworks.structure.api").subClass("SorterAgileRankDescriptor",g,{init:function(b){this.moduleKey="com.almworks.jira.structure:sorter-agile-rank";this.jiraConfig=b.widget.jiraConfig},suggestLabel:function(d){if(!d.params|| !d.params.fieldId)return null;var e=f.Deferred(),a=d.params.fieldId,g=this.jiraConfig;g.load(function(){var c=b.findWhere(g.getJiraAgileRankFields(),{customId:a});e.resolve(c?c.name:null)});return e.promise()}})});define("structure/widget/generator/GeneratorAttributeDescriptor",["almworks/jquery","structure/api/GeneratorDescriptor"],function(f,b){return namespace(
"almworks.structure.api").subClass("GeneratorAttributeDescriptor",b,{init:function(b){this.moduleKey=b.moduleKey;this.attributeRegistry=b.widget.attributeRegistry},suggestLabel:function(b){if(!b.params|| !b.params.attribute)return null;var d=f.Deferred(),e=this.attributeRegistry;e.getMetaPromise().done(function(){d.resolve(e.suggestLabel(b.params.attribute))});return d.promise()}})});define("structure/widget/generator/GrouperAgileEpicDescriptor",["almworks/util/I18n","structure/api/GeneratorDescriptor"],function(f,b){return namespace("almworks.structure.api").subClass("GrouperAgileEpicDescriptor",b,{init:function(b){this.moduleKey="com.almworks.jira.structure:grouper-agile-epic"},suggestLabel:function(b){return f.text("s.w.ext.gen.grouper.agileepic.label")}})});define("structure/widget/generator/SimpleGeneratorDescriptor",["almworks/util/I18n","structure/api/GeneratorDescriptor"],function(f,b){var g=namespace("almworks.structure.api").subClass("SimpleGeneratorDescriptor",b,{init:function(b){this.moduleKey=b.moduleKey;this.labelKey=b.labelKey},suggestLabel:function(b){return f.text(this.labelKey)}});g.add=function(b,e,a){b.addDescriptor(new g({moduleKey:e,labelKey:a}))};return g});
define("structure/widget/generator/LinkGeneratorDescriptors",["almworks/jquery","underscore","structure/api/GeneratorDescriptor"],function(f,b,g){var d=namespace("almworks.structure.api");g=d.subClass("BaseLinkGeneratorDescriptor",g,{init:function(b){this.jiraConfig=b.widget.jiraConfig},suggestLabel:function(d){if(!d.params|| !d.params.linkTypeId)return null;var a=f.Deferred(),g=d.params.linkTypeId+"",c=d.params.inward;this.jiraConfig.getJiraRestAPIPromise("/rest/api/2/issueLinkType").then(function(d){d=b.findWhere(d.issueLinkTypes,{id:g});a.resolve(d?d[c?"inward":"outward"]:null)},function(){a.reject(null)});return a.promise()}});return{Extender:d.subClass("ExtenderLinkDescriptor",g,{init:function(b){this.moduleKey="com.almworks.jira.structure:extender-links"}}),Grouper:d.subClass("GrouperLinkDescriptor",g,{init:function(b){this.moduleKey="com.almworks.jira.structure:grouper-links"}})}});define("structure/widget/generator/ExtenderSubTaskDescriptor",["almworks/jquery","underscore","structure/api/GeneratorDescriptor","almworks/util/Util"],function(f,b,g,d){return namespace("almworks.structure.api").subClass("ExtenderSubTaskDescriptor",g,{init:function(b){this.moduleKey=
"com.almworks.jira.structure:extender-subtasks";this.jiraConfig=b.widget.jiraConfig},suggestLabel:function(e){if(!e.params)return null;var a=e.params.typeIds;if(a&&a.length){var g=f.Deferred();this.jiraConfig.getJiraRestAPIPromise("/rest/api/2/issuetype").then(function(c){c=b.filter(c,function(c){return c.subtask&&b.contains(a,c.id)});c=b.pluck(c,"name").join();g.resolve(c||d.text("s.w.gen.ext.subtasks.all.label"))},function(){g.reject(d.text("s.w.gen.ext.subtasks.all.label"))});return g.promise()}return d.text("s.w.gen.ext.subtasks.all.label")}})});define("structure/widget/generator/FilterQueryDescriptor",["underscore","structure/api/GeneratorDescriptor","almworks/util/Util"],function(f,b,g){var d=namespace("almworks.structure.api"),e={text:"com.almworks.jira.structure:filter-text",jql:"com.almworks.jira.structure:filter-jql",sjql:"com.almworks.jira.structure:filter-sjql"},a=f.invert(e);f=d.subClass("FilterQueryDescriptor",b,{suggestLabel:function(b){var c=a[this.moduleKey];return c?g.abbreviateLabel(b.params[c],20):null}});f.Text=d.subClass("FilterTextDescriptor",f,{moduleKey:e.text});f.JQL=d.subClass("FilterJQLDescriptor",f,{moduleKey:e.jql});f.SJQL=d.subClass(
"FilterSJQLDescriptor",f,{moduleKey:e.sjql});f.getFilterType=function(b){return a[b]};f.getFilterModule=function(a){return e[a]};return f});(function(){var f=require("almworks/util/Util"),b=require("structure/widget/generator/GeneratorRegistry"),g=require("structure/widget/generator/FilterQueryDescriptor"),d=require("structure/widget/generator/SorterAgileRankDescriptor"),e=require("structure/widget/generator/GrouperAgileEpicDescriptor"),a=require("structure/widget/generator/LinkGeneratorDescriptors"),n=require("structure/widget/generator/ExtenderSubTaskDescriptor"),c=require("structure/widget/generator/SimpleGeneratorDescriptor"),p=require("structure/widget/generator/GeneratorAttributeDescriptor");b.registerFactory(function(b){var k=Object.freeze({widget:b.widget});b.addDescriptor(new p(f.extend({},k,{moduleKey:"com.almworks.jira.structure:sorter-attribute"})));b.addDescriptor(new d(k));b.addDescriptor(new e(k));b.addDescriptor(new a.Extender(k));b.addDescriptor(new a.Grouper(k));b.addDescriptor(new n(k));b.addDescriptor(new g.Text);b.addDescriptor(new g.JQL);b.addDescriptor(new g.SJQL);b.addDescriptor(new p(f.extend({},k,{moduleKey:"com.almworks.jira.structure:grouper-text"})));
c.add(b,"com.almworks.jira.structure:grouper-portfolio-parent","s.w.ext.gen.grouper.portfolio.short-label");c.add(b,"com.almworks.jira.structure:grouper-tempo-account","s.w.ext.gen.grouper.tempo.accounts.short-label");c.add(b,"com.almworks.jira.structure:extender-portfolio-children","s.w.ext.gen.extender.portfolio.short-label");c.add(b,"com.almworks.jira.structure:extender-agile","s.w.ext.gen.extender.agile.short-label");c.add(b,"com.almworks.jira.structure:grouper-sprint","s.w.ext.gen.grouper.agilesprint.short-label");c.add(b,"com.almworks.jira.structure:sorter-manual","s.w.ext.gen.sorter.manual.short-label")})})();(function(){(function(){var f=require("jquery"),b=require("structure/widget/ui/UIUtil"),g=require("almworks/util/Keyboard"),d=require("almworks/util/Collections").mapArray(["left","right","home","end","backspace"],function(a){return g.keyboardCodeFromString(a)}),e=function(a){var b=a&&a.keyCode;b&&d[b]&&a.stopPropagation()},a=function(){f(this).on("keydown.dropdown2-text-protect",e)},n=function(){f(this).off(".dropdown2-text-protect")};b.AJS$Bind(f(window),"aui-dropdown2-show aui-dropdown2-hide",function(b){f(b.target).find(":text").each("aui-dropdown2-show"===b.type?a:
n)})})()})();define("structure/widget/confluence/ConfluenceErrorHandler","almworks/jquery underscore almworks/util/Util almworks/util/Template aui/inline-dialog structure/confluence/ConfluenceLoginWindow structure/widget/ui/panel/AbstractErrorPopup".split(" "),function(f,b,g,d,e,a,n){var c=namespace("almworks.structure.appevents"),p=namespace("almworks.structure"),m=g.requireGlobal("AJS");f=new d.load("structure.widget.confluence.error-banner");var k={askAdminWithIgnore:f.render$({message:g.text("s.w.confluence.error.ask.admin.msg"),actionButton:g.renderTemplate('<button class="aui-button" data-bind-id="ignoreButton">{s.w.confluence.error.ignore.title}</button>')}),credentials:f.render$({message:g.text("s.w.confluence.auth.login.url.label"),actionButton:g.renderTemplate('<button class="aui-button" data-bind-id="loginButton">{s.w.confluence.auth.login.url.title}</button>')}),askAdmin:f.render$({message:g.text("s.w.confluence.error.ask.admin.msg"),actionButton:""})};return function(d){function f(a){a=(a=(a=a&&a.extensionData)&&a["com.almworks.structure.pages:pages-extension"])&&a.confluenceErrors;b.isEmpty(a)?v():G.popup||(G.init(w(a)),z.show("confluence-error",g.text(
"s.w.confluence.footer-warning.msg"),g.text("s.w.confluence.footer-warning.title"),function(){G.showPopup()}))}function h(){u(!0);var a=new F.Task(p.ajax.RESOURCES2g.CONFLUENCE.RETRY_USER,p.ajax.UPLOAD,function(a){G.popup&&(u(!1),(a=a.confluenceErrors)&&t(a).type===D.type||v())});a.type="POST";F.addTask(a);return!1}function u(a){G.popup&&A.retryLoader&&(A.retryLoader.toggle(a),A.retryButton.attr("disabled",a))}function s(a){a&&(a.off("click"),a.on("click",function(){var a=new F.Task(p.ajax.RESOURCES2g.CONFLUENCE.IGNORE_SYSTEM_ERROR,p.ajax.UPLOAD,v);a.type="POST";F.addTask(a);return!1}))}function q(a){a&&(a.off("click"),a.on("click",h))}function x(b,c){b&&c&&c.url&&(b.off("click"),b.on("click",function(){(new a(c.url,h)).show();return!1}))}function t(a){return a.system&&"CREDENTIALS"===a.system.errorType&&a.system.errorData.userKey===m.params.loggedInUser?{error:a.system,type:"credentials"}:a.system?{error:a.system,type:"askAdminWithIgnore"}:a.user&&"CREDENTIALS"===a.user.errorType?{error:a.user,type:"credentials"}:{error:a.user,type:"askAdmin"}}function w(a){D=t(a);A=k[D.type].getBindings();s(A.ignoreButton);q(A.retryButton);x(A.loginButton,D.error.errorData);return e(
d.footerConfluenceWarning$.find("i"),"stConfluenceError",function(a,b,c){a.html(A.all$);c();return!1},{gravity:"s",persistent: !1,noBind: !0,width:400,offsetX: -41,showDelay:100,hideCallback:G.hideCallback,initCallback:G.initCallback})}function v(){G.popup&&(z.hide("confluence-error"),G.hidePopup())}g.addSuper(n,this)(d);var C={};C[c.POLL_RESULT]=f;d.eventBus.addListener(new g.Life,C);var z=d.footerConfluenceWarning,F=d.ajax,A,D,G=this;g.extend(this,n.prototype,{checkErrors:f})}});define("structure/widget/ui/editor/ConfluenceCreationParameters","almworks/jquery underscore almworks/util/Util almworks/util/Template structure/widget/attributes/Attributes structure/widget/jira/SingleSelect2Presenter structure/widget/ui/editor/ConfluenceCreationContextManager structure/widget/model/Items".split(" "),function(f,b,g,d,e,a,n,c){function p(a,b){this.panel=a;this.container$=f("<div></div>");this.widget=a.widget;this.hG=b;this._$={};this.presenters={};this.cells={};this.cells.space=(new g.Cell(r.getStored("new.space"))).pipeChanges(function(a){a&&r.setStored("new.space",a)});this.cells.blueprint=(new g.Cell(r.getStored("new.space.blueprint"))).pipeChanges(function(a){a&&r.setStored(
"new.space.blueprint",a)});this.cells.lj=new g.Cell(!1);this.cells.output=new g.Cell(this.cells.space,this.cells.blueprint,this.cells.lj,function(a,b,c){if(!c)return null;a?(a=a.split("."),a={confluenceId:a[0],spaceKey:a[1]}):a={spaceKey:null,confluenceId:null};b&&(b=b.split("."),a.contentType=b[0],a.contentId=b[1]);return g.extend({},a,{parentId:null})});this.cells.controlsLoaded=new g.Cell(!1);this.initHtml();this.loadSpacesForCreation();this.cells.output.pipe(function(a){a&&b.kd(a)})}function m(a){return a.spaces.map(function(b){return u.option.renderHtml({confluenceId:a.info.id,spaceKey:b.key,name:b.name})}).join("")}function k(a){a=1==a.length?m(a[0]):b.map(a,function(a){return u.group.renderHtml({label:a.info.name,options:m(a)})}).join("");return g.renderTemplate('<label for="s-space-field">Space<span class="aui-icon icon-required">Required</span></label><select id="s-space-field">{options:html}</select>',{options:a})}var r=namespace("almworks.structure");namespace("almworks.structure.ajsbridge");var l=g.requireGlobal("AJS");g.requireGlobal("JIRA");var h=d.load("structure.widget.ui.editor.page-creation-panel"),u={option:d.build("option",function(a){return a({value:
"{confluenceId}.{spaceKey}"})("{name}")}),group:d.build("optgroup",function(a){return a({label:"{label}"})("{options:html}")}),blueprint:d.build("option",function(a){return a({value:"{contentType}.{contentId}"})("{name}")})};g.extend(p.prototype,{initValue:function(){},initHtml:function(){var a=h.render$().saveBindings(this._$);this.container$.empty().append(a)},loadSpacesForCreation:function(){this.widget.jiraConfig.loadConfluenceSpaces(g.withThis(this,this.onSpacesLoaded))},onSpacesLoaded:function(a,b){a&&0!=a.length?this._$.spaceDiv.html(k(a)):this._$.spaceSelectContainer.html(g.renderTemplate("<p>{s.w.create.page.no.spaces.error.text}</p>"));this.cacheBlueprints(a);var c=this,d=function(a){c._$.blueprintDiv.html(c.blueprints[a]);c.installAJSControllersBlueprint()};d(this.cells.space.value());this.cells.space.pipeChanges(d);this.cells.controlsLoaded.setValue(!0);!a&&b&&this.widget.errorCentral.reportError(new r.error.AppError(g.text("s.w.editor.new.pt.error"),b.title+"\n\n"+b.details))},renderSpaceBlueprints:function(a){a=b.map(a,function(a){return u.blueprint.renderHtml({name:a.name,contentType:a.contentType,contentId:a.contentId})}).join("");return g.renderTemplate(
'<label for="s-space-blueprint-field">Template<span class="aui-icon icon-required">Required</span></label><select id="s-space-blueprint-field">{options:html}</select>',{options:a})},cacheBlueprints:function(a){var b=this,c={};a.forEach(function(a){a.spaces.forEach(function(d){c[a.info.id+"."+d.key]=b.renderSpaceBlueprints(d.blueprints)})});this.blueprints=c},kt:function(){l.$(this._$.spinner).spin();this.cells.controlsLoaded.value()&& !this.gl&&(this.gl= !0,this.installAJSControllersSpace(),this.installAJSControllersBlueprint(),this.cells.lj.setValue(!0))},installAJSControllersSpace:function(){this.spaceSelect$=l.$(this._$.spaceDiv.find("#s-space-field")[0]);this.spaceSelect$.auiSelect2();this.presenters.space=new a(this.cells.space,this.spaceSelect$,!this.cells.space.value());this.presenters.space.sync(!0)},installAJSControllersBlueprint:function(){this.blueprintSelect$=l.$(this._$.blueprintDiv.find("#s-space-blueprint-field")[0]);this.blueprintSelect$.auiSelect2();this.presenters.blueprint=new a(this.cells.blueprint,this.blueprintSelect$,!this.cells.blueprint.value());this.presenters.blueprint.sync(!0)},kV:function(a,b){return!0},getContextManager:g.lazy(function(){return new n(
this.panel)}),isSameItemType:function(a){return null!==c.getPageId(a)},isOutputReady:function(){return! !this.cells.output.value()}});return p});define("structure/widget/ui/editor/ConfluenceCreationContextManager",["almworks/jquery","almworks/util/Util"],function(f,b){function g(b){this.panel=b}var d={rowId:0};Object.freeze(d);b.extend(g.prototype,{lp:function(d){if(0<this.rowId)return null;var a=d.bC;if(!a|| !a.creationContext)return null;a=b.extend({},a.creationContext);a.sample=d.getSampleForNewIssue();return a.sample.rowId||a.spaceKey&&a.confluenceId?a:null},kd:function(d,a){var f=b.extend(d.bC.creationContext,{spaceKey:a.spaceKey,confluenceId:a.confluenceId,contentId:a.contentId,contentType:a.contentType,parentId:a.parentId}),c=this.panel.widget.jiraConfig.getCopiedAttributeIdsForNewConfluence();this.panel.widget.attributeManager.kJ(d.forestSpecForAttributes,d.rowId,f,c)},prepareContext:function(b){return f.extend({},b,{spaceKey:null,confluenceId:null,contentId:null,contentType:null,parentId:null})},getSample:function(b,a){return{rowId:b}},getNullSample:b.returnConst(d)});return g});(function(){namespace("almworks.structure.api");var f=require("structure/api/ColumnGroup"),b=
require("structure/api/ColumnType");f.register({groupKey:"featured",title:"{sw.conf.colsec.featured}",order:0});f.register({groupKey:"progress",title:"{sw.conf.colsec.progress}",order:200});f.register({groupKey:"structure",title:"{sw.conf.colsec.structure}",order:250});f.register({groupKey:"fields",title:"{sw.conf.colsec.fields}",order:300});f.register({groupKey:"icons",title:"{sw.conf.colsec.icons}",order:350});f.register({groupKey:"totals",title:"{sw.conf.colsec.totals}",order:400});f.register({groupKey:"formulas",title:"{sw.conf.colsec.formulas}",order:450});f.register({groupKey:"advanced",title:"{sw.conf.colsec.advanced}",order:500});f.register({groupKey:"",title:"{sw.conf.colsec.other}",order:1E4});
"structure/widget/columns/MainColumn structure/widget/columns/AttributeColumn structure/widget/columns/RowId structure/widget/columns/ItemId structure/widget/columns/ActionsColumn structure/widget/columns/FieldColumn structure/widget/columns/HandleColumn structure/widget/columns/IconsColumn structure/widget/columns/ProgressColumn structure/widget/columns/WorkloggedColumn structure/widget/columns/SequenceColumn structure/widget/columns/formula/FormulaColumn structure/widget/columns/NotesColumn".split(" ").forEach(function(f){f=require(f);b.register(f.columnType,f.key)})})();(function(){namespace("almworks.structure.api");var f=require("structure/api/ColumnGroup"),b=require("structure/api/ColumnType");f.register({groupKey:"pages",title:"{sw.conf.colsec.pages}",order:500});f=require("structure/widget/columns/confluence/ConfluenceColumn");b.register(f.columnType,f.key)})(); ;