;
/* module-key = 'com.atlassian.jira.plugins.jira-editor-plugin:mentions', location = 'js/plugins/mentions/mentions-util.js' */
define("jira/editor/plugins/mentions/mentions-util",["jquery","underscore"],function(d,b){var a=8203;var c=function(f){f.preventDefault();f.stopPropagation();f.stopImmediatePropagation()};var e={isMentionNode:function(f){if(!f){return false}return d(f).is("a.user-hover")},isCaretAfterMention:function(f){return this.getMentionBeforeCaret(f)!=null},getMentionBeforeCaret:function(g){var f=this.getPreviousNode(g).node;if(this.isMentionNode(f)){return f}return null},getPreviousNode:function(l){var h=function(o){if(o.nodeType===Node.TEXT_NODE){return o.nodeValue.length}else{if(o.nodeType===Node.ELEMENT_NODE){return o.childNodes.length}else{return undefined}}};var m=l.getSelection();var i=m.anchorNode;var k=m.anchorOffset;var g={node:i,offset:m.anchorOffset};if(m.isCollapsed){if(i.nodeType===Node.ELEMENT_NODE&&i.childNodes){var n=m.anchorOffset-1;if(n<0){i=i.childNodes[0];k=0;var f=this._getPreviousSiblingSkipEmptyTextNodes(i,k);if(f){return{node:f,offset:h(f)}}}else{var j=n===i.childNodes.length-1;i=i.childNodes[n];k=h(i);var f=this._getPreviousSiblingSkipEmptyTextNodes(i,k,j);if(f){return{node:f,offset:h(f)}}}}else{if(i.nodeType===Node.TEXT_NODE){var f=this._getPreviousSiblingSkipEmptyTextNodes(i,k);if(f){return{node:f,offset:f===i?k:h(f)}}}}}return g},_getPreviousSiblingSkipEmptyTextNodes:function(h,j,g){g=g||false;var f=h;var i;while((i=this._isContentBeforeCursorEmpty(f,j,g)).outcome){f=f.previousSibling;j=undefined;g=i.relaxed}return f},_isContentBeforeCursorEmpty:function(h,k,j){var i={outcome:true,relaxed:false};var f={outcome:false,relaxed:false};var g={outcome:true,relaxed:true};if(h&&h.nodeType===Node.TEXT_NODE){if(b.isUndefined(k)){k=h.nodeValue.length}if(k===0){return i}if(k===1&&h.nodeValue.charCodeAt(0)===a&&h.nodeValue.length===1){return i}if(j){if(k===1&&h.nodeValue===" "){return g}}}return f},selectMention:function(g,f,h){if(f){c(f)}h.selection.select(g)}};return e});;
;
/* module-key = 'com.atlassian.jira.plugins.jira-editor-plugin:mentions', location = 'js/plugins/mentions/mention.js' */
define("jira/editor/plugins/mentions/mention-rte",["jira/mention/mention-matcher","jquery","jira/mention/mention","underscore","jira/editor/plugins/mentions/mentions-util"],function(c,e,b,a,f){var d=b.extend({init:function(h,i,g){b.prototype.init.call(this,h);this.editor=i;this.skipProcessing=g},_replaceCurrentUserName:function(h,g){if(this._selectMentionText()){this.editor.execCommand("mceInsertContent",false,this._renderMentionLink(h,g))}},_selectMentionText:function(){var o=this._getDocument();var p=this._getSelection();if(p&&p.isCollapsed){var l=this._getNodeForUsernameRetrieval();var g=this._getPreviousSiblingsTextNodes(l.node);if(g.length>0){var h=g[0];var n=g[g.length-1];var j=l.offset;var i=this._getStringFormPreviousSiblingsTextNodes(g,j);var k=c.getLastWordBoundaryIndex(i,true);var m=o.createRange();m.setStart(h,k+1);m.setEnd(n,j);this.editor.selection.setRng(m);return true}}else{return false}},_renderMentionLink:function(h,g){return JIRA.Editor.Tags.Templates.mentionlink({username:h,displayname:g})},_getUserNameFromInput:function(){if(a.isFunction(this.skipProcessing)&&this.skipProcessing()){return null}var h=this._getSelection();if(h&&h.isCollapsed){var i=this._getNodeForUsernameRetrieval();var g=this._getPreviousSiblingsTextNodes(i.node);var j=this._getStringFormPreviousSiblingsTextNodes(g,i.offset);this.currentUserName=c.getUserNameFromCurrentWord(j,j.length);return this.currentUserName}else{return null}},_getStringFormPreviousSiblingsTextNodes:function(g,l){var k="";for(var h=0;h<g.length;h=h+1){var j=g[h];if(h===g.length-1){k=k+j.nodeValue.substring(0,l)}else{k=k+j.nodeValue}}return k},_getPreviousSiblingsTextNodes:function(h){var g=[];if(h&&h.nodeType===Node.TEXT_NODE){for(var i=h;i;i=i.previousSibling){if(i.nodeType===Node.TEXT_NODE){g.unshift(i);if(i.nodeValue.indexOf("@")>=0||i.nodeValue.indexOf("[~")>=0){return g}}else{break}}}return[]},_getNodeForUsernameRetrieval:function(){return f.getPreviousNode(this._getDocument())},_getSelection:function(){if(this.$textarea){var g=this.$textarea.get(0);if(g&&g.ownerDocument){return g.ownerDocument.getSelection()}}return null},_getDocument:function(){return this.$textarea.get(0).ownerDocument},_getOffsetTarget:function(){return e(this.editor.getContainer())}});return d});;