;
/* module-key = 'com.atlassian.jira.plugins.jira-editor-plugin:schema', location = 'js/editor-schema.js' */
define("jira/editor/schema",["jira/editor/schema-builder","jira/richeditor/editor-supported-operations","jira/editor/tinymce","jquery"],function(f,a,l,e){var b=["strong","b","em","i","tt","code","sub","sup","del","cite","panel-title"];var i=[["td","table"],["th","table"],["td","p"],["th","p"]];var h=[];var d=["strong/b"];h.push("xml:lang");h.push("xml:space");var g={};g.getSchemaSpecBuilder=function(m){if(undefined===m){m=new f()}return m.withValidElements(a.getRequiredHtmlTags()).withNoBreak(b).withNoSelfNest(b).withNoNest(i).withUnwantedAttributes(h).withExtendedValidElements(d).withCustomElement("panel-title",["span","#text"],["style"]).setValidChildren("pre","br|span|#text|pre|p|panel-title")};g.getPasteSchemaSpecBuilder=function(m){if(undefined===m){m=g.getSchemaSpecBuilder()}return m.withUnwantedAttributes(["contenteditable"])};g.getPasteInsidePreSchemaSpecBuilder=function(m){if(undefined===m){m=new f()}return m.withValidElements(["br","span","p","pre"]).withUnwantedAttributes(["style"])};g.getSchemaFromSpec=function(n){var m=new l.html.Schema({schema:n.getType(),custom_elements:n.getCustomElements(),valid_children:n.getValidChildren(),valid_elements:n.getValidElements(),extended_valid_elements:n.getExtendedValidElements()});n.fixChildren(m);return m};function k(m){var n=e("<div>").addClass("richeditor-sanitize").append(m)[0];try{e(n).appendTo(document.body);return AJS.escapeHTML(n.innerText||n.textContent)}finally{e(n).remove()}}g.sanitizeHtml=function j(o,p,t){var m=e(p.selection.getStart()).add(p.selection.getEnd()).add(p.selection.getNode());if(m.is("pre, pre > *")){o='<pre class="'+m.attr("class")+'">'+k(o)+"</pre>"}if(m.is("panel-title, panel-title > *")){o=k(o)}var q=g.getSchemaFromSpec(t);var r=new l.html.DomParser(p.settings,q);var n=new l.html.Serializer(p.settings,q);var s=r.parse(o,{forced_root_block:undefined});return n.serialize(s)};return g;function c(p,n,o){var q=new l.html.Schema({schema:o});var m=q.elements;m.img.attributesRequired=["src"];return p.map(function(t){var s=m[t];if(!s){return false}var v=(s.removeEmptyAttrs)?"!":"";var u="";if(s.paddEmpty){u="#"}else{if(s.removeEmpty){u="-"}}var r=s.attributesOrder.map(function(w){var x="";if((s.attributesRequired||[]).indexOf(w)!==-1){x="!"}return x+w}).filter(function(w){return n.indexOf(w)===-1});return u+t+v+"["+r.join("|")+"]"}).filter(function(r){return !!r})}});;