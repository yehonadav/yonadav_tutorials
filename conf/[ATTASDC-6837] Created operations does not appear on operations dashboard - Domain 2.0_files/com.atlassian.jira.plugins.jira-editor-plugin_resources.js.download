;
/* module-key = 'com.atlassian.jira.plugins.jira-editor-plugin:resources', location = 'js/wiki-adapter/wiki-toolbar-adapter.js' */
define("jira/richeditor/wiki-adapter/wiki-toolbar-adapter",["underscore","jira/richeditor/wiki-adapter/toolbar-parser","jira/richeditor/wiki-adapter/wiki-toolbar-button","jira/richeditor/editor-supported-operations"],function(a,d,c,b){var e=function(f,h,i){this.supportedOperations=b.getWikiOperations();var g=d(h,i);this._overrideWikiFallbackOperations(g,f,i);this.buttons=this.buildButtons(f,i,g);this.bindButtonsToToolbar(this.buttons,h,i,f);this.dropdowns=this._getDropdowns(h);f.contextManager.on("change:all",this._disableStateChanged.bind(this))};e.prototype.destroy=function(){this.buttons.forEach(function(f){f.destroy()})};e.prototype.buildButtons=function(h,k,j){var f=h.contextManager;var i=j.map(function(l){if(this.supportedOperations.indexOf(l.getName())>-1){return new c(l,k,f)}}.bind(this)).filter(a.identity);var g=this._filterFallbackWikiOperations(j);g.forEach(function(l){i.push(new c(l,k,f))});return i};e.prototype._overrideWikiFallbackOperations=function(f,h,i){var g=this._filterFallbackWikiOperations(f);g.forEach(function(j){h.addOperationOverride(j.getName(),function(l){var k=i.val();k=k.replace(/(?:\r\n|\r|\n)/g,"<br />");h.executeOperation("editorReplaceContent",{content:k})})})};e.prototype._filterFallbackWikiOperations=function(f){return f.filter(function(g){return this.supportedOperations.indexOf(g.getName())<0}.bind(this))};e.prototype.bindButtonsToToolbar=function(h,f,j,g){h=h||[];h.forEach(function i(k){k.bindButton(g)})};e.prototype._disableStateChanged=function(f){this.dropdowns.attr("aria-disabled",f.disableState.toString())};e.prototype._getDropdowns=function(f){return f.find(".aui-dropdown2-trigger")};return e});;
;
/* module-key = 'com.atlassian.jira.plugins.jira-editor-plugin:resources', location = 'js/wiki-adapter/editor-operation.js' */
define("jira/richeditor/wiki-adapter/editor-operation",["jquery"],function(){var a=function(c,d,b){this.name=c;this.params=d;this.shortcut=b};a.prototype.getName=function(){return this.name};a.prototype.getParams=function(){return this.params};a.prototype.getShortcut=function(){return this.shortcut};return a});;
;
/* module-key = 'com.atlassian.jira.plugins.jira-editor-plugin:resources', location = 'js/wiki-adapter/toolbar-parser.js' */
define("jira/richeditor/wiki-adapter/toolbar-parser",["jquery","jira/richeditor/wiki-adapter/wiki-toolbar-operation"],function(b,a){return function(f,g){var d=function(){var i=["color-parameter"];var h=b(this).attr("data-operation");return i.indexOf(h)<0};var c=b.map(f.find("a[data-operation]").filter(d),function(h){return new a(b(h),g)});var e=f.find(".wiki-edit-dropdown-image, .wiki-edit-dropdown-attachment");if(e.length>0){c.push(new a(b(e),g))}return c}});;
;
/* module-key = 'com.atlassian.jira.plugins.jira-editor-plugin:resources', location = 'js/wiki-adapter/wiki-toolbar-operation.js' */
define("jira/richeditor/wiki-adapter/wiki-toolbar-operation",["underscore","jquery","jira/util/logger","jira/richeditor/wiki-adapter/editor-operation","jira/util/events","jira/editor/constants"],function(e,g,d,a,b,c){var f=function(h,j,i){this.$el=h;this.$wikiTextarea=j;this.params=i||{};this.supportedIcons=[":)",":(",":P",":D",";)","(y)","(n)","(i)","(/)","(x)","(!)","(+)","(-)","(?)","(on)","(off)","(*)","(*r)","(*g)","(*b)","(*y)","(flag)","(flagoff)"];this.supportedParams=["data-color"]};f.prototype.getElement=function(){return this.$el};f.prototype.getName=function(){if(this._isIcon()){return"icon"}if(this._isAttachment()){return"attachment"}return this.$el.attr("data-operation")};f.prototype._isIcon=function(){var h=this.$el.attr("data-operation");return this.supportedIcons.indexOf(h)>-1};f.prototype._isColor=function(){return"color"===this.$el.attr("data-operation")};f.prototype._isAttachment=function(){return this.$el.filter(".wiki-edit-dropdown-image, .wiki-edit-dropdown-attachment").length>0};f.prototype.getParams=function(h){var n={};h=h||{};this.supportedParams.forEach(function(o){var p=this.$el.attr(o);if(p){n[o]=p}}.bind(this));if(this._isIcon()){n.icon=this.$el.attr("data-operation")}if(this._isColor()){n.color=this.$el.is(".wiki-edit-operation-color")?this.$el.find(".wiki-edit-color-indicator").css("background-color"):this.$el.attr("data-color")}if(this._isAttachment()){if(h.attachment){n.attachment=h.attachment}else{var m=h.$attachmentElement;var k=h.attachmentName;var l=h.attachmentType;if(m&&k&&!m.is(".wiki-attachment-browse")){var j=this.getHrefFromDom(k,m,m.is(":not([data-attachment-type])"));var i=this._getAttachmentRendered(k,j,l);if(i){n.attachment=i}}}}n=e.extend(n,this.params);return n};f.prototype._getAttachmentRendered=function(i,h,j){if(j==="image"){if(!h){return undefined}var k=h.replace("/attachment/","/thumbnail/");return JIRA.Editor.Tags.Templates.attachedImage({source:k,filename:i})}else{return JIRA.Editor.Tags.Templates.attachedFile({title:i,href:h,filename:i})}},f.prototype.getShortcut=function(){var h=this.$el.attr("data-shortcut");if(h){return h.replace("command+","meta+").replace("ctrl+","meta+")}};f.prototype.getEditorOperation=function(h){return new a(this.getName(),this.getParams(h),this.getShortcut())};f.prototype.execute=function(i,k){if(!i.isVisible()){return}k=k||{};var h=k.element||this.getElement();if(this._isAttachment()){if(h.is("[data-attachment-type]")){var j=this.getEditorOperation({attachmentName:h.find(".wiki-edit-attachment-name").text(),attachmentType:h.attr("data-attachment-type"),$attachmentElement:h});if(i.executeOperation(j.getName(),j.getParams())){d.trace("jira.editor.operation.executed")}}}else{var j=this.getEditorOperation();if(i.executeOperation(j.getName(),j.getParams())){d.trace("jira.editor.operation.executed")}}};f.prototype.getHrefFromDom=function(k,n,m){var l=n.closest(".jira-dialog");var j=g(document);if(m){j=(l&&l.length>0)?g(l[0]):g(document)}var i=j.find("a.attachment-title, .attachment-title a").filter(function(o,p){return g(p).text()===k});var h;if(i.length===0){i=j.find("span.upload-progress-bar__file-name").filter(function(o,p){return g(p).text()===k});if(i.length===0){return}h=g(i[0].parentElement).find("img").attr("src");if(!h){h=g(i[0]).closest(".attachments-upload-progress-bar").find("img").attr("src")}if(!h){h=g(i[0]).closest(".temp-upload-progress-bar__parent-container").find("img").attr("src")}}else{h=g(i[0]).attr("href")}return h};f.prototype._attachmentReceived=function(k,m,o){if(!k.isVisible()){return}var n=function(p){return p.match(c.SupportedImagesRegexp)?"image":"file"};if(o&&o.files&&o.files.length===1&&o.wikiTextfield){if(this.$wikiTextarea.get(0)===o.wikiTextfield){var j=o.files[0];var h;var i=n(j.name);if(i==="image"){h=window.URL.createObjectURL(j)}var i=this._getAttachmentRendered(j.name,h,i);var l=this.getEditorOperation({attachment:i});if(k.executeOperation(l.getName(),l.getParams())){d.trace("jira.editor.operation.executed")}}}};f.prototype.bindEvents=function(h){if(this._isAttachment()&&!this._eventHandler){this._eventHandler=this._attachmentReceived.bind(this,h);b.bind("wikiAttachmentForPageReceived.operationAttachment",this._eventHandler)}};f.prototype.unbindEvents=function(){if(this._isAttachment()&&this._eventHandler){b.unbind("wikiAttachmentForPageReceived.operationAttachment",this._eventHandler)}};return f});;
;
/* module-key = 'com.atlassian.jira.plugins.jira-editor-plugin:resources', location = 'js/wiki-adapter/wiki-toolbar-button.js' */
define("jira/richeditor/wiki-adapter/wiki-toolbar-button",["jira/richeditor/wiki-adapter/selection","jquery"],function(a,b){var d=".richEditorEvents";var c=function(i,k,g){this.bindButton=function(l){if(!i.getElement()){throw"No toolbar element found"}this.$uiEl=i.getElement();this.editor=l;this.bindSaveSelectionAndCopyText(i);var n=function(o){o.preventDefault();if(this.isDisabled()){return}i.execute(l,{element:b(o.currentTarget)});this.restoreSelection()}.bind(this);i.bindEvents(l);if(i._isAttachment()){this.$uiEl.on("click"+d,"a",n)}else{this.$uiEl.on("click"+d,n)}var m=i.getEditorOperation();l.bindOperationSelectedListener(m.getName(),this.setSelected.bind(this));this.addShortcut(l,i.getShortcut());g.on("change:all change:"+e(i.getName()),function(o){this.setDisabled(o.disableState)},this);l.on("tabs:changed",function(o){if(o){this.setSelected(false)}}.bind(this))};this.setSelected=function(l){if(this.isDisabled()){return}if(!!l!==this.isSelected()){this.$uiEl.attr("aria-pressed",l?"true":null)}};this.isSelected=function(){return !!this.$uiEl.attr("aria-pressed")};this.destroy=function(){if(this.$uiEl){this.setDisabled(false);this.$uiEl.off("click"+d);this.$uiEl.unbind("click"+d)}i.unbindEvents()};this.addShortcut=function(n,l){if(l){var o=this;n.addShortcut(l,function m(){o.$uiEl.click()})}};this.bindSaveSelectionAndCopyText=function(){var m="click";this.$uiEl.bind(m+d,this.saveSelectionAndCopyText.bind(this));var n=this.$uiEl.data("events")[m]||[];var l=n.pop();n.splice(0,0,l)};this.saveSelectionAndCopyText=function(){if(!this.editor.isVisible()||this.isDisabled()){return}this.saveSelection();var l=this.editor.getSelectedContent(true);k.val(l);k.select()};this.saveSelection=function h(){this.savedRange=a.save()};this.restoreSelection=function j(){if(this.savedRange){a.restore(this.savedRange);this.savedRange=undefined}};this.isDisabled=function f(){return this.$uiEl.attr("aria-disabled")==="true"};this.setDisabled=function(l){this.$uiEl.attr("aria-disabled",l.toString());if(l){this.$uiEl.addClass("disabled").css("pointer-events","none")}else{this.$uiEl.removeClass("disabled").css("pointer-events","auto")}}};function e(f){var g={link:"a","link-mail":"a","link-anchor":"a"};return g[f]?g[f]:f}return c});;
;
/* module-key = 'com.atlassian.jira.plugins.jira-editor-plugin:resources', location = 'js/wiki-adapter/selection.js' */
define("jira/richeditor/wiki-adapter/selection",[],function(){var e={};e.saveSelection=function(){var f=window.getSelection();if(f.rangeCount>0){return window.getSelection().getRangeAt(0)}};e.restoreSelection=function(f){if(f){var g=window.getSelection();if(g.rangeCount>0){g.removeAllRanges()}g.addRange(f)}};e.isSupported=function(){return window.getSelection!=null};var c={};c.saveSelection=function(){return document.selection.createRange()};c.restoreSelection=function(f){if(f){f.select()}};c.isSupported=function(){return document.selection!=null};var a=[e,c];var b=function(){a.forEach(function(f){if(f.isSupported()){f.saveSelection()}})};var d=function(f){a.forEach(function(g){if(g.isSupported()){g.restoreSelection(f)}})};return{save:b,restore:d}});;
;
/* module-key = 'com.atlassian.jira.plugins.jira-editor-plugin:resources', location = 'js/plugins/paste-plugin.js' */
define("jira/editor/plugins/paste",["jira/editor/tinymce","jira/editor/converter/util/strings","jira/editor/schema","jira/editor/analytics","jquery","wrm/context-path","dndattachment/ctrlv/utility","dndattachment/ctrlv/base64decode","jira/editor/wrm"],function(j,a,e,i,b,c,h,f,d){var g=d.isAttachmentsAllowed();j.create("tinymce.plugins.jira.Paste",{});j.PluginManager.add("jira.paste",j.plugins.jira.Paste);j.PluginManager.urls["jira.paste"]=true;return{configure:function(l,n){function o(p,q){if(!g){return false}if(p.match(/^(data|blob):http/)){k(p,q)}else{if(p.match(/^(data|blob):image/)){m(new Blob([f.decodeBase64DataUri(p)]),q)}}return true}function m(q,r){var p=h.convertBlobToImage(q,r);if(!h.dropFileToElement(p,l.element.$wikiTextarea)){console.warn("Uploading attachment failed. Check 'allow attachment' setting.")}}function k(q,r){var p=new XMLHttpRequest();p.open("GET",q,true);p.responseType="blob";p.onload=function(s){m(this.response,r)};p.send()}n.plugins.push("paste");n.paste_data_images=true;n.paste_preprocess=function(r,p){var q=l.contextManager.getPasteSchemaForContext();p.content=e.sanitizeHtml(p.content,l.editor,q)};n.paste_postprocess=function(t,r){i.sendEvent("editor.instance.paste");var s=b(r.node).find("img:first-child:last-child");if(s.length===1&&s.is("img")){i.sendEvent("editor.instance.paste.image");var v=s.attr("src");if(s.hasClass(".emoticon")&&a.startsWith(v,document.location.origin+c()+"/images/icons/emoticons/")){return}var q=v;if(a.isAttachmentPath(v)||a.isThumbnailPath(v)){q=a.getFilenameFromHref(v)}var u={source:v,filename:q,width:s.attr("width"),height:s.attr("height"),id:s.attr("id"),vspace:s.attr("vspace")};if(v.match(/^((data|blob):http)|(data:image)|(webkit-fake-url:\/\/)/)){q=h.generateFileName()+".png";if(o(v,q)){u.filename=q;var p=JIRA.Editor.Tags.Templates.image(u);s.replaceWith(b(p))}else{s.remove()}}else{var p=JIRA.Editor.Tags.Templates.image(u);s.replaceWith(b(p))}}else{i.sendEvent("editor.instance.paste.other")}};return n}}});;
;
/* module-key = 'com.atlassian.jira.plugins.jira-editor-plugin:resources', location = 'js/plugins/wiki-autoformat-plugin.js' */
define("jira/editor/plugins/wiki-autoformat",["jira/editor/tinymce","jira/editor/analytics","jquery","jira/util/version","jira/editor/html-renderer","jira/util/logger"],function(m,l,e,b,k,n){var c={_REGEXES_EMOTICON:{SMILE:/\B(:-?)$/,SAD:/\B(:-?)$/,CHEEKY:/\B(:-?)$/,CHEEKY_2:/\B(:-?)$/,LAUGH:/\B(:-?)$/,WINK:/\B(;-?)$/,THUMBS_UP:/\B(\(y)$/,THUMBS_DOWN:/\B(\(n)$/,INFORMATION:/\B(\(i)$/,TICK:/\B(\(\/)$/,CROSS:/\B(\(x)$/,WARNING:/\B(\(!)$/,PLUS:/\B(\(\+)$/,MINUS:/\B(\(-)$/,QUESTION:/\B(\(\?)$/,LIGHT_ON:/\B(\(on)$/,LIGHT_OFF:/\B(\(off)$/,YELLOW_STAR:/\B(\(\*)$/,YELLOW_STAR_2:/\B(\(\*y)$/,RED_STAR:/\B(\(\*r)$/,GREEN_STAR:/\B(\(\*g)$/,BLUE_STAR:/\B(\(\*b)$/,FLAG:/\B(\(flag)$/,FLAG_OFF:/\B(\(flagoff)$/,HEART:/\B(<)$/,BROKEN_HEAR:/\B(<\/)$/}};var j;function a(p){return e("<div>").append(p.cloneNode(true)).html()}function o(p,q,r){var v;var t;if(!q){throw new Error("text node is null")}if(q.nodeType!==Node.TEXT_NODE){q=q.childNodes[r-1];r=q.length}for(var u=q,s=r;u&&u.nodeType===Node.TEXT_NODE;u=u.previousSibling){if(s===-1){s=u.nodeValue.length}if(s>p){return{container:u,offset:s-p}}else{if(s===p){t=0;v=u.parentNode;while(u=u.previousSibling){t++}return{container:v,offset:t}}else{p-=s;s=-1}}}return null}function g(q){var r;var s;if(!q||!q.collapsed){throw new Error("range is null or not collapsed")}r=q.startContainer;s=q.startOffset;if(r.nodeType===Node.ELEMENT_NODE&&s>0){r=r.childNodes[q.startOffset-1];if(r.nodeType===Node.TEXT_NODE){s=r.nodeValue.length}else{return""}}else{if(r.nodeType!==Node.TEXT_NODE){return""}}var p=r.nodeValue.substring(0,s);for(var t=r.previousSibling;t&&t.nodeType===Node.TEXT_NODE;t=t.previousSibling){p=t.nodeValue+p}return p}function i(r,s,q,p){return{handles:function(x){if(typeof p==="string"){p=[p]}else{if(!p||!p.length){p=[]}}var t=false;var w=x.selection.getRng(true);var z=w.commonAncestorContainer||{};if(!w.collapsed){return false}var v=x.contextManager;if(v.isPreContextActive()){l.sendEvent("editor.instance.autoformat.prevented",{context:"pre"});return false}for(var y=0,u=p.length;y<u;++y){if(v.isContextActive(p[y])){l.sendEvent("editor.instance.autoformat.prevented",{context:p[y]});return false}}t=r.test(g(w));return t},execute:function(y,u){var v;var t;var x;var z=1;var w;var A;var B=d(u);if(B===32){y.execCommand("mceInsertContent",false,"&nbsp;")}else{y.execCommand("mceInsertContent",false,String.fromCharCode(B))}v=y.selection.getRng(true);t=g(v);if(t[t.length-1]==="|"){t+=" ";z=0}x=r.exec(t.substring(0,t.length-1));w=o(x[1].length+z,v.commonAncestorContainer,v.startOffset);v.setStart(w.container,w.offset);A=e(v.commonAncestorContainer);y.selection.setRng(v);s(x,y.selection.getRng(true));j=y.selection.getRng(true);if(q){u.preventDefault();u.stopPropagation();m.dom.Event.cancel(u);return false}}}}function d(p){return e.browser.msie?p.keyCode:p.which}function f(){this.handlers={}}f.prototype={registerHandler:function(q,p){if(!this.handlers[q]){this.handlers[q]=[]}this.handlers[q].push(p)},executeHandlers:function(s,r,q){var p=true;e.each(this.handlers[s]||[],function(t,u){if(u.handles(r)){p=u.execute(r,q);n.trace("jira.editor.wiki.autoformatted");return false}});return p}};function h(w){var x=new f();function s(H,L,G,I,E,D){var J=H.charCodeAt(0);var F=AJS.contextPath()+"/images/icons/emoticons/"+E;var K;K=i(L,function(){var M=w.dom.createHTML("img",{src:F,alt:w.getLang(I),title:w.getLang(I),border:0,"class":"emoticon emoticon-"+G,"data-emoticon-name":G,align:"absmiddle"});w.execCommand("mceInsertContent",false,M,{skip_undo:true})},true);this.imagePath=F;x.registerHandler(J,K)}var B=b.isGreaterThanOrEqualTo("7.0")?"png":"gif";var z=[new s(")",c._REGEXES_EMOTICON.SMILE,"smile","emotions_dlg.smile","smile."+B),new s("(",c._REGEXES_EMOTICON.SAD,"sad","emotions_dlg.sad","sad."+B),new s("P",c._REGEXES_EMOTICON.CHEEKY,"tongue","emotions_dlg.tongue","tongue."+B),new s("p",c._REGEXES_EMOTICON.CHEEKY_2,"cheeky","emotions_dlg.tongue","tongue."+B),new s("D",c._REGEXES_EMOTICON.LAUGH,"biggrin","emotions_dlg.biggrin","biggrin."+B),new s(")",c._REGEXES_EMOTICON.WINK,"wink","emotions_dlg.wink","wink."+B),new s(")",c._REGEXES_EMOTICON.THUMBS_UP,"thumbs_up","emotions_dlg.thumbs_up","thumbs_up."+B),new s(")",c._REGEXES_EMOTICON.THUMBS_DOWN,"thumbs_down","emotions_dlg.thumbs_down","thumbs_down."+B),new s(")",c._REGEXES_EMOTICON.INFORMATION,"information","emotions_dlg.information","information."+B),new s(")",c._REGEXES_EMOTICON.TICK,"check","emotions_dlg.check","check."+B),new s(")",c._REGEXES_EMOTICON.CROSS,"error","emotions_dlg.error","error."+B),new s(")",c._REGEXES_EMOTICON.WARNING,"warning","emotions_dlg.warning","warning."+B),new s(")",c._REGEXES_EMOTICON.PLUS,"add","emotions_dlg.add","add."+B),new s(")",c._REGEXES_EMOTICON.MINUS,"forbidden","emotions_dlg.forbidden","forbidden."+B),new s(")",c._REGEXES_EMOTICON.QUESTION,"help_16","emotions_dlg.help_16","help_16."+B),new s(")",c._REGEXES_EMOTICON.LIGHT_ON,"lightbulb_on","emotions_dlg.lightbulb_on","lightbulb_on."+B),new s(")",c._REGEXES_EMOTICON.LIGHT_OFF,"lightbulb","emotions_dlg.lightbulb","lightbulb."+B),new s(")",c._REGEXES_EMOTICON.YELLOW_STAR,"star_yellow","emotions_dlg.star_yellow","star_yellow."+B),new s(")",c._REGEXES_EMOTICON.YELLOW_STAR_2,"star_yellow","emotions_dlg.star_yellow","star_yellow."+B),new s(")",c._REGEXES_EMOTICON.RED_STAR,"star_red","emotions_dlg.star_red","star_red."+B),new s(")",c._REGEXES_EMOTICON.GREEN_STAR,"star_green","emotions_dlg.star_green","star_green."+B),new s(")",c._REGEXES_EMOTICON.BLUE_STAR,"star_blue","emotions_dlg.star_blue","star_blue."+B),new s(")",c._REGEXES_EMOTICON.FLAG,"flag","emotions_dlg.flag","flag."+B),new s(")",c._REGEXES_EMOTICON.FLAG_OFF,"flag_grey","emotions_dlg.flag_grey","flag_grey."+B)];var v=new Array();for(var t=0;t<z.length;t++){v[t]=new Image();v[t].src=z[t].imagePath}function A(G,E){var F=w.formatter.get(G)[0];var D=w.dom.create(F.inline,{style:F.styles});D.appendChild(document.createTextNode(E+"{$caret}"));w.execCommand("mceInsertContent",false,a(D),{skip_undo:true});w.formatter.remove(G)}var u={"*":"bold",_:"italic","~":"subscript","^":"superscript","+":"underline","-":"strikethrough"};e.each(u,function(D,F){var E=new RegExp("(?:[\\s\\xA0\\u200b\\uFEFF]+|^)(\\"+D+"(?=[^\\s"+D+"])([^"+D+"]*?[^\\s]))$");x.registerHandler(D.charCodeAt(0),i(E,function(G){A(F,G[2]);l.sendEvent("editor.instance.autoformat.format")},true))});w.formatter.register("code",{inline:"code"});x.registerHandler("}".charCodeAt(0),i(/(?:[\s\xA0\u200b]+|^)({{(?=[^\s])([^}]*?[^\s])})$/,function(D){A("code",D[2]);l.sendEvent("editor.instance.autoformat.inlinecode")},true));w.formatter.register("cite",{inline:"cite"});x.registerHandler("?".charCodeAt(0),i(/(?:[\s\xA0\u200b]+|^)(\?\?(?=[^\s])([^\?]*?[^\s])\?)$/,function(D){A("cite",D[2]);l.sendEvent("editor.instance.autoformat.cite")},true));for(var t=1;t<=6;t++){(function(D){x.registerHandler(" ".charCodeAt(0),i(new RegExp("^\\u200b?(h"+D+"\\.)$"),function(){w.execCommand("formatBlock",false,"h"+D,{skip_undo:true});l.sendEvent("editor.instance.autoformat.header")},true))})(t)}x.registerHandler(" ".charCodeAt(0),i(/^\u200b?(bq\.)$/,function(){w.execCommand("formatBlock",false,"blockquote",{skip_undo:true});l.sendEvent("editor.instance.autoformat.bq")},true));x.registerHandler(" ".charCodeAt(0),i(/[^-]*[\s](\-\-\-?)$/,function(D){var E=D[1].length===2?"\u2013":"\u2014";w.execCommand("mceInsertContent",false,E,{skip_undo:true});l.sendEvent("editor.instance.autoformat.dash")},false));var r=i(/(([^\s-]+)(\-\-\-?)([^\s-]+))$/,function(D){var E=D[3].length===2?"\u2013":"\u2014";w.execCommand("mceInsertContent",false,D[2]+E+D[4],{skip_undo:true})},false);x.registerHandler(" ".charCodeAt(0),r);x.registerHandler(13,r);var p=i(/^\u200b?(\-\-\-\-)$/,function(){w.execCommand("mceInsertContent",false,"<hr />",{skip_undo:true});l.sendEvent("editor.instance.autoformat.hr")},true);x.registerHandler(" ".charCodeAt(0),p);x.registerHandler(13,p);x.registerHandler("}".charCodeAt(0),i(/(\{code)$/,function(){w.execCommand("mceInsertContent",false,'<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><pre class="code-java">{$caret} </pre></div></div>');l.sendEvent("editor.instance.autoformat.code")},true));x.registerHandler("}".charCodeAt(0),i(/(\{panel)$/,function(){w.execCommand("mceInsertContent",false,'<div class="plain panel"><panel-title>'+"My title"+"</panel-title><p>{$caret} </p></div>");l.sendEvent("editor.instance.autoformat.panel")},true));x.registerHandler("}".charCodeAt(0),i(/(\{noformat)$/,function(){w.execCommand("mceInsertContent",false,'<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent"><pre>{$caret} </pre></div></div>');l.sendEvent("editor.instance.autoformat.noformat")},true));x.registerHandler(13,i(/(^\u200b?\|\|\s*(?:[^|]*\s?\|\|\s?)+$)/,function(F){var I="<table class='confluenceTable'><tr>";var H="";var D=true;var J=e(F[1].slice(2,-2).split("||")).map(function(K){K=e.trim(this);D=D&&K==="";return K});if(D){J[0]="editor.autoformat.sampletext.firstcell"}for(var G=0,E=J.length;G<E;G++){I+="<th class='confluenceTh'>"+J[G]+"</th>";H+="<td class='confluenceTd'>&#x200b;</td>"}I+="</tr><tr>"+H+"</tr></table>";w.execCommand("mceInsertContent",false,I,{skip_undo:true});w.selection.select(e(w.selection.getRng(true).commonAncestorContainer).parents("table").find(D?"th":"td")[0].childNodes[0]);e(w.selection.getRng().startContainer).parent().closest('[contenteditable="true"]').focus();l.sendEvent("editor.instance.table.autoformat.plain")},true,"table"));x.registerHandler(13,i(/(^\u200b?\|\s?(?:[^|]*\s?\|\s?)+$)/,function(F){var H="<table class='confluenceTable'><tr>";var D=true;var I=e(F[1].slice(1,-1).split("|")).map(function(J){J=e.trim(this);D=D&&J==="";return J});if(D){I[0]="editor.autoformat.sampletext.firstcell"}for(var G=0,E=I.length;G<E;G++){H+="<td class='confluenceTd'>"+I[G]+"</td>"}H+="</tr></table>";w.execCommand("mceInsertContent",false,H,{skip_undo:true});D&&w.selection.select(e(w.selection.getRng(true).commonAncestorContainer).parents("table").find("td")[0].childNodes[0]);e(w.selection.getRng().startContainer).parent().closest('[contenteditable="true"]').focus();l.sendEvent("editor.instance.table.autoformat")},true,"table"));e.each({"]":/(?:\s|^)((\[[^\[^\]]+))$/,"\r":/(?:\s|^)((\[[^\[^\]]+)(?:\]))$/," ":/(?:\s|^)((\[[^\[^\]]+)(?:\]))$/},function(D,E){x.registerHandler(D.charCodeAt(0),i(E,function(F,H){var G=F[1]+(F[1].endsWith("]")?"":"]");k.renderMarkup(G,w.settings.target.getRenderParams()).then(function(I){I=e(new DOMParser().parseFromString(I,"text/html").body).find("p").unwrap().html();w.execCommand("mceInsertContent",false,I,{skip_undo:true});l.sendEvent("editor.instance.autoformat.wikilink")})},true))});var y=i(/\b(((https?|ftp):\/\/|(www\.))[\w\.\$\-_\+!\*'\(\),/\?:@=&%#~;\[\]]+)$/,function(D){var E=D[3]?D[1]:"http://"+D[1];var F=w.dom.create("a",{href:E});F.appendChild(document.createTextNode(D[1]));w.execCommand("mceInsertContent",false,a(F),{skip_undo:true});w.getDoc().execCommand("unlink",false,{});l.sendEvent("editor.instance.autoformat.autolink")},false,"a");x.registerHandler(" ".charCodeAt(0),y);x.registerHandler(13,y);var q=i(/\b((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)$/i,function(D){var E=w.dom.create("a",{href:"mailto:"+D[1]});E.appendChild(document.createTextNode(D[1]));w.execCommand("mceInsertContent",false,a(E),{skip_undo:true});w.getDoc().execCommand("unlink",false,{})},false,"a");x.registerHandler(" ".charCodeAt(0),q);x.registerHandler(13,q);var C=function(F,E){var D=i(F,function(){w.execCommand("mceInsertContent",false,E,{skip_undo:true});l.sendEvent("editor.instance.autoformat.quickcorrect")},false);x.registerHandler(" ".charCodeAt(0),D);x.registerHandler(13,D)};C(/(?:\b|^)([Jj]ira)$/,"JIRA");C(/(?:\b|^)(bitbucket|[Bb]itBucket)$/,"Bitbucket");C(/(?:\b|^)(atlassian)$/,"Atlassian");C(/(?:\b|^)([Hh]ipchat)$/,"HipChat");w.on("keydown",function(D){return x.executeHandlers(d(D),w,D)},true);w.on("keypress",function(D){return x.executeHandlers(d(D),w,D)},true)}m.create("tinymce.plugins.jira.WikiAutoFormat",{init:function(p){p.on("init",function(){h(p)})}});m.PluginManager.add("jira.wikiautoformat",m.plugins.jira.WikiAutoFormat);m.PluginManager.urls["jira.wikiautoformat"]=true;return{configure:function(p,q){q.plugins.push("jira.wikiautoformat")}}});;
;
/* module-key = 'com.atlassian.jira.plugins.jira-editor-plugin:resources', location = 'js/plugins/prevent-default-plugin.js' */
define("jira/editor/plugins/prevent-default",["jira/editor/tinymce","jquery"],function(a,b){a.create("tinymce.plugins.jira.PreventDefaultPlugin",{init:function(c){var d=c.settings;c.on("init",function(){var f=c.getBody()._controller;if(f&&f.$textarea&&f.$textarea.get(0)){var g=f.$textarea.get(0).ownerDocument;if(g){var e=d.preventdefault.selector;b(g).on("click",e,function(h){h.preventDefault()})}}})}});a.PluginManager.add("jira.preventdefault",a.plugins.jira.PreventDefaultPlugin);a.PluginManager.urls["jira.preventdefault"]=true;return{configure:function(c,d){d.plugins.push("jira.preventdefault");d.preventdefault={selector:"a[contenteditable=false]"}}}});;
;
/* module-key = 'com.atlassian.jira.plugins.jira-editor-plugin:resources', location = 'js/plugins/editor-content-postprocess-plugin.js' */
define("jira/editor/plugins/editor-content-postprocess",["jira/editor/tinymce"],function(c){var b=function(h,g){var f=h&&h.attr("class")||"";return f.indexOf(g)>=0};var e=function(f){f.parser.addAttributeFilter("class",function(g){var h=g.length;var j;while(h--){j=g[h];if(b(j,"user-hover")){j.attr("contenteditable","false");j.attr("tabindex","-1")}}})};var d=function(f){f.parser.addNodeFilter("h1,h2,h3,h4,h5,h6",function(h){var g=function(p,i){var o=p;var q=[];for(p=o.firstChild;p;p=p.next){if(p.name===i&&!p.firstChild){q.push(p)}}return q};var l=h.length;var m;while(l--){m=h[l];var k=g(m,"a");var j=k.filter(function n(i){return typeof i.attr("name")!=="undefined"});j.forEach(function(i){i.remove()})}})};var a=function(f){f.parser.addNodeFilter("div,pre",function(g){g.forEach(function(k){if(k.parent&&k.parent.name==="pre"&&k.name!=="panel-title"){k.unwrap()}if(!k.attr("class")&&k.name==="pre"){k.unwrap()}if(!b(k,"panel")||b(k,"panelHeader")||b(k,"panelContent")){return}if(b(k,"preformatted")){k.attr("class","noformat panel")}if(k.lastChild&&k.lastChild.firstChild&&/^code/.test(k.lastChild.firstChild.attr("class"))){k.attr("data-language",k.lastChild.firstChild.attr("class"));k.attr("class","code panel")}var i=k.firstChild;if(b(i,"panelHeader")){var j=i.attr("style");i.firstChild.unwrap();i.name="panel-title";i.attr("class",j)}var h=k.lastChild;if(b(h,"panel")||b(h,"panelContent")){var j=h.attr("style");if(b(k,"noformat")||b(k,"code")){h.firstChild.unwrap()}h.unwrap()}if(b(k,"noformat")||b(k,"code")){k.name="pre"}else{k.attr("class","plain panel")}})})};c.create("tinymce.plugins.jira.EditorContentPostprocess",{init:function(f){f.on("PreInit",function(){e(f);d(f);a(f)})}});c.PluginManager.add("jira.editorcontentpostprocess",c.plugins.jira.EditorContentPostprocess);c.PluginManager.urls["jira.editorcontentpostprocess"]=true;return{configure:function(f,g){g.plugins.push("jira.editorcontentpostprocess");g.editor_content_postprocess={};return g}}});;